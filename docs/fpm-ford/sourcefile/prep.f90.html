<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="terminal text attributes">
    
    <meta name="author" content="John S. Urban" >
    <link rel="icon" href="../favicon.png">

    <title>prep.f90 &ndash; prep</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">prep </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            <li><a href="../lists/programs.html">Programs</a></li>
        
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/programs.html">Programs</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>prep.f90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title="93.5% of total for source files.">2184 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/prep.f90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
  
     <li class="active">prep.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 






<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#progs-0">Programs</a></h3></div>
  <div id="progs-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../program/prep.html">prep</a>
      
    </div>
  </div>
</div>



<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/m_expression.html">M_expression</a>
      
      <a class="list-group-item" href="../module/m_fpp.html">M_fpp</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/prep.f90.html#src">prep.f90</a>
  </div>
</div>



</div>

    </div>
    <div class="col-md-9" id='text'>
      
      <br>
    
      
      

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 






<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#progs-1">Programs</a></h3></div>
  <div id="progs-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../program/prep.html">prep</a>
      
    </div>
  </div>
</div>



<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/m_expression.html">M_expression</a>
      
      <a class="list-group-item" href="../module/m_fpp.html">M_fpp</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/prep.f90.html#src">prep.f90</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-3"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-4"></a><span class="c">!  @(#)prep: FORTRAN pre-processor</span>
<a name="ln-5"></a><span class="c">!  Fortran preprocessor originally based on public-domain FPP pre-processor from Lahey Fortran Code Repository</span>
<a name="ln-6"></a><span class="c">!     http://www.lahey.com/code.htm</span>
<a name="ln-7"></a><span class="c">!  Extensively rewritten since under a MIT License.</span>
<a name="ln-8"></a><span class="c">!     2013-10-03,2020-12-19,2021-06-12 : John S. Urban</span>
<a name="ln-9"></a><span class="c">!</span>
<a name="ln-10"></a><span class="c">! CONSIDER</span>
<a name="ln-11"></a><span class="c">! make $OUTPUT file nestable</span>
<a name="ln-12"></a><span class="c">! allow multiple files on $INCLUDE?</span>
<a name="ln-13"></a><span class="c">! undocument $BLOCK HELP|VERSION?</span>
<a name="ln-14"></a><span class="c">! %,&gt;&gt;,&lt;&lt; operators</span>
<a name="ln-15"></a><span class="c">! replace math parsing with M_calculator (but add logical operators to M_calculator)</span>
<a name="ln-16"></a><span class="c">! cpp-like procedure macros</span>
<a name="ln-17"></a><span class="c">! cpp or fpp compatibility mode</span>
<a name="ln-18"></a><span class="c">! line control  # linenumber &quot;file&quot;</span>
<a name="ln-19"></a><span class="c">! modularize and modernize calculator expression, if/else/endif</span>
<a name="ln-20"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-21"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-22"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-23"></a><span class="k">module </span><span class="n">M_expression</span>
<a name="ln-24"></a><span class="k">use </span><span class="n">M_strings</span><span class="p">,</span>   <span class="k">only</span> <span class="p">:</span> <span class="n">str_replace</span><span class="o">=&gt;</span><span class="n">replace</span>
<a name="ln-25"></a><span class="k">private</span>
<a name="ln-26"></a><span class="k">public </span><span class="n">normalize_logical_operators</span>
<a name="ln-27"></a><span class="k">contains</span>
<a name="ln-28"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-29"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-30"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-31"></a><span class="k">subroutine </span><span class="n">normalize_logical_operators</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
<a name="ln-32"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">)</span> <span class="kd">::</span> <span class="n">string</span>
<a name="ln-33"></a>
<a name="ln-34"></a>   <span class="n">string</span><span class="o">=</span><span class="n">str_replace</span><span class="p">(</span><span class="n">string</span><span class="p">,</span><span class="s1">&#39;==&#39;</span><span class="p">,</span><span class="s1">&#39;.EQ.&#39;</span><span class="p">)</span>
<a name="ln-35"></a>   <span class="n">string</span><span class="o">=</span><span class="n">str_replace</span><span class="p">(</span><span class="n">string</span><span class="p">,</span><span class="s1">&#39;/=&#39;</span><span class="p">,</span><span class="s1">&#39;.NE.&#39;</span><span class="p">)</span>
<a name="ln-36"></a>   <span class="n">string</span><span class="o">=</span><span class="n">str_replace</span><span class="p">(</span><span class="n">string</span><span class="p">,</span><span class="s1">&#39;!=&#39;</span><span class="p">,</span><span class="s1">&#39;.NE.&#39;</span><span class="p">)</span>
<a name="ln-37"></a>   <span class="n">string</span><span class="o">=</span><span class="n">str_replace</span><span class="p">(</span><span class="n">string</span><span class="p">,</span><span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span><span class="s1">&#39;.GE.&#39;</span><span class="p">)</span>
<a name="ln-38"></a>   <span class="n">string</span><span class="o">=</span><span class="n">str_replace</span><span class="p">(</span><span class="n">string</span><span class="p">,</span><span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span><span class="s1">&#39;.LE.&#39;</span><span class="p">)</span>
<a name="ln-39"></a>   <span class="n">string</span><span class="o">=</span><span class="n">str_replace</span><span class="p">(</span><span class="n">string</span><span class="p">,</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;.GT.&#39;</span><span class="p">)</span>
<a name="ln-40"></a>   <span class="n">string</span><span class="o">=</span><span class="n">str_replace</span><span class="p">(</span><span class="n">string</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;.LT.&#39;</span><span class="p">)</span>
<a name="ln-41"></a>   <span class="n">string</span><span class="o">=</span><span class="n">str_replace</span><span class="p">(</span><span class="n">string</span><span class="p">,</span><span class="s1">&#39;&amp;&amp;&#39;</span><span class="p">,</span><span class="s1">&#39;.AND.&#39;</span><span class="p">)</span>
<a name="ln-42"></a>   <span class="n">string</span><span class="o">=</span><span class="n">str_replace</span><span class="p">(</span><span class="n">string</span><span class="p">,</span><span class="s1">&#39;||&#39;</span><span class="p">,</span><span class="s1">&#39;.OR.&#39;</span><span class="p">)</span>
<a name="ln-43"></a>   <span class="n">string</span><span class="o">=</span><span class="n">str_replace</span><span class="p">(</span><span class="n">string</span><span class="p">,</span><span class="s1">&#39;!&#39;</span><span class="p">,</span><span class="s1">&#39;.NOT.&#39;</span><span class="p">)</span>
<a name="ln-44"></a>   <span class="n">string</span><span class="o">=</span><span class="n">str_replace</span><span class="p">(</span><span class="n">string</span><span class="p">,</span><span class="s1">&#39;.XOR.&#39;</span><span class="p">,</span><span class="s1">&#39;.NEQV.&#39;</span><span class="p">)</span>
<a name="ln-45"></a>
<a name="ln-46"></a><span class="k">end subroutine </span><span class="n">normalize_logical_operators</span>
<a name="ln-47"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-48"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-49"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-50"></a><span class="k">end module </span><span class="n">M_expression</span>
<a name="ln-51"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-52"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-53"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-54"></a><span class="k">module </span><span class="n">M_fpp</span>                                                              <span class="c">!@(#)M_fpp(3f): module used by prep program</span>
<a name="ln-55"></a><span class="k">USE </span><span class="n">ISO_FORTRAN_ENV</span><span class="p">,</span> <span class="k">ONLY</span> <span class="p">:</span> <span class="n">STDERR</span><span class="o">=&gt;</span><span class="n">ERROR_UNIT</span><span class="p">,</span> <span class="n">STDOUT</span><span class="o">=&gt;</span><span class="n">OUTPUT_UNIT</span><span class="p">,</span><span class="n">STDIN</span><span class="o">=&gt;</span><span class="n">INPUT_UNIT</span>
<a name="ln-56"></a><span class="k">use </span><span class="n">M_io</span><span class="p">,</span>        <span class="k">only</span> <span class="p">:</span> <span class="n">get_tmp</span><span class="p">,</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">uniq</span><span class="p">,</span> <span class="n">fileopen</span><span class="p">,</span> <span class="n">filedelete</span><span class="p">,</span> <span class="n">get_env</span>  <span class="c">! Fortran file I/O routines</span>
<a name="ln-57"></a><span class="k">use </span><span class="n">M_kracken95</span><span class="p">,</span> <span class="k">only</span> <span class="p">:</span> <span class="n">sget</span><span class="p">,</span> <span class="n">dissect</span><span class="p">,</span> <span class="n">lget</span>                                    <span class="c">! load command argument parsing module</span>
<a name="ln-58"></a><span class="k">use </span><span class="n">M_strings</span><span class="p">,</span>   <span class="k">only</span> <span class="p">:</span> <span class="n">nospace</span><span class="p">,</span> <span class="n">v2s</span><span class="p">,</span> <span class="n">substitute</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">isalpha</span><span class="p">,</span> <span class="n">split</span><span class="p">,</span> <span class="n">delim</span><span class="p">,</span> <span class="n">str_replace</span><span class="o">=&gt;</span><span class="n">replace</span><span class="p">,</span> <span class="n">sep</span><span class="p">,</span> <span class="n">atleast</span><span class="p">,</span> <span class="n">unquote</span>
<a name="ln-59"></a><span class="k">use </span><span class="n">M_strings</span><span class="p">,</span>   <span class="k">only</span> <span class="p">:</span> <span class="n">glob</span>
<a name="ln-60"></a><span class="k">use </span><span class="n">M_expression</span>
<a name="ln-61"></a><span class="k">implicit none</span>
<a name="ln-62"></a>
<a name="ln-63"></a><span class="kt">logical</span><span class="p">,</span><span class="k">save</span>                         <span class="kd">::</span> <span class="n">G_debug</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-64"></a>
<a name="ln-65"></a><span class="kt">integer</span><span class="p">,</span><span class="k">parameter</span>                    <span class="kd">::</span> <span class="n">num</span><span class="o">=</span><span class="mi">2048</span>                       <span class="c">! number of named values allowed</span>
<a name="ln-66"></a><span class="kt">integer</span><span class="p">,</span><span class="k">public</span><span class="p">,</span><span class="k">parameter</span>             <span class="kd">::</span> <span class="n">G_line_length</span><span class="o">=</span><span class="mi">4096</span>             <span class="c">! allowed length of input lines</span>
<a name="ln-67"></a><span class="kt">integer</span><span class="p">,</span><span class="k">public</span><span class="p">,</span><span class="k">parameter</span>             <span class="kd">::</span> <span class="n">G_var_len</span><span class="o">=</span><span class="mi">63</span>                   <span class="c">! allowed length of variable names</span>
<a name="ln-68"></a>
<a name="ln-69"></a><span class="kt">integer</span><span class="p">,</span><span class="k">public</span>                       <span class="kd">::</span> <span class="n">G_numdef</span><span class="o">=</span><span class="mi">0</span>                     <span class="c">! number of defined variables in dictionary</span>
<a name="ln-70"></a><span class="kt">logical</span><span class="p">,</span><span class="k">public</span>                       <span class="kd">::</span> <span class="n">G_ident</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>                <span class="c">! whether to write IDENT as a comment or CHARACTER</span>
<a name="ln-71"></a>
<a name="ln-72"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">),</span><span class="k">public</span>  <span class="kd">::</span> <span class="n">G_source</span>                       <span class="c">! original source file line</span>
<a name="ln-73"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">),</span><span class="k">public</span>  <span class="kd">::</span> <span class="n">G_outline</span>                      <span class="c">! message to build for writing to output</span>
<a name="ln-74"></a>
<a name="ln-75"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_var_len</span><span class="p">),</span><span class="k">public</span>      <span class="kd">::</span> <span class="n">G_defval</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>                  <span class="c">! variable values in variable dictionary</span>
<a name="ln-76"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_var_len</span><span class="p">),</span><span class="k">public</span>      <span class="kd">::</span> <span class="n">G_defvar</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>                  <span class="c">! variables in variable dictionary</span>
<a name="ln-77"></a>
<a name="ln-78"></a><span class="k">type </span><span class="n">file_stack</span>
<a name="ln-79"></a>   <span class="kt">integer</span>                           <span class="kd">::</span>  <span class="n">unit_number</span>
<a name="ln-80"></a>   <span class="kt">integer</span>                           <span class="kd">::</span>  <span class="n">line_number</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-81"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">)</span>      <span class="kd">::</span>  <span class="n">filename</span>
<a name="ln-82"></a><span class="k">end type</span>
<a name="ln-83"></a><span class="k">type</span><span class="p">(</span><span class="n">file_stack</span><span class="p">),</span><span class="k">public</span>              <span class="kd">::</span>  <span class="n">G_file_dictionary</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<a name="ln-84"></a>
<a name="ln-85"></a><span class="k">type </span><span class="n">parcel_stack</span>
<a name="ln-86"></a>   <span class="kt">integer</span>                           <span class="kd">::</span>  <span class="n">unit_number</span>
<a name="ln-87"></a>   <span class="kt">integer</span>                           <span class="kd">::</span>  <span class="n">line_number</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-88"></a>   <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">)</span>      <span class="kd">::</span>  <span class="n">name</span>
<a name="ln-89"></a><span class="k">end type</span>
<a name="ln-90"></a><span class="k">type</span><span class="p">(</span><span class="n">parcel_stack</span><span class="p">),</span><span class="k">public</span>            <span class="kd">::</span> <span class="n">G_parcel_dictionary</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
<a name="ln-91"></a>
<a name="ln-92"></a><span class="kt">integer</span><span class="p">,</span><span class="k">save</span>                         <span class="kd">::</span> <span class="n">G_line_number</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-93"></a><span class="kt">logical</span><span class="p">,</span><span class="k">save</span><span class="p">,</span><span class="k">public</span>                  <span class="kd">::</span> <span class="n">G_inparcel</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-94"></a><span class="kt">integer</span><span class="p">,</span><span class="k">public</span>                       <span class="kd">::</span> <span class="n">G_iocount</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-95"></a><span class="kt">integer</span><span class="p">,</span><span class="k">public</span>                       <span class="kd">::</span> <span class="n">G_parcelcount</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-96"></a><span class="kt">integer</span><span class="p">,</span><span class="k">public</span>                       <span class="kd">::</span> <span class="n">G_io_total_lines</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-97"></a><span class="kt">integer</span><span class="p">,</span><span class="k">public</span>                       <span class="kd">::</span> <span class="n">G_iwidth</span>                       <span class="c">! maximum width of line to write on output unit</span>
<a name="ln-98"></a><span class="kt">logical</span><span class="p">,</span><span class="k">public</span>                       <span class="kd">::</span> <span class="n">G_noenv</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>                <span class="c">! ignore environment variables in $IFDEF and $IFNDEF</span>
<a name="ln-99"></a>
<a name="ln-100"></a><span class="kt">integer</span><span class="p">,</span><span class="k">public</span>                       <span class="kd">::</span> <span class="n">G_iout</span>                         <span class="c">! output unit</span>
<a name="ln-101"></a><span class="kt">integer</span><span class="p">,</span><span class="k">save</span><span class="p">,</span><span class="k">public</span>                  <span class="kd">::</span> <span class="n">G_iout_init</span>                    <span class="c">! initial output unit</span>
<a name="ln-102"></a><span class="c">!integer,public                       :: G_ihelp=stderr                 ! output unit for help text</span>
<a name="ln-103"></a><span class="kt">integer</span><span class="p">,</span><span class="k">public</span>                       <span class="kd">::</span> <span class="n">G_ihelp</span><span class="o">=</span><span class="n">stdout</span>                 <span class="c">! output unit for help text</span>
<a name="ln-104"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span><span class="k">public</span>             <span class="kd">::</span> <span class="n">G_outtype</span><span class="o">=</span><span class="s1">&#39;asis&#39;</span>
<a name="ln-105"></a>
<a name="ln-106"></a><span class="kt">integer</span><span class="p">,</span><span class="k">public</span>                       <span class="kd">::</span> <span class="n">G_inc_count</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-107"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">),</span><span class="k">public</span>  <span class="kd">::</span> <span class="n">G_inc_files</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<a name="ln-108"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">save</span>    <span class="kd">::</span> <span class="n">G_MAN</span>
<a name="ln-109"></a><span class="kt">logical</span><span class="p">,</span><span class="k">save</span>                         <span class="kd">::</span> <span class="n">G_MAN_COLLECT</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-110"></a><span class="kt">logical</span><span class="p">,</span><span class="k">save</span>                         <span class="kd">::</span> <span class="n">G_MAN_PRINT</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-111"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span>         <span class="kd">::</span> <span class="n">G_MAN_FILE</span>
<a name="ln-112"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>                    <span class="kd">::</span> <span class="n">G_MAN_FILE_POSITION</span><span class="o">=</span><span class="s1">&#39;ASIS      &#39;</span>
<a name="ln-113"></a>
<a name="ln-114"></a><span class="kt">integer</span><span class="p">,</span><span class="k">public</span>                       <span class="kd">::</span> <span class="n">G_nestl</span><span class="o">=</span><span class="mi">0</span>                      <span class="c">! count of if/elseif/else/endif nesting level</span>
<a name="ln-115"></a><span class="kt">integer</span><span class="p">,</span><span class="k">public</span><span class="p">,</span><span class="k">parameter</span>             <span class="kd">::</span> <span class="n">G_nestl_max</span><span class="o">=</span><span class="mi">20</span>                 <span class="c">! maximum nesting level of conditionals</span>
<a name="ln-116"></a>
<a name="ln-117"></a><span class="kt">logical</span><span class="p">,</span><span class="k">save</span><span class="p">,</span><span class="k">public</span>                  <span class="kd">::</span> <span class="n">G_verbose</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>           <span class="c">! verbose, including write strings after @(#) like what(1).</span>
<a name="ln-118"></a><span class="kt">logical</span><span class="p">,</span><span class="k">save</span><span class="p">,</span><span class="k">public</span>                  <span class="kd">::</span> <span class="n">G_system_on</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>            <span class="c">! allow system commands or not on $SYSTEM</span>
<a name="ln-119"></a>
<a name="ln-120"></a><span class="kt">logical</span><span class="p">,</span><span class="k">public</span><span class="p">,</span><span class="k">save</span>                  <span class="kd">::</span> <span class="n">G_condop</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">G_nestl_max</span><span class="p">)</span>        <span class="c">! storage to keep track of previous write flags</span>
<a name="ln-121"></a><span class="k">data </span><span class="n">G_condop</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="n">G_nestl_max</span><span class="p">)</span> <span class="o">/</span><span class="p">.</span><span class="n">true</span><span class="p">.,</span><span class="n">G_nestl_max</span><span class="o">*</span><span class="p">.</span><span class="n">false</span><span class="p">.</span><span class="o">/</span>
<a name="ln-122"></a><span class="kt">logical</span><span class="p">,</span><span class="k">public</span>                       <span class="kd">::</span> <span class="n">G_dc</span>                           <span class="c">! flag to determine write flag</span>
<a name="ln-123"></a>
<a name="ln-124"></a><span class="kt">logical</span><span class="p">,</span><span class="k">public</span>                       <span class="kd">::</span> <span class="n">G_write</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>                 <span class="c">! whether non-if/else/endif directives should be processed</span>
<a name="ln-125"></a><span class="kt">logical</span><span class="p">,</span><span class="k">public</span>                       <span class="kd">::</span> <span class="n">G_llwrite</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>               <span class="c">! whether to write current line or skip it</span>
<a name="ln-126"></a>
<a name="ln-127"></a><span class="kt">integer</span><span class="p">,</span><span class="k">public</span>                       <span class="kd">::</span> <span class="n">G_comment_count</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-128"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span><span class="k">public</span>             <span class="kd">::</span> <span class="n">G_comment_style</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
<a name="ln-129"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">public</span>  <span class="kd">::</span> <span class="n">G_comment</span>
<a name="ln-130"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">save</span>    <span class="kd">::</span> <span class="n">G_scratch_file</span>
<a name="ln-131"></a><span class="kt">integer</span><span class="p">,</span><span class="k">save</span>                         <span class="kd">::</span> <span class="n">G_scratch_lun</span><span class="o">=-</span><span class="mi">1</span>
<a name="ln-132"></a>
<a name="ln-133"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">save</span>    <span class="kd">::</span> <span class="n">G_extract_start</span>
<a name="ln-134"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">save</span>    <span class="kd">::</span> <span class="n">G_extract_stop</span>
<a name="ln-135"></a><span class="kt">logical</span><span class="p">,</span><span class="k">save</span>                         <span class="kd">::</span> <span class="n">G_extract</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-136"></a><span class="kt">logical</span><span class="p">,</span><span class="k">save</span>                         <span class="kd">::</span> <span class="n">G_extract_auto</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-137"></a><span class="kt">logical</span><span class="p">,</span><span class="k">save</span>                         <span class="kd">::</span> <span class="n">G_extract_flag</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-138"></a>
<a name="ln-139"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span>         <span class="kd">::</span> <span class="n">keywords</span><span class="p">(:)</span>
<a name="ln-140"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span>         <span class="kd">::</span> <span class="n">values</span><span class="p">(:)</span>
<a name="ln-141"></a><span class="kt">integer</span><span class="p">,</span><span class="k">allocatable</span>                  <span class="kd">::</span> <span class="n">counts</span><span class="p">(:)</span>
<a name="ln-142"></a>
<a name="ln-143"></a><span class="k">contains</span>
<a name="ln-144"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-145"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-146"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-147"></a><span class="k">subroutine </span><span class="n">cond</span><span class="p">()</span>       <span class="c">!@(#)cond(3f): process conditional directive assumed to be in SOURCE &#39;$verb...&#39;</span>
<a name="ln-148"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">)</span> <span class="kd">::</span> <span class="n">line</span>                       <span class="c">! directive line with leading prefix character (default is $) removed</span>
<a name="ln-149"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">)</span> <span class="kd">::</span> <span class="n">verb</span>                       <span class="c">! first word of command converted to uppercase</span>
<a name="ln-150"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">)</span> <span class="kd">::</span> <span class="k">options</span>                    <span class="c">! everything after first word of command till end of line or !</span>
<a name="ln-151"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">)</span> <span class="kd">::</span> <span class="n">upopts</span>                     <span class="c">! directive line with leading prefix removed; uppercase; no spaces</span>
<a name="ln-152"></a><span class="kt">logical</span><span class="p">,</span><span class="k">save</span>                 <span class="kd">::</span> <span class="n">eb</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-153"></a><span class="kt">integer</span><span class="p">,</span><span class="k">save</span>                 <span class="kd">::</span> <span class="n">noelse</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-154"></a><span class="kt">integer</span>                      <span class="kd">::</span> <span class="n">verblen</span>
<a name="ln-155"></a><span class="kt">logical</span>                      <span class="kd">::</span> <span class="n">ifound</span>
<a name="ln-156"></a>
<a name="ln-157"></a>   <span class="n">line</span><span class="o">=</span><span class="nb">adjustl</span><span class="p">(</span><span class="n">G_source</span><span class="p">(</span><span class="mi">2</span><span class="p">:))</span>                              <span class="c">! remove leading prefix and spaces from directive line</span>
<a name="ln-158"></a>
<a name="ln-159"></a>   <span class="k">if</span> <span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">line</span><span class="o">//</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="n">G_comment</span><span class="p">).</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>               <span class="c">! assume if directive contains G_comment comment is present</span>
<a name="ln-160"></a>                                                           <span class="c">! LIMITATION: EVEN MESSAGES CANNOT CONTAIN COMMENTS</span>
<a name="ln-161"></a>      <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="p">(:</span><span class="nb">index</span><span class="p">(</span><span class="n">line</span><span class="o">//</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="n">G_comment</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>             <span class="c">! trim trailing comment from directive</span>
<a name="ln-162"></a>   <span class="k">endif</span>
<a name="ln-163"></a><span class="k">   if</span> <span class="p">(</span><span class="n">line</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="n">G_comment</span><span class="p">)</span><span class="n">line</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
<a name="ln-164"></a>
<a name="ln-165"></a>   <span class="n">verblen</span><span class="o">=</span><span class="nb">scan</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="s1">&#39; (&#39;</span><span class="p">)</span>
<a name="ln-166"></a>   <span class="k">if</span><span class="p">(</span><span class="n">verblen</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-167"></a><span class="k">      </span><span class="n">verblen</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<a name="ln-168"></a>      <span class="n">verb</span><span class="o">=</span><span class="n">line</span>
<a name="ln-169"></a>      <span class="k">options</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
<a name="ln-170"></a>   <span class="k">else</span>
<a name="ln-171"></a><span class="k">      </span><span class="n">verb</span><span class="o">=</span><span class="n">line</span><span class="p">(:</span><span class="n">verblen</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-172"></a>      <span class="k">options</span><span class="o">=</span><span class="nb">adjustl</span><span class="p">(</span><span class="n">line</span><span class="p">(</span><span class="n">verblen</span><span class="p">:))</span>
<a name="ln-173"></a>   <span class="k">endif</span>
<a name="ln-174"></a><span class="k">   </span><span class="n">verb</span><span class="o">=</span><span class="n">upper</span><span class="p">(</span><span class="n">verb</span><span class="p">)</span>
<a name="ln-175"></a>   <span class="n">upopts</span><span class="o">=</span><span class="n">nospace</span><span class="p">(</span><span class="n">upper</span><span class="p">(</span><span class="k">options</span><span class="p">))</span>                          <span class="c">! remove spaces from directive</span>
<a name="ln-176"></a>
<a name="ln-177"></a>   <span class="k">if</span><span class="p">(</span><span class="n">G_debug</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">G_verbose</span><span class="p">)</span><span class="k">then</span>                           <span class="c">! if processing lines in a logically selected region</span>
<a name="ln-178"></a>      <span class="k">write</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;G_SOURCE=&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">g_source</span><span class="p">)</span>
<a name="ln-179"></a>      <span class="k">write</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;LINE=&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<a name="ln-180"></a>      <span class="k">write</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;VERB=&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">verb</span><span class="p">)</span>
<a name="ln-181"></a>      <span class="k">write</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;OPTIONS=&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="k">options</span><span class="p">)</span>
<a name="ln-182"></a>      <span class="k">write</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;UPOPTS=&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">upopts</span><span class="p">)</span>
<a name="ln-183"></a>      <span class="k">call </span><span class="n">flushit</span><span class="p">()</span>
<a name="ln-184"></a>   <span class="k">endif</span>
<a name="ln-185"></a>
<a name="ln-186"></a><span class="k">   </span><span class="n">ifound</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-187"></a>   <span class="k">if</span><span class="p">(</span><span class="n">G_write</span><span class="p">)</span><span class="k">then</span>                                                    <span class="c">! if processing lines in a logically selected region</span>
<a name="ln-188"></a>
<a name="ln-189"></a>      <span class="k">if</span><span class="p">(</span><span class="n">G_inparcel</span><span class="p">.</span><span class="nb">and</span><span class="p">.(</span><span class="n">VERB</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="s1">&#39;PARCEL&#39;</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">VERB</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="s1">&#39;ENDPARCEL&#39;</span><span class="p">)</span> <span class="p">)</span><span class="k">then</span>
<a name="ln-190"></a><span class="k">         call </span><span class="n">write_out</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_source</span><span class="p">))</span>                               <span class="c">! write data line</span>
<a name="ln-191"></a>         <span class="k">return</span>
<a name="ln-192"></a><span class="k">      endif</span>
<a name="ln-193"></a>                                                                      <span class="c">! process the directive</span>
<a name="ln-194"></a>      <span class="k">select case</span><span class="p">(</span><span class="n">VERB</span><span class="p">)</span>
<a name="ln-195"></a>      <span class="k">case</span><span class="p">(</span><span class="s1">&#39;  &#39;</span><span class="p">)</span>                                                      <span class="c">! entire line is a comment</span>
<a name="ln-196"></a>      <span class="k">case</span><span class="p">(</span><span class="s1">&#39;DEFINE&#39;</span><span class="p">,</span><span class="s1">&#39;DEF&#39;</span><span class="p">,</span><span class="s1">&#39;LET&#39;</span><span class="p">);</span>     <span class="k">call </span><span class="n">define</span><span class="p">(</span><span class="n">upopts</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>                 <span class="c">! only process DEFINE if not skipping data lines</span>
<a name="ln-197"></a>      <span class="k">case</span><span class="p">(</span><span class="s1">&#39;REDEFINE&#39;</span><span class="p">,</span><span class="s1">&#39;REDEF&#39;</span><span class="p">);</span> <span class="k">call </span><span class="n">define</span><span class="p">(</span><span class="n">upopts</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>                 <span class="c">! only process DEFINE if not skipping data lines</span>
<a name="ln-198"></a>      <span class="k">case</span><span class="p">(</span><span class="s1">&#39;UNDEF&#39;</span><span class="p">,</span><span class="s1">&#39;UNDEFINE&#39;</span><span class="p">,</span><span class="s1">&#39;DELETE&#39;</span><span class="p">);</span> <span class="k">call </span><span class="n">undef</span><span class="p">(</span><span class="n">upper</span><span class="p">(</span><span class="k">options</span><span class="p">))</span>   <span class="c">! only process UNDEF if not skipping data lines</span>
<a name="ln-199"></a>      <span class="k">case</span><span class="p">(</span><span class="s1">&#39;INCLUDE&#39;</span><span class="p">,</span><span class="s1">&#39;READ&#39;</span><span class="p">);</span>   <span class="k">call include</span><span class="p">(</span><span class="k">options</span><span class="p">,</span><span class="mi">50</span><span class="o">+</span><span class="n">G_iocount</span><span class="p">)</span>    <span class="c">! Filenames can be case sensitive</span>
<a name="ln-200"></a>      <span class="k">case</span><span class="p">(</span><span class="s1">&#39;OUTPUT&#39;</span><span class="p">);</span>           <span class="k">call </span><span class="n">output_case</span><span class="p">(</span><span class="k">options</span><span class="p">)</span>             <span class="c">! Filenames can be case sensitive</span>
<a name="ln-201"></a>      <span class="k">case</span><span class="p">(</span><span class="s1">&#39;PARCEL&#39;</span><span class="p">);</span>           <span class="k">call </span><span class="n">parcel_case</span><span class="p">(</span><span class="n">upopts</span><span class="p">)</span>
<a name="ln-202"></a>      <span class="k">case</span><span class="p">(</span><span class="s1">&#39;ENDPARCEL&#39;</span><span class="p">);</span>        <span class="k">call </span><span class="n">parcel_case</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<a name="ln-203"></a>      <span class="k">case</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">);</span>             <span class="k">call </span><span class="n">post</span><span class="p">(</span><span class="n">upopts</span><span class="p">)</span>
<a name="ln-204"></a>      <span class="k">case</span><span class="p">(</span><span class="s1">&#39;BLOCK&#39;</span><span class="p">);</span>            <span class="k">call </span><span class="n">document</span><span class="p">(</span><span class="k">options</span><span class="p">)</span>
<a name="ln-205"></a>      <span class="k">case</span><span class="p">(</span><span class="s1">&#39;ENDBLOCK&#39;</span><span class="p">);</span>         <span class="k">call </span><span class="n">document</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<a name="ln-206"></a>      <span class="k">case</span><span class="p">(</span><span class="s1">&#39;SET&#39;</span><span class="p">);</span>              <span class="k">call </span><span class="n">set</span><span class="p">(</span><span class="k">options</span><span class="p">)</span>
<a name="ln-207"></a>      <span class="k">case</span><span class="p">(</span><span class="s1">&#39;IMPORT&#39;</span><span class="p">);</span>           <span class="k">call import</span><span class="p">(</span><span class="k">options</span><span class="p">)</span>
<a name="ln-208"></a>      <span class="k">case</span><span class="p">(</span><span class="s1">&#39;IDENT&#39;</span><span class="p">,</span><span class="s1">&#39;@(#)&#39;</span><span class="p">);</span>     <span class="k">call </span><span class="n">ident</span><span class="p">(</span><span class="k">options</span><span class="p">)</span>
<a name="ln-209"></a>      <span class="k">case</span><span class="p">(</span><span class="s1">&#39;SHOW&#39;</span><span class="p">)</span> <span class="p">;</span>            <span class="k">call </span><span class="n">debug_state</span><span class="p">(</span><span class="n">upper</span><span class="p">(</span><span class="k">options</span><span class="p">),</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-210"></a>      <span class="k">case</span><span class="p">(</span><span class="s1">&#39;SYSTEM&#39;</span><span class="p">);</span>           <span class="k">call </span><span class="n">exe</span><span class="p">()</span>
<a name="ln-211"></a>      <span class="k">case</span><span class="p">(</span><span class="s1">&#39;MESSAGE&#39;</span><span class="p">);</span>          <span class="k">call </span><span class="n">write_err</span><span class="p">(</span><span class="k">options</span><span class="p">)</span>               <span class="c">! trustingly trim MESSAGE from directive</span>
<a name="ln-212"></a>      <span class="k">case</span><span class="p">(</span><span class="s1">&#39;STOP&#39;</span><span class="p">);</span>             <span class="k">call stop</span><span class="p">(</span><span class="k">options</span><span class="p">)</span>
<a name="ln-213"></a>      <span class="k">case</span><span class="p">(</span><span class="s1">&#39;QUIT&#39;</span><span class="p">);</span>             <span class="k">call stop</span><span class="p">(</span><span class="s1">&#39;0 &#39;</span><span class="o">//</span><span class="k">options</span><span class="p">)</span>
<a name="ln-214"></a>      <span class="k">case</span><span class="p">(</span><span class="s1">&#39;ERROR&#39;</span><span class="p">);</span>            <span class="k">call stop</span><span class="p">(</span><span class="s1">&#39;1 &#39;</span><span class="o">//</span><span class="k">options</span><span class="p">)</span>
<a name="ln-215"></a>      <span class="k">CASE</span><span class="p">(</span><span class="s1">&#39;GET_ARGUMENTS&#39;</span><span class="p">);</span>    <span class="k">call </span><span class="n">write_get_arguments</span><span class="p">()</span>
<a name="ln-216"></a>      <span class="k">CASE</span><span class="p">(</span><span class="s1">&#39;HELP&#39;</span><span class="p">);</span>             <span class="k">call </span><span class="n">short_help</span><span class="p">()</span>
<a name="ln-217"></a>      <span class="k">case </span><span class="n">default</span>
<a name="ln-218"></a>         <span class="n">ifound</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-219"></a>      <span class="k">end select</span>
<a name="ln-220"></a><span class="k">   endif</span>
<a name="ln-221"></a>
<a name="ln-222"></a><span class="k">   select case</span><span class="p">(</span><span class="n">VERB</span><span class="p">)</span>                                                  <span class="c">! process logical flow control even if G_write is false</span>
<a name="ln-223"></a>   <span class="k">case</span><span class="p">(</span><span class="s1">&#39;ELSE&#39;</span><span class="p">,</span><span class="s1">&#39;ELSEIF&#39;</span><span class="p">,</span><span class="s1">&#39;ELIF&#39;</span><span class="p">);</span>  <span class="k">call else</span><span class="p">(</span><span class="n">verb</span><span class="p">,</span><span class="n">upopts</span><span class="p">,</span><span class="n">noelse</span><span class="p">,</span><span class="n">eb</span><span class="p">)</span>
<a name="ln-224"></a>   <span class="k">case</span><span class="p">(</span><span class="s1">&#39;ENDIF&#39;</span><span class="p">);</span>          <span class="k">call endif</span><span class="p">(</span><span class="n">noelse</span><span class="p">,</span><span class="n">eb</span><span class="p">)</span>
<a name="ln-225"></a>   <span class="k">case</span><span class="p">(</span><span class="s1">&#39;IF&#39;</span><span class="p">);</span>       <span class="k">call if</span><span class="p">(</span><span class="n">upopts</span><span class="p">,</span><span class="n">noelse</span><span class="p">,</span><span class="n">eb</span><span class="p">)</span>
<a name="ln-226"></a>   <span class="k">case</span><span class="p">(</span><span class="s1">&#39;IFDEF&#39;</span><span class="p">,</span><span class="s1">&#39;IFNDEF&#39;</span><span class="p">);</span> <span class="k">call </span><span class="n">def</span><span class="p">(</span><span class="n">verb</span><span class="p">,</span><span class="n">upopts</span><span class="p">,</span><span class="n">noelse</span><span class="p">,</span><span class="n">eb</span><span class="p">)</span>
<a name="ln-227"></a>   <span class="k">case </span><span class="n">default</span>
<a name="ln-228"></a>      <span class="k">if</span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">ifound</span><span class="p">)</span><span class="k">then</span>
<a name="ln-229"></a>         <span class="c">!==========================================================================================================================</span>
<a name="ln-230"></a>         <span class="c">!PROPOSAL&gt;!==================== allow assignments  name=expression by default </span>
<a name="ln-231"></a>         <span class="c">!upopts=nospace(upper(line))     ! remove spaces from directive</span>
<a name="ln-232"></a>         <span class="c">!if(index(upopts,&#39;=&#39;).gt.1.and.G_write)then  ! maybe try it as a simple expression instead; but should do it earlier</span>
<a name="ln-233"></a>         <span class="c">!                                ! to behave like fortran and not have reserved words, and only if LHS is</span>
<a name="ln-234"></a>         <span class="c">!                                ! an acceptable variable name</span>
<a name="ln-235"></a>         <span class="c">!   call define(upopts,0)        ! only process DEFINE if not skipping data lines</span>
<a name="ln-236"></a>         <span class="c">!else</span>
<a name="ln-237"></a>         <span class="c">!   call stop_prep(&#39;*prep* ERROR(001) - UNKNOWN COMPILER DIRECTIVE [&#39;//trim(verb)//&#39;]: &#39;//trim(G_SOURCE))</span>
<a name="ln-238"></a>         <span class="c">!endif</span>
<a name="ln-239"></a>         <span class="c">!PROPOSAL&lt;!====================</span>
<a name="ln-240"></a>            <span class="k">call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(001) - UNKNOWN COMPILER DIRECTIVE [&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">verb</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;]: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_SOURCE</span><span class="p">))</span>
<a name="ln-241"></a>         <span class="c">!PROPOSAL!====================</span>
<a name="ln-242"></a>         <span class="c">!==========================================================================================================================</span>
<a name="ln-243"></a>      <span class="k">endif</span>
<a name="ln-244"></a><span class="k">   end select</span>
<a name="ln-245"></a>
<a name="ln-246"></a><span class="k">end subroutine </span><span class="n">cond</span>
<a name="ln-247"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-248"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-249"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-250"></a><span class="k">subroutine </span><span class="n">exe</span><span class="p">()</span>                              <span class="c">!@(#)exe(3f): Execute the command line specified by the string COMMAND.</span>
<a name="ln-251"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">command</span>      <span class="c">! directive line with leading prefix and directive name removed</span>
<a name="ln-252"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">defineme</span>     <span class="c">! scratch string for writing a DEFINE directive in to return command status</span>
<a name="ln-253"></a><span class="kt">integer</span>                       <span class="kd">::</span> <span class="n">icmd</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-254"></a><span class="kt">integer</span>                       <span class="kd">::</span> <span class="n">cstat</span>
<a name="ln-255"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">sstat</span>
<a name="ln-256"></a>
<a name="ln-257"></a>   <span class="k">if</span><span class="p">(</span><span class="n">G_system_on</span><span class="p">)</span><span class="k">then</span>
<a name="ln-258"></a><span class="k">      </span><span class="n">command</span><span class="o">=</span><span class="nb">adjustl</span><span class="p">(</span><span class="n">G_source</span><span class="p">(</span><span class="mi">2</span><span class="p">:))</span>                                                 <span class="c">! remove $ from directive</span>
<a name="ln-259"></a>      <span class="n">command</span><span class="o">=</span><span class="n">command</span><span class="p">(</span><span class="mi">7</span><span class="p">:)</span>                                                           <span class="c">! trim SYSTEM from directive</span>
<a name="ln-260"></a>      <span class="k">if</span><span class="p">(</span><span class="n">G_verbose</span><span class="p">)</span><span class="k">then</span>
<a name="ln-261"></a><span class="k">         call </span><span class="n">write_err</span><span class="p">(</span><span class="s1">&#39;+ &#39;</span><span class="o">//</span><span class="n">command</span><span class="p">)</span>
<a name="ln-262"></a>      <span class="k">endif</span>
<a name="ln-263"></a>
<a name="ln-264"></a>      <span class="c">! not returning command status on all platforms</span>
<a name="ln-265"></a>      <span class="k">call </span><span class="nb">execute_command_line</span> <span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">exitstat</span><span class="o">=</span><span class="n">icmd</span><span class="p">,</span><span class="n">cmdstat</span><span class="o">=</span><span class="n">cstat</span><span class="p">,</span><span class="n">cmdmsg</span><span class="o">=</span><span class="n">sstat</span><span class="p">)</span> <span class="c">! execute system command</span>
<a name="ln-266"></a>
<a name="ln-267"></a>      <span class="k">if</span><span class="p">(</span><span class="n">icmd</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>                                                             <span class="c">! if system command failed exit program</span>
<a name="ln-268"></a>         <span class="k">call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(002) - SYSTEM COMMAND FAILED:&#39;</span><span class="o">//</span><span class="n">v2s</span><span class="p">(</span><span class="n">icmd</span><span class="p">))</span>
<a name="ln-269"></a>      <span class="k">endif</span>
<a name="ln-270"></a><span class="k">   else</span>
<a name="ln-271"></a><span class="k">      call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(003) - SYSTEM DIRECTIVE ENCOUNTERED BUT NOT ENABLED:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_SOURCE</span><span class="p">))</span>
<a name="ln-272"></a>   <span class="k">endif</span>
<a name="ln-273"></a>
<a name="ln-274"></a><span class="k">   write</span><span class="p">(</span><span class="n">defineme</span><span class="p">,</span><span class="s1">&#39;(&quot;CMD_STATUS=&quot;,i8)&#39;</span><span class="p">)</span><span class="n">icmd</span>
<a name="ln-275"></a>   <span class="n">defineme</span><span class="o">=</span><span class="n">nospace</span><span class="p">(</span><span class="n">defineme</span><span class="p">)</span>
<a name="ln-276"></a>   <span class="k">call </span><span class="n">define</span><span class="p">(</span><span class="n">defineme</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<a name="ln-277"></a>
<a name="ln-278"></a><span class="k">end subroutine </span><span class="n">exe</span>
<a name="ln-279"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-280"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-281"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-282"></a><span class="k">subroutine </span><span class="n">write_get_arguments</span><span class="p">()</span>                <span class="c">!@(#)write_get_arguments(3f): write block for processing M_CLI command line parsing</span>
<a name="ln-283"></a><span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span>
<a name="ln-284"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">132</span><span class="p">),</span><span class="k">parameter</span> <span class="kd">::</span> <span class="n">text</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="o">=</span><span class="p">[</span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">132</span><span class="p">)</span> <span class="kd">::</span> <span class="p">&amp;</span>
<a name="ln-285"></a><span class="s2">&quot;function get_arguments()&quot;</span>                                                                              <span class="p">,&amp;</span>
<a name="ln-286"></a><span class="s2">&quot;character(len=255)           :: message ! use for I/O error messages&quot;</span>                                  <span class="p">,&amp;</span>
<a name="ln-287"></a><span class="s2">&quot;character(len=:),allocatable :: string  ! stores command line argument&quot;</span>                                <span class="p">,&amp;</span>
<a name="ln-288"></a><span class="s2">&quot;integer                      :: get_arguments&quot;</span>                                                         <span class="p">,&amp;</span>
<a name="ln-289"></a><span class="s2">&quot;integer :: command_line_length&quot;</span>                                                                        <span class="p">,&amp;</span>
<a name="ln-290"></a><span class="s2">&quot;   call get_command(length=command_line_length)   ! get length needed to hold command&quot;</span>                 <span class="p">,&amp;</span>
<a name="ln-291"></a><span class="s2">&quot;   allocate(character(len=command_line_length) :: string)&quot;</span>                                             <span class="p">,&amp;</span>
<a name="ln-292"></a><span class="s2">&quot;   call get_command(string)&quot;</span>                                                                           <span class="p">,&amp;</span>
<a name="ln-293"></a><span class="s2">&quot;   ! trim off command name and get command line arguments&quot;</span>                                             <span class="p">,&amp;</span>
<a name="ln-294"></a><span class="s2">&quot;   string=adjustl(string)//&#39; &#39;                    ! assuming command verb does not have spaces in it&quot;</span>  <span class="p">,&amp;</span>
<a name="ln-295"></a><span class="s2">&quot;   string=string(index(string,&#39; &#39;):)&quot;</span>                                                                  <span class="p">,&amp;</span>
<a name="ln-296"></a><span class="s2">&quot;   string=&#39;&amp;cmd &#39;//string//&#39; /&#39;                   ! add namelist prefix and terminator&quot;</span>                <span class="p">,&amp;</span>
<a name="ln-297"></a><span class="s2">&quot;   read(string,nml=cmd,iostat=get_arguments,iomsg=message) ! internal read of namelist&quot;</span>                <span class="p">,&amp;</span>
<a name="ln-298"></a><span class="s2">&quot;   if(get_arguments.ne.0)then&quot;</span>                                                                         <span class="p">,&amp;</span>
<a name="ln-299"></a><span class="s2">&quot;      write(*,&#39;(&#39;&#39;ERROR:&#39;&#39;,i0,1x,a)&#39;)get_arguments, trim(message)&quot;</span>                                       <span class="p">,&amp;</span>
<a name="ln-300"></a><span class="s2">&quot;      write(*,*)&#39;COMMAND OPTIONS ARE&#39;&quot;</span>                                                                 <span class="p">,&amp;</span>
<a name="ln-301"></a><span class="s2">&quot;      write(*,nml=cmd)&quot;</span>                                                                                <span class="p">,&amp;</span>
<a name="ln-302"></a><span class="s2">&quot;      stop 1&quot;</span>                                                                                          <span class="p">,&amp;</span>
<a name="ln-303"></a><span class="s2">&quot;   endif&quot;</span>                                                                                              <span class="p">,&amp;</span>
<a name="ln-304"></a><span class="s2">&quot;end function get_arguments&quot;</span>                                                                            <span class="p">,&amp;</span>
<a name="ln-305"></a><span class="s2">&quot;&quot;</span> <span class="p">]</span>
<a name="ln-306"></a><span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<a name="ln-307"></a>   <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="nb">trim</span><span class="p">(</span><span class="n">text</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-308"></a><span class="k">enddo</span>
<a name="ln-309"></a><span class="k">end subroutine </span><span class="n">write_get_arguments</span>
<a name="ln-310"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-311"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-312"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-313"></a><span class="k">subroutine </span><span class="n">output_case</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>                                  <span class="c">!@(#)output_case(3f): process $OUTPUT directive</span>
<a name="ln-314"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">opts</span>
<a name="ln-315"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">filename</span>                     <span class="c">! filename on $OUTPUT command</span>
<a name="ln-316"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">position</span>
<a name="ln-317"></a><span class="kt">integer</span>                       <span class="kd">::</span> <span class="n">ios</span>
<a name="ln-318"></a>      <span class="k">call </span><span class="n">dissect2</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">,</span><span class="s1">&#39;-oo --append .false.&#39;</span><span class="p">,</span><span class="n">opts</span><span class="p">)</span>     <span class="c">! parse options and inline comment on input line</span>
<a name="ln-319"></a>      <span class="n">filename</span><span class="o">=</span><span class="n">sget</span><span class="p">(</span><span class="s1">&#39;output_oo&#39;</span><span class="p">)</span>
<a name="ln-320"></a>      <span class="k">select case</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<a name="ln-321"></a>      <span class="k">case</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)</span>
<a name="ln-322"></a>         <span class="n">G_iout</span><span class="o">=</span><span class="n">stdout</span>
<a name="ln-323"></a>      <span class="k">case</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>                                               <span class="c">! reset back to initial output file</span>
<a name="ln-324"></a>         <span class="k">if</span><span class="p">(</span><span class="n">G_iout</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">G_iout</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="n">G_iout_init</span><span class="p">)</span><span class="k">then</span>   <span class="c">! do not close current output if it is stdout or default output file</span>
<a name="ln-325"></a>            <span class="k">close</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">ios</span><span class="p">)</span>
<a name="ln-326"></a>         <span class="k">endif</span>
<a name="ln-327"></a><span class="k">         </span><span class="n">G_iout</span><span class="o">=</span><span class="n">G_iout_init</span>
<a name="ln-328"></a>      <span class="k">case </span><span class="n">default</span>
<a name="ln-329"></a>         <span class="n">G_iout</span><span class="o">=</span><span class="mi">61</span>
<a name="ln-330"></a>         <span class="k">close</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">ios</span><span class="p">)</span>
<a name="ln-331"></a>         <span class="k">if</span><span class="p">(</span><span class="n">lget</span><span class="p">(</span><span class="s1">&#39;output_append&#39;</span><span class="p">))</span><span class="k">then</span><span class="p">;</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;append&#39;</span><span class="p">;</span> <span class="k">else</span><span class="p">;</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;asis&#39;</span><span class="p">;</span> <span class="k">endif</span>
<a name="ln-332"></a><span class="k">         open</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">G_iout</span><span class="p">,</span><span class="k">file</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">ios</span><span class="p">,</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;write&#39;</span><span class="p">,</span><span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">)</span>
<a name="ln-333"></a>         <span class="k">if</span><span class="p">(</span><span class="n">ios</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-334"></a><span class="k">            call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(004) - FAILED TO OPEN OUTPUT FILE:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
<a name="ln-335"></a>         <span class="k">endif</span>
<a name="ln-336"></a><span class="k">      end select</span>
<a name="ln-337"></a><span class="k">   if</span><span class="p">(</span><span class="n">G_verbose</span><span class="p">)</span><span class="k">then</span>
<a name="ln-338"></a><span class="k">      call </span><span class="n">write_err</span><span class="p">(</span> <span class="s1">&#39;+ OUTPUT FILE CHANGED TO: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-339"></a>   <span class="k">endif</span>
<a name="ln-340"></a><span class="k">end subroutine </span><span class="n">output_case</span>
<a name="ln-341"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-342"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-343"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-344"></a><span class="k">subroutine </span><span class="n">parcel_case</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>                             <span class="c">!@(#)parcel_case(3f): process $PARCEL directive</span>
<a name="ln-345"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">opts</span>
<a name="ln-346"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">name</span>                 <span class="c">! name on $PARCEL command</span>
<a name="ln-347"></a><span class="kt">integer</span>                       <span class="kd">::</span> <span class="n">ios</span>
<a name="ln-348"></a><span class="kt">integer</span>                       <span class="kd">::</span> <span class="n">lun</span>
<a name="ln-349"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>            <span class="kd">::</span> <span class="n">message</span>
<a name="ln-350"></a>   <span class="k">call </span><span class="n">dissect2</span><span class="p">(</span><span class="s1">&#39;parcel&#39;</span><span class="p">,</span><span class="s1">&#39;-oo &#39;</span><span class="p">,</span><span class="n">opts</span><span class="p">)</span>  <span class="c">! parse options and inline comment on input line</span>
<a name="ln-351"></a>   <span class="n">name</span><span class="o">=</span><span class="n">sget</span><span class="p">(</span><span class="s1">&#39;parcel_oo&#39;</span><span class="p">)</span>
<a name="ln-352"></a>   <span class="k">if</span><span class="p">(</span><span class="n">name</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="k">then</span>
<a name="ln-353"></a><span class="k">      </span><span class="n">G_inparcel</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-354"></a>      <span class="n">G_iout</span><span class="o">=</span><span class="n">G_iout_init</span>
<a name="ln-355"></a>   <span class="k">else</span>
<a name="ln-356"></a><span class="k">      open</span><span class="p">(</span><span class="n">newunit</span><span class="o">=</span><span class="n">lun</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">ios</span><span class="p">,</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;readwrite&#39;</span><span class="p">,</span><span class="n">status</span><span class="o">=</span><span class="s1">&#39;scratch&#39;</span><span class="p">,</span><span class="n">iomsg</span><span class="o">=</span><span class="n">message</span><span class="p">)</span>
<a name="ln-357"></a>      <span class="k">if</span><span class="p">(</span><span class="n">ios</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-358"></a><span class="k">         call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(005) - FAILED TO OPEN PARCEL SCRATCH FILE:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">message</span><span class="p">))</span>
<a name="ln-359"></a>      <span class="k">else</span>
<a name="ln-360"></a><span class="k">         </span><span class="n">G_parcelcount</span><span class="o">=</span><span class="n">G_parcelcount</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-361"></a>         <span class="n">G_parcel_dictionary</span><span class="p">(</span><span class="n">G_parcelcount</span><span class="p">)%</span><span class="n">name</span><span class="o">=</span><span class="n">name</span>
<a name="ln-362"></a>         <span class="n">G_parcel_dictionary</span><span class="p">(</span><span class="n">G_parcelcount</span><span class="p">)%</span><span class="n">unit_number</span><span class="o">=</span><span class="n">lun</span>
<a name="ln-363"></a>         <span class="n">G_inparcel</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-364"></a>         <span class="n">G_iout</span><span class="o">=</span><span class="n">lun</span>
<a name="ln-365"></a>      <span class="k">endif</span>
<a name="ln-366"></a><span class="k">   endif</span>
<a name="ln-367"></a><span class="k">end subroutine </span><span class="n">parcel_case</span>
<a name="ln-368"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-369"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-370"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-371"></a><span class="k">subroutine </span><span class="n">ident</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>                                 <span class="c">!@(#)ident(3f): process $IDENT directive</span>
<a name="ln-372"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">opts</span>
<a name="ln-373"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">lang</span>               <span class="c">! language on $IDENT command</span>
<a name="ln-374"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span>  <span class="kd">::</span> <span class="n">text</span>
<a name="ln-375"></a><span class="kt">integer</span><span class="p">,</span><span class="k">save</span>                  <span class="kd">::</span> <span class="n">ident_count</span><span class="o">=</span><span class="mi">1</span>
<a name="ln-376"></a>
<a name="ln-377"></a>   <span class="k">call </span><span class="n">dissect2</span><span class="p">(</span><span class="s1">&#39;ident&#39;</span><span class="p">,</span><span class="s1">&#39;-oo --language fortran&#39;</span><span class="p">,</span><span class="n">opts</span><span class="p">)</span>  <span class="c">! parse options and inline comment on input line</span>
<a name="ln-378"></a>   <span class="n">text</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">sget</span><span class="p">(</span><span class="s1">&#39;ident_oo&#39;</span><span class="p">))</span>
<a name="ln-379"></a>   <span class="n">lang</span><span class="o">=</span><span class="n">sget</span><span class="p">(</span><span class="s1">&#39;ident_language&#39;</span><span class="p">)</span>
<a name="ln-380"></a>
<a name="ln-381"></a>   <span class="k">select case</span><span class="p">(</span><span class="n">lang</span><span class="p">)</span>
<a name="ln-382"></a>   <span class="k">case</span><span class="p">(</span><span class="s1">&#39;fortran&#39;</span><span class="p">)</span>    <span class="c">!x! should make look for characters not allowed in metadata, continue over multiple lines, ...</span>
<a name="ln-383"></a>      <span class="k">select case</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
<a name="ln-384"></a>      <span class="k">case</span><span class="p">(:</span><span class="mi">89</span><span class="p">)</span>
<a name="ln-385"></a>         <span class="k">if</span><span class="p">(</span><span class="n">G_ident</span><span class="p">)</span><span class="k">then</span>
<a name="ln-386"></a><span class="k">            write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(&quot;character(len=*),parameter::ident_&quot;,i0,&quot;=&quot;&quot;@(#)&quot;,a,&#39;&#39;&quot;&#39;&#39;)&#39;</span><span class="p">)</span><span class="n">ident_count</span><span class="p">,</span><span class="n">text</span>
<a name="ln-387"></a>         <span class="k">else</span>
<a name="ln-388"></a><span class="k">            write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(&quot;! ident_&quot;,i0,&quot;=&quot;&quot;@(#)&quot;,a,&#39;&#39;&quot;&#39;&#39;)&#39;</span><span class="p">)</span><span class="n">ident_count</span><span class="p">,</span><span class="n">text</span>
<a name="ln-389"></a>         <span class="k">endif</span>
<a name="ln-390"></a><span class="k">         </span><span class="n">ident_count</span><span class="o">=</span><span class="n">ident_count</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-391"></a>      <span class="k">case</span><span class="p">(</span><span class="mi">90</span><span class="p">:</span><span class="mi">126</span><span class="p">)</span>
<a name="ln-392"></a>         <span class="k">if</span><span class="p">(</span><span class="n">G_ident</span><span class="p">)</span><span class="k">then</span>
<a name="ln-393"></a><span class="k">            write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(&quot;character(len=*),parameter::ident_&quot;,i0,&quot;=&quot;&quot;&amp;&quot;)&#39;</span><span class="p">)</span><span class="n">ident_count</span>
<a name="ln-394"></a>            <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(&#39;&#39;&amp;@(#)&#39;&#39;,a,&#39;&#39;&quot;&#39;&#39;)&#39;</span><span class="p">)</span><span class="n">text</span>
<a name="ln-395"></a>         <span class="k">else</span>
<a name="ln-396"></a><span class="k">            write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(&quot;! ident_&quot;,i0,&quot;=&quot;&quot;@(#)&quot;,a,&#39;&#39;&quot;&#39;&#39;)&#39;</span><span class="p">)</span><span class="n">ident_count</span><span class="p">,</span><span class="n">text</span>
<a name="ln-397"></a>         <span class="k">endif</span>
<a name="ln-398"></a><span class="k">         </span><span class="n">ident_count</span><span class="o">=</span><span class="n">ident_count</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-399"></a>      <span class="k">case </span><span class="n">default</span>
<a name="ln-400"></a>         <span class="k">call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(006) - IDENT TOO LONG:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_SOURCE</span><span class="p">))</span>
<a name="ln-401"></a>      <span class="k">end select</span>
<a name="ln-402"></a><span class="k">   case</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">)</span>
<a name="ln-403"></a>         <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s1">&#39;#ident &quot;@(#)&#39;</span><span class="o">//</span><span class="n">text</span><span class="o">//</span><span class="s1">&#39;&quot;&#39;</span>
<a name="ln-404"></a>   <span class="k">case </span><span class="n">default</span>
<a name="ln-405"></a>         <span class="k">call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(007) - IDENT LANGUAGE UNKNOWN:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_SOURCE</span><span class="p">))</span>
<a name="ln-406"></a>   <span class="k">end select</span>
<a name="ln-407"></a>
<a name="ln-408"></a><span class="k">end subroutine </span><span class="n">ident</span>
<a name="ln-409"></a><span class="c">!==================================================================================================================================</span>
<a name="ln-410"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-411"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-412"></a><span class="k">subroutine </span><span class="n">define</span><span class="p">(</span><span class="n">allopts</span><span class="p">,</span><span class="n">ireset</span><span class="p">)</span>                           <span class="c">!@(#)define(3f): process &#39;DEFINE variablename[=expression]&#39; directive</span>
<a name="ln-413"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">allopts</span>                   <span class="c">! packed uppercase working copy of input line with leading $verb removed</span>
<a name="ln-414"></a><span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">ireset</span>                    <span class="c">! 0= can redefine variable, anything else fail on redefine</span>
<a name="ln-415"></a>
<a name="ln-416"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">)</span><span class="kd">::</span> <span class="n">temp</span>                         <span class="c">! scratch</span>
<a name="ln-417"></a><span class="kt">integer</span>                     <span class="kd">::</span> <span class="n">iequ</span>                         <span class="c">! location of &quot;=&quot; in the directive, if any</span>
<a name="ln-418"></a><span class="kt">integer</span>                     <span class="kd">::</span> <span class="n">i</span>                            <span class="c">! loop through each expression</span>
<a name="ln-419"></a><span class="kt">integer</span>                     <span class="kd">::</span> <span class="n">j</span>                            <span class="c">! index thru variable dictionary to see if variable is already defined</span>
<a name="ln-420"></a><span class="kt">integer</span>                     <span class="kd">::</span> <span class="n">iname</span>                        <span class="c">! length of variable name</span>
<a name="ln-421"></a><span class="kt">integer</span>                     <span class="kd">::</span> <span class="n">istore</span>                       <span class="c">! location of variable name in dictionary</span>
<a name="ln-422"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="k">array</span><span class="p">(:)</span>
<a name="ln-423"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">opts</span>
<a name="ln-424"></a>
<a name="ln-425"></a>   <span class="c">!x!if(allopts.eq.&#39;&#39;)then                                    ! if no options show all variables.</span>
<a name="ln-426"></a>   <span class="c">!x!   call debug_state(&#39;*&#39;,msg=&#39;&#39;)</span>
<a name="ln-427"></a>   <span class="c">!x!   return</span>
<a name="ln-428"></a>   <span class="c">!x!endif</span>
<a name="ln-429"></a>
<a name="ln-430"></a>   <span class="k">CALL </span><span class="n">split</span><span class="p">(</span><span class="n">allopts</span><span class="p">,</span><span class="k">array</span><span class="p">,</span><span class="n">delimiters</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>                 <span class="c">! parse string to an array parsing on delimiters</span>
<a name="ln-431"></a>
<a name="ln-432"></a>   <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="k">array</span><span class="p">)</span>
<a name="ln-433"></a>     <span class="n">opts</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-434"></a>     <span class="k">if</span><span class="p">(</span><span class="n">opts</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="k">cycle</span>
<a name="ln-435"></a>   <span class="c">! CHECK COMMAND SYNTAX</span>
<a name="ln-436"></a>      <span class="n">iequ</span><span class="o">=</span><span class="nb">index</span><span class="p">(</span><span class="n">opts</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>                                     <span class="c">! find &quot;=&quot; in &quot;variable_name=expression&quot; if any</span>
<a name="ln-437"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">opts</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39; &#39;</span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="n">iequ</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">opts</span><span class="p">))</span> <span class="k">then</span>     <span class="c">! no variable name in packed string or string after = is null</span>
<a name="ln-438"></a>         <span class="k">call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(008) - INCOMPLETE STATEMENT:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">opts</span><span class="p">))</span>
<a name="ln-439"></a>      <span class="k">endif</span>
<a name="ln-440"></a><span class="k">      if</span> <span class="p">(</span><span class="n">iequ</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="n">G_var_len</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>                            <span class="c">! variable name too long</span>
<a name="ln-441"></a>         <span class="k">call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(009) - MISSPELLING OR NAME LENGTH EXCEEDS &#39;</span><span class="o">//</span><span class="n">v2s</span><span class="p">(</span><span class="n">G_var_len</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; CHARACTERS:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">opts</span><span class="p">))</span>
<a name="ln-442"></a>      <span class="k">endif</span>
<a name="ln-443"></a>
<a name="ln-444"></a><span class="k">      if</span><span class="p">(</span><span class="n">iequ</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>                                        <span class="c">! find end of variable name</span>
<a name="ln-445"></a>         <span class="n">iname</span><span class="o">=</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>
<a name="ln-446"></a>      <span class="k">else</span>
<a name="ln-447"></a><span class="k">         </span><span class="n">iname</span><span class="o">=</span><span class="n">iequ</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-448"></a>      <span class="k">endif</span>
<a name="ln-449"></a>
<a name="ln-450"></a><span class="k">      call </span><span class="n">checkname</span><span class="p">(</span><span class="n">opts</span><span class="p">(:</span><span class="n">iname</span><span class="p">))</span>                             <span class="c">! check that variable name is composed of allowed characters</span>
<a name="ln-451"></a>
<a name="ln-452"></a>      <span class="n">istore</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-453"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">G_numdef</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>                                  <span class="c">! test for redefinition of defined name</span>
<a name="ln-454"></a>         <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">G_numdef</span>
<a name="ln-455"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">opts</span><span class="p">(:</span><span class="n">iname</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="n">G_defvar</span><span class="p">(</span><span class="n">j</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-456"></a><span class="k">               </span><span class="n">istore</span><span class="o">=</span><span class="n">j</span>
<a name="ln-457"></a>               <span class="k">if</span><span class="p">(</span><span class="n">ireset</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>                             <span class="c">! fail if redefinitions are not allowed on this call</span>
<a name="ln-458"></a>                  <span class="k">call </span><span class="n">warn_prep</span><span class="p">(</span><span class="s1">&#39;*prep* WARNING(010) - REDEFINITION OF DEFINED NAME :&#39;</span> <span class="p">&amp;</span>
<a name="ln-459"></a>                  <span class="p">&amp;</span> <span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_defvar</span><span class="p">(</span><span class="n">j</span><span class="p">))</span><span class="o">//</span><span class="s1">&#39;=&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="nb">adjustl</span><span class="p">(</span><span class="n">G_defval</span><span class="p">(</span><span class="n">j</span><span class="p">)))</span><span class="o">//</span><span class="s1">&#39; with &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">opts</span><span class="p">))</span>
<a name="ln-460"></a>               <span class="k">endif</span>
<a name="ln-461"></a><span class="k">            endif</span>
<a name="ln-462"></a><span class="k">         enddo</span>
<a name="ln-463"></a><span class="k">      endif</span>
<a name="ln-464"></a>
<a name="ln-465"></a><span class="k">      if</span><span class="p">(</span><span class="n">istore</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>                                      <span class="c">! new variable name</span>
<a name="ln-466"></a>         <span class="n">G_numdef</span><span class="o">=</span><span class="n">G_numdef</span><span class="o">+</span><span class="mi">1</span>                                   <span class="c">! increment number of defined variables</span>
<a name="ln-467"></a>         <span class="n">istore</span><span class="o">=</span><span class="n">G_numdef</span>
<a name="ln-468"></a>         <span class="n">temp</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
<a name="ln-469"></a>      <span class="k">endif</span>
<a name="ln-470"></a><span class="k">      if</span> <span class="p">(</span><span class="n">iequ</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>                                      <span class="c">! if no = then variable assumes value of 1</span>
<a name="ln-471"></a>         <span class="n">G_defvar</span><span class="p">(</span><span class="n">istore</span><span class="p">)</span><span class="o">=</span><span class="n">opts</span>                                 <span class="c">! store variable name from line with no =value string</span>
<a name="ln-472"></a>         <span class="n">temp</span><span class="o">=</span><span class="s1">&#39;1&#39;</span>                                              <span class="c">! set string to default value</span>
<a name="ln-473"></a>      <span class="k">else</span>                                                     <span class="c">! =value string trails name on directive</span>
<a name="ln-474"></a>         <span class="n">G_defvar</span><span class="p">(</span><span class="n">istore</span><span class="p">)</span><span class="o">=</span><span class="n">opts</span><span class="p">(:</span><span class="n">iequ</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>                        <span class="c">! store variable name from line with =value string</span>
<a name="ln-475"></a>         <span class="n">temp</span><span class="o">=</span><span class="n">opts</span><span class="p">(</span><span class="n">iequ</span><span class="o">+</span><span class="mi">1</span><span class="p">:)</span>                                    <span class="c">! get expression</span>
<a name="ln-476"></a>      <span class="k">endif</span>
<a name="ln-477"></a><span class="k">      call </span><span class="n">normalize_logical_operators</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
<a name="ln-478"></a>      <span class="k">call </span><span class="n">parens</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>                                        <span class="c">!</span>
<a name="ln-479"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">iequ</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-480"></a><span class="k">         </span><span class="n">temp</span><span class="o">=</span><span class="n">opts</span><span class="p">(:</span><span class="n">iequ</span><span class="p">)</span><span class="o">//</span><span class="n">temp</span>
<a name="ln-481"></a>      <span class="k">endif</span>
<a name="ln-482"></a>
<a name="ln-483"></a><span class="k">      call </span><span class="n">math</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="n">iequ</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>
<a name="ln-484"></a>      <span class="k">call </span><span class="n">doop</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="n">iequ</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>
<a name="ln-485"></a>      <span class="k">call </span><span class="n">logic</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="n">iequ</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>
<a name="ln-486"></a>      <span class="k">call </span><span class="n">getval</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="n">iequ</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">temp</span><span class="p">),</span><span class="n">G_defval</span><span class="p">(</span><span class="n">istore</span><span class="p">))</span>
<a name="ln-487"></a>   <span class="k">enddo</span>
<a name="ln-488"></a>
<a name="ln-489"></a><span class="k">end subroutine </span><span class="n">define</span>
<a name="ln-490"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-491"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-492"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-493"></a><span class="k">function </span><span class="n">getdate</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>         <span class="c">!@(#) getdate(3f): Function to write date and time into returned string</span>
<a name="ln-494"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">name</span>
<a name="ln-495"></a>
<a name="ln-496"></a><span class="c">! PURPOSE - Return a string with the current date and time</span>
<a name="ln-497"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">parameter</span>         <span class="kd">::</span> <span class="n">month</span><span class="o">=</span><span class="s1">&#39;JanFebMarAprMayJunJulAugSepOctNovDec&#39;</span>
<a name="ln-498"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">parameter</span>         <span class="kd">::</span> <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;(I2.2,A1,I2.2,I3,1X,A3,1x,I4)&#39;</span>
<a name="ln-499"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">parameter</span>         <span class="kd">::</span> <span class="n">cdate</span> <span class="o">=</span> <span class="s1">&#39;(A3,1X,I2.2,1X,I4.4)&#39;</span>
<a name="ln-500"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span>       <span class="kd">::</span> <span class="n">s</span>
<a name="ln-501"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>                  <span class="kd">::</span> <span class="n">line</span>
<a name="ln-502"></a><span class="kt">integer</span><span class="p">,</span><span class="k">dimension</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">v</span>
<a name="ln-503"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name_</span>
<a name="ln-504"></a>
<a name="ln-505"></a>   <span class="k">call </span><span class="nb">date_and_time</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">v</span><span class="p">)</span>
<a name="ln-506"></a>   <span class="n">name_</span><span class="o">=</span><span class="s1">&#39;prep&#39;</span>
<a name="ln-507"></a>   <span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">name</span><span class="p">))</span><span class="n">name_</span><span class="o">=</span><span class="n">name</span>
<a name="ln-508"></a>   <span class="k">select case</span><span class="p">(</span><span class="n">lower</span><span class="p">(</span><span class="n">name_</span><span class="p">))</span>
<a name="ln-509"></a>   <span class="k">case</span><span class="p">(</span><span class="s1">&#39;prep&#39;</span><span class="p">)</span> <span class="c">! PREP_DATE=&quot;00:39  5 Nov 2013&quot;</span>
<a name="ln-510"></a>   <span class="k">write</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="n">fmt</span><span class="p">)</span> <span class="n">v</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">v</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">v</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">month</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">v</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="o">*</span><span class="n">v</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-511"></a>   <span class="k">case</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
<a name="ln-512"></a>   <span class="k">write</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="s1">&#39;(i4.4,&quot;-&quot;,i2.2,&quot;-&quot;,i2.2)&#39;</span><span class="p">)</span> <span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">v</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">v</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-513"></a>   <span class="k">case</span><span class="p">(</span><span class="s1">&#39;cdate&#39;</span><span class="p">)</span>
<a name="ln-514"></a>   <span class="k">write</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="n">cdate</span><span class="p">)</span> <span class="n">month</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">v</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="o">*</span><span class="n">v</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="n">v</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-515"></a>   <span class="k">case</span><span class="p">(</span><span class="s1">&#39;long&#39;</span><span class="p">)</span>
<a name="ln-516"></a>   <span class="k">write</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="s1">&#39;(i4.4,&quot;-&quot;,i2.2,&quot;-&quot;,i2.2,&quot; &quot;,i2.2,&quot;:&quot;,i2.2,&quot;:&quot;,i2.2,&quot; UTC&quot;,sp,i0)&#39;</span><span class="p">)</span> <span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">v</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">v</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="n">v</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span><span class="n">v</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span><span class="n">v</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span><span class="n">v</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-517"></a>   <span class="k">case</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
<a name="ln-518"></a>   <span class="k">write</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="s1">&#39;(i2.2,&quot;:&quot;,i2.2,&quot;:&quot;,i2.2)&#39;</span><span class="p">)</span> <span class="n">v</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span><span class="n">v</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span><span class="n">v</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<a name="ln-519"></a>   <span class="k">case </span><span class="n">default</span>
<a name="ln-520"></a>   <span class="k">write</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="s1">&#39;(i4.4,&quot;-&quot;,i2.2,&quot;-&quot;,i2.2,&quot; &quot;,i2.2,&quot;:&quot;,i2.2,&quot;:&quot;,i2.2,&quot; UTC&quot;,sp,i0)&#39;</span><span class="p">)</span> <span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">v</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">v</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="n">v</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span><span class="n">v</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span><span class="n">v</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span><span class="n">v</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-521"></a>   <span class="k">end select</span>
<a name="ln-522"></a><span class="k">   </span><span class="n">s</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<a name="ln-523"></a><span class="k">end function </span><span class="n">getdate</span>
<a name="ln-524"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-525"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-526"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-527"></a><span class="k">subroutine </span><span class="n">checkname</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>                                                 <span class="c">!@(#)name(3f): test for legal variable name</span>
<a name="ln-528"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">line</span>
<a name="ln-529"></a><span class="kt">integer</span>                   <span class="kd">::</span> <span class="n">i</span>
<a name="ln-530"></a>
<a name="ln-531"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">line</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">).</span><span class="n">lt</span><span class="p">.</span><span class="s1">&#39;A&#39;</span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">).</span><span class="n">gt</span><span class="p">.</span><span class="s1">&#39;Z&#39;</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">).</span><span class="n">ne</span><span class="p">.</span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="k">then</span>                         <span class="c">! variable names start with a-z</span>
<a name="ln-532"></a>    <span class="k">call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s2">&quot;*prep* ERROR(016) - VARIABLE NAME DOES NOT START WITH ALPHAMERIC(OR GENERAL SYNTAX ERROR):&quot;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_source</span><span class="p">))</span>
<a name="ln-533"></a>   <span class="k">endif</span>
<a name="ln-534"></a>
<a name="ln-535"></a><span class="k">   if</span><span class="p">(</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">line</span><span class="p">).</span><span class="n">gt</span><span class="p">.</span><span class="n">G_var_len</span><span class="p">)</span><span class="k">then</span>
<a name="ln-536"></a><span class="k">     call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(017) - VARIABLE NAME EXCEEDS &#39;</span><span class="o">//</span><span class="n">v2s</span><span class="p">(</span><span class="n">G_var_len</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; CHARACTERS:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_source</span><span class="p">))</span>
<a name="ln-537"></a>   <span class="k">endif</span>
<a name="ln-538"></a>
<a name="ln-539"></a><span class="k">   do </span><span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>                                                 <span class="c">! name uses $  _ and letters (A-Z) digits (0-9)</span>
<a name="ln-540"></a>      <span class="k">if</span><span class="p">(</span><span class="n">line</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">).</span><span class="n">ne</span><span class="p">.</span><span class="s1">&#39;$&#39;</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">).</span><span class="n">ne</span><span class="p">.</span><span class="s1">&#39;_&#39;</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span>     <span class="p">&amp;</span>
<a name="ln-541"></a>      <span class="p">&amp;</span> <span class="p">(</span><span class="n">line</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">).</span><span class="n">lt</span><span class="p">.</span><span class="s1">&#39;A&#39;</span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">).</span><span class="n">gt</span><span class="p">.</span><span class="s1">&#39;Z&#39;</span><span class="p">).</span><span class="nb">and</span><span class="p">.</span>     <span class="p">&amp;</span>
<a name="ln-542"></a>      <span class="p">&amp;</span> <span class="p">(</span><span class="n">line</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">).</span><span class="n">lt</span><span class="p">.</span><span class="s1">&#39;0&#39;</span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">).</span><span class="n">gt</span><span class="p">.</span><span class="s1">&#39;9&#39;</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-543"></a><span class="k">      call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(018) - VARIABLE NAME CONTAINS UNALLOWED CHARACTER(OR GENERAL SYNTAX ERROR):&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_source</span><span class="p">))</span>
<a name="ln-544"></a>      <span class="k">endif</span>
<a name="ln-545"></a><span class="k">   enddo</span>
<a name="ln-546"></a>
<a name="ln-547"></a><span class="k">end subroutine </span><span class="n">checkname</span>
<a name="ln-548"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-549"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-550"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-551"></a><span class="k">subroutine </span><span class="n">getval</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="n">ipos1</span><span class="p">,</span><span class="n">ipos2</span><span class="p">,</span><span class="k">value</span><span class="p">)</span>     <span class="c">!@(#)getval(3f): get value from dictionary for given variable name or return input</span>
<a name="ln-552"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">line</span>                           <span class="c">! current(maybe partial) directive line</span>
<a name="ln-553"></a><span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                        <span class="kd">::</span> <span class="n">ipos1</span>                          <span class="c">! beginning position of variable name in LINE</span>
<a name="ln-554"></a><span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                        <span class="kd">::</span> <span class="n">ipos2</span>                          <span class="c">! ending position of variable name in LINE</span>
<a name="ln-555"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_var_len</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>      <span class="kd">::</span> <span class="k">value</span>                          <span class="c">! returned variable value</span>
<a name="ln-556"></a>
<a name="ln-557"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">temp</span>                              <span class="c">! copy of substring being examined</span>
<a name="ln-558"></a><span class="kt">integer</span>                                <span class="kd">::</span> <span class="n">i</span>
<a name="ln-559"></a><span class="kt">integer</span>                                <span class="kd">::</span> <span class="n">ivalue</span>
<a name="ln-560"></a>
<a name="ln-561"></a>   <span class="n">temp</span><span class="o">=</span><span class="n">line</span><span class="p">(</span><span class="n">ipos1</span><span class="p">:</span><span class="n">ipos2</span><span class="p">)</span>                                                   <span class="c">! place variable name/value substring into TEMP</span>
<a name="ln-562"></a>
<a name="ln-563"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">temp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="k">then</span>                                                <span class="c">! did not find expected variable name or value</span>
<a name="ln-564"></a>      <span class="k">call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(019) - INCOMPLETE STATEMENT.&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_SOURCE</span><span class="p">))</span>
<a name="ln-565"></a>   <span class="k">endif</span>
<a name="ln-566"></a>
<a name="ln-567"></a><span class="k">   if</span> <span class="p">(</span><span class="n">temp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">).</span><span class="n">ge</span><span class="p">.</span><span class="s1">&#39;A&#39;</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">temp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">).</span><span class="n">le</span><span class="p">.</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span> <span class="k">then</span>                          <span class="c">! appears to be a variable name (not number or logical)</span>
<a name="ln-568"></a>
<a name="ln-569"></a>     <span class="k">value</span><span class="o">=</span><span class="n">temp</span><span class="p">(:</span><span class="n">G_var_len</span><span class="p">)</span>
<a name="ln-570"></a>     <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">G_numdef</span>                                                        <span class="c">! find defined parameter in dictionary</span>
<a name="ln-571"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">G_defvar</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="k">value</span><span class="p">)</span><span class="k">exit</span>
<a name="ln-572"></a><span class="k">     enddo</span>
<a name="ln-573"></a><span class="k">     if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="n">G_numdef</span><span class="p">)</span><span class="k">then</span>                                                 <span class="c">! unknown variable name</span>
<a name="ln-574"></a>        <span class="k">call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(020) - UNDEFINED PARAMETER IN GETVAL:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_source</span><span class="p">))</span>
<a name="ln-575"></a>     <span class="k">endif</span>
<a name="ln-576"></a><span class="k">     value</span><span class="o">=</span><span class="n">G_defval</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>                                                      <span class="c">! (trusted) value for variable name found in dictionary</span>
<a name="ln-577"></a>     <span class="k">return</span>
<a name="ln-578"></a><span class="k">   else</span>                                                                     <span class="c">! not a variable name, try as a value</span>
<a name="ln-579"></a>     <span class="k">read</span><span class="p">(</span><span class="n">temp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">11</span><span class="p">),</span><span class="s1">&#39;(i11)&#39;</span><span class="p">,</span><span class="n">err</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="n">ivalue</span>                                  <span class="c">! try string as a numeric integer value</span>
<a name="ln-580"></a>     <span class="k">write</span><span class="p">(</span><span class="k">value</span><span class="p">,</span><span class="s1">&#39;(i11)&#39;</span><span class="p">)</span> <span class="n">ivalue</span>                                            <span class="c">! write numeric value into VALUE</span>
<a name="ln-581"></a>     <span class="k">return</span>                                                                 <span class="c">! successfully return numeric VALUE</span>
<a name="ln-582"></a>
<a name="ln-583"></a><span class="mi">3</span>    <span class="k">continue</span>                                                               <span class="c">! failed to read numeric value</span>
<a name="ln-584"></a>     <span class="k">value</span><span class="o">=</span><span class="n">temp</span><span class="p">(:</span><span class="n">G_var_len</span><span class="p">)</span>                                                 <span class="c">! test TEMP as a logical</span>
<a name="ln-585"></a>     <span class="k">if</span> <span class="p">(</span><span class="k">value</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="s1">&#39;.FALSE.&#39;</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="k">value</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="s1">&#39;.TRUE.&#39;</span><span class="p">)</span><span class="k">then</span>                      <span class="c">! if here, value should be a logical</span>
<a name="ln-586"></a>        <span class="k">call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(021) - SYNTAX ERROR.&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_source</span><span class="p">))</span>
<a name="ln-587"></a>     <span class="k">endif</span>
<a name="ln-588"></a>                                                                            <span class="c">! value is &quot;.TRUE.&quot; or &quot;.FALSE.&quot;</span>
<a name="ln-589"></a>   <span class="k">endif</span>
<a name="ln-590"></a>
<a name="ln-591"></a><span class="k">   if</span><span class="p">(</span><span class="n">temp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">).</span><span class="n">ge</span><span class="p">.</span><span class="s1">&#39;A&#39;</span><span class="p">)</span><span class="k">then</span>
<a name="ln-592"></a><span class="k">      call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(022) - $DEFINE VALUE MUST BE AN INTEGER OR LOGICAL CONSTANT.&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_source</span><span class="p">))</span>
<a name="ln-593"></a>   <span class="k">endif</span>
<a name="ln-594"></a>
<a name="ln-595"></a><span class="k">end subroutine </span><span class="n">getval</span>
<a name="ln-596"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-597"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-598"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-599"></a><span class="k">subroutine </span><span class="n">undef</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>                                     <span class="c">!@(#)undef(3f): process UNDEFINE directive</span>
<a name="ln-600"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">opts</span>                               <span class="c">! directive with no spaces, leading prefix removed, and all uppercase</span>
<a name="ln-601"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">names</span><span class="p">(:)</span>
<a name="ln-602"></a><span class="kt">integer</span>                     <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span>
<a name="ln-603"></a>
<a name="ln-604"></a><span class="c">! REMOVE VARIABLE IF FOUND IN VARIABLE NAME DICTIONARY</span>
<a name="ln-605"></a><span class="c">! allow basic globbing where * is any string and ? is any character</span>
<a name="ln-606"></a>   <span class="k">if</span> <span class="p">(</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">opts</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>                           <span class="c">! if no variable name</span>
<a name="ln-607"></a>      <span class="k">call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(023) - $UNDEFINE MISSING TARGETS:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_source</span><span class="p">))</span>
<a name="ln-608"></a>   <span class="k">endif</span>
<a name="ln-609"></a><span class="k">   call </span><span class="n">split</span><span class="p">(</span><span class="n">opts</span><span class="p">,</span><span class="n">names</span><span class="p">,</span><span class="n">delimiters</span><span class="o">=</span><span class="s1">&#39; ;,&#39;</span><span class="p">)</span>
<a name="ln-610"></a>
<a name="ln-611"></a>   <span class="k">do </span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
<a name="ln-612"></a>      <span class="k">if</span><span class="p">(</span><span class="n">G_verbose</span><span class="p">)</span><span class="k">then</span>
<a name="ln-613"></a><span class="k">         call </span><span class="n">write_err</span><span class="p">(</span><span class="s1">&#39;+ $UNDEFINE &#39;</span><span class="o">//</span><span class="n">names</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
<a name="ln-614"></a>      <span class="k">endif</span>
<a name="ln-615"></a><span class="k">      </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-616"></a>      <span class="k">do</span>                                                   <span class="c">! find defined variable to be undefined by searching dictionary</span>
<a name="ln-617"></a>         <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-618"></a>         <span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="n">G_numdef</span><span class="p">)</span><span class="k">exit</span>
<a name="ln-619"></a><span class="k">         if</span> <span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_defvar</span><span class="p">(</span><span class="n">i</span><span class="p">)),</span><span class="nb">trim</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">k</span><span class="p">))))</span><span class="k">then</span>   <span class="c">! found the requested variable name</span>
<a name="ln-620"></a>            <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="n">i</span><span class="p">,</span><span class="n">G_numdef</span><span class="o">-</span><span class="mi">1</span>                              <span class="c">! remove variable name and value from list of variable names and values</span>
<a name="ln-621"></a>              <span class="n">G_defvar</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">=</span><span class="n">G_defvar</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>                    <span class="c">! replace the value to be removed with the one above it and then repeat</span>
<a name="ln-622"></a>              <span class="n">G_defval</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">=</span><span class="n">G_defval</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-623"></a>            <span class="k">enddo</span>
<a name="ln-624"></a><span class="k">            </span><span class="n">G_numdef</span><span class="o">=</span><span class="n">G_numdef</span><span class="o">-</span><span class="mi">1</span>                            <span class="c">! decrement number of defined variables</span>
<a name="ln-625"></a>            <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-626"></a>         <span class="k">endif</span>
<a name="ln-627"></a><span class="k">      enddo</span>
<a name="ln-628"></a><span class="k">   enddo</span>
<a name="ln-629"></a>
<a name="ln-630"></a><span class="k">end subroutine </span><span class="n">undef</span>
<a name="ln-631"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-632"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-633"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-634"></a><span class="k">subroutine if</span><span class="p">(</span><span class="n">opts</span><span class="p">,</span><span class="n">noelse</span><span class="p">,</span><span class="n">eb</span><span class="p">)</span>                                 <span class="c">!@(#)if(3f): process IF and ELSEIF directives</span>
<a name="ln-635"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">opts</span>
<a name="ln-636"></a><span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">noelse</span>
<a name="ln-637"></a><span class="kt">logical</span>                         <span class="kd">::</span> <span class="n">eb</span>
<a name="ln-638"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_var_len</span><span class="p">)</span>     <span class="kd">::</span> <span class="k">value</span>
<a name="ln-639"></a><span class="kt">integer</span>                      <span class="kd">::</span> <span class="n">ios</span>
<a name="ln-640"></a><span class="kt">integer</span>                      <span class="kd">::</span> <span class="n">i</span>
<a name="ln-641"></a><span class="kt">integer</span>                      <span class="kd">::</span> <span class="n">ithen</span>
<a name="ln-642"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">)</span> <span class="kd">::</span> <span class="n">expression</span>                 
<a name="ln-643"></a>
<a name="ln-644"></a>   <span class="n">noelse</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-645"></a>   <span class="n">G_write</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-646"></a>
<a name="ln-647"></a>   <span class="n">G_nestl</span><span class="o">=</span><span class="n">G_nestl</span><span class="o">+</span><span class="mi">1</span>                                          <span class="c">! increment IF nest level</span>
<a name="ln-648"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">G_nestl</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="n">G_nestl_max</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-649"></a><span class="k">      call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ABORT(bh) - &quot;IF&quot; BLOCK NESTING TOO DEEP, LIMITED TO &#39;</span><span class="o">//</span><span class="n">v2s</span><span class="p">(</span><span class="n">G_nestl_max</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; LEVELS:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_source</span><span class="p">))</span>
<a name="ln-650"></a>   <span class="k">endif</span>
<a name="ln-651"></a>
<a name="ln-652"></a><span class="k">   </span><span class="n">expression</span><span class="o">=</span><span class="n">opts</span>
<a name="ln-653"></a>   <span class="n">ithen</span><span class="o">=</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>                                       <span class="c">! trim off &quot;)THEN&quot;</span>
<a name="ln-654"></a>   <span class="k">if</span><span class="p">(</span><span class="n">ithen</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span><span class="k">then</span>
<a name="ln-655"></a><span class="k">      if</span><span class="p">(</span><span class="n">expression</span><span class="p">(</span><span class="n">ithen</span><span class="o">-</span><span class="mi">4</span><span class="p">:</span><span class="n">ithen</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;)THEN&#39;</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">expression</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;(&#39;</span><span class="p">)</span><span class="k">then</span>
<a name="ln-656"></a><span class="k">         </span><span class="n">expression</span><span class="o">=</span><span class="n">expression</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="n">ithen</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span>
<a name="ln-657"></a>      <span class="k">endif</span>
<a name="ln-658"></a><span class="k">   endif</span>
<a name="ln-659"></a>
<a name="ln-660"></a><span class="k">   </span><span class="n">FIND_DEFINED</span><span class="p">:</span> <span class="k">do</span>                                               <span class="c">! find and reduce all DEFINED() functions to &quot;.TRUE.&quot; or &quot;.FALSE.&quot;</span>
<a name="ln-661"></a>      <span class="k">if</span> <span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span><span class="s1">&#39;DEFINED(&#39;</span><span class="p">).</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>                 <span class="c">! find a DEFINED() function</span>
<a name="ln-662"></a>         <span class="k">call </span><span class="n">ifdefined</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span><span class="nb">index</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span><span class="s1">&#39;DEFINED(&#39;</span><span class="p">))</span>  <span class="c">! reduce DEFINED() function that was found</span>
<a name="ln-663"></a>         <span class="n">expression</span><span class="o">=</span><span class="n">nospace</span><span class="p">(</span><span class="n">expression</span><span class="p">)</span>                           <span class="c">! remove any spaces from rewritten expression</span>
<a name="ln-664"></a>         <span class="k">cycle</span>                                                    <span class="c">! look for another DEFINED() function</span>
<a name="ln-665"></a>      <span class="k">endif</span>
<a name="ln-666"></a><span class="k">      exit</span>                                                        <span class="c">! no remaining DEFINED() functions so exit loop</span>
<a name="ln-667"></a>   <span class="k">enddo </span><span class="n">FIND_DEFINED</span>
<a name="ln-668"></a>
<a name="ln-669"></a>   <span class="k">call </span><span class="n">normalize_logical_operators</span><span class="p">(</span><span class="n">expression</span><span class="p">)</span>
<a name="ln-670"></a>   <span class="k">call </span><span class="n">parens</span><span class="p">(</span><span class="n">expression</span><span class="p">)</span>
<a name="ln-671"></a>   <span class="k">if</span> <span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>                            <span class="c">! if line should be a variable only</span>
<a name="ln-672"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">expression</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">).</span><span class="n">ge</span><span class="p">.</span><span class="s1">&#39;A&#39;</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">expression</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">).</span><span class="n">le</span><span class="p">.</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span> <span class="k">then</span>  <span class="c">! check that variable name starts with a valid character</span>
<a name="ln-673"></a>         <span class="k">call </span><span class="n">checkname</span><span class="p">(</span><span class="n">expression</span><span class="p">)</span>                        <span class="c">! check that expression contains only a legitimate variable name</span>
<a name="ln-674"></a>         <span class="k">value</span><span class="o">=</span><span class="n">expression</span><span class="p">(:</span><span class="n">G_var_len</span><span class="p">)</span>                      <span class="c">! set VALUE to variable name</span>
<a name="ln-675"></a>         <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">G_numdef</span>                                   <span class="c">! find variable in variable dictionary</span>
<a name="ln-676"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">G_defvar</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="k">value</span><span class="p">)</span> <span class="k">exit</span>
<a name="ln-677"></a><span class="k">         enddo</span>
<a name="ln-678"></a><span class="k">         if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="n">G_numdef</span><span class="p">)</span> <span class="k">then</span>                           <span class="c">! if failed to find variable name</span>
<a name="ln-679"></a>            <span class="k">call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(024) - UNDEFINED PARAMETER IN IF:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_source</span><span class="p">))</span>
<a name="ln-680"></a>         <span class="k">endif</span>
<a name="ln-681"></a><span class="k">         read</span><span class="p">(</span><span class="n">G_defval</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="s1">&#39;(l4)&#39;</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">ios</span><span class="p">)</span> <span class="n">G_dc</span>          <span class="c">! convert variable value to a logical</span>
<a name="ln-682"></a>         <span class="k">if</span><span class="p">(</span><span class="n">ios</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-683"></a><span class="k">            call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(025) - CONSTANT LOGICAL EXPRESSION REQUIRED.&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_source</span><span class="p">))</span>
<a name="ln-684"></a>         <span class="k">endif</span>
<a name="ln-685"></a><span class="k">      else</span>                                                 <span class="c">! this should have been a variable name</span>
<a name="ln-686"></a>         <span class="k">call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(026) - CONSTANT LOGICAL EXPRESSION REQUIRED:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_source</span><span class="p">))</span>
<a name="ln-687"></a>      <span class="k">endif</span>
<a name="ln-688"></a><span class="k">   else</span>                                                    <span class="c">! a period is present in the expression so it needs evaluated</span>
<a name="ln-689"></a>      <span class="k">call </span><span class="n">eval</span><span class="p">(</span><span class="n">expression</span><span class="p">)</span>                                <span class="c">! evaluate line</span>
<a name="ln-690"></a>   <span class="k">endif</span>
<a name="ln-691"></a><span class="k">   if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">G_dc</span><span class="p">.</span><span class="nb">or</span><span class="p">..</span><span class="nb">not</span><span class="p">.</span><span class="n">G_condop</span><span class="p">(</span><span class="n">G_nestl</span><span class="o">-</span><span class="mi">1</span><span class="p">).</span><span class="nb">or</span><span class="p">.</span><span class="n">eb</span><span class="p">)</span><span class="k">then</span>
<a name="ln-692"></a><span class="k">      return</span>                                               <span class="c">! check to make sure previous IF was true</span>
<a name="ln-693"></a>   <span class="k">endif</span>
<a name="ln-694"></a><span class="k">   </span><span class="n">G_condop</span><span class="p">(</span><span class="n">G_nestl</span><span class="p">)</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-695"></a>   <span class="n">G_write</span><span class="o">=</span><span class="n">G_condop</span><span class="p">(</span><span class="n">G_nestl</span><span class="p">)</span>
<a name="ln-696"></a><span class="k">end subroutine if</span>
<a name="ln-697"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-698"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-699"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-700"></a><span class="k">subroutine </span><span class="n">def</span><span class="p">(</span><span class="n">verb</span><span class="p">,</span><span class="n">opts</span><span class="p">,</span><span class="n">noelse</span><span class="p">,</span><span class="n">eb</span><span class="p">)</span>                  <span class="c">!@(#)def(3f): process IFDEF and IFNDEF directives</span>
<a name="ln-701"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">verb</span>
<a name="ln-702"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">opts</span>
<a name="ln-703"></a><span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">noelse</span>
<a name="ln-704"></a><span class="kt">logical</span>                      <span class="kd">::</span> <span class="n">eb</span>
<a name="ln-705"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_var_len</span><span class="p">)</span>     <span class="kd">::</span> <span class="k">value</span>
<a name="ln-706"></a><span class="kt">integer</span>                      <span class="kd">::</span> <span class="n">i</span>
<a name="ln-707"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">varvalue</span>
<a name="ln-708"></a>
<a name="ln-709"></a>   <span class="n">noelse</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-710"></a>   <span class="n">G_write</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-711"></a>   <span class="n">G_nestl</span><span class="o">=</span><span class="n">G_nestl</span><span class="o">+</span><span class="mi">1</span>                                 <span class="c">! increment IF nest level</span>
<a name="ln-712"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">G_nestl</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="n">G_nestl_max</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-713"></a><span class="k">      call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ABORT(bh) - &quot;IF&quot; BLOCK NESTING TOO DEEP, LIMITED TO &#39;</span><span class="o">//</span><span class="n">v2s</span><span class="p">(</span><span class="n">G_nestl_max</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; LEVELS:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_source</span><span class="p">))</span>
<a name="ln-714"></a>   <span class="k">endif</span>
<a name="ln-715"></a><span class="k">   call </span><span class="n">checkname</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>                              <span class="c">! check that opts contains only a legitimate variable name</span>
<a name="ln-716"></a>   <span class="k">value</span><span class="o">=</span><span class="n">opts</span>                                        <span class="c">! set VALUE to variable name</span>
<a name="ln-717"></a>   <span class="n">G_dc</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>                                       <span class="c">! initialize</span>
<a name="ln-718"></a>   <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">G_numdef</span>                                   <span class="c">! find variable in variable dictionary</span>
<a name="ln-719"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">G_defvar</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="k">value</span><span class="p">)</span> <span class="k">exit</span>
<a name="ln-720"></a><span class="k">   enddo</span>
<a name="ln-721"></a><span class="k">   if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="n">G_numdef</span><span class="p">)</span> <span class="k">then</span>                           <span class="c">! if failed to find variable name</span>
<a name="ln-722"></a>      <span class="n">G_dc</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-723"></a>   <span class="k">endif</span>
<a name="ln-724"></a><span class="k">   if</span><span class="p">((.</span><span class="nb">not</span><span class="p">.</span><span class="n">G_noenv</span><span class="p">).</span><span class="nb">and</span><span class="p">.(.</span><span class="nb">not</span><span class="p">.</span><span class="n">G_dc</span><span class="p">))</span><span class="k">then</span>            <span class="c">! if not found in variable dictionary check environment variables if allowed</span>
<a name="ln-725"></a>      <span class="n">varvalue</span><span class="o">=</span><span class="n">get_env</span><span class="p">(</span><span class="k">value</span><span class="p">)</span>
<a name="ln-726"></a>      <span class="k">if</span><span class="p">(</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">varvalue</span><span class="p">).</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-727"></a><span class="k">         </span><span class="n">G_dc</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-728"></a>      <span class="k">endif</span>
<a name="ln-729"></a><span class="k">   endif</span>
<a name="ln-730"></a><span class="k">   if</span><span class="p">(</span><span class="n">verb</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;IFNDEF&#39;</span><span class="p">)</span><span class="k">then</span>
<a name="ln-731"></a><span class="k">      </span><span class="n">G_dc</span><span class="o">=</span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="n">G_dc</span>
<a name="ln-732"></a>   <span class="k">endif</span>
<a name="ln-733"></a><span class="k">   if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">G_dc</span><span class="p">.</span><span class="nb">or</span><span class="p">..</span><span class="nb">not</span><span class="p">.</span><span class="n">G_condop</span><span class="p">(</span><span class="n">G_nestl</span><span class="o">-</span><span class="mi">1</span><span class="p">).</span><span class="nb">or</span><span class="p">.</span><span class="n">eb</span><span class="p">)</span><span class="k">then</span>
<a name="ln-734"></a><span class="k">      return</span>                                               <span class="c">! check to make sure previous IFDEF or IFNDEF was true</span>
<a name="ln-735"></a>   <span class="k">endif</span>
<a name="ln-736"></a><span class="k">   </span><span class="n">G_condop</span><span class="p">(</span><span class="n">G_nestl</span><span class="p">)</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-737"></a>   <span class="n">G_write</span><span class="o">=</span><span class="n">G_condop</span><span class="p">(</span><span class="n">G_nestl</span><span class="p">)</span>
<a name="ln-738"></a><span class="k">end subroutine </span><span class="n">def</span>
<a name="ln-739"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-740"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-741"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-742"></a><span class="k">subroutine </span><span class="n">ifdefined</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="n">ipos1</span><span class="p">)</span>                         <span class="c">!@(#)ifdefined(3f): process and reduce DEFINED() function that was found</span>
<a name="ln-743"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">line</span>
<a name="ln-744"></a><span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                   <span class="kd">::</span> <span class="n">ipos1</span>
<a name="ln-745"></a>
<a name="ln-746"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">newl</span>
<a name="ln-747"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_var_len</span><span class="p">),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">ifvars</span><span class="p">(:)</span>
<a name="ln-748"></a><span class="kt">integer</span>                              <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span>
<a name="ln-749"></a>   <span class="k">if</span><span class="p">(</span><span class="n">G_debug</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">G_verbose</span><span class="p">)</span><span class="k">then</span>
<a name="ln-750"></a><span class="k">      write</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;*IFDEF* TOP&#39;</span>
<a name="ln-751"></a>      <span class="k">write</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;        LINE=&#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<a name="ln-752"></a>      <span class="k">call </span><span class="n">flushit</span><span class="p">()</span>
<a name="ln-753"></a>   <span class="k">endif</span>
<a name="ln-754"></a>
<a name="ln-755"></a><span class="k">   </span><span class="n">newl</span><span class="o">=</span><span class="n">line</span><span class="p">(</span><span class="n">ipos1</span><span class="o">+</span><span class="mi">7</span><span class="p">:)</span> <span class="c">! defined(</span>
<a name="ln-756"></a>
<a name="ln-757"></a>   <span class="k">if</span> <span class="p">(</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">newl</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="mf">1.</span><span class="nb">or</span><span class="p">.</span><span class="nb">index</span><span class="p">(</span><span class="n">newl</span><span class="p">,</span><span class="s1">&#39;)&#39;</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="mf">0.</span><span class="nb">or</span><span class="p">.</span> <span class="nb">index</span><span class="p">(</span><span class="n">newl</span><span class="p">,</span><span class="s1">&#39;)&#39;</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span><span class="k">then</span>
<a name="ln-758"></a><span class="k">      call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s2">&quot;*prep* ERROR(027) - INCOMPLETE STATEMENT.&quot;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_SOURCE</span><span class="p">))</span>
<a name="ln-759"></a>   <span class="k">endif</span>
<a name="ln-760"></a>
<a name="ln-761"></a><span class="k">   </span><span class="n">G_dc</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-762"></a>   <span class="n">line</span><span class="p">(</span><span class="n">ipos1</span><span class="p">:</span><span class="n">ipos1</span><span class="o">+</span><span class="mi">6</span><span class="o">+</span><span class="nb">index</span><span class="p">(</span><span class="n">newl</span><span class="p">,</span><span class="s1">&#39;)&#39;</span><span class="p">))</span><span class="o">=</span><span class="s1">&#39;.TRUE.&#39;</span>
<a name="ln-763"></a>   <span class="n">ifvars</span><span class="o">=</span> <span class="n">sep</span><span class="p">(</span><span class="n">newl</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="nb">index</span><span class="p">(</span><span class="n">newl</span><span class="p">,</span><span class="s1">&#39;)&#39;</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
<a name="ln-764"></a>
<a name="ln-765"></a>   <span class="n">LIST</span><span class="p">:</span> <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">ifvars</span><span class="p">)</span>
<a name="ln-766"></a>
<a name="ln-767"></a>      <span class="k">call </span><span class="n">checkname</span><span class="p">(</span><span class="n">ifvars</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>                          <span class="c">! test for legal variable name</span>
<a name="ln-768"></a>      <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">G_numdef</span>                                    <span class="c">! sequentially search for variable in variable dictionary</span>
<a name="ln-769"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">G_defvar</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="n">ifvars</span><span class="p">(</span><span class="n">j</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-770"></a><span class="k">          cycle </span><span class="n">LIST</span>
<a name="ln-771"></a>        <span class="k">endif</span>
<a name="ln-772"></a><span class="k">      enddo</span>
<a name="ln-773"></a><span class="k">      </span><span class="n">G_dc</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-774"></a>      <span class="n">line</span><span class="p">(</span><span class="n">ipos1</span><span class="p">:</span><span class="n">ipos1</span><span class="o">+</span><span class="mi">6</span><span class="o">+</span><span class="nb">index</span><span class="p">(</span><span class="n">newl</span><span class="p">,</span><span class="s1">&#39;)&#39;</span><span class="p">))</span><span class="o">=</span><span class="s1">&#39;.FALSE.&#39;</span>
<a name="ln-775"></a>      <span class="k">if</span><span class="p">(</span><span class="n">G_debug</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">G_verbose</span><span class="p">)</span><span class="k">then</span>
<a name="ln-776"></a><span class="k">              write</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;*IFDEF* FALSE  LINE=&#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">line</span><span class="p">),</span><span class="s1">&#39; for &#39;</span><span class="p">,</span><span class="n">ifvars</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-777"></a>         <span class="k">call </span><span class="n">flushit</span><span class="p">()</span>
<a name="ln-778"></a>      <span class="k">endif</span>
<a name="ln-779"></a><span class="k">      exit </span><span class="n">LIST</span>
<a name="ln-780"></a>
<a name="ln-781"></a>   <span class="k">enddo </span><span class="n">LIST</span>
<a name="ln-782"></a>   <span class="k">if</span><span class="p">(</span><span class="n">G_debug</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">G_verbose</span><span class="p">)</span><span class="k">then</span>
<a name="ln-783"></a><span class="k">      write</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;*IFDEF* BOTTOM&#39;</span>
<a name="ln-784"></a>      <span class="k">write</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;        G_DC=&#39;</span><span class="p">,</span><span class="n">G_dc</span>
<a name="ln-785"></a>      <span class="k">call </span><span class="n">flushit</span><span class="p">()</span>
<a name="ln-786"></a>   <span class="k">endif</span>
<a name="ln-787"></a>
<a name="ln-788"></a><span class="k">end subroutine </span><span class="n">ifdefined</span>
<a name="ln-789"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-790"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-791"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-792"></a><span class="k">subroutine else</span><span class="p">(</span><span class="n">verb</span><span class="p">,</span><span class="n">opts</span><span class="p">,</span><span class="n">noelse</span><span class="p">,</span><span class="n">eb</span><span class="p">)</span>                       <span class="c">!@(#)else(3f): process else and elseif</span>
<a name="ln-793"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">verb</span>
<a name="ln-794"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">opts</span>
<a name="ln-795"></a><span class="kt">integer</span>                       <span class="kd">::</span> <span class="n">noelse</span>
<a name="ln-796"></a><span class="kt">integer</span>                       <span class="kd">::</span> <span class="n">ithen</span>
<a name="ln-797"></a><span class="kt">logical</span>                       <span class="kd">::</span> <span class="n">eb</span>
<a name="ln-798"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">expression</span>
<a name="ln-799"></a>
<a name="ln-800"></a>   <span class="k">if</span><span class="p">(</span><span class="n">G_debug</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">G_verbose</span><span class="p">)</span><span class="k">then</span>
<a name="ln-801"></a><span class="k">      write</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;*ELSE* TOP&#39;</span>
<a name="ln-802"></a>      <span class="k">write</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;        G_NESTL =&#39;</span><span class="p">,</span><span class="n">g_nestl</span>
<a name="ln-803"></a>      <span class="k">write</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;        EB      =&#39;</span><span class="p">,</span><span class="n">eb</span>
<a name="ln-804"></a>      <span class="k">write</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;        NOELSE  =&#39;</span><span class="p">,</span><span class="n">noelse</span>
<a name="ln-805"></a>      <span class="k">write</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;        G_WRITE =&#39;</span><span class="p">,</span><span class="n">g_write</span>
<a name="ln-806"></a>      <span class="k">write</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;        G_CONDOP=&#39;</span><span class="p">,</span><span class="n">g_condop</span>
<a name="ln-807"></a>      <span class="k">call </span><span class="n">flushit</span><span class="p">()</span>
<a name="ln-808"></a>   <span class="k">endif</span>
<a name="ln-809"></a>
<a name="ln-810"></a><span class="k">   </span><span class="n">expression</span><span class="o">=</span><span class="n">opts</span>
<a name="ln-811"></a>   <span class="n">ithen</span><span class="o">=</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>  <span class="c">! trim off &quot;)THEN&quot;</span>
<a name="ln-812"></a>   <span class="k">if</span><span class="p">(</span><span class="n">ithen</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span><span class="k">then</span>
<a name="ln-813"></a><span class="k">      if</span><span class="p">(</span><span class="n">expression</span><span class="p">(</span><span class="n">ithen</span><span class="o">-</span><span class="mi">4</span><span class="p">:</span><span class="n">ithen</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;)THEN&#39;</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">expression</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;(&#39;</span><span class="p">)</span><span class="k">then</span>
<a name="ln-814"></a><span class="k">         </span><span class="n">expression</span><span class="o">=</span><span class="n">expression</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="n">ithen</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span>
<a name="ln-815"></a>      <span class="k">endif</span>
<a name="ln-816"></a><span class="k">   endif</span>
<a name="ln-817"></a>
<a name="ln-818"></a><span class="k">   if</span><span class="p">(</span><span class="n">noelse</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mf">1.</span><span class="nb">or</span><span class="p">.</span><span class="n">G_nestl</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>                    <span class="c">! test for else instead of elseif</span>
<a name="ln-819"></a>      <span class="k">call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s2">&quot;*prep* ERROR(031) - MISPLACED $ELSE OR $ELSEIF DIRECTIVE:&quot;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_SOURCE</span><span class="p">))</span>
<a name="ln-820"></a>   <span class="k">endif</span>
<a name="ln-821"></a><span class="k">   if</span><span class="p">(</span><span class="n">verb</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;ELSE&#39;</span><span class="p">)</span><span class="k">then</span>
<a name="ln-822"></a><span class="k">      </span><span class="n">noelse</span><span class="o">=</span><span class="mi">1</span>
<a name="ln-823"></a>   <span class="k">endif</span>
<a name="ln-824"></a><span class="k">   if</span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">G_condop</span><span class="p">(</span><span class="n">G_nestl</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="k">return</span>                      <span class="c">! if was true so ignore else</span>
<a name="ln-825"></a>   <span class="n">eb</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-826"></a>   <span class="k">if</span><span class="p">(</span><span class="n">G_condop</span><span class="p">(</span><span class="n">G_nestl</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-827"></a><span class="k">       </span><span class="n">eb</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-828"></a>       <span class="n">G_write</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-829"></a>   <span class="n">elseif</span><span class="p">(</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">expression</span><span class="p">).</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>                   <span class="c">! elseif detected</span>
<a name="ln-830"></a>     <span class="n">G_nestl</span><span class="o">=</span><span class="n">G_nestl</span><span class="o">-</span><span class="mi">1</span>                                     <span class="c">! decrease if level because it will be incremented in subroutine if</span>
<a name="ln-831"></a>     <span class="k">call if</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span><span class="n">noelse</span><span class="p">,</span><span class="n">eb</span><span class="p">)</span>
<a name="ln-832"></a>   <span class="k">else</span>                                                    <span class="c">! else detected</span>
<a name="ln-833"></a>     <span class="n">G_condop</span><span class="p">(</span><span class="n">G_nestl</span><span class="p">)</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-834"></a>     <span class="n">G_write</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-835"></a>   <span class="k">endif</span>
<a name="ln-836"></a>
<a name="ln-837"></a><span class="k">   if</span><span class="p">(</span><span class="n">G_debug</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">G_verbose</span><span class="p">)</span><span class="k">then</span>
<a name="ln-838"></a><span class="k">      write</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;*ELSE* BOTTOM&#39;</span>
<a name="ln-839"></a>      <span class="k">write</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;        G_NESTL =&#39;</span><span class="p">,</span><span class="n">g_nestl</span>
<a name="ln-840"></a>      <span class="k">write</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;        EB      =&#39;</span><span class="p">,</span><span class="n">eb</span>
<a name="ln-841"></a>      <span class="k">write</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;        NOELSE  =&#39;</span><span class="p">,</span><span class="n">noelse</span>
<a name="ln-842"></a>      <span class="k">write</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;        G_WRITE =&#39;</span><span class="p">,</span><span class="n">g_write</span>
<a name="ln-843"></a>      <span class="k">write</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;        G_CONDOP=&#39;</span><span class="p">,</span><span class="n">g_condop</span>
<a name="ln-844"></a>      <span class="k">call </span><span class="n">flushit</span><span class="p">()</span>
<a name="ln-845"></a>   <span class="k">endif</span>
<a name="ln-846"></a><span class="k">end subroutine else</span>
<a name="ln-847"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-848"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-849"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-850"></a><span class="k">subroutine endif</span><span class="p">(</span><span class="n">noelse</span><span class="p">,</span><span class="n">eb</span><span class="p">)</span>                             <span class="c">!@(#)endif(3f): process ENDIF directive</span>
<a name="ln-851"></a><span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">noelse</span>
<a name="ln-852"></a><span class="kt">logical</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">eb</span>
<a name="ln-853"></a>
<a name="ln-854"></a>   <span class="k">if</span><span class="p">(</span><span class="n">G_debug</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">G_verbose</span><span class="p">)</span><span class="k">then</span>
<a name="ln-855"></a><span class="k">      write</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;*ENDIF* TOP&#39;</span>
<a name="ln-856"></a>      <span class="k">write</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;        G_NESTL =&#39;</span><span class="p">,</span><span class="n">g_nestl</span>
<a name="ln-857"></a>      <span class="k">write</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;        EB      =&#39;</span><span class="p">,</span><span class="n">eb</span>
<a name="ln-858"></a>      <span class="k">write</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;        NOELSE  =&#39;</span><span class="p">,</span><span class="n">noelse</span>
<a name="ln-859"></a>      <span class="k">write</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;        G_WRITE =&#39;</span><span class="p">,</span><span class="n">g_write</span>
<a name="ln-860"></a>      <span class="k">write</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;        G_CONDOP=&#39;</span><span class="p">,</span><span class="n">g_condop</span>
<a name="ln-861"></a>      <span class="k">call </span><span class="n">flushit</span><span class="p">()</span>
<a name="ln-862"></a>   <span class="k">endif</span>
<a name="ln-863"></a>
<a name="ln-864"></a>   <span class="c">! if no ELSE or ELSEIF present insert ELSE to simplify logic</span>
<a name="ln-865"></a>   <span class="k">if</span><span class="p">(</span><span class="n">noelse</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-866"></a><span class="k">      call else</span><span class="p">(</span><span class="s1">&#39;ELSE&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="n">noelse</span><span class="p">,</span><span class="n">eb</span><span class="p">)</span>
<a name="ln-867"></a>   <span class="k">endif</span>
<a name="ln-868"></a>
<a name="ln-869"></a><span class="k">   </span><span class="n">G_nestl</span><span class="o">=</span><span class="n">G_nestl</span><span class="o">-</span><span class="mi">1</span>                                           <span class="c">! decrease if level</span>
<a name="ln-870"></a>
<a name="ln-871"></a>   <span class="k">if</span><span class="p">(</span><span class="n">G_nestl</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-872"></a><span class="k">      call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s2">&quot;*prep* ERROR(032) - MISPLACED $ENDIF DIRECTIVE:&quot;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_source</span><span class="p">))</span>
<a name="ln-873"></a>   <span class="k">endif</span>
<a name="ln-874"></a>
<a name="ln-875"></a><span class="k">   </span><span class="n">noelse</span><span class="o">=</span><span class="mi">0</span>                                                    <span class="c">! reset else level</span>
<a name="ln-876"></a>   <span class="n">eb</span><span class="o">=</span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="n">G_condop</span><span class="p">(</span><span class="n">G_nestl</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-877"></a>   <span class="n">G_write</span><span class="o">=</span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="n">eb</span>
<a name="ln-878"></a>   <span class="n">G_condop</span><span class="p">(</span><span class="n">G_nestl</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-879"></a>
<a name="ln-880"></a>   <span class="k">if</span><span class="p">(</span><span class="n">G_nestl</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-881"></a><span class="k">      </span><span class="n">G_write</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-882"></a>      <span class="n">eb</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-883"></a>   <span class="k">endif</span>
<a name="ln-884"></a>
<a name="ln-885"></a><span class="k">   if</span><span class="p">(</span><span class="n">G_debug</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">G_verbose</span><span class="p">)</span><span class="k">then</span>
<a name="ln-886"></a><span class="k">      write</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;*ENDIF* BOTTOM&#39;</span>
<a name="ln-887"></a>      <span class="k">write</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;        G_NESTL =&#39;</span><span class="p">,</span><span class="n">g_nestl</span>
<a name="ln-888"></a>      <span class="k">write</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;        EB      =&#39;</span><span class="p">,</span><span class="n">eb</span>
<a name="ln-889"></a>      <span class="k">write</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;        NOELSE  =&#39;</span><span class="p">,</span><span class="n">noelse</span>
<a name="ln-890"></a>      <span class="k">write</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;        G_WRITE =&#39;</span><span class="p">,</span><span class="n">g_write</span>
<a name="ln-891"></a>      <span class="k">write</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;        G_CONDOP=&#39;</span><span class="p">,</span><span class="n">g_condop</span>
<a name="ln-892"></a>      <span class="k">call </span><span class="n">flushit</span><span class="p">()</span>
<a name="ln-893"></a>   <span class="k">endif</span>
<a name="ln-894"></a>
<a name="ln-895"></a><span class="k">end subroutine endif</span>
<a name="ln-896"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-897"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-898"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-899"></a><span class="k">subroutine </span><span class="n">parens</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>                       <span class="c">!@(#)parens(3f): find subexpressions in parenthesis and process them</span>
<a name="ln-900"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">line</span>       <span class="c">! line        -</span>
<a name="ln-901"></a><span class="kt">integer</span>                         <span class="kd">::</span> <span class="n">i</span>
<a name="ln-902"></a><span class="kt">integer</span>                         <span class="kd">::</span> <span class="n">j</span>
<a name="ln-903"></a>
<a name="ln-904"></a>   <span class="n">TILLDONE</span><span class="p">:</span> <span class="k">do</span>
<a name="ln-905"></a><span class="k">      if</span> <span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="s1">&#39;)&#39;</span><span class="p">).</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>          <span class="c">! closing parens found</span>
<a name="ln-906"></a>         <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="nb">index</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="s1">&#39;)&#39;</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span>            <span class="c">! find first right paren, then backwards to left paren (find innermost set of parens)</span>
<a name="ln-907"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">line</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;(&#39;</span><span class="p">)</span> <span class="k">exit</span>
<a name="ln-908"></a><span class="k">         enddo</span>
<a name="ln-909"></a><span class="k">         if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-910"></a><span class="k">            call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s2">&quot;*prep* ERROR(033) - CONSTANT LOGICAL EXPRESSION REQUIRED:&quot;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_source</span><span class="p">))</span>
<a name="ln-911"></a>         <span class="k">endif</span>
<a name="ln-912"></a><span class="k">         call </span><span class="n">math</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">index</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="s1">&#39;)&#39;</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-913"></a>         <span class="k">call </span><span class="n">doop</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">index</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="s1">&#39;)&#39;</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-914"></a>         <span class="k">call </span><span class="n">logic</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">index</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="s1">&#39;)&#39;</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-915"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mf">1.</span><span class="nb">and</span><span class="p">.</span><span class="nb">index</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="s1">&#39;)&#39;</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">line</span><span class="p">))</span> <span class="k">then</span>          <span class="c">! rewrite line after no more parens</span>
<a name="ln-916"></a>            <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="nb">index</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="s1">&#39;)&#39;</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-917"></a>         <span class="n">elseif</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>                                            <span class="c">! rewrite line after first set of parens</span>
<a name="ln-918"></a>            <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="nb">index</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="s1">&#39;)&#39;</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="n">line</span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="s1">&#39;)&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:)</span>
<a name="ln-919"></a>         <span class="n">elseif</span> <span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="s1">&#39;)&#39;</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">line</span><span class="p">))</span> <span class="k">then</span>                 <span class="c">! rewrite line after last set of parens on line</span>
<a name="ln-920"></a>
<a name="ln-921"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">line</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;-&#39;</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="nb">index</span><span class="p">(</span><span class="s1">&#39;*/+-&#39;</span><span class="p">,</span><span class="n">line</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)).</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-922"></a><span class="k">               do </span><span class="n">j</span><span class="o">=</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-923"></a>                  <span class="k">if</span> <span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="s1">&#39;*/+-&#39;</span><span class="p">,</span><span class="n">line</span><span class="p">(</span><span class="n">j</span><span class="p">:</span><span class="n">j</span><span class="p">)).</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">exit</span>
<a name="ln-924"></a><span class="k">               enddo</span>
<a name="ln-925"></a>               <span class="c">!if (j.eq.i-2) then</span>
<a name="ln-926"></a>               <span class="c">!   call stop_prep(&quot;*prep* 1**(-1) NOT IMPLEMENTED YET&quot;)</span>
<a name="ln-927"></a>               <span class="c">!endif</span>
<a name="ln-928"></a>
<a name="ln-929"></a>               <span class="k">select case</span> <span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="s1">&#39;*/+-&#39;</span><span class="p">,</span><span class="n">line</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span>
<a name="ln-930"></a>               <span class="k">case</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-931"></a>                  <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-932"></a><span class="k">                     </span><span class="n">line</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="o">//</span><span class="n">line</span><span class="p">(:</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="n">line</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="nb">index</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="s1">&#39;)&#39;</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-933"></a>                  <span class="k">else</span>
<a name="ln-934"></a><span class="k">                     </span><span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="p">(:</span><span class="n">j</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;(-&#39;</span><span class="o">//</span><span class="n">line</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="n">line</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="nb">index</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="s1">&#39;)&#39;</span><span class="p">))</span>
<a name="ln-935"></a>                  <span class="k">endif</span>
<a name="ln-936"></a><span class="k">               case</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-937"></a>                  <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="p">(:</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;-&#39;</span><span class="o">//</span><span class="n">line</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="nb">index</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="s1">&#39;)&#39;</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-938"></a>               <span class="k">case</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-939"></a>                  <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="p">(:</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;+&#39;</span><span class="o">//</span><span class="n">line</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="nb">index</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="s1">&#39;)&#39;</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-940"></a>               <span class="k">case </span><span class="n">default</span>
<a name="ln-941"></a>               <span class="k">end select</span>
<a name="ln-942"></a><span class="k">            else</span>
<a name="ln-943"></a><span class="k">               </span><span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="p">(:</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="n">line</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="nb">index</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="s1">&#39;)&#39;</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-944"></a>            <span class="k">endif</span>
<a name="ln-945"></a><span class="k">         </span><span class="n">elseif</span> <span class="p">(</span><span class="n">line</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;-&#39;</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="nb">index</span><span class="p">(</span><span class="s1">&#39;*/+-&#39;</span><span class="p">,</span><span class="n">line</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)).</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-946"></a><span class="k">            do </span><span class="n">j</span><span class="o">=</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-947"></a>               <span class="k">if</span> <span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="s1">&#39;*/+-&#39;</span><span class="p">,</span><span class="n">line</span><span class="p">(</span><span class="n">j</span><span class="p">:</span><span class="n">j</span><span class="p">)).</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">exit</span>
<a name="ln-948"></a><span class="k">            enddo</span>
<a name="ln-949"></a>            <span class="c">!if (j.eq.i-2) then</span>
<a name="ln-950"></a>            <span class="c">!   !call stop_prep(&quot;*prep* 1**(-1) Not Implemented Yet&quot;)</span>
<a name="ln-951"></a>            <span class="c">!endif</span>
<a name="ln-952"></a>
<a name="ln-953"></a>            <span class="k">select case</span> <span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="s1">&#39;*/+-&#39;</span><span class="p">,</span><span class="n">line</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span>
<a name="ln-954"></a>            <span class="k">case</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-955"></a>               <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-956"></a><span class="k">                  </span><span class="n">line</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="o">//</span><span class="n">line</span><span class="p">(:</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="n">line</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="nb">index</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="s1">&#39;)&#39;</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="n">line</span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="s1">&#39;)&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:)</span>
<a name="ln-957"></a>               <span class="k">else</span>
<a name="ln-958"></a><span class="k">                  </span><span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="p">(:</span><span class="n">j</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;(-&#39;</span><span class="o">//</span><span class="n">line</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="n">line</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="nb">index</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="s1">&#39;)&#39;</span><span class="p">))</span><span class="o">//</span><span class="n">line</span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="s1">&#39;)&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:)</span>
<a name="ln-959"></a>               <span class="k">endif</span>
<a name="ln-960"></a><span class="k">            case</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-961"></a>               <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="p">(:</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;-&#39;</span><span class="o">//</span><span class="n">line</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="nb">index</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="s1">&#39;)&#39;</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="n">line</span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="s1">&#39;)&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:)</span>
<a name="ln-962"></a>            <span class="k">case</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-963"></a>               <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="p">(:</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;+&#39;</span><span class="o">//</span><span class="n">line</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="nb">index</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="s1">&#39;)&#39;</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="n">line</span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="s1">&#39;)&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:)</span>
<a name="ln-964"></a>            <span class="k">case </span><span class="n">default</span>
<a name="ln-965"></a>            <span class="k">end select</span>
<a name="ln-966"></a><span class="k">         else</span>
<a name="ln-967"></a><span class="k">            </span><span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="p">(:</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="n">line</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="nb">index</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="s1">&#39;)&#39;</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="n">line</span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="s1">&#39;)&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:)</span>
<a name="ln-968"></a>         <span class="k">endif</span>
<a name="ln-969"></a><span class="k">      </span><span class="n">line</span><span class="o">=</span><span class="n">nospace</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<a name="ln-970"></a>      <span class="k">cycle </span><span class="n">TILLDONE</span>
<a name="ln-971"></a>   <span class="n">elseif</span> <span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="s1">&#39;(&#39;</span><span class="p">).</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-972"></a><span class="k">      call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(034) - CONSTANT LOGICAL EXPRESSION REQUIRED:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_source</span><span class="p">))</span>
<a name="ln-973"></a>   <span class="k">endif</span>
<a name="ln-974"></a><span class="k">   exit</span>
<a name="ln-975"></a><span class="k">   enddo </span><span class="n">TILLDONE</span>
<a name="ln-976"></a><span class="k">end subroutine </span><span class="n">parens</span>
<a name="ln-977"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-978"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-979"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-980"></a><span class="k">subroutine </span><span class="n">math</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="n">ipos1</span><span class="p">,</span><span class="n">ipos2</span><span class="p">)</span>                             <span class="c">!@(#)math(3f):</span>
<a name="ln-981"></a><span class="kt">integer</span>                               <span class="kd">::</span> <span class="n">ipos1</span>
<a name="ln-982"></a><span class="kt">integer</span>                               <span class="kd">::</span> <span class="n">ipos2</span>
<a name="ln-983"></a><span class="kt">integer</span>                               <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span>
<a name="ln-984"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">line</span>
<a name="ln-985"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">newl</span>
<a name="ln-986"></a>
<a name="ln-987"></a>   <span class="n">newl</span><span class="o">=</span><span class="n">line</span><span class="p">(</span><span class="n">ipos1</span><span class="p">:</span><span class="n">ipos2</span><span class="p">)</span>
<a name="ln-988"></a>   <span class="n">i</span><span class="o">=</span><span class="mi">1</span>
<a name="ln-989"></a>
<a name="ln-990"></a>   <span class="k">do</span>
<a name="ln-991"></a><span class="k">      </span><span class="n">j</span><span class="o">=</span><span class="nb">index</span><span class="p">(</span><span class="n">newl</span><span class="p">(</span><span class="n">i</span><span class="p">:),</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<a name="ln-992"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mf">0.</span><span class="nb">and</span><span class="p">.</span><span class="n">j</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-993"></a><span class="k">         call </span><span class="n">domath</span><span class="p">(</span><span class="n">newl</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">j</span><span class="o">+</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-994"></a>         <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="n">j</span>
<a name="ln-995"></a>      <span class="n">elseif</span> <span class="p">(</span><span class="n">j</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-996"></a><span class="k">         </span><span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-997"></a>      <span class="k">else</span>
<a name="ln-998"></a><span class="k">         call </span><span class="n">domath</span><span class="p">(</span><span class="n">newl</span><span class="p">(</span><span class="n">i</span><span class="p">:),</span><span class="n">ipos2</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-999"></a>         <span class="k">exit</span>
<a name="ln-1000"></a><span class="k">      endif</span>
<a name="ln-1001"></a><span class="k">   enddo</span>
<a name="ln-1002"></a>
<a name="ln-1003"></a><span class="k">   </span><span class="n">line</span><span class="p">(</span><span class="n">ipos1</span><span class="p">:</span><span class="n">ipos2</span><span class="p">)</span><span class="o">=</span><span class="n">newl</span>
<a name="ln-1004"></a>   <span class="n">line</span><span class="o">=</span><span class="n">nospace</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<a name="ln-1005"></a>
<a name="ln-1006"></a><span class="k">end subroutine </span><span class="n">math</span>
<a name="ln-1007"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1008"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-1009"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1010"></a><span class="k">subroutine </span><span class="n">domath</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="n">ipos2</span><span class="p">)</span>            <span class="c">!@(#)domath(3f): reduce integer expression containing  +-/* and ** operators</span>
<a name="ln-1011"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">)</span>                <span class="kd">::</span> <span class="n">line</span>
<a name="ln-1012"></a><span class="kt">integer</span>                         <span class="kd">::</span> <span class="n">ipos2</span>
<a name="ln-1013"></a>
<a name="ln-1014"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">temp</span>
<a name="ln-1015"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">newl</span>
<a name="ln-1016"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span><span class="k">save</span>           <span class="kd">::</span> <span class="n">ops</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">=</span> <span class="p">(</span><span class="o">/</span><span class="s1">&#39;**&#39;</span><span class="p">,</span><span class="s1">&#39;*/&#39;</span><span class="p">,</span><span class="s1">&#39;+-&#39;</span><span class="o">/</span><span class="p">)</span>
<a name="ln-1017"></a><span class="kt">integer</span>                         <span class="kd">::</span> <span class="n">i</span>
<a name="ln-1018"></a><span class="kt">integer</span>                         <span class="kd">::</span> <span class="n">j</span>
<a name="ln-1019"></a><span class="kt">integer</span>                         <span class="kd">::</span> <span class="nb">loc</span>
<a name="ln-1020"></a><span class="kt">integer</span>                         <span class="kd">::</span> <span class="n">minus1</span>
<a name="ln-1021"></a><span class="kt">integer</span>                         <span class="kd">::</span> <span class="n">i1</span>
<a name="ln-1022"></a><span class="kt">integer</span>                         <span class="kd">::</span> <span class="n">i2</span>
<a name="ln-1023"></a><span class="kt">integer</span>                         <span class="kd">::</span> <span class="n">l</span>
<a name="ln-1024"></a><span class="kt">integer</span>                         <span class="kd">::</span> <span class="nb">len</span>
<a name="ln-1025"></a><span class="kt">integer</span>                         <span class="kd">::</span> <span class="n">numop</span>
<a name="ln-1026"></a>
<a name="ln-1027"></a>  <span class="k">if</span> <span class="p">(</span><span class="n">ipos2</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-1028"></a><span class="k">  </span><span class="nb">loc</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-1029"></a>  <span class="n">j</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-1030"></a>  <span class="n">minus1</span><span class="o">=</span><span class="mi">1</span>
<a name="ln-1031"></a>  <span class="n">newl</span><span class="o">=</span><span class="n">line</span><span class="p">(:</span><span class="n">ipos2</span><span class="p">)</span>
<a name="ln-1032"></a>  <span class="n">OVERALL</span><span class="p">:</span> <span class="k">do </span><span class="n">numop</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span>                         <span class="c">! check **, then */, then +-</span>
<a name="ln-1033"></a>     <span class="n">TILLDONE</span><span class="p">:</span> <span class="k">do</span>                               <span class="c">! keep doing reduction of current operators</span>
<a name="ln-1034"></a>       <span class="n">i</span><span class="o">=</span><span class="nb">index</span><span class="p">(</span><span class="n">newl</span><span class="p">,</span><span class="n">ops</span><span class="p">(</span><span class="n">numop</span><span class="p">))</span>                 <span class="c">! find location in input string where operator string was found</span>
<a name="ln-1035"></a>       <span class="k">if</span> <span class="p">(</span><span class="n">numop</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>                     <span class="c">! if not the two-character operator ** check for either operator of current group</span>
<a name="ln-1036"></a>         <span class="n">i</span><span class="o">=</span><span class="nb">index</span><span class="p">(</span><span class="n">newl</span><span class="p">,</span><span class="n">ops</span><span class="p">(</span><span class="n">numop</span><span class="p">)(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">))</span>          <span class="c">! find  first operator of group, if present</span>
<a name="ln-1037"></a>         <span class="n">j</span><span class="o">=</span><span class="nb">index</span><span class="p">(</span><span class="n">newl</span><span class="p">,</span><span class="n">ops</span><span class="p">(</span><span class="n">numop</span><span class="p">)(</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">))</span>          <span class="c">! find second operator of group, if present</span>
<a name="ln-1038"></a>         <span class="n">i</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>                             <span class="c">! find right-most operator, if any</span>
<a name="ln-1039"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">j</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="n">i</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>               <span class="c">! if at least one operator is present find left-most</span>
<a name="ln-1040"></a>       <span class="k">endif</span>
<a name="ln-1041"></a><span class="k">       IF</span> <span class="p">(</span><span class="n">I</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">cycle </span><span class="n">OVERALL</span>                <span class="c">! did not find these operators</span>
<a name="ln-1042"></a>
<a name="ln-1043"></a>       <span class="nb">LEN</span><span class="o">=</span><span class="mi">1</span>                                    <span class="c">! operator length</span>
<a name="ln-1044"></a>       <span class="k">IF</span> <span class="p">(</span><span class="n">NUMOP</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="nb">LEN</span><span class="o">=</span><span class="mi">2</span>
<a name="ln-1045"></a>       <span class="k">IF</span> <span class="p">(</span><span class="n">I</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">NEWL</span><span class="p">))</span> <span class="k">then</span>            <span class="c">! if operator is at end of string</span>
<a name="ln-1046"></a>          <span class="k">call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s2">&quot;*prep* ERROR(035) - INCOMPLETE STATEMENT. OPERATOR (**,/,*,+,-) AT STRING END:&quot;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_SOURCE</span><span class="p">))</span>
<a name="ln-1047"></a>       <span class="k">endif</span>
<a name="ln-1048"></a><span class="k">       IF</span> <span class="p">(</span><span class="n">I</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mf">1.</span><span class="nb">AND</span><span class="p">.</span><span class="n">NUMOP</span><span class="p">.</span><span class="n">NE</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span> <span class="k">then</span>          <span class="c">! if operator at beginning of string and not +-</span>
<a name="ln-1049"></a>        <span class="k">call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s2">&quot;*prep* ERROR(036) - SYNTAX ERROR. OPERATOR (**,*,/) NOT ALLOWED TO PREFIX EXPRESSION:&quot;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_SOURCE</span><span class="p">))</span>
<a name="ln-1050"></a>       <span class="k">endif</span>
<a name="ln-1051"></a><span class="k">       if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.(</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mf">1.</span><span class="nb">and</span><span class="p">.</span><span class="n">numop</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">3</span><span class="p">))</span> <span class="k">then</span>   <span class="c">! if processing +- operators and sign at beginning of string skip this</span>
<a name="ln-1052"></a>          <span class="k">if</span> <span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="s1">&#39;*/+-&#39;</span><span class="p">,</span><span class="n">newl</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)).</span><span class="n">ne</span><span class="p">.</span><span class="mf">0.</span><span class="nb">or</span><span class="p">.</span><span class="nb">index</span><span class="p">(</span><span class="s1">&#39;*/+-&#39;</span><span class="p">,</span><span class="n">newl</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="nb">len</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="nb">len</span><span class="p">)).</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1053"></a><span class="k">            call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(037) - SYNTAX ERROR IN DOMATH:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_source</span><span class="p">))</span>
<a name="ln-1054"></a>          <span class="k">endif</span>
<a name="ln-1055"></a><span class="k">       endif</span>
<a name="ln-1056"></a>
<a name="ln-1057"></a><span class="k">       </span><span class="n">i1</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-1058"></a>       <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.(</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mf">1.</span><span class="nb">and</span><span class="p">.</span><span class="n">numop</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">3</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1059"></a><span class="k">          do </span><span class="n">j</span><span class="o">=</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1060"></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="s1">&#39;*/+-.&#39;</span><span class="p">,</span><span class="n">newl</span><span class="p">(</span><span class="n">j</span><span class="p">:</span><span class="n">j</span><span class="p">)).</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">cycle</span>
<a name="ln-1061"></a><span class="k">            exit</span>
<a name="ln-1062"></a><span class="k">          enddo</span>
<a name="ln-1063"></a><span class="k">          if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.(</span><span class="n">j</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">i</span><span class="o">-</span><span class="mf">1.</span><span class="nb">and</span><span class="p">.</span><span class="n">j</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">1</span><span class="p">))</span><span class="k">then</span>
<a name="ln-1064"></a><span class="k">             </span><span class="n">i1</span><span class="o">=</span><span class="n">get_integer_from_string</span><span class="p">(</span><span class="n">newl</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-1065"></a>          <span class="k">endif</span>
<a name="ln-1066"></a><span class="k">       endif</span>
<a name="ln-1067"></a><span class="k">       do </span><span class="n">l</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">ops</span><span class="p">(</span><span class="n">numop</span><span class="p">)),</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">newl</span><span class="p">)</span>
<a name="ln-1068"></a>         <span class="k">if</span> <span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="s1">&#39;*/+-.&#39;</span><span class="p">,</span><span class="n">newl</span><span class="p">(</span><span class="n">l</span><span class="p">:</span><span class="n">l</span><span class="p">)).</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">cycle</span>
<a name="ln-1069"></a><span class="k">         exit</span>
<a name="ln-1070"></a><span class="k">       enddo</span>
<a name="ln-1071"></a>
<a name="ln-1072"></a><span class="k">       </span><span class="n">i2</span><span class="o">=</span><span class="n">get_integer_from_string</span><span class="p">(</span><span class="n">newl</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="nb">len</span><span class="p">:</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-1073"></a>
<a name="ln-1074"></a>       <span class="k">if</span> <span class="p">(</span><span class="n">numop</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1075"></a><span class="k">         </span><span class="n">i1</span><span class="o">=</span><span class="n">i1</span><span class="o">**</span><span class="n">i2</span><span class="o">*</span><span class="n">minus1</span>
<a name="ln-1076"></a>       <span class="k">else</span>
<a name="ln-1077"></a><span class="k">          select case</span> <span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="s1">&#39;*/+-&#39;</span><span class="p">,</span><span class="n">newl</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">)))</span>
<a name="ln-1078"></a>          <span class="k">case</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1079"></a>             <span class="n">i1</span><span class="o">=</span><span class="n">i1</span><span class="o">*</span><span class="n">i2</span><span class="o">*</span><span class="n">minus1</span>
<a name="ln-1080"></a>          <span class="k">case</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-1081"></a>             <span class="k">if</span><span class="p">(</span><span class="n">i2</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1082"></a><span class="k">                call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(038) - DIVIDE BY ZERO:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_source</span><span class="p">))</span>
<a name="ln-1083"></a>             <span class="k">endif</span>
<a name="ln-1084"></a><span class="k">             </span><span class="n">i1</span><span class="o">=</span><span class="n">i1</span><span class="o">/</span><span class="n">i2</span><span class="o">*</span><span class="n">minus1</span>
<a name="ln-1085"></a>          <span class="k">case</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-1086"></a>          <span class="k">if</span> <span class="p">(</span><span class="n">i1</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1087"></a><span class="k">            </span><span class="n">i1</span><span class="o">=</span><span class="n">i1</span><span class="o">*</span><span class="n">minus1</span><span class="o">+</span><span class="n">i2</span>
<a name="ln-1088"></a>          <span class="k">else</span>
<a name="ln-1089"></a><span class="k">            </span><span class="n">i1</span><span class="o">=</span><span class="n">i1</span><span class="o">+</span><span class="n">i2</span><span class="o">*</span><span class="n">minus1</span>
<a name="ln-1090"></a>          <span class="k">endif</span>
<a name="ln-1091"></a><span class="k">          case</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-1092"></a>             <span class="k">if</span> <span class="p">(</span><span class="n">i1</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1093"></a><span class="k">               </span><span class="n">i1</span><span class="o">=</span><span class="n">i1</span><span class="o">*</span><span class="n">minus1</span><span class="o">-</span><span class="n">i2</span>
<a name="ln-1094"></a>             <span class="k">else</span>
<a name="ln-1095"></a><span class="k">               </span><span class="n">i1</span><span class="o">=</span><span class="n">i1</span><span class="o">-</span><span class="n">i2</span><span class="o">*</span><span class="n">minus1</span>
<a name="ln-1096"></a>             <span class="k">endif</span>
<a name="ln-1097"></a><span class="k">          case </span><span class="n">default</span>
<a name="ln-1098"></a>             <span class="k">call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(039) - INTERNAL PROGRAM ERROR:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_source</span><span class="p">))</span>
<a name="ln-1099"></a>          <span class="k">end select</span>
<a name="ln-1100"></a><span class="k">       endif</span>
<a name="ln-1101"></a>
<a name="ln-1102"></a><span class="k">       if</span> <span class="p">(</span><span class="n">i1</span><span class="p">.</span><span class="n">le</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1103"></a><span class="k">         if</span> <span class="p">(</span><span class="n">j</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">i</span><span class="o">-</span><span class="mf">1.</span><span class="nb">and</span><span class="p">.</span><span class="n">j</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1104"></a><span class="k">           </span><span class="n">minus1</span><span class="o">=-</span><span class="mi">1</span>
<a name="ln-1105"></a>           <span class="n">i1</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span>
<a name="ln-1106"></a>           <span class="nb">loc</span><span class="o">=</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-1107"></a>           <span class="n">newl</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
<a name="ln-1108"></a>           <span class="n">l</span><span class="o">=</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1109"></a>           <span class="n">newl</span><span class="o">=</span><span class="n">nospace</span><span class="p">(</span><span class="n">newl</span><span class="p">)</span>
<a name="ln-1110"></a>         <span class="n">elseif</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mf">1.</span><span class="nb">and</span><span class="p">.</span><span class="n">numop</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1111"></a><span class="k">           </span><span class="n">minus1</span><span class="o">=-</span><span class="mi">1</span>
<a name="ln-1112"></a>           <span class="n">i1</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">i1</span><span class="p">)</span>
<a name="ln-1113"></a>           <span class="nb">loc</span><span class="o">=</span><span class="n">i</span>
<a name="ln-1114"></a>           <span class="n">newl</span><span class="p">(</span><span class="n">j</span><span class="p">:</span><span class="n">j</span><span class="p">)</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
<a name="ln-1115"></a>           <span class="n">l</span><span class="o">=</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1116"></a>           <span class="n">j</span><span class="o">=</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1117"></a>           <span class="n">newl</span><span class="o">=</span><span class="n">nospace</span><span class="p">(</span><span class="n">newl</span><span class="p">)</span>
<a name="ln-1118"></a>         <span class="k">else</span>
<a name="ln-1119"></a><span class="k">           </span><span class="n">minus1</span><span class="o">=</span><span class="mi">1</span>
<a name="ln-1120"></a>         <span class="k">endif</span>
<a name="ln-1121"></a><span class="k">       else</span>
<a name="ln-1122"></a><span class="k">         </span><span class="n">minus1</span><span class="o">=</span><span class="mi">1</span>
<a name="ln-1123"></a>       <span class="k">endif</span>
<a name="ln-1124"></a><span class="k">       write</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="s1">&#39;(i11)&#39;</span><span class="p">)</span> <span class="n">i1</span>
<a name="ln-1125"></a>       <span class="n">temp</span><span class="o">=</span><span class="n">nospace</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
<a name="ln-1126"></a>       <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mf">0.</span><span class="nb">and</span><span class="p">.</span><span class="n">l</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">newl</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1127"></a><span class="k">         </span><span class="n">newl</span><span class="o">=</span><span class="n">temp</span><span class="p">(:</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>
<a name="ln-1128"></a>         <span class="k">cycle </span><span class="n">overall</span>
<a name="ln-1129"></a>       <span class="n">elseif</span> <span class="p">(</span><span class="n">j</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1130"></a><span class="k">         </span><span class="n">newl</span><span class="o">=</span><span class="n">temp</span><span class="p">(:</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span><span class="o">//</span><span class="n">newl</span><span class="p">(</span><span class="n">l</span><span class="p">:)</span>
<a name="ln-1131"></a>       <span class="n">elseif</span> <span class="p">(</span><span class="n">l</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">newl</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1132"></a><span class="k">         </span><span class="n">newl</span><span class="o">=</span><span class="n">newl</span><span class="p">(:</span><span class="n">j</span><span class="p">)</span><span class="o">//</span><span class="n">temp</span><span class="p">(:</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>
<a name="ln-1133"></a>       <span class="k">else</span>
<a name="ln-1134"></a><span class="k">         </span><span class="n">newl</span><span class="o">=</span><span class="n">newl</span><span class="p">(:</span><span class="n">j</span><span class="p">)</span><span class="o">//</span><span class="n">temp</span><span class="p">(:</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span><span class="o">//</span><span class="n">newl</span><span class="p">(</span><span class="n">l</span><span class="p">:)</span>
<a name="ln-1135"></a>       <span class="k">endif</span>
<a name="ln-1136"></a><span class="k">       if</span><span class="p">(</span><span class="n">i1</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>  <span class="c">! if i1 is negative, could produce +-</span>
<a name="ln-1137"></a>          <span class="k">call </span><span class="n">substitute</span><span class="p">(</span><span class="n">newl</span><span class="p">,</span><span class="s1">&#39;+-&#39;</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
<a name="ln-1138"></a>       <span class="k">endif</span>
<a name="ln-1139"></a><span class="k">     enddo </span><span class="n">TILLDONE</span>
<a name="ln-1140"></a>  <span class="k">enddo </span><span class="n">OVERALL</span>
<a name="ln-1141"></a>
<a name="ln-1142"></a>  <span class="k">if</span> <span class="p">(</span><span class="n">minus1</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="o">-</span><span class="mf">1.</span><span class="nb">and</span><span class="p">.(</span><span class="nb">loc</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mf">0.</span><span class="nb">or</span><span class="p">.</span><span class="nb">loc</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1143"></a><span class="k">     </span><span class="n">newl</span><span class="p">(:</span><span class="n">G_line_length</span><span class="p">)</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">newl</span><span class="p">)</span>  <span class="c">!x! note potentially trimming a character off the end</span>
<a name="ln-1144"></a>  <span class="n">elseif</span> <span class="p">(</span><span class="n">minus1</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="o">-</span><span class="mf">1.</span><span class="nb">and</span><span class="p">.</span><span class="nb">loc</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1145"></a><span class="k">     </span><span class="n">newl</span><span class="o">=</span><span class="n">newl</span><span class="p">(:</span><span class="nb">loc</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;-&#39;</span><span class="o">//</span><span class="n">newl</span><span class="p">(</span><span class="nb">loc</span><span class="p">:)</span>
<a name="ln-1146"></a>  <span class="k">endif</span>
<a name="ln-1147"></a>
<a name="ln-1148"></a><span class="k">  </span><span class="n">line</span><span class="p">(:</span><span class="n">ipos2</span><span class="p">)</span><span class="o">=</span><span class="n">newl</span><span class="p">(:</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">newl</span><span class="p">))</span>
<a name="ln-1149"></a>
<a name="ln-1150"></a><span class="k">end subroutine </span><span class="n">domath</span>
<a name="ln-1151"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1152"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-1153"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1154"></a><span class="k">subroutine </span><span class="n">doop</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="n">ipos1</span><span class="p">,</span><span class="n">ipos2</span><span class="p">)</span>                       <span class="c">!@(#)doop(3f): find VAL.OP.VAL strings and reduce to .TRUE. or .FALSE.</span>
<a name="ln-1155"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">line</span>
<a name="ln-1156"></a><span class="kt">integer</span>                         <span class="kd">::</span> <span class="n">ipos1</span>
<a name="ln-1157"></a><span class="kt">integer</span>                         <span class="kd">::</span> <span class="n">ipos2</span>
<a name="ln-1158"></a>
<a name="ln-1159"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span><span class="k">parameter</span>      <span class="kd">::</span> <span class="n">ops</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;.EQ.&#39;</span><span class="p">,</span><span class="s1">&#39;.NE.&#39;</span><span class="p">,</span><span class="s1">&#39;.GE.&#39;</span><span class="p">,</span><span class="s1">&#39;.GT.&#39;</span><span class="p">,</span><span class="s1">&#39;.LE.&#39;</span><span class="p">,</span><span class="s1">&#39;.LT.&#39;</span><span class="p">]</span>
<a name="ln-1160"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_var_len</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">val1</span>
<a name="ln-1161"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_var_len</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">val2</span>
<a name="ln-1162"></a><span class="kt">integer</span>                         <span class="kd">::</span> <span class="n">ival1</span><span class="p">,</span> <span class="n">ival2</span>
<a name="ln-1163"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>                <span class="kd">::</span> <span class="n">temp</span>
<a name="ln-1164"></a>
<a name="ln-1165"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">newl</span>
<a name="ln-1166"></a><span class="kt">integer</span>                         <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span>
<a name="ln-1167"></a>
<a name="ln-1168"></a>   <span class="n">newl</span><span class="o">=</span><span class="n">line</span><span class="p">(</span><span class="n">ipos1</span><span class="p">:</span><span class="n">ipos2</span><span class="p">)</span>
<a name="ln-1169"></a>   <span class="n">CHECK_EACH_OP_TYPE</span><span class="p">:</span> <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span>
<a name="ln-1170"></a>      <span class="n">FIND_MORE_OF</span><span class="p">:</span> <span class="k">do</span>
<a name="ln-1171"></a><span class="k">         </span><span class="n">G_dc</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-1172"></a>         <span class="k">if</span> <span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">newl</span><span class="p">,</span><span class="n">ops</span><span class="p">(</span><span class="n">i</span><span class="p">)).</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>                       <span class="c">! found current operator looking for</span>
<a name="ln-1173"></a>            <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="nb">index</span><span class="p">(</span><span class="n">newl</span><span class="p">,</span><span class="n">ops</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1174"></a>               <span class="k">if</span> <span class="p">(</span><span class="n">newl</span><span class="p">(</span><span class="n">j</span><span class="p">:</span><span class="n">j</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1175"></a><span class="k">                  exit</span>
<a name="ln-1176"></a><span class="k">               endif</span>
<a name="ln-1177"></a><span class="k">            enddo</span>
<a name="ln-1178"></a><span class="k">            call </span><span class="n">getval</span><span class="p">(</span><span class="n">newl</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">index</span><span class="p">(</span><span class="n">newl</span><span class="p">,</span><span class="n">ops</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">val1</span><span class="p">)</span>
<a name="ln-1179"></a>            <span class="k">do </span><span class="n">k</span><span class="o">=</span><span class="nb">index</span><span class="p">(</span><span class="n">newl</span><span class="p">,</span><span class="n">ops</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">+</span><span class="mi">4</span><span class="p">,</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">newl</span><span class="p">)</span>
<a name="ln-1180"></a>               <span class="k">if</span> <span class="p">(</span><span class="n">newl</span><span class="p">(</span><span class="n">k</span><span class="p">:</span><span class="n">k</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1181"></a><span class="k">                  exit</span>
<a name="ln-1182"></a><span class="k">               endif</span>
<a name="ln-1183"></a><span class="k">            enddo</span>
<a name="ln-1184"></a><span class="k">            call </span><span class="n">getval</span><span class="p">(</span><span class="n">newl</span><span class="p">,</span><span class="nb">index</span><span class="p">(</span><span class="n">newl</span><span class="p">,</span><span class="n">ops</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">+</span><span class="mi">4</span><span class="p">,</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">val2</span><span class="p">)</span>
<a name="ln-1185"></a>            <span class="n">ival1</span><span class="o">=</span><span class="n">get_integer_from_string</span><span class="p">(</span><span class="n">val1</span><span class="p">)</span>
<a name="ln-1186"></a>            <span class="n">ival2</span><span class="o">=</span><span class="n">get_integer_from_string</span><span class="p">(</span><span class="n">val2</span><span class="p">)</span>
<a name="ln-1187"></a>            <span class="k">select case</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>                                       <span class="c">! determine truth</span>
<a name="ln-1188"></a>            <span class="k">case</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>                                              <span class="c">! .eq.</span>
<a name="ln-1189"></a>               <span class="k">if</span> <span class="p">(</span><span class="n">ival1</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">ival2</span><span class="p">)</span> <span class="n">G_dc</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-1190"></a>            <span class="k">case</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>                                              <span class="c">! .ne.</span>
<a name="ln-1191"></a>               <span class="k">if</span> <span class="p">(</span><span class="n">ival1</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="n">ival2</span><span class="p">)</span> <span class="n">G_dc</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-1192"></a>            <span class="k">case</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>                                              <span class="c">! .ge.</span>
<a name="ln-1193"></a>               <span class="k">if</span> <span class="p">(</span><span class="n">ival1</span><span class="p">.</span><span class="n">ge</span><span class="p">.</span><span class="n">ival2</span><span class="p">)</span> <span class="n">G_dc</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-1194"></a>            <span class="k">case</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>                                              <span class="c">! .gt.</span>
<a name="ln-1195"></a>               <span class="k">if</span> <span class="p">(</span><span class="n">ival1</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="n">ival2</span><span class="p">)</span> <span class="n">G_dc</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-1196"></a>            <span class="k">case</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>                                              <span class="c">! .le.</span>
<a name="ln-1197"></a>               <span class="k">if</span> <span class="p">(</span><span class="n">ival1</span><span class="p">.</span><span class="n">le</span><span class="p">.</span><span class="n">ival2</span><span class="p">)</span> <span class="n">G_dc</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-1198"></a>            <span class="k">case</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>                                              <span class="c">! .lt.</span>
<a name="ln-1199"></a>               <span class="k">if</span> <span class="p">(</span><span class="n">ival1</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="n">ival2</span><span class="p">)</span> <span class="n">G_dc</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-1200"></a>            <span class="k">case </span><span class="n">default</span>
<a name="ln-1201"></a>            <span class="k">end select</span>
<a name="ln-1202"></a><span class="k">            </span><span class="n">temp</span><span class="o">=</span><span class="s1">&#39;.FALSE.&#39;</span>
<a name="ln-1203"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">G_dc</span><span class="p">)</span> <span class="n">temp</span><span class="o">=</span><span class="s1">&#39;.TRUE.&#39;</span>
<a name="ln-1204"></a>            <span class="k">call </span><span class="n">rewrit</span><span class="p">(</span><span class="n">newl</span><span class="p">,</span><span class="n">temp</span><span class="p">(:</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">temp</span><span class="p">)),</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-1205"></a>            <span class="n">newl</span><span class="o">=</span><span class="n">nospace</span><span class="p">(</span><span class="n">newl</span><span class="p">)</span>
<a name="ln-1206"></a>            <span class="k">cycle</span>
<a name="ln-1207"></a><span class="k">         endif</span>
<a name="ln-1208"></a><span class="k">         exit</span>
<a name="ln-1209"></a><span class="k">      enddo </span><span class="n">FIND_MORE_OF</span>
<a name="ln-1210"></a>   <span class="k">enddo </span><span class="n">CHECK_EACH_OP_TYPE</span>
<a name="ln-1211"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">ipos1</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1212"></a><span class="k">      </span><span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="p">(:</span><span class="n">ipos1</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="n">newl</span><span class="p">(:</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">newl</span><span class="p">))</span><span class="o">//</span><span class="n">line</span><span class="p">(</span><span class="n">ipos2</span><span class="o">+</span><span class="mi">1</span><span class="p">:)</span>
<a name="ln-1213"></a>   <span class="k">else</span>
<a name="ln-1214"></a><span class="k">      </span><span class="n">line</span><span class="o">=</span><span class="n">newl</span><span class="p">(:</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">newl</span><span class="p">))</span><span class="o">//</span><span class="n">line</span><span class="p">(</span><span class="n">ipos2</span><span class="o">+</span><span class="mi">1</span><span class="p">:)</span>
<a name="ln-1215"></a>   <span class="k">endif</span>
<a name="ln-1216"></a><span class="k">   </span><span class="n">line</span><span class="o">=</span><span class="n">nospace</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<a name="ln-1217"></a><span class="k">end subroutine </span><span class="n">doop</span>
<a name="ln-1218"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1219"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-1220"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1221"></a><span class="kt">logical </span><span class="k">function </span><span class="n">trufal</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="n">ipos1</span><span class="p">,</span><span class="n">ipos2</span><span class="p">)</span>       <span class="c">!@(#)trufal(3f): convert variable name or .TRUE./.FALSE. to a logical value</span>
<a name="ln-1222"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">line</span>              <span class="c">! line containing string to interpret as a logical value</span>
<a name="ln-1223"></a><span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                      <span class="kd">::</span> <span class="n">ipos1</span>             <span class="c">! starting column of substring in LINE</span>
<a name="ln-1224"></a><span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                      <span class="kd">::</span> <span class="n">ipos2</span>             <span class="c">! ending column of substring in LINE</span>
<a name="ln-1225"></a>
<a name="ln-1226"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_var_len</span><span class="p">)</span>                <span class="kd">::</span> <span class="k">value</span>             <span class="c">! substring to extract from LINE</span>
<a name="ln-1227"></a><span class="kt">integer</span>                                 <span class="kd">::</span> <span class="n">i</span>                 <span class="c">! loop counter</span>
<a name="ln-1228"></a><span class="kt">integer</span>                                 <span class="kd">::</span> <span class="n">ios</span>               <span class="c">! error code returned by an internal READ</span>
<a name="ln-1229"></a><span class="kt">integer</span>                                 <span class="kd">::</span> <span class="n">ifound</span>            <span class="c">! index in dictionary at which a variable name was found, or -1</span>
<a name="ln-1230"></a>
<a name="ln-1231"></a>   <span class="n">trufal</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>                                            <span class="c">! initialize return value</span>
<a name="ln-1232"></a>   <span class="k">value</span><span class="o">=</span><span class="n">line</span><span class="p">(</span><span class="n">ipos1</span><span class="p">:</span><span class="n">ipos2</span><span class="p">)</span>                                   <span class="c">! extract substring from LINE to interpret</span>
<a name="ln-1233"></a>   <span class="n">ifound</span><span class="o">=-</span><span class="mi">1</span>                                                 <span class="c">! flag if successfully converted string, or index variable name found</span>
<a name="ln-1234"></a>
<a name="ln-1235"></a>   <span class="k">select case</span> <span class="p">(</span><span class="k">value</span><span class="p">)</span>                                       <span class="c">! if string is not a logical string assume it is a variable name</span>
<a name="ln-1236"></a>   <span class="k">case</span> <span class="p">(</span><span class="s1">&#39;.FALSE.&#39;</span><span class="p">,</span><span class="s1">&#39;.F.&#39;</span><span class="p">)</span>
<a name="ln-1237"></a>      <span class="n">ifound</span><span class="o">=</span><span class="mi">0</span>                                               <span class="c">! set flag to indicate a good value has been found</span>
<a name="ln-1238"></a>      <span class="n">trufal</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>                                         <span class="c">! set appropriate return value</span>
<a name="ln-1239"></a>   <span class="k">case</span> <span class="p">(</span><span class="s1">&#39;.TRUE.&#39;</span><span class="p">,</span><span class="s1">&#39;.T.&#39;</span><span class="p">)</span>
<a name="ln-1240"></a>      <span class="n">ifound</span><span class="o">=</span><span class="mi">0</span>                                               <span class="c">! set flag to indicate a good value has been found</span>
<a name="ln-1241"></a>      <span class="n">trufal</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>                                          <span class="c">! set appropriate return value</span>
<a name="ln-1242"></a>   <span class="k">case </span><span class="n">default</span>                                              <span class="c">! assume this is a variable name, find name in dictionary</span>
<a name="ln-1243"></a>      <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">G_numdef</span>
<a name="ln-1244"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">G_defvar</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="k">value</span><span class="p">)</span> <span class="k">then</span>                      <span class="c">! found variable name in dictionary</span>
<a name="ln-1245"></a>            <span class="n">ifound</span><span class="o">=</span><span class="n">i</span>                                         <span class="c">! record index in diction where variable was found</span>
<a name="ln-1246"></a>            <span class="k">exit</span>
<a name="ln-1247"></a><span class="k">         endif</span>
<a name="ln-1248"></a><span class="k">      enddo</span>
<a name="ln-1249"></a>
<a name="ln-1250"></a><span class="k">      if</span> <span class="p">(</span><span class="n">ifound</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>                                 <span class="c">! if not a defined variable name stop program</span>
<a name="ln-1251"></a>         <span class="k">call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(040) - UNDEFINED PARAMETER.&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_source</span><span class="p">))</span>
<a name="ln-1252"></a>      <span class="k">else</span>
<a name="ln-1253"></a><span class="k">         read</span><span class="p">(</span><span class="n">G_defval</span><span class="p">(</span><span class="n">ifound</span><span class="p">),</span><span class="s1">&#39;(l4)&#39;</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">ios</span><span class="p">)</span> <span class="n">trufal</span>     <span class="c">! try to read a logical from the value for the variable name</span>
<a name="ln-1254"></a>         <span class="k">if</span><span class="p">(</span><span class="n">ios</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>                                    <span class="c">! not successful in reading string as a logical value</span>
<a name="ln-1255"></a>            <span class="k">call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(041) - CONSTANT LOGICAL EXPRESSION REQUIRED.&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_source</span><span class="p">))</span>
<a name="ln-1256"></a>         <span class="k">endif</span>
<a name="ln-1257"></a><span class="k">      endif</span>
<a name="ln-1258"></a>
<a name="ln-1259"></a><span class="k">   end select</span>
<a name="ln-1260"></a>
<a name="ln-1261"></a><span class="k">   if</span> <span class="p">(</span><span class="n">ifound</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>                                     <span class="c">! not a variable name or string &#39;.TRUE.&#39; or &#39;.FALSE.&#39;</span>
<a name="ln-1262"></a>      <span class="k">call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(042) - CONSTANT LOGICAL EXPRESSION REQUIRED:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_source</span><span class="p">))</span>
<a name="ln-1263"></a>   <span class="k">endif</span>
<a name="ln-1264"></a>
<a name="ln-1265"></a><span class="k">end function </span><span class="n">trufal</span>
<a name="ln-1266"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1267"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-1268"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1269"></a><span class="k">subroutine </span><span class="n">logic</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="n">ipos1</span><span class="p">,</span><span class="n">ipos2</span><span class="p">)</span>           <span class="c">!@(#)logic(3f): process .OP. operator strings</span>
<a name="ln-1270"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">line</span>
<a name="ln-1271"></a><span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">ipos1</span><span class="p">,</span> <span class="n">ipos2</span>
<a name="ln-1272"></a>
<a name="ln-1273"></a><span class="kt">logical</span>                      <span class="kd">::</span> <span class="n">one</span><span class="p">,</span> <span class="n">two</span>
<a name="ln-1274"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">temp</span>
<a name="ln-1275"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">)</span> <span class="kd">::</span> <span class="n">newl</span>
<a name="ln-1276"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">6</span><span class="p">),</span><span class="k">save</span>        <span class="kd">::</span> <span class="n">ops</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">=</span> <span class="p">(</span><span class="o">/</span><span class="s1">&#39;.NOT. &#39;</span><span class="p">,</span><span class="s1">&#39;.AND. &#39;</span><span class="p">,</span><span class="s1">&#39;.OR.  &#39;</span><span class="p">,</span><span class="s1">&#39;.EQV. &#39;</span><span class="p">,</span><span class="s1">&#39;.NEQV.&#39;</span><span class="o">/</span><span class="p">)</span>
<a name="ln-1277"></a><span class="kt">integer</span>                      <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span>
<a name="ln-1278"></a><span class="kt">integer</span>                      <span class="kd">::</span> <span class="n">ieqv</span>
<a name="ln-1279"></a><span class="kt">integer</span>                      <span class="kd">::</span> <span class="n">ineqv</span>
<a name="ln-1280"></a><span class="kt">integer</span>                      <span class="kd">::</span> <span class="n">i1</span>
<a name="ln-1281"></a><span class="kt">integer</span>                      <span class="kd">::</span> <span class="n">iop</span>
<a name="ln-1282"></a><span class="kt">integer</span>                      <span class="kd">::</span> <span class="nb">len</span>
<a name="ln-1283"></a><span class="kt">integer</span>                      <span class="kd">::</span> <span class="n">len1</span>
<a name="ln-1284"></a><span class="kt">integer</span>                      <span class="kd">::</span> <span class="n">len2</span>
<a name="ln-1285"></a>
<a name="ln-1286"></a>   <span class="n">newl</span><span class="o">=</span><span class="n">line</span><span class="p">(</span><span class="n">ipos1</span><span class="p">:</span><span class="n">ipos2</span><span class="p">)</span>
<a name="ln-1287"></a>   <span class="n">len1</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-1288"></a>   <span class="n">len2</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-1289"></a>   <span class="n">one</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-1290"></a>   <span class="n">LOOP</span><span class="p">:</span> <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span>
<a name="ln-1291"></a>      <span class="mi">20</span> <span class="k">continue</span>
<a name="ln-1292"></a><span class="k">           </span><span class="nb">LEN</span><span class="o">=</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">ops</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-1293"></a>           <span class="k">IF</span> <span class="p">(</span><span class="nb">INDEX</span><span class="p">(</span><span class="n">NEWL</span><span class="p">,</span><span class="n">OPS</span><span class="p">(</span><span class="n">I</span><span class="p">)(:</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">OPS</span><span class="p">(</span><span class="n">I</span><span class="p">)))).</span><span class="n">EQ</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">cycle</span>
<a name="ln-1294"></a><span class="k">           </span><span class="n">I1</span><span class="o">=</span><span class="nb">INDEX</span><span class="p">(</span><span class="n">NEWL</span><span class="p">,</span><span class="n">OPS</span><span class="p">(</span><span class="n">I</span><span class="p">)(:</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">OPS</span><span class="p">(</span><span class="n">I</span><span class="p">))))</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1295"></a>           <span class="n">J</span><span class="o">=</span><span class="n">I1</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-1296"></a>           <span class="n">LEN1</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-1297"></a>           <span class="k">IF</span> <span class="p">(</span><span class="n">I</span><span class="p">.</span><span class="n">NE</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1298"></a><span class="k">              </span><span class="n">OUTER</span><span class="p">:</span> <span class="k">DO </span><span class="n">J</span><span class="o">=</span><span class="n">I1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1299"></a>                <span class="n">INNER</span><span class="p">:</span> <span class="k">DO </span><span class="n">K</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span>
<a name="ln-1300"></a>                   <span class="n">LEN1</span><span class="o">=</span><span class="mi">5</span>
<a name="ln-1301"></a>                   <span class="k">IF</span> <span class="p">(</span><span class="n">K</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span> <span class="n">LEN1</span><span class="o">=</span><span class="mi">4</span>
<a name="ln-1302"></a>                   <span class="k">IF</span> <span class="p">(</span><span class="nb">INDEX</span><span class="p">(</span><span class="n">NEWL</span><span class="p">(</span><span class="n">J</span><span class="p">:</span><span class="n">I1</span><span class="p">),</span><span class="n">OPS</span><span class="p">(</span><span class="n">K</span><span class="p">)(:</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">OPS</span><span class="p">(</span><span class="n">K</span><span class="p">)))).</span><span class="n">NE</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">exit </span><span class="n">OUTER</span>
<a name="ln-1303"></a>                <span class="k">enddo </span><span class="n">INNER</span>
<a name="ln-1304"></a>              <span class="k">enddo </span><span class="n">OUTER</span>
<a name="ln-1305"></a>              <span class="k">IF</span> <span class="p">(</span><span class="n">J</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="n">LEN1</span><span class="o">=</span><span class="mi">1</span>
<a name="ln-1306"></a>              <span class="n">ONE</span><span class="o">=</span><span class="n">TRUFAL</span><span class="p">(</span><span class="n">NEWL</span><span class="p">,</span><span class="n">J</span><span class="o">+</span><span class="n">LEN1</span><span class="p">,</span><span class="n">I1</span><span class="p">)</span>
<a name="ln-1307"></a>           <span class="k">endif</span>
<a name="ln-1308"></a>
<a name="ln-1309"></a><span class="k">           </span><span class="n">OUT</span><span class="p">:</span> <span class="k">DO </span><span class="n">L</span><span class="o">=</span><span class="n">I1</span><span class="o">+</span><span class="nb">LEN</span><span class="p">,</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">NEWL</span><span class="p">)</span>
<a name="ln-1310"></a>             <span class="n">IN</span><span class="p">:</span> <span class="k">DO </span><span class="n">K</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span>
<a name="ln-1311"></a>                <span class="n">LEN2</span><span class="o">=</span><span class="mi">5</span>
<a name="ln-1312"></a>                <span class="k">IF</span> <span class="p">(</span><span class="n">K</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">3</span><span class="p">)</span> <span class="n">LEN2</span><span class="o">=</span><span class="mi">4</span>
<a name="ln-1313"></a>                <span class="k">IF</span> <span class="p">(</span><span class="nb">INDEX</span><span class="p">(</span><span class="n">NEWL</span><span class="p">(</span><span class="n">I1</span><span class="o">+</span><span class="nb">LEN</span><span class="p">:</span><span class="n">L</span><span class="p">),</span><span class="n">OPS</span><span class="p">(</span><span class="n">K</span><span class="p">)(:</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">OPS</span><span class="p">(</span><span class="n">K</span><span class="p">)))).</span><span class="n">NE</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">exit </span><span class="n">OUT</span>
<a name="ln-1314"></a>             <span class="k">enddo </span><span class="n">IN</span>
<a name="ln-1315"></a>           <span class="k">enddo </span><span class="n">OUT</span>
<a name="ln-1316"></a>
<a name="ln-1317"></a>           <span class="k">IF</span> <span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">GT</span><span class="p">.</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">NEWL</span><span class="p">))</span> <span class="n">LEN2</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-1318"></a>           <span class="n">TWO</span><span class="o">=</span><span class="n">TRUFAL</span><span class="p">(</span><span class="n">NEWL</span><span class="p">,</span><span class="n">I1</span><span class="o">+</span><span class="nb">LEN</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">L</span><span class="o">-</span><span class="n">LEN2</span><span class="p">)</span>
<a name="ln-1319"></a>
<a name="ln-1320"></a>           <span class="k">select case</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-1321"></a>           <span class="k">case</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="n">G_dc</span><span class="o">=</span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="n">two</span>
<a name="ln-1322"></a>           <span class="k">case</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="n">G_dc</span><span class="o">=</span><span class="n">one</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">two</span>
<a name="ln-1323"></a>           <span class="k">case</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span> <span class="n">G_dc</span><span class="o">=</span><span class="n">one</span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="n">two</span>
<a name="ln-1324"></a>           <span class="k">case </span><span class="n">default</span>
<a name="ln-1325"></a>              <span class="k">call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* internal error&#39;</span><span class="p">)</span>
<a name="ln-1326"></a>           <span class="k">end select</span>
<a name="ln-1327"></a>
<a name="ln-1328"></a><span class="k">           </span><span class="n">temp</span><span class="o">=</span><span class="s1">&#39;.FALSE.&#39;</span>
<a name="ln-1329"></a>           <span class="k">if</span> <span class="p">(</span><span class="n">G_dc</span><span class="p">)</span> <span class="n">temp</span><span class="o">=</span><span class="s1">&#39;.TRUE.&#39;</span>
<a name="ln-1330"></a>           <span class="k">call </span><span class="n">rewrit</span><span class="p">(</span><span class="n">newl</span><span class="p">,</span><span class="n">temp</span><span class="p">(:</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">temp</span><span class="p">)),</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="n">len1</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">l</span><span class="o">-</span><span class="n">len2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1331"></a>        <span class="k">goto </span><span class="mi">20</span>
<a name="ln-1332"></a>   <span class="k">enddo </span><span class="n">LOOP</span>
<a name="ln-1333"></a>   <span class="n">TILLDONE</span><span class="p">:</span> <span class="k">do</span>
<a name="ln-1334"></a><span class="k">      </span><span class="n">ieqv</span><span class="o">=</span><span class="nb">index</span><span class="p">(</span><span class="n">newl</span><span class="p">,</span><span class="s1">&#39;.EQV.&#39;</span><span class="p">)</span>
<a name="ln-1335"></a>      <span class="n">ineqv</span><span class="o">=</span><span class="nb">index</span><span class="p">(</span><span class="n">newl</span><span class="p">,</span><span class="s1">&#39;.NEQV.&#39;</span><span class="p">)</span>
<a name="ln-1336"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">ieqv</span><span class="o">*</span><span class="n">ineqv</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mf">0.</span><span class="nb">and</span><span class="p">.</span><span class="n">ieqv</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="n">ineqv</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1337"></a><span class="k">        </span><span class="n">iop</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">ieqv</span><span class="p">,</span><span class="n">ineqv</span><span class="p">)</span>
<a name="ln-1338"></a>      <span class="n">elseif</span> <span class="p">(</span><span class="n">ieqv</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1339"></a><span class="k">        </span><span class="n">iop</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">ieqv</span><span class="p">,</span><span class="n">ineqv</span><span class="p">)</span>
<a name="ln-1340"></a>      <span class="n">elseif</span> <span class="p">(</span><span class="n">ipos1</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1341"></a><span class="k">        </span><span class="n">line</span><span class="o">=</span><span class="n">newl</span><span class="p">(:</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">newl</span><span class="p">))</span><span class="o">//</span><span class="n">line</span><span class="p">(</span><span class="n">ipos2</span><span class="o">+</span><span class="mi">1</span><span class="p">:)</span>
<a name="ln-1342"></a>        <span class="k">return</span>
<a name="ln-1343"></a><span class="k">      else</span>
<a name="ln-1344"></a><span class="k">        </span><span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="p">(:</span><span class="n">ipos1</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="n">newl</span><span class="p">(:</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">newl</span><span class="p">))</span><span class="o">//</span><span class="n">line</span><span class="p">(</span><span class="n">ipos2</span><span class="o">+</span><span class="mi">1</span><span class="p">:)</span>
<a name="ln-1345"></a>        <span class="k">return</span>
<a name="ln-1346"></a><span class="k">      endif</span>
<a name="ln-1347"></a><span class="k">      </span><span class="nb">len</span><span class="o">=</span><span class="mi">5</span>
<a name="ln-1348"></a>      <span class="k">if</span> <span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">newl</span><span class="p">,</span><span class="s1">&#39;.EQV.&#39;</span><span class="p">).</span><span class="n">ne</span><span class="p">.</span><span class="n">iop</span><span class="p">)</span> <span class="nb">len</span><span class="o">=</span><span class="mi">6</span>
<a name="ln-1349"></a>      <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="n">iop</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-1350"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">newl</span><span class="p">(</span><span class="n">j</span><span class="p">:</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;V.&#39;</span><span class="p">)</span> <span class="k">exit</span>
<a name="ln-1351"></a><span class="k">      enddo</span>
<a name="ln-1352"></a><span class="k">      if</span> <span class="p">(</span><span class="n">j</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="n">len1</span><span class="o">=</span><span class="mi">1</span>
<a name="ln-1353"></a>      <span class="n">one</span><span class="o">=</span><span class="n">trufal</span><span class="p">(</span><span class="n">newl</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="n">len1</span><span class="p">,</span><span class="n">iop</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1354"></a>      <span class="k">do </span><span class="n">l</span><span class="o">=</span><span class="n">iop</span><span class="o">+</span><span class="nb">len</span><span class="p">,</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">newl</span><span class="p">)</span>
<a name="ln-1355"></a>         <span class="k">if</span> <span class="p">(</span><span class="n">newl</span><span class="p">(</span><span class="n">l</span><span class="p">:</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;.E&#39;</span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="n">newl</span><span class="p">(</span><span class="n">l</span><span class="p">:</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;.N&#39;</span><span class="p">)</span> <span class="k">exit</span>
<a name="ln-1356"></a><span class="k">      enddo</span>
<a name="ln-1357"></a><span class="k">      if</span> <span class="p">(</span><span class="n">l</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">newl</span><span class="p">))</span> <span class="n">len2</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-1358"></a>      <span class="n">two</span><span class="o">=</span><span class="n">trufal</span><span class="p">(</span><span class="n">newl</span><span class="p">,</span><span class="n">iop</span><span class="o">+</span><span class="nb">len</span><span class="p">,</span><span class="n">l</span><span class="o">+</span><span class="n">len2</span><span class="p">)</span>
<a name="ln-1359"></a>      <span class="n">G_dc</span><span class="o">=</span><span class="n">one</span><span class="p">.</span><span class="n">eqv</span><span class="p">.</span><span class="n">two</span>
<a name="ln-1360"></a>      <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span> <span class="n">G_dc</span><span class="o">=</span><span class="n">one</span><span class="p">.</span><span class="n">neqv</span><span class="p">.</span><span class="n">two</span>
<a name="ln-1361"></a>      <span class="n">temp</span><span class="o">=</span><span class="s1">&#39;.FALSE.&#39;</span>
<a name="ln-1362"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">G_dc</span><span class="p">)</span> <span class="n">temp</span><span class="o">=</span><span class="s1">&#39;.TRUE.&#39;</span>
<a name="ln-1363"></a>      <span class="k">call </span><span class="n">rewrit</span><span class="p">(</span><span class="n">newl</span><span class="p">,</span><span class="n">temp</span><span class="p">(:</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">temp</span><span class="p">)),</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="n">len1</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">l</span><span class="o">-</span><span class="n">len2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1364"></a>   <span class="k">enddo </span><span class="n">TILLDONE</span>
<a name="ln-1365"></a><span class="k">end subroutine </span><span class="n">logic</span>
<a name="ln-1366"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1367"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-1368"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1369"></a><span class="k">subroutine </span><span class="n">eval</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>                                   <span class="c">!@(#)eval(3f): evaluate math expression to .TRUE. or .FALSE.</span>
<a name="ln-1370"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">line</span>
<a name="ln-1371"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>               <span class="kd">::</span> <span class="k">value</span>
<a name="ln-1372"></a>
<a name="ln-1373"></a><span class="k">   call </span><span class="n">parens</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<a name="ln-1374"></a>   <span class="k">call </span><span class="n">math</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
<a name="ln-1375"></a>   <span class="k">call </span><span class="n">doop</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
<a name="ln-1376"></a>   <span class="k">call </span><span class="n">logic</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
<a name="ln-1377"></a>   <span class="k">value</span><span class="o">=</span><span class="n">line</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">7</span><span class="p">)</span>
<a name="ln-1378"></a>
<a name="ln-1379"></a>   <span class="k">if</span> <span class="p">(</span><span class="k">value</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="s1">&#39;.TRUE.&#39;</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="k">value</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="s1">&#39;.FALSE.&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1380"></a><span class="k">      call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(043) - value neither true or false:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="k">value</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; when evaluating: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_source</span><span class="p">))</span>
<a name="ln-1381"></a>   <span class="k">endif</span>
<a name="ln-1382"></a>
<a name="ln-1383"></a><span class="k">   read</span><span class="p">(</span><span class="k">value</span><span class="p">,</span><span class="s1">&#39;(l4)&#39;</span><span class="p">)</span> <span class="n">G_dc</span>
<a name="ln-1384"></a>
<a name="ln-1385"></a><span class="k">end subroutine </span><span class="n">eval</span>
<a name="ln-1386"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1387"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-1388"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1389"></a><span class="k">function </span><span class="n">get_integer_from_string</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="c">!@(#)get_integer_from_string(3f): read integer value from line(ipos1:ipos2)</span>
<a name="ln-1390"></a>                                                                    <span class="c">! assume string is a variable name or an integer value</span>
<a name="ln-1391"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">line</span>                                <span class="c">! string containing substring to read an integer value from</span>
<a name="ln-1392"></a>
<a name="ln-1393"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_var_len</span><span class="p">)</span>     <span class="kd">::</span> <span class="k">value</span>                               <span class="c">! the substring</span>
<a name="ln-1394"></a><span class="kt">integer</span>                      <span class="kd">::</span> <span class="n">i</span>                                   <span class="c">! index of variable dictionary where variable name is stored</span>
<a name="ln-1395"></a><span class="kt">integer</span>                      <span class="kd">::</span> <span class="n">ios</span>                                 <span class="c">! I/O error value to check to see if internal reads succeeded</span>
<a name="ln-1396"></a><span class="kt">integer</span>                      <span class="kd">::</span> <span class="n">get_integer_from_string</span>             <span class="c">! integer value to return if string is converted successfully</span>
<a name="ln-1397"></a><span class="kt">integer</span>                      <span class="kd">::</span> <span class="n">ipos1</span><span class="p">,</span> <span class="n">ipos2</span>
<a name="ln-1398"></a>
<a name="ln-1399"></a>   <span class="n">ipos1</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
<a name="ln-1400"></a>   <span class="n">ipos2</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<a name="ln-1401"></a>   <span class="n">ipos2</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ipos2</span><span class="p">),</span><span class="n">ipos2</span><span class="p">)</span>
<a name="ln-1402"></a>   <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1403"></a><span class="k">      </span><span class="n">get_integer_from_string</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-1404"></a>   <span class="n">elseif</span> <span class="p">(</span><span class="n">line</span><span class="p">(</span><span class="n">ipos1</span><span class="p">:</span><span class="n">ipos1</span><span class="p">).</span><span class="n">ge</span><span class="p">.</span><span class="s1">&#39;A&#39;</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="n">ipos1</span><span class="p">:</span><span class="n">ipos1</span><span class="p">).</span><span class="n">le</span><span class="p">.</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span> <span class="k">then</span>  <span class="c">! not a number, now assumed to  be a variable name</span>
<a name="ln-1405"></a>      <span class="k">value</span><span class="o">=</span> <span class="n">line</span><span class="p">(</span><span class="n">ipos1</span><span class="p">:</span><span class="n">ipos2</span><span class="p">)</span>                                      <span class="c">! extract substring that is assumed to be a variable name</span>
<a name="ln-1406"></a>      <span class="n">i</span><span class="o">=-</span><span class="mi">1</span>                                                          <span class="c">! this will be index where variable name is found in dictionary</span>
<a name="ln-1407"></a>      <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">G_numdef</span>                                               <span class="c">! scan variable dictionary for the variable name</span>
<a name="ln-1408"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">G_defvar</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="k">value</span><span class="p">)</span> <span class="k">exit</span>
<a name="ln-1409"></a><span class="k">      enddo</span>
<a name="ln-1410"></a><span class="k">      if</span> <span class="p">(</span><span class="n">i</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="n">G_numdef</span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="n">i</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>                              <span class="c">! if variable name not found in dictionary, stop</span>
<a name="ln-1411"></a>        <span class="k">call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(044) - UNDEFINED PARAMETER:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_source</span><span class="p">))</span>
<a name="ln-1412"></a>      <span class="k">endif</span>
<a name="ln-1413"></a><span class="k">      read</span><span class="p">(</span><span class="n">G_defval</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="s1">&#39;(i11)&#39;</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">ios</span><span class="p">)</span> <span class="n">get_integer_from_string</span>  <span class="c">! read integer value from the value associated with name</span>
<a name="ln-1414"></a>      <span class="k">if</span><span class="p">(</span><span class="n">ios</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>                                              <span class="c">! failed reading integer from value, stop</span>
<a name="ln-1415"></a>        <span class="k">call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(045) - MUST BE INTEGER:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_source</span><span class="p">))</span>
<a name="ln-1416"></a>      <span class="k">endif</span>
<a name="ln-1417"></a><span class="k">   else</span>                                                             <span class="c">! input is not a variable name, assume it represents an integer</span>
<a name="ln-1418"></a>      <span class="k">read</span><span class="p">(</span><span class="n">line</span><span class="p">(</span><span class="n">ipos1</span><span class="p">:</span><span class="n">ipos2</span><span class="p">),</span><span class="s1">&#39;(i11)&#39;</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">ios</span><span class="p">)</span> <span class="n">get_integer_from_string</span>   <span class="c">! try to read integer value from input string</span>
<a name="ln-1419"></a>      <span class="k">if</span><span class="p">(</span><span class="n">ios</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>                                              <span class="c">! failed to convert the string to an integer, so stop</span>
<a name="ln-1420"></a>        <span class="k">call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(046) - MUST BE INTEGER:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_source</span><span class="p">))</span>
<a name="ln-1421"></a>      <span class="k">endif</span>
<a name="ln-1422"></a><span class="k">   endif</span>                                                            <span class="c">! return integer value</span>
<a name="ln-1423"></a><span class="k">end function </span><span class="n">get_integer_from_string</span>
<a name="ln-1424"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1425"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-1426"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1427"></a><span class="k">subroutine </span><span class="n">rewrit</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="n">temp</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">j1</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">l1</span><span class="p">)</span>           <span class="c">!@(#)rewrit(3f):</span>
<a name="ln-1428"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">)</span>  <span class="n">line</span>
<a name="ln-1429"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">temp</span>
<a name="ln-1430"></a><span class="kt">integer</span>                    <span class="kd">::</span> <span class="n">j</span>
<a name="ln-1431"></a><span class="kt">integer</span>                    <span class="kd">::</span> <span class="n">j1</span>
<a name="ln-1432"></a><span class="kt">integer</span>                    <span class="kd">::</span> <span class="n">l</span>
<a name="ln-1433"></a><span class="kt">integer</span>                    <span class="kd">::</span> <span class="n">l1</span>
<a name="ln-1434"></a>
<a name="ln-1435"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mf">0.</span><span class="nb">and</span><span class="p">.</span><span class="n">l</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">line</span><span class="p">))</span> <span class="k">then</span>      <span class="c">! done</span>
<a name="ln-1436"></a>      <span class="n">line</span><span class="o">=</span><span class="n">temp</span>
<a name="ln-1437"></a>   <span class="n">elseif</span> <span class="p">(</span><span class="n">j</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>                          <span class="c">! first item</span>
<a name="ln-1438"></a>      <span class="n">line</span><span class="o">=</span><span class="n">temp</span><span class="o">//</span><span class="n">line</span><span class="p">(</span><span class="n">l1</span><span class="p">:)</span>
<a name="ln-1439"></a>   <span class="n">elseif</span> <span class="p">(</span><span class="n">l</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">line</span><span class="p">))</span> <span class="k">then</span>             <span class="c">! last item</span>
<a name="ln-1440"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">j1</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1441"></a><span class="k">         </span><span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="p">(:</span><span class="n">j1</span><span class="p">)</span><span class="o">//</span><span class="n">temp</span>
<a name="ln-1442"></a>      <span class="k">else</span>
<a name="ln-1443"></a><span class="k">         </span><span class="n">line</span><span class="o">=</span><span class="n">temp</span>
<a name="ln-1444"></a>      <span class="k">endif</span>
<a name="ln-1445"></a><span class="k">   else</span>                                          <span class="c">! middle item</span>
<a name="ln-1446"></a>        <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="p">(:</span><span class="n">j1</span><span class="p">)</span><span class="o">//</span><span class="n">temp</span><span class="o">//</span><span class="n">line</span><span class="p">(</span><span class="n">l1</span><span class="p">:)</span>
<a name="ln-1447"></a>   <span class="k">endif</span>
<a name="ln-1448"></a><span class="k">end subroutine </span><span class="n">rewrit</span>
<a name="ln-1449"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1450"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-1451"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1452"></a><span class="k">subroutine </span><span class="n">document</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>                    <span class="c">!@(#)document(3f): process BLOCK command to start or stop special processing</span>
<a name="ln-1453"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">opts</span>
<a name="ln-1454"></a><span class="kt">integer</span>                      <span class="kd">::</span> <span class="n">ierr</span>
<a name="ln-1455"></a><span class="kt">integer</span>                      <span class="kd">::</span> <span class="n">ios</span>
<a name="ln-1456"></a><span class="kt">integer</span>                      <span class="kd">::</span> <span class="n">i</span>
<a name="ln-1457"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">)</span> <span class="kd">::</span> <span class="k">options</span>                 <span class="c">! everything after first word of command till end of line or !</span>
<a name="ln-1458"></a>
<a name="ln-1459"></a><span class="c">! CHECK COMMAND SYNTAX</span>
<a name="ln-1460"></a>   <span class="k">if</span><span class="p">(</span><span class="n">G_outtype</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;help&#39;</span><span class="p">)</span><span class="k">then</span>  <span class="c">! if in &#39;help&#39; mode wrap up the routine</span>
<a name="ln-1461"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s2">&quot;&#39;&#39;]&quot;</span>
<a name="ln-1462"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s2">&quot;   WRITE(stdout,&#39;(a)&#39;)(trim(help_text(i)),i=1,size(help_text))&quot;</span>
<a name="ln-1463"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s2">&quot;   stop ! if --help was specified, stop&quot;</span>
<a name="ln-1464"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s2">&quot;endif&quot;</span>
<a name="ln-1465"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s2">&quot;end subroutine help_usage&quot;</span>
<a name="ln-1466"></a>      <span class="c">!x!write(G_iout,&#39;(&quot;!&quot;,a)&#39;)repeat(&#39;-&#39;,131)</span>
<a name="ln-1467"></a>   <span class="n">elseif</span><span class="p">(</span><span class="n">G_outtype</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;variable&#39;</span><span class="p">)</span><span class="k">then</span>     <span class="c">! if in &#39;variable&#39; mode wrap up the variable</span>
<a name="ln-1468"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s2">&quot;&#39;&#39;]&quot;</span>
<a name="ln-1469"></a>   <span class="n">elseif</span><span class="p">(</span><span class="n">G_outtype</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;system&#39;</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1470"></a><span class="k">         close</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">G_scratch_lun</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">ios</span><span class="p">)</span>
<a name="ln-1471"></a>         <span class="k">call </span><span class="nb">execute_command_line</span><span class="p">(</span> <span class="nb">trim</span><span class="p">(</span><span class="n">sget</span><span class="p">(</span><span class="s1">&#39;block_cmd&#39;</span><span class="p">))</span><span class="o">//</span><span class="s1">&#39; &lt; &#39;</span><span class="o">//</span><span class="n">G_scratch_file</span><span class="o">//</span><span class="s1">&#39; &gt; &#39;</span><span class="o">//</span><span class="n">G_scratch_file</span><span class="o">//</span><span class="s1">&#39;.out&#39;</span><span class="p">)</span>
<a name="ln-1472"></a>         <span class="n">ierr</span><span class="o">=</span><span class="n">filedelete</span><span class="p">(</span><span class="n">G_scratch_file</span><span class="p">)</span>
<a name="ln-1473"></a>         <span class="k">options</span><span class="o">=</span><span class="n">G_scratch_file</span><span class="o">//</span><span class="s1">&#39;.out&#39;</span>
<a name="ln-1474"></a>         <span class="k">call include</span><span class="p">(</span><span class="k">options</span><span class="p">,</span><span class="mi">50</span><span class="o">+</span><span class="n">G_iocount</span><span class="p">)</span>    <span class="c">! Filenames can be case sensitive</span>
<a name="ln-1475"></a>   <span class="n">elseif</span><span class="p">(</span><span class="n">G_outtype</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;version&#39;</span><span class="p">)</span><span class="k">then</span>  <span class="c">! if in &#39;version&#39; mode wrap up the routine</span>
<a name="ln-1476"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(&quot;&#39;&#39;@(#)COMPILED:       &quot;,a,&quot;&#39;&#39;,&amp;&quot;)&#39;</span><span class="p">)</span> <span class="n">getdate</span><span class="p">(</span><span class="s1">&#39;long&#39;</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;&gt;&#39;</span>
<a name="ln-1477"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s2">&quot;&#39;&#39;]&quot;</span>
<a name="ln-1478"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s2">&quot;   WRITE(stdout,&#39;(a)&#39;)(trim(help_text(i)(5:len_trim(help_text(i))-1)),i=1,size(help_text))&quot;</span>
<a name="ln-1479"></a>      <span class="c">!x!write(G_iout,&#39;(a)&#39;)&#39;   write(stdout,*)&quot;COMPILER VERSION=&quot;,COMPILER_VERSION()&#39;</span>
<a name="ln-1480"></a>      <span class="c">!x!write(G_iout,&#39;(a)&#39;)&#39;   write(stdout,*)&quot;COMPILER OPTIONS=&quot;,COMPILER_OPTIONS()&#39;</span>
<a name="ln-1481"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s2">&quot;   stop ! if --version was specified, stop&quot;</span>
<a name="ln-1482"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s2">&quot;endif&quot;</span>
<a name="ln-1483"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s2">&quot;end subroutine help_version&quot;</span>
<a name="ln-1484"></a>      <span class="c">!x!write(G_iout,&#39;(&quot;!&quot;,a)&#39;)repeat(&#39;-&#39;,131)</span>
<a name="ln-1485"></a>   <span class="k">endif</span>
<a name="ln-1486"></a>
<a name="ln-1487"></a><span class="k">   call </span><span class="n">dissect2</span><span class="p">(</span><span class="s1">&#39;block&#39;</span><span class="p">,</span><span class="s1">&#39;--oo --file --cmd sh --varname textblock --append .false.&#39;</span><span class="p">,</span><span class="n">opts</span><span class="p">)</span> <span class="c">! parse options on input line</span>
<a name="ln-1488"></a>   <span class="c">! if a previous command has opened a --file FILENAME flush it, because a new one is being opened or this is an END command</span>
<a name="ln-1489"></a>   <span class="c">! and if a --file FILENAME has been selected open it</span>
<a name="ln-1490"></a>   <span class="k">call </span><span class="n">print_comment_block</span><span class="p">()</span>
<a name="ln-1491"></a>
<a name="ln-1492"></a>   <span class="c">! now can start new section</span>
<a name="ln-1493"></a>   <span class="n">G_MAN</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
<a name="ln-1494"></a>   <span class="k">if</span><span class="p">(</span><span class="n">sget</span><span class="p">(</span><span class="s1">&#39;block_file&#39;</span><span class="p">).</span><span class="n">ne</span><span class="p">.</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1495"></a><span class="k">      </span><span class="n">G_MAN_FILE</span><span class="o">=</span><span class="n">sget</span><span class="p">(</span><span class="s1">&#39;block_file&#39;</span><span class="p">)</span>
<a name="ln-1496"></a>      <span class="n">G_MAN_COLLECT</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-1497"></a>   <span class="k">else</span>
<a name="ln-1498"></a><span class="k">      </span><span class="n">G_MAN_FILE</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
<a name="ln-1499"></a>      <span class="n">G_MAN_COLLECT</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-1500"></a>   <span class="k">endif</span>
<a name="ln-1501"></a>
<a name="ln-1502"></a><span class="k">   </span><span class="n">G_MAN_PRINT</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-1503"></a>   <span class="k">if</span><span class="p">(</span><span class="n">lget</span><span class="p">(</span><span class="s1">&#39;block_append&#39;</span><span class="p">))</span><span class="k">then</span>
<a name="ln-1504"></a><span class="k">      </span><span class="n">G_MAN_FILE_POSITION</span><span class="o">=</span><span class="s1">&#39;APPEND&#39;</span>
<a name="ln-1505"></a>   <span class="k">else</span>
<a name="ln-1506"></a><span class="k">      </span><span class="n">G_MAN_FILE_POSITION</span><span class="o">=</span><span class="s1">&#39;ASIS&#39;</span>
<a name="ln-1507"></a>   <span class="k">endif</span>
<a name="ln-1508"></a>
<a name="ln-1509"></a><span class="k">   select case</span><span class="p">(</span><span class="n">upper</span><span class="p">(</span><span class="n">sget</span><span class="p">(</span><span class="s1">&#39;block_oo&#39;</span><span class="p">)))</span>
<a name="ln-1510"></a>
<a name="ln-1511"></a>   <span class="k">case</span><span class="p">(</span><span class="s1">&#39;COMMENT&#39;</span><span class="p">)</span>
<a name="ln-1512"></a>      <span class="n">G_outtype</span><span class="o">=</span><span class="s1">&#39;comment&#39;</span>
<a name="ln-1513"></a>      <span class="n">G_MAN_PRINT</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-1514"></a>      <span class="n">G_MAN_COLLECT</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-1515"></a>
<a name="ln-1516"></a>   <span class="k">case</span><span class="p">(</span><span class="s1">&#39;NULL&#39;</span><span class="p">)</span>
<a name="ln-1517"></a>      <span class="n">G_outtype</span><span class="o">=</span><span class="s1">&#39;null&#39;</span>
<a name="ln-1518"></a>
<a name="ln-1519"></a>   <span class="k">case</span><span class="p">(</span><span class="s1">&#39;SET&#39;</span><span class="p">)</span>
<a name="ln-1520"></a>      <span class="n">G_outtype</span><span class="o">=</span><span class="s1">&#39;set&#39;</span>
<a name="ln-1521"></a>      <span class="n">G_MAN_PRINT</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-1522"></a>      <span class="n">G_MAN_COLLECT</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-1523"></a>   <span class="k">case</span><span class="p">(</span><span class="s1">&#39;DEFINE&#39;</span><span class="p">)</span>
<a name="ln-1524"></a>      <span class="n">G_outtype</span><span class="o">=</span><span class="s1">&#39;define&#39;</span>
<a name="ln-1525"></a>      <span class="n">G_MAN_PRINT</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-1526"></a>      <span class="n">G_MAN_COLLECT</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-1527"></a>   <span class="k">case</span><span class="p">(</span><span class="s1">&#39;REDEFINE&#39;</span><span class="p">)</span>
<a name="ln-1528"></a>      <span class="n">G_outtype</span><span class="o">=</span><span class="s1">&#39;redefine&#39;</span>
<a name="ln-1529"></a>      <span class="n">G_MAN_PRINT</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-1530"></a>      <span class="n">G_MAN_COLLECT</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-1531"></a>   <span class="k">case</span><span class="p">(</span><span class="s1">&#39;MESSAGE&#39;</span><span class="p">)</span>
<a name="ln-1532"></a>      <span class="n">G_outtype</span><span class="o">=</span><span class="s1">&#39;message&#39;</span>
<a name="ln-1533"></a>      <span class="n">G_MAN_PRINT</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-1534"></a>      <span class="n">G_MAN_COLLECT</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-1535"></a>
<a name="ln-1536"></a>   <span class="k">case</span><span class="p">(</span><span class="s1">&#39;SHELL&#39;</span><span class="p">,</span><span class="s1">&#39;SYSTEM&#39;</span><span class="p">)</span>
<a name="ln-1537"></a>      <span class="n">G_outtype</span><span class="o">=</span><span class="s1">&#39;system&#39;</span>
<a name="ln-1538"></a>      <span class="n">G_MAN_PRINT</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-1539"></a>      <span class="n">G_MAN_COLLECT</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-1540"></a>      <span class="k">if</span><span class="p">(</span><span class="n">G_system_on</span><span class="p">)</span><span class="k">then</span>                             <span class="c">! if allowing commands to be executed</span>
<a name="ln-1541"></a>         <span class="nb">flush</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">G_iout</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">ios</span><span class="p">)</span>
<a name="ln-1542"></a>         <span class="c">!!G_scratch_file=scratch(&#39;prep_scratch.&#39;))</span>
<a name="ln-1543"></a>         <span class="n">G_scratch_file</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">uniq</span><span class="p">(</span><span class="n">get_tmp</span><span class="p">()</span><span class="o">//</span><span class="s1">&#39;prep_scratch.&#39;</span><span class="p">))</span>  <span class="c">!! THIS HAS TO BE A UNIQUE NAME -- IMPROVE THIS</span>
<a name="ln-1544"></a>         <span class="n">G_scratch_lun</span><span class="o">=</span><span class="n">fileopen</span><span class="p">(</span><span class="n">G_scratch_file</span><span class="p">,</span><span class="s1">&#39;rw&#39;</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-1545"></a>         <span class="k">if</span><span class="p">(</span><span class="n">ierr</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1546"></a><span class="k">            call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(048) - FILTER COMMAND FAILED TO OPEN PROCESS:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_SOURCE</span><span class="p">))</span>
<a name="ln-1547"></a>         <span class="k">endif</span>
<a name="ln-1548"></a><span class="k">      else</span>
<a name="ln-1549"></a><span class="k">         call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(049) - FILTER COMMAND BLOCK ENCOUNTERED BUT SYSTEM COMMANDS NOT ENABLED:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_SOURCE</span><span class="p">))</span>
<a name="ln-1550"></a>      <span class="k">endif</span>
<a name="ln-1551"></a>
<a name="ln-1552"></a><span class="k">   case</span><span class="p">(</span><span class="s1">&#39;VARIABLE&#39;</span><span class="p">)</span>
<a name="ln-1553"></a>      <span class="n">G_outtype</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span>
<a name="ln-1554"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="nb">trim</span><span class="p">(</span><span class="n">sget</span><span class="p">(</span><span class="s1">&#39;block_varname&#39;</span><span class="p">))</span><span class="o">//</span><span class="s1">&#39;=[ CHARACTER(LEN=128) :: &amp;&#39;</span>
<a name="ln-1555"></a>      <span class="n">G_MAN_PRINT</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-1556"></a>
<a name="ln-1557"></a>   <span class="k">case</span><span class="p">(</span><span class="s1">&#39;HELP&#39;</span><span class="p">)</span>
<a name="ln-1558"></a>      <span class="n">G_outtype</span><span class="o">=</span><span class="s1">&#39;help&#39;</span>
<a name="ln-1559"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s1">&#39;subroutine help_usage(l_help)&#39;</span>
<a name="ln-1560"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s1">&#39;implicit none&#39;</span>
<a name="ln-1561"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s1">&#39;character(len=*),parameter     :: ident=&quot;@(#)help_usage(3f): prints help information&quot;&#39;</span>
<a name="ln-1562"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s1">&#39;logical,intent(in)             :: l_help&#39;</span>
<a name="ln-1563"></a>      <span class="c">!write(G_iout,&#39;(a)&#39;)&#39;character(len=128),allocatable :: help_text(:)&#39;</span>
<a name="ln-1564"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s1">&#39;character(len=:),allocatable :: help_text(:)&#39;</span>
<a name="ln-1565"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s1">&#39;integer                        :: i&#39;</span>
<a name="ln-1566"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s1">&#39;logical                        :: stopit=.false.&#39;</span>
<a name="ln-1567"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s1">&#39;stopit=.false.&#39;</span>
<a name="ln-1568"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s1">&#39;if(l_help)then&#39;</span>
<a name="ln-1569"></a><span class="c">! NOTE: Without the type specification this constructor would have to specify all of the constants with the same character length.</span>
<a name="ln-1570"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s1">&#39;help_text=[ CHARACTER(LEN=128) :: &amp;&#39;</span>
<a name="ln-1571"></a>
<a name="ln-1572"></a>         <span class="k">select case</span><span class="p">(</span><span class="n">G_comment_style</span><span class="p">)</span>  <span class="c">! duplicate help text as a comment for some code documentation utilities</span>
<a name="ln-1573"></a>         <span class="k">case</span><span class="p">(</span><span class="s1">&#39;doxygen&#39;</span><span class="p">)</span>               <span class="c">! convert plain text to doxygen comment blocks with some automatic markdown highlights</span>
<a name="ln-1574"></a>            <span class="n">G_MAN_PRINT</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-1575"></a>         <span class="k">case</span><span class="p">(</span><span class="s1">&#39;fort&#39;</span><span class="p">)</span>                  <span class="c">! convert plain text to ford  comment blocks with some automatic markdown highlights</span>
<a name="ln-1576"></a>            <span class="n">G_MAN_PRINT</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-1577"></a>         <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>                  <span class="c">! do not print comment lines from block</span>
<a name="ln-1578"></a>            <span class="n">G_MAN_PRINT</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-1579"></a>         <span class="k">case </span><span class="n">default</span>
<a name="ln-1580"></a>         <span class="k">end select</span>
<a name="ln-1581"></a>
<a name="ln-1582"></a><span class="k">   case</span><span class="p">(</span><span class="s1">&#39;VERSION&#39;</span><span class="p">)</span>
<a name="ln-1583"></a>      <span class="n">G_outtype</span><span class="o">=</span><span class="s1">&#39;version&#39;</span>
<a name="ln-1584"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s1">&#39;subroutine help_version(l_version)&#39;</span>
<a name="ln-1585"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s1">&#39;implicit none&#39;</span>
<a name="ln-1586"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s1">&#39;character(len=*),parameter     :: ident=&quot;@(#)help_version(3f): prints version information&quot;&#39;</span>
<a name="ln-1587"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s1">&#39;logical,intent(in)             :: l_version&#39;</span>
<a name="ln-1588"></a>      <span class="c">!write(G_iout,&#39;(a)&#39;)&#39;character(len=128),allocatable :: help_text(:)&#39;</span>
<a name="ln-1589"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s1">&#39;character(len=:),allocatable   :: help_text(:)&#39;</span>
<a name="ln-1590"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s1">&#39;integer                        :: i&#39;</span>
<a name="ln-1591"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s1">&#39;logical                        :: stopit=.false.&#39;</span>
<a name="ln-1592"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s1">&#39;stopit=.false.&#39;</span>
<a name="ln-1593"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s1">&#39;if(l_version)then&#39;</span>
<a name="ln-1594"></a><span class="c">! NOTE: Without the type specification this constructor would have to specify all of the constants with the same character length.</span>
<a name="ln-1595"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s1">&#39;help_text=[ CHARACTER(LEN=128) :: &amp;&#39;</span>
<a name="ln-1596"></a>
<a name="ln-1597"></a>   <span class="k">case</span><span class="p">(</span><span class="s1">&#39;WRITE&#39;</span><span class="p">)</span>
<a name="ln-1598"></a>      <span class="n">G_outtype</span><span class="o">=</span><span class="s1">&#39;write&#39;</span>
<a name="ln-1599"></a>   <span class="k">case</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;END&#39;</span><span class="p">)</span>
<a name="ln-1600"></a>      <span class="n">G_outtype</span><span class="o">=</span><span class="s1">&#39;asis&#39;</span>
<a name="ln-1601"></a>      <span class="n">G_MAN_COLLECT</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-1602"></a>   <span class="k">case</span><span class="p">(</span><span class="s1">&#39;ASIS&#39;</span><span class="p">)</span>
<a name="ln-1603"></a>      <span class="n">G_outtype</span><span class="o">=</span><span class="s1">&#39;asis&#39;</span>
<a name="ln-1604"></a>   <span class="k">case </span><span class="n">default</span>
<a name="ln-1605"></a>      <span class="k">call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(047) - UNEXPECTED &quot;BLOCK&quot; OPTION. FOUND:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">sget</span><span class="p">(</span><span class="s1">&#39;block_oo&#39;</span><span class="p">))</span><span class="o">//</span><span class="s1">&#39; IN &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_source</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-1606"></a>   <span class="k">end select</span>
<a name="ln-1607"></a>
<a name="ln-1608"></a><span class="k">   </span><span class="n">G_comment_count</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-1609"></a><span class="k">end subroutine </span><span class="n">document</span>
<a name="ln-1610"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1611"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-1612"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1613"></a><span class="k">subroutine </span><span class="n">print_comment_block</span><span class="p">()</span> <span class="c">!@(#)print_comment_block(3f): format comment block to file in document directory and output</span>
<a name="ln-1614"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">filename</span>
<a name="ln-1615"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">varvalue</span>
<a name="ln-1616"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">parameter</span>   <span class="kd">::</span> <span class="n">varname</span><span class="o">=</span><span class="s1">&#39;PREP_DOCUMENT_DIR&#39;</span>
<a name="ln-1617"></a><span class="kt">integer</span>                      <span class="kd">::</span> <span class="n">ios</span><span class="p">,</span><span class="n">iend</span><span class="p">,</span><span class="n">istatus</span><span class="p">,</span><span class="n">ilength</span>
<a name="ln-1618"></a>
<a name="ln-1619"></a>   <span class="k">if</span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">allocated</span><span class="p">(</span><span class="n">G_MAN</span><span class="p">))</span><span class="k">then</span>
<a name="ln-1620"></a><span class="k">      return</span>
<a name="ln-1621"></a><span class="k">   endif</span>
<a name="ln-1622"></a>
<a name="ln-1623"></a><span class="k">   call </span><span class="nb">get_environment_variable</span><span class="p">(</span><span class="n">varname</span><span class="p">,</span><span class="n">length</span><span class="o">=</span><span class="n">ilength</span><span class="p">,</span><span class="n">status</span><span class="o">=</span><span class="n">istatus</span><span class="p">)</span>
<a name="ln-1624"></a>   <span class="k">if</span><span class="p">(</span><span class="n">istatus</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="n">ilength</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-1625"></a>   <span class="k">if</span><span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">varvalue</span><span class="p">))</span><span class="k">deallocate</span><span class="p">(</span><span class="n">varvalue</span><span class="p">)</span>
<a name="ln-1626"></a>   <span class="k">allocate</span><span class="p">(</span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">ilength</span><span class="p">)</span> <span class="kd">::</span> <span class="n">varvalue</span><span class="p">)</span>
<a name="ln-1627"></a>   <span class="k">call </span><span class="nb">get_environment_variable</span><span class="p">(</span><span class="n">varname</span><span class="p">,</span><span class="k">value</span><span class="o">=</span><span class="n">varvalue</span><span class="p">,</span><span class="n">status</span><span class="o">=</span><span class="n">istatus</span><span class="p">)</span>
<a name="ln-1628"></a>   <span class="k">select case</span><span class="p">(</span><span class="n">istatus</span><span class="p">)</span>
<a name="ln-1629"></a>   <span class="k">case</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a name="ln-1630"></a>   <span class="k">case</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span><span class="k">call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(051) - VARIABLE VALUE TOO LONG:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">varname</span><span class="p">))</span>
<a name="ln-1631"></a>   <span class="k">case</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c">! VARIABLE DOES NOT EXIST</span>
<a name="ln-1632"></a>   <span class="k">case</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="k">call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(052) - COMPILER DOES NOT SUPPORT ENVIRONMENT VARIABLES:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">varname</span><span class="p">))</span>
<a name="ln-1633"></a>   <span class="k">case </span><span class="n">default</span><span class="p">;</span> <span class="k">call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(053) - UNEXPECTED STATUS VALUE &#39;</span><span class="o">//</span><span class="n">v2s</span><span class="p">(</span><span class="n">istatus</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">varname</span><span class="p">))</span>
<a name="ln-1634"></a>   <span class="k">end select</span>
<a name="ln-1635"></a>
<a name="ln-1636"></a><span class="k">   if</span><span class="p">(</span><span class="n">ilength</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mf">0.</span><span class="nb">and</span><span class="p">.</span><span class="n">G_MAN</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="s1">&#39;&#39;</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">G_MAN_FILE</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="k">then</span> <span class="c">! if $BLOCK ... --file FILE is present generate file in directory/doc</span>
<a name="ln-1637"></a>      <span class="n">filename</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">varvalue</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;/doc/&#39;</span>
<a name="ln-1638"></a>
<a name="ln-1639"></a>      <span class="n">iend</span><span class="o">=</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">varvalue</span><span class="p">)</span>
<a name="ln-1640"></a>
<a name="ln-1641"></a>      <span class="k">if</span><span class="p">(</span><span class="n">varvalue</span><span class="p">(</span><span class="n">iend</span><span class="p">:</span><span class="n">iend</span><span class="p">).</span><span class="n">ne</span><span class="p">.</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1642"></a><span class="k">         </span><span class="n">filename</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">varvalue</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;/doc/&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_MAN_FILE</span><span class="p">)</span>
<a name="ln-1643"></a>      <span class="k">else</span>
<a name="ln-1644"></a><span class="k">         </span><span class="n">filename</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">varvalue</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;doc/&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_MAN_FILE</span><span class="p">)</span>
<a name="ln-1645"></a>      <span class="k">endif</span>
<a name="ln-1646"></a>
<a name="ln-1647"></a><span class="k">      if</span><span class="p">(</span><span class="n">filename</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;OOPS.txt&#39;</span>
<a name="ln-1648"></a>
<a name="ln-1649"></a>      <span class="k">open</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span><span class="k">file</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">ios</span><span class="p">,</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;write&#39;</span><span class="p">,</span><span class="n">position</span><span class="o">=</span><span class="n">G_MAN_FILE_POSITION</span><span class="p">)</span>
<a name="ln-1650"></a>
<a name="ln-1651"></a>      <span class="k">if</span><span class="p">(</span><span class="n">ios</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1652"></a>
<a name="ln-1653"></a><span class="k">         call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(054) - FAILED TO OPEN DOCUMENT OUTPUT FILE:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
<a name="ln-1654"></a>      <span class="k">else</span>
<a name="ln-1655"></a><span class="k">         if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">G_MAN</span><span class="p">).</span><span class="n">gt</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="k">then</span>                   <span class="c">! the way the string is built it starts with a newline</span>
<a name="ln-1656"></a>            <span class="k">write</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">ios</span><span class="p">)</span> <span class="n">G_MAN</span><span class="p">(</span><span class="mi">2</span><span class="p">:)</span>
<a name="ln-1657"></a>         <span class="k">else</span>
<a name="ln-1658"></a><span class="k">            write</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">ios</span><span class="p">)</span> <span class="n">G_MAN</span>
<a name="ln-1659"></a>         <span class="k">endif</span>
<a name="ln-1660"></a><span class="k">         if</span><span class="p">(</span><span class="n">ios</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1661"></a><span class="k">            call </span><span class="n">write_err</span><span class="p">(</span><span class="s1">&#39;G_MAN=&#39;</span><span class="o">//</span><span class="n">G_MAN</span><span class="p">)</span>
<a name="ln-1662"></a>            <span class="k">call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(055) - FAILED TO WRITE OUTPUT FILE:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
<a name="ln-1663"></a>         <span class="k">endif</span>
<a name="ln-1664"></a><span class="k">      endif</span>
<a name="ln-1665"></a>
<a name="ln-1666"></a><span class="k">      close</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">ios</span><span class="p">)</span>
<a name="ln-1667"></a>
<a name="ln-1668"></a>   <span class="k">endif</span>
<a name="ln-1669"></a>
<a name="ln-1670"></a>   <span class="c">! now if $BLOCK COMMENT print comment block</span>
<a name="ln-1671"></a>   <span class="k">if</span><span class="p">(</span><span class="n">G_MAN_PRINT</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1672"></a><span class="k">      call </span><span class="n">format_G_MAN</span><span class="p">()</span>
<a name="ln-1673"></a>   <span class="k">endif</span>
<a name="ln-1674"></a>
<a name="ln-1675"></a><span class="k">end subroutine </span><span class="n">print_comment_block</span>
<a name="ln-1676"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1677"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-1678"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1679"></a><span class="k">subroutine </span><span class="n">format_g_man</span><span class="p">()</span>
<a name="ln-1680"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span>   <span class="kd">::</span> <span class="n">array1</span><span class="p">(:)</span>   <span class="c">! output array of tokens</span>
<a name="ln-1681"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span>   <span class="kd">::</span> <span class="k">array</span><span class="p">(:)</span>    <span class="c">! output array of tokens</span>
<a name="ln-1682"></a><span class="kt">integer</span>                        <span class="kd">::</span> <span class="n">ios</span>
<a name="ln-1683"></a><span class="kt">integer</span>                        <span class="kd">::</span> <span class="n">i</span>
<a name="ln-1684"></a>
<a name="ln-1685"></a>   <span class="k">ALL</span><span class="p">:</span> <span class="k">block</span>
<a name="ln-1686"></a><span class="k">      </span><span class="n">WRITEIT</span><span class="p">:</span> <span class="k">block</span>
<a name="ln-1687"></a>
<a name="ln-1688"></a><span class="k">         select case</span><span class="p">(</span><span class="n">G_comment_style</span><span class="p">)</span>
<a name="ln-1689"></a>
<a name="ln-1690"></a>         <span class="k">case</span><span class="p">(</span><span class="s1">&#39;doxygen&#39;</span><span class="p">)</span>                 <span class="c">! convert plain text to doxygen comment blocks with some automatic markdown highlights</span>
<a name="ln-1691"></a>            <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">G_MAN</span><span class="p">).</span><span class="n">gt</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="k">then</span>      <span class="c">! the way the string is built it starts with a newline</span>
<a name="ln-1692"></a>
<a name="ln-1693"></a>               <span class="k">CALL </span><span class="n">split</span><span class="p">(</span><span class="n">G_MAN</span><span class="p">,</span><span class="n">array1</span><span class="p">,</span><span class="n">delimiters</span><span class="o">=</span><span class="nb">new_line</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">),</span><span class="n">nulls</span><span class="o">=</span><span class="s1">&#39;return&#39;</span><span class="p">)</span> <span class="c">! parse string to an array parsing on delimiters</span>
<a name="ln-1694"></a>               <span class="k">if</span><span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="k">array</span><span class="p">))</span><span class="k">deallocate</span><span class="p">(</span><span class="k">array</span><span class="p">)</span>
<a name="ln-1695"></a>               <span class="k">allocate</span><span class="p">(</span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">array1</span><span class="p">)</span><span class="o">+</span><span class="mi">6</span><span class="p">)</span> <span class="kd">::</span> <span class="k">array</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">array1</span><span class="p">)))</span>  <span class="c">! make room for !! and ##</span>
<a name="ln-1696"></a>               <span class="k">array</span><span class="p">(:)</span><span class="o">=</span><span class="n">array1</span>
<a name="ln-1697"></a>               <span class="k">deallocate</span><span class="p">(</span><span class="n">array1</span><span class="p">)</span>
<a name="ln-1698"></a>
<a name="ln-1699"></a>               <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="k">array</span><span class="p">)</span>        <span class="c">! lines starting with a letter and all uppercase letters is prefixed with &quot;##&quot;</span>
<a name="ln-1700"></a>                  <span class="k">if</span><span class="p">(</span> <span class="n">upper</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="n">i</span><span class="p">)).</span><span class="n">eq</span><span class="p">.</span><span class="k">array</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">isalpha</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="n">i</span><span class="p">)(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)).</span><span class="nb">and</span><span class="p">.</span><span class="n">lower</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="n">i</span><span class="p">)).</span><span class="n">ne</span><span class="p">.</span><span class="k">array</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="k">then</span>
<a name="ln-1701"></a><span class="k">                     array</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="s1">&#39;##&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-1702"></a>                     <span class="k">select case</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-1703"></a>                     <span class="k">case</span><span class="p">(</span><span class="s1">&#39;##SYNOPSIS&#39;</span><span class="p">,</span><span class="s1">&#39;##EXAMPLES&#39;</span><span class="p">,</span><span class="s1">&#39;##EXAMPLE&#39;</span><span class="p">)</span>
<a name="ln-1704"></a>                        <span class="k">array</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">//</span><span class="nb">new_line</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;!&#39;</span><span class="o">//</span><span class="s1">&#39;!&#39;</span>
<a name="ln-1705"></a>                     <span class="k">endselect</span>
<a name="ln-1706"></a><span class="k">                  else</span>
<a name="ln-1707"></a><span class="k">                     array</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-1708"></a>                  <span class="k">endif</span>
<a name="ln-1709"></a><span class="k">               enddo</span>
<a name="ln-1710"></a>
<a name="ln-1711"></a><span class="k">               if</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="k">array</span><span class="p">).</span><span class="n">gt</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1712"></a><span class="k">                  write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(&quot;!&quot;,&quot;&gt;&quot;,a)&#39;</span><span class="p">)</span><span class="nb">trim</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-1713"></a>               <span class="k">endif</span>
<a name="ln-1714"></a>
<a name="ln-1715"></a><span class="k">               do </span><span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="k">array</span><span class="p">)</span>
<a name="ln-1716"></a>                  <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(&quot;!&quot;,&quot;!&quot;,a)&#39;</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">ios</span><span class="p">)</span><span class="nb">trim</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-1717"></a>                  <span class="k">if</span><span class="p">(</span><span class="n">ios</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">exit </span><span class="n">WRITEIT</span>
<a name="ln-1718"></a>               <span class="k">enddo</span>
<a name="ln-1719"></a>
<a name="ln-1720"></a><span class="k">            endif</span>
<a name="ln-1721"></a>            <span class="c">!x!write(G_iout,&#39;(&quot;!&quot;,131(&quot;=&quot;))&#39;)</span>
<a name="ln-1722"></a>
<a name="ln-1723"></a>         <span class="k">case</span><span class="p">(</span><span class="s1">&#39;ford&#39;</span><span class="p">)</span>                    <span class="c">! convert plain text to doxygen comment blocks with some automatic markdown highlights</span>
<a name="ln-1724"></a>            <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">G_MAN</span><span class="p">).</span><span class="n">gt</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="k">then</span>      <span class="c">! the way the string is built it starts with a newline</span>
<a name="ln-1725"></a>               <span class="k">CALL </span><span class="n">split</span><span class="p">(</span><span class="n">G_MAN</span><span class="p">,</span><span class="n">array1</span><span class="p">,</span><span class="n">delimiters</span><span class="o">=</span><span class="nb">new_line</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">),</span><span class="n">nulls</span><span class="o">=</span><span class="s1">&#39;return&#39;</span><span class="p">)</span> <span class="c">! parse string to an array parsing on delimiters</span>
<a name="ln-1726"></a>               <span class="c">!======================================================================================== nvfortran bug</span>
<a name="ln-1727"></a>               <span class="c">! array=[character(len=(len(array1)+6)) :: array1] !! pad with trailing spaces</span>
<a name="ln-1728"></a>
<a name="ln-1729"></a>               <span class="k">if</span><span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="k">array</span><span class="p">))</span><span class="k">deallocate</span><span class="p">(</span><span class="k">array</span><span class="p">)</span>
<a name="ln-1730"></a>               <span class="k">allocate</span><span class="p">(</span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">array1</span><span class="p">)</span><span class="o">+</span><span class="mi">6</span><span class="p">)</span> <span class="kd">::</span> <span class="k">array</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">array1</span><span class="p">)))</span>  <span class="c">! make room for !! and ##</span>
<a name="ln-1731"></a>               <span class="k">array</span><span class="p">(:)</span><span class="o">=</span><span class="n">array1</span>
<a name="ln-1732"></a>               <span class="c">!========================================================================================</span>
<a name="ln-1733"></a>               <span class="k">deallocate</span><span class="p">(</span><span class="n">array1</span><span class="p">)</span>
<a name="ln-1734"></a>
<a name="ln-1735"></a>               <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="k">array</span><span class="p">)</span>        <span class="c">! lines starting with a letter and all uppercase letters is prefixed with &quot;##&quot;</span>
<a name="ln-1736"></a>                  <span class="k">if</span><span class="p">(</span> <span class="n">upper</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="n">i</span><span class="p">)).</span><span class="n">eq</span><span class="p">.</span><span class="k">array</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">isalpha</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="n">i</span><span class="p">)(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)).</span><span class="nb">and</span><span class="p">.</span><span class="n">lower</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="n">i</span><span class="p">)).</span><span class="n">ne</span><span class="p">.</span><span class="k">array</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="k">then</span>
<a name="ln-1737"></a><span class="k">                     array</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="s1">&#39;## &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-1738"></a>                     <span class="k">select case</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-1739"></a>                     <span class="k">case</span><span class="p">(</span><span class="s1">&#39;## SYNOPSIS&#39;</span><span class="p">,</span><span class="s1">&#39;## EXAMPLES&#39;</span><span class="p">,</span><span class="s1">&#39;## EXAMPLE&#39;</span><span class="p">)</span>
<a name="ln-1740"></a>                        <span class="k">array</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">//</span><span class="nb">new_line</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;!&gt;&#39;</span>
<a name="ln-1741"></a>                     <span class="k">endselect</span>
<a name="ln-1742"></a><span class="k">                  else</span>
<a name="ln-1743"></a><span class="k">                     array</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-1744"></a>                  <span class="k">endif</span>
<a name="ln-1745"></a><span class="k">               enddo</span>
<a name="ln-1746"></a>
<a name="ln-1747"></a><span class="k">               if</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="k">array</span><span class="p">).</span><span class="n">gt</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1748"></a><span class="k">                  write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(&quot;!&gt;&quot;,a)&#39;</span><span class="p">)</span><span class="nb">trim</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-1749"></a>               <span class="k">endif</span>
<a name="ln-1750"></a>
<a name="ln-1751"></a><span class="k">               do </span><span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="k">array</span><span class="p">)</span>
<a name="ln-1752"></a>                  <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(&quot;!&gt;&quot;,a)&#39;</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">ios</span><span class="p">)</span><span class="nb">trim</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-1753"></a>                  <span class="k">if</span><span class="p">(</span><span class="n">ios</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">exit </span><span class="n">WRITEIT</span>
<a name="ln-1754"></a>               <span class="k">enddo</span>
<a name="ln-1755"></a>
<a name="ln-1756"></a><span class="k">            endif</span>
<a name="ln-1757"></a>            <span class="c">!x!write(G_iout,&#39;(&quot;!&gt;&quot;,131(&quot;=&quot;))&#39;)</span>
<a name="ln-1758"></a>
<a name="ln-1759"></a>         <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>                    <span class="c">! ignore comment block</span>
<a name="ln-1760"></a>
<a name="ln-1761"></a>         <span class="k">case </span><span class="n">default</span>
<a name="ln-1762"></a>            <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">G_MAN</span><span class="p">).</span><span class="n">gt</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="k">then</span>                       <span class="c">! the way the string is built it starts with a newline</span>
<a name="ln-1763"></a>               <span class="n">G_MAN</span><span class="o">=</span><span class="n">G_MAN</span><span class="p">(</span><span class="mi">2</span><span class="p">:)</span><span class="o">//</span><span class="nb">repeat</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">G_MAN</span><span class="p">))</span>  <span class="c">! make sure the white-space exists</span>
<a name="ln-1764"></a>               <span class="k">call </span><span class="n">substitute</span><span class="p">(</span><span class="n">G_MAN</span><span class="p">,</span><span class="nb">NEW_LINE</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">),</span><span class="nb">NEW_LINE</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;! &#39;</span><span class="p">)</span>
<a name="ln-1765"></a>               <span class="n">G_MAN</span><span class="o">=</span><span class="s1">&#39;! &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_MAN</span><span class="p">)</span>
<a name="ln-1766"></a>            <span class="k">endif</span>
<a name="ln-1767"></a><span class="k">            write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">ios</span><span class="p">)</span> <span class="n">G_MAN</span>
<a name="ln-1768"></a>            <span class="k">if</span><span class="p">(</span><span class="n">ios</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">exit </span><span class="n">WRITEIT</span>
<a name="ln-1769"></a>            <span class="c">!x!write(G_iout,&#39;(&quot;!&quot;,131(&quot;=&quot;))&#39;)</span>
<a name="ln-1770"></a>         <span class="k">end select</span>
<a name="ln-1771"></a>
<a name="ln-1772"></a><span class="k">         exit ALL</span>
<a name="ln-1773"></a><span class="k">      endblock </span><span class="n">WRITEIT</span>
<a name="ln-1774"></a>      <span class="k">call </span><span class="n">write_err</span><span class="p">(</span><span class="s1">&#39;G_MAN=&#39;</span><span class="o">//</span><span class="n">G_MAN</span><span class="p">)</span>
<a name="ln-1775"></a>      <span class="k">call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(056) - FAILED TO WRITE COMMENT BLOCK&#39;</span><span class="p">)</span>
<a name="ln-1776"></a>   <span class="k">endblock ALL</span>
<a name="ln-1777"></a><span class="k">end subroutine </span><span class="n">format_g_man</span>
<a name="ln-1778"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1779"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-1780"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1781"></a><span class="k">subroutine </span><span class="n">debug_state</span><span class="p">(</span><span class="n">list</span><span class="p">,</span><span class="n">msg</span><span class="p">)</span>                        <span class="c">!@(#)debug(3f): process $SHOW command or state output when errors occur</span>
<a name="ln-1782"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">list</span>
<a name="ln-1783"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">msg</span>
<a name="ln-1784"></a><span class="kt">integer</span>                     <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span>
<a name="ln-1785"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span>   <span class="kd">::</span> <span class="k">array</span><span class="p">(:)</span>    <span class="c">! output array of tokens</span>
<a name="ln-1786"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">parameter</span>  <span class="kd">::</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;(*(g0,1x))&#39;</span>
<a name="ln-1787"></a>   <span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">list</span><span class="p">))</span><span class="k">then</span>
<a name="ln-1788"></a><span class="k">      if</span><span class="p">(</span><span class="n">list</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1789"></a>         <span class="c">! print variables:</span>
<a name="ln-1790"></a>         <span class="k">CALL </span><span class="n">split</span><span class="p">(</span><span class="n">list</span><span class="p">,</span><span class="k">array</span><span class="p">,</span><span class="n">delimiters</span><span class="o">=</span><span class="s1">&#39; ;,&#39;</span><span class="p">)</span> <span class="c">! parse string to an array parsing on delimiters</span>
<a name="ln-1791"></a>         <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="k">array</span><span class="p">)</span>
<a name="ln-1792"></a>            <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">G_numdef</span>                                                                 <span class="c">! print variable dictionary</span>
<a name="ln-1793"></a>               <span class="k">if</span><span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_defvar</span><span class="p">(</span><span class="n">i</span><span class="p">)),</span><span class="nb">trim</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="n">j</span><span class="p">))))</span><span class="k">then</span>
<a name="ln-1794"></a><span class="k">                  write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="n">fmt</span><span class="p">)</span><span class="s2">&quot;! &quot;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_defvar</span><span class="p">(</span><span class="n">i</span><span class="p">)),</span><span class="s1">&#39; = &#39;</span><span class="p">,</span><span class="nb">adjustl</span><span class="p">(</span><span class="n">G_defval</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="c">! write variable and corresponding value</span>
<a name="ln-1795"></a>               <span class="k">endif</span>
<a name="ln-1796"></a><span class="k">            enddo</span>
<a name="ln-1797"></a><span class="k">         enddo</span>
<a name="ln-1798"></a><span class="k">         return</span>
<a name="ln-1799"></a><span class="k">      endif</span>
<a name="ln-1800"></a><span class="k">   endif</span>
<a name="ln-1801"></a><span class="k">   write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s1">&#39;!===============================================================================&#39;</span>
<a name="ln-1802"></a>   <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s1">&#39;! &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a name="ln-1803"></a>
<a name="ln-1804"></a>   <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s1">&#39;! Current state of prep(1):(&#39;</span><span class="o">//</span><span class="n">getdate</span><span class="p">()</span><span class="o">//</span><span class="s1">&#39;)&#39;</span>
<a name="ln-1805"></a>   <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(&quot;! Total lines read ............... &quot;,i0)&#39;</span><span class="p">)</span><span class="n">G_io_total_lines</span>     <span class="c">! write number of lines read</span>
<a name="ln-1806"></a>   <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(&quot;! Conditional nesting level....... &quot;,i0)&#39;</span><span class="p">)</span><span class="n">G_nestl</span>              <span class="c">! write nesting level</span>
<a name="ln-1807"></a>   <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(&quot;! G_WRITE (general processing).... &quot;,l1)&#39;</span><span class="p">)</span><span class="n">G_write</span>              <span class="c">! non-if/else/endif directives processed</span>
<a name="ln-1808"></a>   <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(&quot;! G_LLWRITE (write input lines)... &quot;,l1)&#39;</span><span class="p">)</span><span class="n">G_llwrite</span>            <span class="c">! non-if/else/endif directives processed</span>
<a name="ln-1809"></a>
<a name="ln-1810"></a>   <span class="k">call </span><span class="n">write_arguments</span><span class="p">()</span>
<a name="ln-1811"></a>
<a name="ln-1812"></a>   <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s1">&#39;! Open files:&#39;</span>
<a name="ln-1813"></a>   <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s1">&#39;!    unit ! line number ! filename&#39;</span>
<a name="ln-1814"></a>   <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">G_iocount</span>                                                               <span class="c">! print file dictionary</span>
<a name="ln-1815"></a>      <span class="c">! write table of files</span>
<a name="ln-1816"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(&quot;!    &quot;,i4,&quot; ! &quot;,i11,&quot; ! &quot;,a)&#39;</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1817"></a>      <span class="p">&amp;</span>  <span class="n">G_file_dictionary</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">unit_number</span><span class="p">,</span>    <span class="p">&amp;</span>
<a name="ln-1818"></a>      <span class="p">&amp;</span>  <span class="n">G_file_dictionary</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">line_number</span><span class="p">,</span>    <span class="p">&amp;</span>
<a name="ln-1819"></a>      <span class="p">&amp;</span>  <span class="nb">trim</span><span class="p">(</span><span class="n">G_file_dictionary</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">filename</span> <span class="p">)</span>
<a name="ln-1820"></a>   <span class="k">enddo</span>
<a name="ln-1821"></a>
<a name="ln-1822"></a><span class="k">   write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s1">&#39;! INCLUDE directories:&#39;</span>
<a name="ln-1823"></a>   <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">G_inc_count</span>
<a name="ln-1824"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(&quot;!    &quot;,a)&#39;</span><span class="p">)</span> <span class="nb">trim</span><span class="p">(</span><span class="n">G_inc_files</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-1825"></a>   <span class="k">enddo</span>
<a name="ln-1826"></a>
<a name="ln-1827"></a><span class="k">   write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s1">&#39;! Variables:&#39;</span>
<a name="ln-1828"></a>   <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">G_numdef</span>                                                                 <span class="c">! print variable dictionary</span>
<a name="ln-1829"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="n">fmt</span><span class="p">)</span><span class="s2">&quot;!    $DEFINE&quot;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_defvar</span><span class="p">(</span><span class="n">i</span><span class="p">)),</span><span class="s1">&#39; = &#39;</span><span class="p">,</span><span class="nb">adjustl</span><span class="p">(</span><span class="n">G_defval</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="c">! write variable and corresponding value</span>
<a name="ln-1830"></a>   <span class="k">enddo</span>
<a name="ln-1831"></a>
<a name="ln-1832"></a><span class="k">   write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s1">&#39;! Parcels:&#39;</span>
<a name="ln-1833"></a>   <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">G_parcelcount</span>
<a name="ln-1834"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="n">fmt</span><span class="p">)</span> <span class="s1">&#39;!   &#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_parcel_dictionary</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">name</span><span class="p">)</span>
<a name="ln-1835"></a>   <span class="k">enddo</span>
<a name="ln-1836"></a>
<a name="ln-1837"></a><span class="k">   if</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">keywords</span><span class="p">).</span><span class="n">gt</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1838"></a><span class="k">      write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="n">fmt</span><span class="p">)</span><span class="s1">&#39;! SET strings:(There are&#39;</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">keywords</span><span class="p">),</span><span class="s1">&#39;keywords defined)&#39;</span>
<a name="ln-1839"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(3(g0,1x))&#39;</span><span class="p">)(</span><span class="s1">&#39;!    $SET&#39;</span><span class="p">,</span><span class="n">keywords</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">values</span><span class="p">(</span><span class="n">i</span><span class="p">)(:</span><span class="n">counts</span><span class="p">(</span><span class="n">i</span><span class="p">)),</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">keywords</span><span class="p">))</span>
<a name="ln-1840"></a>   <span class="k">endif</span>
<a name="ln-1841"></a>
<a name="ln-1842"></a><span class="k">   write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s1">&#39;!-------------------------------------------------------------------------------&#39;</span>
<a name="ln-1843"></a><span class="k">end subroutine </span><span class="n">debug_state</span>
<a name="ln-1844"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1845"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-1846"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1847"></a><span class="k">subroutine </span><span class="n">write_arguments</span><span class="p">()</span> <span class="c">!@(#)write_arguments(3f): return all command arguments as a string</span>
<a name="ln-1848"></a>
<a name="ln-1849"></a><span class="kt">integer</span>                      <span class="kd">::</span> <span class="n">istatus</span>          <span class="c">!  status (non-zero means error)</span>
<a name="ln-1850"></a><span class="kt">integer</span>                      <span class="kd">::</span> <span class="n">ilength</span>          <span class="c">!  length of individual arguments</span>
<a name="ln-1851"></a><span class="kt">integer</span>                      <span class="kd">::</span> <span class="n">i</span>                <span class="c">!  loop count</span>
<a name="ln-1852"></a><span class="kt">integer</span>                      <span class="kd">::</span> <span class="n">icount</span>           <span class="c">!  count of number of arguments available</span>
<a name="ln-1853"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>           <span class="kd">::</span> <span class="k">value</span>            <span class="c">!  store individual arguments one at a time</span>
<a name="ln-1854"></a>
<a name="ln-1855"></a>   <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">,</span><span class="n">advance</span><span class="o">=</span><span class="s1">&#39;no&#39;</span><span class="p">)</span><span class="s1">&#39;! Arguments ...................... &#39;</span>
<a name="ln-1856"></a>   <span class="n">icount</span><span class="o">=</span><span class="nb">command_argument_count</span><span class="p">()</span>               <span class="c">! intrinsic gets number of arguments</span>
<a name="ln-1857"></a>   <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">icount</span>
<a name="ln-1858"></a>      <span class="k">call </span><span class="nb">get_command_argument</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="k">value</span><span class="p">,</span><span class="n">ilength</span><span class="p">,</span><span class="n">istatus</span><span class="p">)</span>
<a name="ln-1859"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a,1x)&#39;</span><span class="p">,</span><span class="n">advance</span><span class="o">=</span><span class="s1">&#39;no&#39;</span><span class="p">)</span><span class="k">value</span><span class="p">(:</span><span class="n">ilength</span><span class="p">)</span>
<a name="ln-1860"></a>   <span class="k">enddo</span>
<a name="ln-1861"></a><span class="k">   write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span>
<a name="ln-1862"></a><span class="k">end subroutine </span><span class="n">write_arguments</span>
<a name="ln-1863"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1864"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-1865"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1866"></a><span class="k">subroutine include</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="n">iunit</span><span class="p">)</span>  <span class="c">!@(#)include(3f): add file to input file list</span>
<a name="ln-1867"></a><span class="k">implicit none</span>
<a name="ln-1868"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">line</span>
<a name="ln-1869"></a><span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                       <span class="kd">::</span> <span class="n">iunit</span>
<a name="ln-1870"></a><span class="kt">integer</span>                                  <span class="kd">::</span> <span class="n">ios</span>
<a name="ln-1871"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">4096</span><span class="p">)</span>                      <span class="kd">::</span> <span class="n">message</span>
<a name="ln-1872"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">line_unquoted</span>
<a name="ln-1873"></a><span class="kt">integer</span>                                  <span class="kd">::</span> <span class="n">iend</span>
<a name="ln-1874"></a>
<a name="ln-1875"></a>   <span class="n">line_unquoted</span><span class="o">=</span><span class="nb">adjustl</span><span class="p">(</span><span class="n">unquote</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>                   <span class="c">! remove &quot; from filename using Fortran list-directed I/O rules</span>
<a name="ln-1876"></a>   <span class="n">iend</span><span class="o">=</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">line_unquoted</span><span class="p">)</span>
<a name="ln-1877"></a>   <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">line_unquoted</span><span class="p">).</span><span class="n">ge</span><span class="p">.</span><span class="mi">2</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1878"></a><span class="k">      if</span><span class="p">(</span><span class="n">line_unquoted</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;&lt;&#39;</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">line_unquoted</span><span class="p">(</span><span class="n">iend</span><span class="p">:</span><span class="n">iend</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)</span><span class="k">then</span>       <span class="c">! remove &lt; and &gt; from filename</span>
<a name="ln-1879"></a>         <span class="n">line_unquoted</span><span class="o">=</span><span class="n">line_unquoted</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="n">iend</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-1880"></a>      <span class="k">endif</span>
<a name="ln-1881"></a><span class="k">   endif</span>
<a name="ln-1882"></a>
<a name="ln-1883"></a><span class="k">   if</span><span class="p">(</span><span class="n">iunit</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mf">5.</span><span class="nb">or</span><span class="p">.</span><span class="n">line_unquoted</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;@&#39;</span><span class="p">)</span><span class="k">then</span>                   <span class="c">! assume this is stdin</span>
<a name="ln-1884"></a>      <span class="n">G_iocount</span><span class="o">=</span><span class="n">G_iocount</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-1885"></a>      <span class="n">G_file_dictionary</span><span class="p">(</span><span class="n">G_iocount</span><span class="p">)%</span><span class="n">unit_number</span><span class="o">=</span><span class="mi">5</span>
<a name="ln-1886"></a>      <span class="n">G_file_dictionary</span><span class="p">(</span><span class="n">G_iocount</span><span class="p">)%</span><span class="n">filename</span><span class="o">=</span><span class="n">line_unquoted</span>
<a name="ln-1887"></a>      <span class="k">return</span>
<a name="ln-1888"></a><span class="k">   endif</span>
<a name="ln-1889"></a>
<a name="ln-1890"></a><span class="k">   call </span><span class="n">findit</span><span class="p">(</span><span class="n">line_unquoted</span><span class="p">)</span>
<a name="ln-1891"></a>
<a name="ln-1892"></a>   <span class="k">open</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">iunit</span><span class="p">,</span><span class="k">file</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">line_unquoted</span><span class="p">),</span><span class="n">iostat</span><span class="o">=</span><span class="n">ios</span><span class="p">,</span><span class="n">status</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">,</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;read&#39;</span><span class="p">,</span><span class="n">iomsg</span><span class="o">=</span><span class="n">message</span><span class="p">)</span>
<a name="ln-1893"></a>   <span class="k">if</span><span class="p">(</span><span class="n">ios</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1894"></a><span class="k">      call </span><span class="n">debug_state</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;OPEN IN INCLUDE&#39;</span><span class="p">)</span>
<a name="ln-1895"></a>      <span class="k">call </span><span class="n">write_err</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<a name="ln-1896"></a>      <span class="k">call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s2">&quot;*prep* ERROR(057) - FAILED OPEN OF INPUT FILE(&quot;</span><span class="o">//</span><span class="n">v2s</span><span class="p">(</span><span class="n">iunit</span><span class="p">)</span><span class="o">//</span><span class="s2">&quot;):&quot;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">line_unquoted</span><span class="p">))</span>
<a name="ln-1897"></a>   <span class="k">else</span>
<a name="ln-1898"></a><span class="k">      rewind</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">iunit</span><span class="p">)</span>
<a name="ln-1899"></a>      <span class="n">G_iocount</span><span class="o">=</span><span class="n">G_iocount</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-1900"></a>      <span class="k">if</span><span class="p">(</span><span class="n">G_iocount</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="n">size</span><span class="p">(</span><span class="n">G_file_dictionary</span><span class="p">))</span><span class="k">then</span>
<a name="ln-1901"></a><span class="k">         call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(058) - INPUT FILE NESTING TOO DEEP:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_source</span><span class="p">))</span>
<a name="ln-1902"></a>      <span class="k">endif</span>
<a name="ln-1903"></a><span class="k">      </span><span class="n">G_file_dictionary</span><span class="p">(</span><span class="n">G_iocount</span><span class="p">)%</span><span class="n">unit_number</span><span class="o">=</span><span class="n">iunit</span>
<a name="ln-1904"></a>      <span class="n">G_file_dictionary</span><span class="p">(</span><span class="n">G_iocount</span><span class="p">)%</span><span class="n">filename</span><span class="o">=</span><span class="n">line_unquoted</span>
<a name="ln-1905"></a>      <span class="n">G_file_dictionary</span><span class="p">(</span><span class="n">G_iocount</span><span class="p">)%</span><span class="n">line_number</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-1906"></a>   <span class="k">endif</span>
<a name="ln-1907"></a>
<a name="ln-1908"></a><span class="k">end subroutine include</span>
<a name="ln-1909"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1910"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-1911"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1912"></a><span class="k">subroutine </span><span class="n">post</span><span class="p">(</span><span class="n">parcel_name</span><span class="p">)</span>  <span class="c">!@(#)post(3f): switch to scratch file defined by PARCEL</span>
<a name="ln-1913"></a><span class="k">implicit none</span>
<a name="ln-1914"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">parcel_name</span>
<a name="ln-1915"></a><span class="kt">integer</span>                      <span class="kd">::</span> <span class="n">ifound</span>
<a name="ln-1916"></a><span class="kt">integer</span>                      <span class="kd">::</span> <span class="n">ios</span>
<a name="ln-1917"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">4096</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">message</span>
<a name="ln-1918"></a><span class="kt">integer</span>                      <span class="kd">::</span> <span class="n">i</span>
<a name="ln-1919"></a>   <span class="n">ifound</span><span class="o">=-</span><span class="mi">1</span>
<a name="ln-1920"></a>   <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">G_parcelcount</span>
<a name="ln-1921"></a>      <span class="k">if</span><span class="p">(</span><span class="n">G_parcel_dictionary</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">name</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">parcel_name</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1922"></a><span class="k">         </span><span class="n">ifound</span><span class="o">=</span><span class="n">G_parcel_dictionary</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">unit_number</span>
<a name="ln-1923"></a>         <span class="k">exit</span>
<a name="ln-1924"></a><span class="k">      endif</span>
<a name="ln-1925"></a><span class="k">   enddo</span>
<a name="ln-1926"></a><span class="k">   if</span><span class="p">(</span><span class="n">ifound</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1927"></a><span class="k">      call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(059) - PARCEL NAME NOT DEFINED:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_source</span><span class="p">))</span>
<a name="ln-1928"></a>   <span class="k">else</span>
<a name="ln-1929"></a><span class="k">      inquire</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">ifound</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">ios</span><span class="p">)</span>
<a name="ln-1930"></a>      <span class="k">rewind</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">ifound</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">ios</span><span class="p">,</span><span class="n">iomsg</span><span class="o">=</span><span class="n">message</span><span class="p">)</span>
<a name="ln-1931"></a>      <span class="k">if</span><span class="p">(</span><span class="n">ios</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1932"></a><span class="k">         call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(060) - ERROR REWINDING PARCEL:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_source</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">message</span><span class="p">))</span>
<a name="ln-1933"></a>      <span class="k">endif</span>
<a name="ln-1934"></a>
<a name="ln-1935"></a><span class="k">      if</span><span class="p">(</span><span class="n">G_debug</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1936"></a><span class="k">         do</span>
<a name="ln-1937"></a><span class="k">            read</span><span class="p">(</span><span class="n">ifound</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">ios</span><span class="p">)</span><span class="n">message</span>
<a name="ln-1938"></a>            <span class="k">if</span><span class="p">(</span><span class="n">ios</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">exit</span>
<a name="ln-1939"></a><span class="k">            write</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;&gt;&gt;&gt;&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<a name="ln-1940"></a>         <span class="k">enddo</span>
<a name="ln-1941"></a><span class="k">         rewind</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">ifound</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">ios</span><span class="p">,</span><span class="n">iomsg</span><span class="o">=</span><span class="n">message</span><span class="p">)</span>
<a name="ln-1942"></a>      <span class="k">endif</span>
<a name="ln-1943"></a>
<a name="ln-1944"></a><span class="k">      </span><span class="n">G_iocount</span><span class="o">=</span><span class="n">G_iocount</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-1945"></a>      <span class="k">if</span><span class="p">(</span><span class="n">G_iocount</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="n">size</span><span class="p">(</span><span class="n">G_file_dictionary</span><span class="p">))</span><span class="k">then</span>
<a name="ln-1946"></a><span class="k">         call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(061) - INPUT FILE NESTING TOO DEEP:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_source</span><span class="p">))</span>
<a name="ln-1947"></a>      <span class="k">endif</span>
<a name="ln-1948"></a><span class="k">      </span><span class="n">G_file_dictionary</span><span class="p">(</span><span class="n">G_iocount</span><span class="p">)%</span><span class="n">unit_number</span><span class="o">=</span><span class="n">ifound</span>
<a name="ln-1949"></a>      <span class="n">G_file_dictionary</span><span class="p">(</span><span class="n">G_iocount</span><span class="p">)%</span><span class="n">filename</span><span class="o">=</span><span class="n">parcel_name</span>
<a name="ln-1950"></a>      <span class="n">G_file_dictionary</span><span class="p">(</span><span class="n">G_iocount</span><span class="p">)%</span><span class="n">line_number</span><span class="o">=</span><span class="mi">0</span>
<a name="ln-1951"></a>   <span class="k">endif</span>
<a name="ln-1952"></a><span class="k">end subroutine </span><span class="n">post</span>
<a name="ln-1953"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1954"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-1955"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1956"></a><span class="k">subroutine </span><span class="n">findit</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="c">!@(#)findit(3f): look for filename in search directories if name does not exist and return modified name</span>
<a name="ln-1957"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">line</span>
<a name="ln-1958"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">filename</span>
<a name="ln-1959"></a><span class="kt">logical</span>                         <span class="kd">::</span> <span class="n">file_exist</span>
<a name="ln-1960"></a><span class="kt">integer</span>                         <span class="kd">::</span> <span class="n">i</span>
<a name="ln-1961"></a><span class="kt">integer</span>                         <span class="kd">::</span> <span class="n">iend_dir</span>
<a name="ln-1962"></a>
<a name="ln-1963"></a>   <span class="k">inquire</span><span class="p">(</span><span class="k">file</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">line</span><span class="p">),</span> <span class="n">exist</span><span class="o">=</span><span class="n">file_exist</span><span class="p">)</span>                    <span class="c">! test if input filename exists</span>
<a name="ln-1964"></a>   <span class="k">if</span><span class="p">(</span><span class="n">file_exist</span><span class="p">)</span><span class="k">then</span>                                            <span class="c">! if file exits then return filename</span>
<a name="ln-1965"></a>      <span class="k">return</span>
<a name="ln-1966"></a><span class="k">   endif</span>
<a name="ln-1967"></a>
<a name="ln-1968"></a><span class="k">   if</span><span class="p">(</span><span class="n">G_inc_count</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>                                      <span class="c">! if search directories have been specified search for file</span>
<a name="ln-1969"></a>      <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">G_inc_count</span>
<a name="ln-1970"></a>         <span class="n">iend_dir</span><span class="o">=</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">G_inc_files</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-1971"></a>         <span class="k">if</span><span class="p">(</span><span class="n">G_inc_files</span><span class="p">(</span><span class="n">i</span><span class="p">)(</span><span class="n">iend_dir</span><span class="p">:</span><span class="n">iend_dir</span><span class="p">).</span><span class="n">ne</span><span class="p">.</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="k">then</span>
<a name="ln-1972"></a><span class="k">            </span><span class="n">filename</span><span class="o">=</span><span class="n">G_inc_files</span><span class="p">(</span><span class="n">i</span><span class="p">)(:</span><span class="n">iend_dir</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;/&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<a name="ln-1973"></a>         <span class="k">else</span>
<a name="ln-1974"></a><span class="k">            </span><span class="n">filename</span><span class="o">=</span><span class="n">G_inc_files</span><span class="p">(</span><span class="n">i</span><span class="p">)(:</span><span class="n">iend_dir</span><span class="p">)</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<a name="ln-1975"></a>         <span class="k">endif</span>
<a name="ln-1976"></a><span class="k">         inquire</span><span class="p">(</span><span class="k">file</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="n">exist</span><span class="o">=</span><span class="n">file_exist</span><span class="p">)</span>
<a name="ln-1977"></a>         <span class="k">if</span><span class="p">(</span><span class="n">file_exist</span><span class="p">)</span><span class="k">then</span>                                      <span class="c">! if find filename exit</span>
<a name="ln-1978"></a>            <span class="n">line</span><span class="o">=</span><span class="n">filename</span>
<a name="ln-1979"></a>            <span class="k">return</span>
<a name="ln-1980"></a><span class="k">         endif</span>
<a name="ln-1981"></a><span class="k">      enddo</span>
<a name="ln-1982"></a><span class="k">   else</span>                                                          <span class="c">! file did not exist and no search directories have been specified</span>
<a name="ln-1983"></a>      <span class="n">filename</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<a name="ln-1984"></a>   <span class="k">endif</span>
<a name="ln-1985"></a>
<a name="ln-1986"></a><span class="k">   call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s2">&quot;*prep* ERROR(062) - MISSING INPUT FILE:&quot;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
<a name="ln-1987"></a>
<a name="ln-1988"></a><span class="k">end subroutine </span><span class="n">findit</span>
<a name="ln-1989"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1990"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-1991"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-1992"></a><span class="k">subroutine </span><span class="n">opens</span><span class="p">()</span>                   <span class="c">!@(#)opens(3f): use expression on command line to  open input files</span>
<a name="ln-1993"></a>
<a name="ln-1994"></a><span class="kt">integer</span><span class="p">,</span><span class="k">parameter</span>                     <span class="kd">::</span> <span class="n">n</span><span class="o">=</span><span class="mi">50</span>                       <span class="c">! maximum number of tokens to look for</span>
<a name="ln-1995"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">)</span>          <span class="kd">::</span> <span class="k">array</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>                   <span class="c">! the array to fill with tokens</span>
<a name="ln-1996"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>                      <span class="kd">::</span> <span class="n">dlim</span><span class="o">=</span><span class="s1">&#39; &#39;</span>                   <span class="c">! string of single characters to use as delimiters</span>
<a name="ln-1997"></a>
<a name="ln-1998"></a><span class="kt">integer</span>                               <span class="kd">::</span> <span class="n">icount</span>                     <span class="c">! how many tokens are found</span>
<a name="ln-1999"></a><span class="kt">integer</span>                               <span class="kd">::</span> <span class="n">ibegin</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>                  <span class="c">! starting column numbers for the tokens in INLINE</span>
<a name="ln-2000"></a><span class="kt">integer</span>                               <span class="kd">::</span> <span class="n">iterm</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>                   <span class="c">! ending column numbers for the tokens in INLINE</span>
<a name="ln-2001"></a><span class="kt">integer</span>                               <span class="kd">::</span> <span class="n">ilen</span>                       <span class="c">! is the position of last nonblank character in INLINE</span>
<a name="ln-2002"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">in_filename1</span><span class="o">=</span><span class="s1">&#39;&#39;</span>            <span class="c">! input filename, default is stdin</span>
<a name="ln-2003"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">in_filename2</span><span class="o">=</span><span class="s1">&#39;&#39;</span>            <span class="c">! input filename, default is stdin</span>
<a name="ln-2004"></a><span class="kt">integer</span>                               <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">ii</span>
<a name="ln-2005"></a><span class="kt">integer</span>                               <span class="kd">::</span> <span class="n">ivalue</span>
<a name="ln-2006"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">dir</span>                        <span class="c">! directory used by an input file</span>
<a name="ln-2007"></a>
<a name="ln-2008"></a>   <span class="n">in_filename1</span><span class="p">(:</span><span class="n">G_line_length</span><span class="p">)</span>  <span class="o">=</span> <span class="n">sget</span><span class="p">(</span><span class="s1">&#39;_prep_i&#39;</span><span class="p">)</span>                  <span class="c">! get values from command line</span>
<a name="ln-2009"></a>   <span class="n">in_filename2</span><span class="p">(:</span><span class="n">G_line_length</span><span class="p">)</span>  <span class="o">=</span> <span class="n">sget</span><span class="p">(</span><span class="s1">&#39;prep_i&#39;</span><span class="p">)</span>                   <span class="c">! get values from command line</span>
<a name="ln-2010"></a>   <span class="k">if</span><span class="p">(</span><span class="n">in_filename1</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="s1">&#39;&#39;</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">in_filename2</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">in_filename1</span><span class="p">)</span><span class="k">then</span>
<a name="ln-2011"></a><span class="k">      </span><span class="n">in_filename2</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
<a name="ln-2012"></a>   <span class="k">endif</span>
<a name="ln-2013"></a><span class="k">   if</span><span class="p">(</span><span class="n">in_filename2</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="k">then</span>                                       <span class="c">! read stdin if no -i on command line</span>
<a name="ln-2014"></a>      <span class="n">in_filename2</span>  <span class="o">=</span> <span class="s1">&#39;@&#39;</span>
<a name="ln-2015"></a>   <span class="k">endif</span>
<a name="ln-2016"></a>
<a name="ln-2017"></a>   <span class="c">! break command argument prep_i into single words</span>
<a name="ln-2018"></a>   <span class="k">call </span><span class="n">delim</span><span class="p">(</span><span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">sget</span><span class="p">(</span><span class="s1">&#39;_prep_i&#39;</span><span class="p">))</span><span class="o">//</span><span class="s1">&#39; &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">in_filename2</span><span class="p">)),</span><span class="k">array</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">icount</span><span class="p">,</span><span class="n">ibegin</span><span class="p">,</span><span class="n">iterm</span><span class="p">,</span><span class="n">ilen</span><span class="p">,</span><span class="n">dlim</span><span class="p">)</span>
<a name="ln-2019"></a>   <span class="n">ivalue</span><span class="o">=</span><span class="mi">50</span>                                <span class="c">! starting file unit to use</span>
<a name="ln-2020"></a>   <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="n">icount</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-2021"></a>      <span class="n">G_source</span><span class="o">=</span><span class="s1">&#39;$include &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>  <span class="c">! for messages</span>
<a name="ln-2022"></a>      <span class="k">call include</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">ivalue</span><span class="p">)</span>
<a name="ln-2023"></a>      <span class="n">ivalue</span><span class="o">=</span><span class="n">ivalue</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-2024"></a>
<a name="ln-2025"></a>      <span class="n">ALREADY</span><span class="p">:</span> <span class="k">block</span>                       <span class="c">! store directory path of input files as an implicit directory for reading $INCLUDE files</span>
<a name="ln-2026"></a>         <span class="n">dir</span><span class="o">=</span><span class="n">dirname</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-2027"></a>         <span class="k">do </span><span class="n">ii</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">G_inc_count</span>
<a name="ln-2028"></a>            <span class="k">if</span><span class="p">(</span><span class="n">G_inc_files</span><span class="p">(</span><span class="n">ii</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="n">dir</span><span class="p">)</span><span class="k">exit </span><span class="n">ALREADY</span>
<a name="ln-2029"></a>         <span class="k">enddo</span>
<a name="ln-2030"></a><span class="k">         </span><span class="n">G_inc_count</span><span class="o">=</span><span class="n">G_inc_count</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-2031"></a>         <span class="n">G_inc_count</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">G_inc_count</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">G_inc_files</span><span class="p">))</span> <span class="c">! guard against too many files; !x! should warn on overflow</span>
<a name="ln-2032"></a>         <span class="n">G_inc_files</span><span class="p">(</span><span class="n">G_inc_count</span><span class="p">)</span><span class="o">=</span><span class="n">dir</span>
<a name="ln-2033"></a>      <span class="k">endblock </span><span class="n">ALREADY</span>
<a name="ln-2034"></a>
<a name="ln-2035"></a>   <span class="k">enddo</span>
<a name="ln-2036"></a>
<a name="ln-2037"></a><span class="c">! &gt;&gt;&gt;</span>
<a name="ln-2038"></a><span class="c">!   If ARRAY(N) fills before reaching the end of the line the routine stops.</span>
<a name="ln-2039"></a><span class="c">!   Check &quot;if(iend(icount) .eq. ilen)&quot; to see if you got to the end to warn if not all files include</span>
<a name="ln-2040"></a>
<a name="ln-2041"></a><span class="k">end subroutine </span><span class="n">opens</span>
<a name="ln-2042"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2043"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-2044"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2045"></a><span class="k">subroutine </span><span class="n">includes</span><span class="p">()</span>         <span class="c">!@(#)includes(3f): use expression on command line to  get include directories</span>
<a name="ln-2046"></a>
<a name="ln-2047"></a><span class="kt">integer</span><span class="p">,</span><span class="k">parameter</span>                     <span class="kd">::</span> <span class="n">n</span><span class="o">=</span><span class="mi">50</span>                    <span class="c">! maximum number of tokens to look for</span>
<a name="ln-2048"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>                      <span class="kd">::</span> <span class="n">dlim</span><span class="o">=</span><span class="s1">&#39; &#39;</span>                <span class="c">! string of single characters to use as delimiters</span>
<a name="ln-2049"></a><span class="kt">integer</span>                               <span class="kd">::</span> <span class="n">ibegin</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>               <span class="c">! starting column numbers for the tokens in G_inc_files</span>
<a name="ln-2050"></a><span class="kt">integer</span>                               <span class="kd">::</span> <span class="n">iterm</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>                <span class="c">! ending column numbers for the tokens in G_inc_files</span>
<a name="ln-2051"></a><span class="kt">integer</span>                               <span class="kd">::</span> <span class="n">ilen</span>                    <span class="c">! is the position of last nonblank character in G_inc_files</span>
<a name="ln-2052"></a>
<a name="ln-2053"></a>   <span class="c">! G_inc_files is the array to fill with tokens</span>
<a name="ln-2054"></a>   <span class="c">! G_inc_count is the number of tokens found</span>
<a name="ln-2055"></a>
<a name="ln-2056"></a>   <span class="c">! break command argument prep_I into single words</span>
<a name="ln-2057"></a>   <span class="k">call </span><span class="n">delim</span><span class="p">(</span><span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">sget</span><span class="p">(</span><span class="s1">&#39;_prep_I&#39;</span><span class="p">))</span><span class="o">//</span><span class="s1">&#39; &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">sget</span><span class="p">(</span><span class="s1">&#39;prep_I&#39;</span><span class="p">))),</span><span class="n">G_inc_files</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">G_inc_count</span><span class="p">,</span><span class="n">ibegin</span><span class="p">,</span><span class="n">iterm</span><span class="p">,</span><span class="n">ilen</span><span class="p">,</span><span class="n">dlim</span><span class="p">)</span>
<a name="ln-2058"></a><span class="k">end subroutine </span><span class="n">includes</span>
<a name="ln-2059"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2060"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-2061"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2062"></a><span class="k">subroutine </span><span class="n">defines</span><span class="p">()</span>       <span class="c">!@(#)defines(3f): use expressions on command line to initialize dictionary and define variables</span>
<a name="ln-2063"></a><span class="kt">integer</span><span class="p">,</span><span class="k">parameter</span>                     <span class="kd">::</span> <span class="n">n</span><span class="o">=</span><span class="mi">300</span>                   <span class="c">! maximum number of tokens to look for</span>
<a name="ln-2064"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">)</span>          <span class="kd">::</span> <span class="k">array</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>                <span class="c">! the array to fill with tokens</span>
<a name="ln-2065"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>                      <span class="kd">::</span> <span class="n">dlim</span><span class="o">=</span><span class="s1">&#39; &#39;</span>                <span class="c">! string of single characters to use as delimiters</span>
<a name="ln-2066"></a>
<a name="ln-2067"></a><span class="kt">integer</span>                               <span class="kd">::</span> <span class="n">icount</span>                  <span class="c">! how many tokens are found</span>
<a name="ln-2068"></a><span class="kt">integer</span>                               <span class="kd">::</span> <span class="n">ibegin</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>               <span class="c">! starting column numbers for the tokens in INLINE</span>
<a name="ln-2069"></a><span class="kt">integer</span>                               <span class="kd">::</span> <span class="n">iterm</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>                <span class="c">! ending column numbers for the tokens in INLINE</span>
<a name="ln-2070"></a><span class="kt">integer</span>                               <span class="kd">::</span> <span class="n">ilen</span>                    <span class="c">! is the position of last nonblank character in INLINE</span>
<a name="ln-2071"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">in_define1</span><span class="o">=</span><span class="s1">&#39;&#39;</span>           <span class="c">! variable definition from environment variable</span>
<a name="ln-2072"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">in_define2</span><span class="o">=</span><span class="s1">&#39;&#39;</span>           <span class="c">! variable definition from environment variable and command</span>
<a name="ln-2073"></a><span class="kt">integer</span>                               <span class="kd">::</span> <span class="n">i</span>
<a name="ln-2074"></a>
<a name="ln-2075"></a>   <span class="k">if</span><span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">keywords</span><span class="p">))</span><span class="k">deallocate</span><span class="p">(</span><span class="n">keywords</span><span class="p">)</span>
<a name="ln-2076"></a>   <span class="k">if</span><span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">values</span><span class="p">))</span><span class="k">deallocate</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
<a name="ln-2077"></a>   <span class="k">if</span><span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">counts</span><span class="p">))</span><span class="k">deallocate</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>
<a name="ln-2078"></a>   <span class="k">allocate</span><span class="p">(</span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="kd">::</span> <span class="n">keywords</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<a name="ln-2079"></a>   <span class="k">allocate</span><span class="p">(</span><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="kd">::</span> <span class="n">values</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<a name="ln-2080"></a>   <span class="k">allocate</span><span class="p">(</span><span class="n">counts</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<a name="ln-2081"></a>
<a name="ln-2082"></a>   <span class="n">in_define1</span><span class="o">=</span><span class="n">sget</span><span class="p">(</span><span class="s1">&#39;_prep_oo&#39;</span><span class="p">)</span>
<a name="ln-2083"></a>   <span class="n">in_define2</span><span class="o">=</span><span class="n">sget</span><span class="p">(</span><span class="s1">&#39;prep_oo&#39;</span><span class="p">)</span>
<a name="ln-2084"></a>   <span class="k">if</span><span class="p">(</span><span class="n">in_define1</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="s1">&#39;&#39;</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">in_define2</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">in_define1</span><span class="p">)</span><span class="k">then</span>            <span class="c">! if duplicates remove one</span>
<a name="ln-2085"></a>      <span class="n">in_define2</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
<a name="ln-2086"></a>   <span class="k">endif</span>
<a name="ln-2087"></a>   <span class="c">! break command argument prep_oo into single words</span>
<a name="ln-2088"></a>   <span class="k">call </span><span class="n">delim</span><span class="p">(</span><span class="nb">adjustl</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">in_define1</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">in_define2</span><span class="p">))</span><span class="o">//</span><span class="s1">&#39; &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">sget</span><span class="p">(</span><span class="s1">&#39;prep_D&#39;</span><span class="p">)),</span><span class="k">array</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">icount</span><span class="p">,</span><span class="n">ibegin</span><span class="p">,</span><span class="n">iterm</span><span class="p">,</span><span class="n">ilen</span><span class="p">,</span><span class="n">dlim</span><span class="p">)</span>
<a name="ln-2089"></a>   <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">icount</span>
<a name="ln-2090"></a>      <span class="n">G_source</span><span class="o">=</span><span class="s1">&#39;$redefine &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-2091"></a>      <span class="k">call </span><span class="n">cond</span><span class="p">()</span> <span class="c">! convert variable name into a &quot;$define variablename&quot; directive and process it</span>
<a name="ln-2092"></a>   <span class="k">enddo</span>
<a name="ln-2093"></a>
<a name="ln-2094"></a><span class="c">!   If ARRAY(N) fills before reaching the end of the line the routine stops.</span>
<a name="ln-2095"></a><span class="c">!   Check &quot;if(iend(icount) .eq. ilen)&quot; to see if you got to the end.</span>
<a name="ln-2096"></a>
<a name="ln-2097"></a><span class="k">end subroutine </span><span class="n">defines</span>
<a name="ln-2098"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2099"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-2100"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2101"></a><span class="k">subroutine stop</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>                    <span class="c">!@(#)stop(3f): process stop directive</span>
<a name="ln-2102"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">opts</span>
<a name="ln-2103"></a><span class="kt">integer</span>                      <span class="kd">::</span> <span class="n">ivalue</span>
<a name="ln-2104"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">message</span>
<a name="ln-2105"></a><span class="kt">integer</span>                      <span class="kd">::</span> <span class="n">iend</span>
<a name="ln-2106"></a>
<a name="ln-2107"></a><span class="c">! CHECK COMMAND SYNTAX</span>
<a name="ln-2108"></a>   <span class="k">if</span><span class="p">(</span><span class="n">opts</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="k">then</span>
<a name="ln-2109"></a><span class="k">      call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">stop_value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-2110"></a>   <span class="k">else</span>
<a name="ln-2111"></a><span class="k">      </span><span class="n">iend</span><span class="o">=</span><span class="nb">index</span><span class="p">(</span><span class="n">opts</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<a name="ln-2112"></a>      <span class="k">if</span><span class="p">(</span><span class="n">iend</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-2113"></a><span class="k">         </span><span class="n">iend</span><span class="o">=</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>
<a name="ln-2114"></a>         <span class="n">message</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
<a name="ln-2115"></a>      <span class="k">else</span>
<a name="ln-2116"></a><span class="k">         </span><span class="n">message</span><span class="o">=</span><span class="n">unquote</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">opts</span><span class="p">(</span><span class="n">iend</span><span class="p">:)))</span>
<a name="ln-2117"></a>         <span class="k">write</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="n">message</span>
<a name="ln-2118"></a>         <span class="k">call </span><span class="n">flushit</span><span class="p">()</span>
<a name="ln-2119"></a>      <span class="k">endif</span>
<a name="ln-2120"></a>
<a name="ln-2121"></a><span class="k">      </span><span class="n">ivalue</span><span class="o">=</span><span class="n">get_integer_from_string</span><span class="p">(</span><span class="n">opts</span><span class="p">(:</span><span class="n">iend</span><span class="p">))</span>
<a name="ln-2122"></a>
<a name="ln-2123"></a>      <span class="k">if</span><span class="p">(</span><span class="n">ivalue</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-2124"></a><span class="k">         if</span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">G_debug</span><span class="p">)</span><span class="k">stop</span>
<a name="ln-2125"></a><span class="k">      </span><span class="n">elseif</span><span class="p">(</span><span class="n">message</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="k">then</span>
<a name="ln-2126"></a><span class="k">         call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">stop_value</span><span class="o">=</span><span class="n">ivalue</span><span class="p">)</span>
<a name="ln-2127"></a>         <span class="c">!call stop_prep(&#39;*prep* ERROR(050) - UNEXPECTED &quot;STOP&quot; VALUE=&#39;//trim(opts)//&#39;. FROM:&#39;//trim(G_source))</span>
<a name="ln-2128"></a>      <span class="k">else</span>
<a name="ln-2129"></a><span class="k">         if</span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">G_debug</span><span class="p">)</span><span class="k">stop </span><span class="n">ivalue</span>
<a name="ln-2130"></a>      <span class="k">endif</span>
<a name="ln-2131"></a>
<a name="ln-2132"></a><span class="k">   endif</span>
<a name="ln-2133"></a><span class="k">end subroutine stop</span>
<a name="ln-2134"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2135"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-2136"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2137"></a><span class="k">subroutine </span><span class="n">stop_prep</span><span class="p">(</span><span class="n">message</span><span class="p">,</span><span class="n">stop_value</span><span class="p">)</span>                   <span class="c">!@(#)stop_prep(3f): write MESSAGE to stderr and exit program</span>
<a name="ln-2138"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">message</span>
<a name="ln-2139"></a><span class="kt">integer</span><span class="p">,</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">stop_value</span>
<a name="ln-2140"></a><span class="kt">integer</span> <span class="kd">::</span> <span class="n">stop_value_local</span>
<a name="ln-2141"></a>   <span class="n">stop_value_local</span><span class="o">=</span><span class="mi">1</span>
<a name="ln-2142"></a>   <span class="k">if</span><span class="p">(</span> <span class="nb">present</span><span class="p">(</span><span class="n">stop_value</span><span class="p">)</span> <span class="p">)</span><span class="n">stop_value_local</span><span class="o">=</span><span class="n">stop_value</span>
<a name="ln-2143"></a>   <span class="c">!call write_err(message)</span>
<a name="ln-2144"></a>   <span class="k">call </span><span class="n">write_err</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_SOURCE</span><span class="p">))</span>
<a name="ln-2145"></a>   <span class="k">call </span><span class="n">debug_state</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="n">message</span><span class="p">)</span>
<a name="ln-2146"></a>   <span class="k">if</span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">G_debug</span><span class="p">)</span><span class="k">stop </span><span class="n">stop_value_local</span>
<a name="ln-2147"></a><span class="k">end subroutine </span><span class="n">stop_prep</span>
<a name="ln-2148"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2149"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-2150"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2151"></a><span class="k">subroutine </span><span class="n">warn_prep</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>                   <span class="c">!@(#)warn_prep(3f): write MESSAGE to stderr and and continue program</span>
<a name="ln-2152"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">message</span>
<a name="ln-2153"></a>   <span class="k">call </span><span class="n">write_err</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<a name="ln-2154"></a>   <span class="k">call </span><span class="n">write_err</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_SOURCE</span><span class="p">))</span>
<a name="ln-2155"></a><span class="k">end subroutine </span><span class="n">warn_prep</span>
<a name="ln-2156"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2157"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-2158"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2159"></a>
<a name="ln-2160"></a><span class="c">! This documentation is a combination of</span>
<a name="ln-2161"></a><span class="c">!    o the original Lahey documentation of fpp(1) from &quot;LAHEY FORTRAN REFERENCE MANUAL&quot;; Revision C, 1992;</span>
<a name="ln-2162"></a><span class="c">!    o examination of the code</span>
<a name="ln-2163"></a><span class="c">!    o and documentation for the features subsequently added to the program.</span>
<a name="ln-2164"></a>
<a name="ln-2165"></a><span class="k">subroutine </span><span class="n">help_usage</span><span class="p">(</span><span class="n">l_help</span><span class="p">)</span>
<a name="ln-2166"></a><span class="k">implicit none</span>
<a name="ln-2167"></a><span class="c">!@(#)help_usage(3f): prints help information&quot;</span>
<a name="ln-2168"></a><span class="kt">logical</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">l_help</span>
<a name="ln-2169"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">help_text</span><span class="p">(:)</span>
<a name="ln-2170"></a><span class="kt">integer</span>                        <span class="kd">::</span> <span class="n">i</span>
<a name="ln-2171"></a><span class="kt">logical</span>                        <span class="kd">::</span> <span class="n">stopit</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-2172"></a><span class="n">stopit</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-2173"></a><span class="k">if</span><span class="p">(</span><span class="n">l_help</span><span class="p">)</span><span class="k">then</span>
<a name="ln-2174"></a><span class="c">!-------------------------------------------------------------------------------</span>
<a name="ln-2175"></a><span class="n">help_text</span><span class="o">=</span><span class="p">[</span> <span class="kt">CHARACTER</span><span class="p">(</span><span class="nb">LEN</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span> <span class="kd">::</span> <span class="p">&amp;</span>
<a name="ln-2176"></a><span class="s1">&#39;NAME                                                                            &#39;</span><span class="p">,&amp;</span>
<a name="ln-2177"></a><span class="s1">&#39;   prep(1) - [DEVELOPER] pre-process FORTRAN source files                       &#39;</span><span class="p">,&amp;</span>
<a name="ln-2178"></a><span class="s1">&#39;   (LICENSE:MIT)                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2179"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2180"></a><span class="s1">&#39;SYNOPSIS                                                                        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2181"></a><span class="s1">&#39;   prep [[-D] define_list]                                                      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2182"></a><span class="s1">&#39;        [-I include_directories]                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2183"></a><span class="s1">&#39;        [-i input_file(s)]                                                      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2184"></a><span class="s1">&#39;        [-o output_file]                                                        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2185"></a><span class="s1">&#39;        [--system]                                                              &#39;</span><span class="p">,&amp;</span>
<a name="ln-2186"></a><span class="s1">&#39;        [--verbose]                                                             &#39;</span><span class="p">,&amp;</span>
<a name="ln-2187"></a><span class="s1">&#39;        [--prefix character|ADE]                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2188"></a><span class="s1">&#39;        [--keeptabs]                                                            &#39;</span><span class="p">,&amp;</span>
<a name="ln-2189"></a><span class="s1">&#39;        [--noenv]                                                               &#39;</span><span class="p">,&amp;</span>
<a name="ln-2190"></a><span class="s1">&#39;        [--width n]                                                             &#39;</span><span class="p">,&amp;</span>
<a name="ln-2191"></a><span class="s1">&#39;        [-d ignore|remove|blank]                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2192"></a><span class="s1">&#39;        [--comment default|doxygen|ford|none]                                   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2193"></a><span class="s1">&#39;        [--type FILE_TYPE | --start START_STRING --stop STOP_STRING]            &#39;</span><span class="p">,&amp;</span>
<a name="ln-2194"></a><span class="s1">&#39;        [--ident]                                                               &#39;</span><span class="p">,&amp;</span>
<a name="ln-2195"></a><span class="s1">&#39;        [--version]                                                             &#39;</span><span class="p">,&amp;</span>
<a name="ln-2196"></a><span class="s1">&#39;        [--help]                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2197"></a><span class="s1">&#39;DESCRIPTION                                                                     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2198"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2199"></a><span class="s1">&#39;   A preprocessor is used to conditionally perform operations on input files    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2200"></a><span class="s1">&#39;   before they are passed to a compiler, including machine-specific selection   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2201"></a><span class="s1">&#39;   of input lines. This makes it possible to use a single source file even when &#39;</span><span class="p">,&amp;</span>
<a name="ln-2202"></a><span class="s1">&#39;   different code is required for different execution environments.             &#39;</span><span class="p">,&amp;</span>
<a name="ln-2203"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2204"></a><span class="s1">&#39;   The prep(1) preprocessor has additional features that help to include        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2205"></a><span class="s1">&#39;   documentation in the same file as the source and to generate generic code    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2206"></a><span class="s1">&#39;   using a simple templating technique. The basic directives ....               &#39;</span><span class="p">,&amp;</span>
<a name="ln-2207"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2208"></a><span class="s1">&#39;   * Conditionally output parts of the source file (controlled by expressions   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2209"></a><span class="s1">&#39;     on the directives $if, $ifdef, $ifndef, $else, $elif, and $endif. The      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2210"></a><span class="s1">&#39;     expressions may include variables defined on the command line and the      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2211"></a><span class="s1">&#39;     directives $define, $redefine, and $undefine).                             &#39;</span><span class="p">,&amp;</span>
<a name="ln-2212"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2213"></a><span class="s1">&#39;   * Include other files (provided by directive $include).                      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2214"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2215"></a><span class="s1">&#39;   * Define parcels of text that may be replayed multiple times with            &#39;</span><span class="p">,&amp;</span>
<a name="ln-2216"></a><span class="s1">&#39;     expansion, allowing for basic templating (controlled by directives         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2217"></a><span class="s1">&#39;     $parcel/$endparcel and $post). The mechanism supported is to replace       &#39;</span><span class="p">,&amp;</span>
<a name="ln-2218"></a><span class="s1">&#39;     text of the form ${NAME} with user-supplied strings similar to the         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2219"></a><span class="s1">&#39;     POSIX shell (controlled by directives $set and $import).                   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2220"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2221"></a><span class="s1">&#39;   * Filter blocks of text and convert them to comments, a CHARACTER array,     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2222"></a><span class="s1">&#39;     Fortran WRITE statements, ... (provided by the $block directive.)          &#39;</span><span class="p">,&amp;</span>
<a name="ln-2223"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2224"></a><span class="s1">&#39;     The blocks of text may also be written to a file and executed, with        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2225"></a><span class="s1">&#39;     stdout captured and included in the prep(1) output file.                   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2226"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2227"></a><span class="s1">&#39;     Blocked text may optionally be simultaneously written to a separate file,  &#39;</span><span class="p">,&amp;</span>
<a name="ln-2228"></a><span class="s1">&#39;     typically for use as documentation.                                        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2229"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2230"></a><span class="s1">&#39;   * Call system commands (using the $system directive).                        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2231"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2232"></a><span class="s1">&#39;   * Generate multiple output files from a single input file (using             &#39;</span><span class="p">,&amp;</span>
<a name="ln-2233"></a><span class="s1">&#39;     directive $output).                                                        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2234"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2235"></a><span class="s1">&#39;   * Record the parameters used and the date and time executed                  &#39;</span><span class="p">,&amp;</span>
<a name="ln-2236"></a><span class="s1">&#39;     as Fortran comments in the output (using $show).                           &#39;</span><span class="p">,&amp;</span>
<a name="ln-2237"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2238"></a><span class="s1">&#39;   * Cause an error (controlled by directive $stop or $error) and produce       &#39;</span><span class="p">,&amp;</span>
<a name="ln-2239"></a><span class="s1">&#39;     messages on stderr (using $message).                                       &#39;</span><span class="p">,&amp;</span>
<a name="ln-2240"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2241"></a><span class="s1">&#39;   DIRECTIVE SYNTAX                                                             &#39;</span><span class="p">,&amp;</span>
<a name="ln-2242"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2243"></a><span class="s1">&#39;   The prep(1) pre-processor directives begin with &quot;$&quot; (by default) in column   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2244"></a><span class="s1">&#39;   one, and will output no such lines. Other input is conditionally written     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2245"></a><span class="s1">&#39;   to the output file(s) based on the case-insensitive command names.           &#39;</span><span class="p">,&amp;</span>
<a name="ln-2246"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2247"></a><span class="s1">&#39;   An exclamation character FOLLOWED BY A SPACE on most directives              &#39;</span><span class="p">,&amp;</span>
<a name="ln-2248"></a><span class="s1">&#39;   begins an in-line comment that is terminated by an end-of-line. The space    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2249"></a><span class="s1">&#39;   is required so comments are not confused with C-style logical operators such &#39;</span><span class="p">,&amp;</span>
<a name="ln-2250"></a><span class="s1">&#39;   as &quot;!&quot;, which may NOT be followed by a space.                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2251"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2252"></a><span class="s1">&#39;   INTEGER or LOGICAL expressions are used on the family of $IF directives      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2253"></a><span class="s1">&#39;   to conditionally select output lines. An expression is composed of INTEGER   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2254"></a><span class="s1">&#39;   and LOGICAL constants, variable names, and operators. Operators are processed&#39;</span><span class="p">,&amp;</span>
<a name="ln-2255"></a><span class="s1">&#39;   as in Fortran and/or C expressions. The supported operators are ...          &#39;</span><span class="p">,&amp;</span>
<a name="ln-2256"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2257"></a><span class="s1">&#39;       #-----#-----#-----#-----#-----#-----#-----#                              &#39;</span><span class="p">,&amp;</span>
<a name="ln-2258"></a><span class="s1">&#39;       |  +  |  -  |  *  |  /  |  ** |  (  |  )  |  Math Operators              &#39;</span><span class="p">,&amp;</span>
<a name="ln-2259"></a><span class="s1">&#39;       #-----#-----#-----#-----#-----#-----#-----#                              &#39;</span><span class="p">,&amp;</span>
<a name="ln-2260"></a><span class="s1">&#39;       Logical Operators                                                        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2261"></a><span class="s1">&#39;       #-----#-----#-----#-----#-----#-----#-----#-----#-----#-----#------#     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2262"></a><span class="s1">&#39;       | .EQ.| .NE.| .GE.| .GT.| .LE.| .LT.|.NOT.|.AND.| .OR.|.EQV.|.NEQV.|     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2263"></a><span class="s1">&#39;       |  == |  /= |  &gt;= |  &gt;  |  &lt;= |  &lt;  |  !  |  &amp;&amp; |  || | ==  |  !=  |     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2264"></a><span class="s1">&#39;       #-----#  != #-----#-----#-----#-----#-----#-----#-----#-----#------#     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2265"></a><span class="s1">&#39;             #-----#                                                            &#39;</span><span class="p">,&amp;</span>
<a name="ln-2266"></a><span class="c">! C-STYLE NOT SUPPORTED:   %,  &lt;&lt;,  &gt;&gt;, &amp;,  ~</span>
<a name="ln-2267"></a><span class="s1">&#39;SUGGESTED INPUT FILE SUFFIX                                                     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2268"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2269"></a><span class="s1">&#39;   The suggested suffix for Fortran input files is &quot;.ff&quot; for code files unless  &#39;</span><span class="p">,&amp;</span>
<a name="ln-2270"></a><span class="s1">&#39;   they contain $SYSTEM directives in which case &quot;.FF&quot; is preferred. $INCLUDE   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2271"></a><span class="s1">&#39;   files should use &quot;.ffinc&quot; and &quot;.FFINC&quot; if they include prep(1) directives.   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2272"></a><span class="s1">&#39;   This naming convention is not required.                                      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2273"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2274"></a><span class="s1">&#39;   If files end in &quot;.md&quot; they may be extended markdown files, as explained      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2275"></a><span class="s1">&#39;   under the --type option description.                                         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2276"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2277"></a><span class="s1">&#39;DIRECTIVE SYNTAX SUMMARY                                                        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2278"></a><span class="s1">&#39; The directives fall into the following categories:                             &#39;</span><span class="p">,&amp;</span>
<a name="ln-2279"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2280"></a><span class="s1">&#39;  Variable Definition For Conditionals                                          &#39;</span><span class="p">,&amp;</span>
<a name="ln-2281"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2282"></a><span class="s1">&#39;      $DEFINE   variable_name[=expression] [;...]          [! comment ]         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2283"></a><span class="s1">&#39;      $REDEFINE variable_name[=expression] [;...]          [! comment ]         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2284"></a><span class="s1">&#39;      $UNDEFINE|$UNDEF variable_name [;...]                [! comment ]         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2285"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2286"></a><span class="s1">&#39;  Conditional Code Selection                                                    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2287"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2288"></a><span class="s1">&#39;      $IF  logical_integer-based expression |                                   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2289"></a><span class="s1">&#39;      $IFDEF [variable_name|environment_variable] |                             &#39;</span><span class="p">,&amp;</span>
<a name="ln-2290"></a><span class="s1">&#39;      $IFNDEF [variable_name|environment_variable]         [! comment ]         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2291"></a><span class="s1">&#39;              { sequence of source statements}                                  &#39;</span><span class="p">,&amp;</span>
<a name="ln-2292"></a><span class="s1">&#39;      [$ELSEIF|$ELIF logical_integer-based expression      [! comment ]         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2293"></a><span class="s1">&#39;              { sequence of source statements}]                                 &#39;</span><span class="p">,&amp;</span>
<a name="ln-2294"></a><span class="s1">&#39;      [$ELSE                                               [! comment ]         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2295"></a><span class="s1">&#39;              { sequence of source statements}]                                 &#39;</span><span class="p">,&amp;</span>
<a name="ln-2296"></a><span class="s1">&#39;      $ENDIF                                               [! comment ]         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2297"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2298"></a><span class="s1">&#39;  Macro String Expansion and Text Replay                                        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2299"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2300"></a><span class="s1">&#39;      $SET      varname  string                                                 &#39;</span><span class="p">,&amp;</span>
<a name="ln-2301"></a><span class="s1">&#39;      $IMPORT   envname[;...]                              [! comment ]         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2302"></a><span class="s1">&#39;      $PARCEL   blockname                                  [! comment ]         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2303"></a><span class="s1">&#39;      $ENDPARCEL                                           [! comment ]         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2304"></a><span class="s1">&#39;      $POST     blockname                                  [! comment ]         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2305"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2306"></a><span class="s1">&#39;  External Files (see $BLOCK ... --file also)                                   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2307"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2308"></a><span class="s1">&#39;      $OUTPUT   filename  [--append]                       [! comment ]         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2309"></a><span class="s1">&#39;      $INCLUDE  filename                                   [! comment ]         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2310"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2311"></a><span class="s1">&#39;  Text Block Filters (--file is ignored unless $PREP_DOCUMENT_DIR is set)       &#39;</span><span class="p">,&amp;</span>
<a name="ln-2312"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2313"></a><span class="s1">&#39;      $BLOCK   [null|comment|write|variable [--varname NAME]|                   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2314"></a><span class="s1">&#39;               set|system|message|define|redefine|                              &#39;</span><span class="p">,&amp;</span>
<a name="ln-2315"></a><span class="s1">&#39;               help|version] [--file NAME [--append]]      [! comment ]         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2316"></a><span class="s1">&#39;      $ENDBLOCK                                            [! comment ]         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2317"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2318"></a><span class="s1">&#39;  Identifiers                                                                   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2319"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2320"></a><span class="s1">&#39;      $IDENT | $@(#)    metadata                           [! comment ]         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2321"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2322"></a><span class="s1">&#39;  Information                                                                   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2323"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2324"></a><span class="s1">&#39;      $MESSAGE  message_to_stderr                                               &#39;</span><span class="p">,&amp;</span>
<a name="ln-2325"></a><span class="s1">&#39;      $SHOW [defined_variable_name[;...]]                  [! comment ]         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2326"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2327"></a><span class="s1">&#39;  System Commands (See also: $BLOCK SHELL)                                      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2328"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2329"></a><span class="s1">&#39;      $SYSTEM   system_command                                                  &#39;</span><span class="p">,&amp;</span>
<a name="ln-2330"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2331"></a><span class="s1">&#39;  Program Termination                                                           &#39;</span><span class="p">,&amp;</span>
<a name="ln-2332"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2333"></a><span class="s1">&#39;      $STOP     [stop_value [&quot;message&quot;]]                   [! comment ]         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2334"></a><span class="s1">&#39;      $QUIT     [&quot;message&quot;]                                [! comment ]         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2335"></a><span class="s1">&#39;      $ERROR    [&quot;message&quot;]                                [! comment ]         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2336"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2337"></a><span class="s1">&#39;OPTIONS                                                                         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2338"></a><span class="s1">&#39;   define_list, -D define_list  An optional space-delimited list of expressions &#39;</span><span class="p">,&amp;</span>
<a name="ln-2339"></a><span class="s1">&#39;                                used to define variables before file processing &#39;</span><span class="p">,&amp;</span>
<a name="ln-2340"></a><span class="s1">&#39;                                commences.                                      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2341"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2342"></a><span class="s1">&#39;   -i input_files               The default input file is stdin. Filenames are  &#39;</span><span class="p">,&amp;</span>
<a name="ln-2343"></a><span class="s1">&#39;                                space-delimited. In a list, @ represents stdin. &#39;</span><span class="p">,&amp;</span>
<a name="ln-2344"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2345"></a><span class="s1">&#39;   -o output_file               The default output file is stdout.              &#39;</span><span class="p">,&amp;</span>
<a name="ln-2346"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2347"></a><span class="s1">&#39;   -I include_directories  The directories to search for files specified on     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2348"></a><span class="s1">&#39;                           $INCLUDE directives.                                 &#39;</span><span class="p">,&amp;</span>
<a name="ln-2349"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2350"></a><span class="s1">&#39;   --prefix ADE|letter  The directive prefix character. The default is &quot;$&quot;.     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2351"></a><span class="s1">&#39;                        If the value is numeric it is assumed to be an ASCII    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2352"></a><span class="s1">&#39;                        Decimal Equivalent (Common values are 37=% 42=* 35=#    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2353"></a><span class="s1">&#39;                        36=$ 64=@).                                             &#39;</span><span class="p">,&amp;</span>
<a name="ln-2354"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2355"></a><span class="s1">&#39;   --noenv          The $IFDEF and $IFNDEF directives test for an internal      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2356"></a><span class="s1">&#39;                    prep(1) variable and then an environment variable by        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2357"></a><span class="s1">&#39;                    default. This option turns off testing for environment      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2358"></a><span class="s1">&#39;                    variables.                                                  &#39;</span><span class="p">,&amp;</span>
<a name="ln-2359"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2360"></a><span class="s1">&#39;   --type FILETYPE  This flag indicates to skip input lines until after a       &#39;</span><span class="p">,&amp;</span>
<a name="ln-2361"></a><span class="s1">&#39;                    specific start string is encountered and to stop once a     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2362"></a><span class="s1">&#39;                    specific end string is found, left-justified on lines by    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2363"></a><span class="s1">&#39;                    themselves.                                                 &#39;</span><span class="p">,&amp;</span>
<a name="ln-2364"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2365"></a><span class="s1">&#39;                        FileType  Start_String            Stop_String           &#39;</span><span class="p">,&amp;</span>
<a name="ln-2366"></a><span class="s1">&#39;                        --------  ------------            -----------           &#39;</span><span class="p">,&amp;</span>
<a name="ln-2367"></a><span class="s1">&#39;                        md        ```fortran              ```                   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2368"></a><span class="s1">&#39;                        html      &lt;xmp&gt;                   &lt;/xmp&gt;                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2369"></a><span class="s1">&#39;                        tex       \begin{minted}{Fortran} \end{minted}          &#39;</span><span class="p">,&amp;</span>
<a name="ln-2370"></a><span class="s1">&#39;                        auto                                                    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2371"></a><span class="s1">&#39;                        none                                                    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2372"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2373"></a><span class="s1">&#39;                    The special type &quot;auto&quot; may be specified, in which case     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2374"></a><span class="s1">&#39;                    files will be processed according to their file suffix.     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2375"></a><span class="s1">&#39;                    This allows for easily extracting code from common          &#39;</span><span class="p">,&amp;</span>
<a name="ln-2376"></a><span class="s1">&#39;                    document formats. This is particularly useful with extended &#39;</span><span class="p">,&amp;</span>
<a name="ln-2377"></a><span class="s1">&#39;                    markdown formats, allowing for code source to be easily     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2378"></a><span class="s1">&#39;                    documented and for tests in documents to be able to be      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2379"></a><span class="s1">&#39;                    extracted and tested. &quot;auto&quot; switches processing mode       &#39;</span><span class="p">,&amp;</span>
<a name="ln-2380"></a><span class="s1">&#39;                    depending on input file suffix, treating supported file     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2381"></a><span class="s1">&#39;                    prefixes (&quot;md&quot;,&quot;html&quot;) appropriately.                       &#39;</span><span class="p">,&amp;</span>
<a name="ln-2382"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2383"></a><span class="s1">&#39;   --start STRING   Same as --type except along with --stop allows for custom   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2384"></a><span class="s1">&#39;                    strings to be specified.                                    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2385"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2386"></a><span class="s1">&#39;   --stop STRING    Same as --type except along with --start allows for custom  &#39;</span><span class="p">,&amp;</span>
<a name="ln-2387"></a><span class="s1">&#39;                    strings to be specified.                                    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2388"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2389"></a><span class="s1">&#39;   --system         Allow system commands on $SYSTEM directives to              &#39;</span><span class="p">,&amp;</span>
<a name="ln-2390"></a><span class="s1">&#39;                    be executed.                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2391"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2392"></a><span class="s1">&#39;   --keeptabs       By default tab characters are expanded assuming             &#39;</span><span class="p">,&amp;</span>
<a name="ln-2393"></a><span class="s1">&#39;                    a stop has been set every eight columns; and                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2394"></a><span class="s1">&#39;                    trailing carriage-return characters are removed.            &#39;</span><span class="p">,&amp;</span>
<a name="ln-2395"></a><span class="s1">&#39;                    Use this flag to prevent this processing from               &#39;</span><span class="p">,&amp;</span>
<a name="ln-2396"></a><span class="s1">&#39;                    occurring.                                                  &#39;</span><span class="p">,&amp;</span>
<a name="ln-2397"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2398"></a><span class="s1">&#39;   --comment        try to style comments generated in $BLOCK COMMENT blocks    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2399"></a><span class="s1">&#39;                    for other utilities such as doxygen. Default is to          &#39;</span><span class="p">,&amp;</span>
<a name="ln-2400"></a><span class="s1">&#39;                    prefix lines with &#39;&#39;! &#39;&#39;. Allowed keywords are              &#39;</span><span class="p">,&amp;</span>
<a name="ln-2401"></a><span class="s1">&#39;                    currently &quot;default&quot;, &quot;doxygen&quot;,&quot;none&quot;,&quot;ford&quot;.               &#39;</span><span class="p">,&amp;</span>
<a name="ln-2402"></a><span class="s1">&#39;                    THIS IS AN ALPHA FEATURE AND NOT FULLY IMPLEMENTED.         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2403"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2404"></a><span class="s1">&#39;   --ident          The output of the $IDENT directive is in the form of a      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2405"></a><span class="s1">&#39;                    comment by default. If this flag is set the output is       &#39;</span><span class="p">,&amp;</span>
<a name="ln-2406"></a><span class="s1">&#39;                    of the form described in the $IDENT documentation           &#39;</span><span class="p">,&amp;</span>
<a name="ln-2407"></a><span class="s1">&#39;                    so executables and object code can contain the metadata     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2408"></a><span class="s1">&#39;                    for use with the what(1) command. Note this generates an    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2409"></a><span class="s1">&#39;                    unused variable which some compilers might optimize         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2410"></a><span class="s1">&#39;                    away depending on what compilation options are used.        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2411"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2412"></a><span class="s1">&#39;   -d ignore|remove|blank  Enable special treatment for lines beginning         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2413"></a><span class="s1">&#39;                           with &quot;d&quot; or &quot;D&quot;. The letter will be left as-is       &#39;</span><span class="p">,&amp;</span>
<a name="ln-2414"></a><span class="s1">&#39;                           (the default); removed; or replaced with a blank     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2415"></a><span class="s1">&#39;                           character. This non-standard syntax has been         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2416"></a><span class="s1">&#39;                           used to support the optional compilation of          &#39;</span><span class="p">,&amp;</span>
<a name="ln-2417"></a><span class="s1">&#39;                           &quot;debug&quot; code by many Fortran compilers when          &#39;</span><span class="p">,&amp;</span>
<a name="ln-2418"></a><span class="s1">&#39;                           compiling fixed-format Fortran source.               &#39;</span><span class="p">,&amp;</span>
<a name="ln-2419"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2420"></a><span class="s1">&#39;   --width n    Maximum line length of the output file. The default is 1024.    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2421"></a><span class="s1">&#39;                The parameter is typically used to trim fixed-format FORTRAN    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2422"></a><span class="s1">&#39;                code that contains comments or &quot;ident&quot; labels past column 72    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2423"></a><span class="s1">&#39;                when compiling fixed-format Fortran code.                       &#39;</span><span class="p">,&amp;</span>
<a name="ln-2424"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2425"></a><span class="s1">&#39;   --verbose    All commands on a $SYSTEM directive are echoed                  &#39;</span><span class="p">,&amp;</span>
<a name="ln-2426"></a><span class="s1">&#39;                to stderr with a + prefix. Text following the                   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2427"></a><span class="s1">&#39;                string &quot;@(#)&quot; is printed to stderr similar to                   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2428"></a><span class="s1">&#39;                the Unix command what(1) but is otherwise                       &#39;</span><span class="p">,&amp;</span>
<a name="ln-2429"></a><span class="s1">&#39;                treated as other text input.                                    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2430"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2431"></a><span class="s1">&#39;   --version    Display version and exit                                        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2432"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2433"></a><span class="s1">&#39;   --help       Display documentation and exit.                                 &#39;</span><span class="p">,&amp;</span>
<a name="ln-2434"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2435"></a><span class="s1">&#39;DIRECTIVES                                                                      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2436"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2437"></a><span class="s1">&#39;   $DEFINE|$REDEFINE variable_name [=expression]; ...                           &#39;</span><span class="p">,&amp;</span>
<a name="ln-2438"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2439"></a><span class="s1">&#39;   Defines a numeric or logical variable name and its value. The variable       &#39;</span><span class="p">,&amp;</span>
<a name="ln-2440"></a><span class="s1">&#39;   name may be used in the expressions on the conditional output selector       &#39;</span><span class="p">,&amp;</span>
<a name="ln-2441"></a><span class="s1">&#39;   directives $IF, $ELSEIF, $IFDEF, and $IFNDEF.                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2442"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2443"></a><span class="s1">&#39;   A $DEFINE may appear anywhere in a source file. If the result of             &#39;</span><span class="p">,&amp;</span>
<a name="ln-2444"></a><span class="s1">&#39;   the expression is &quot;.TRUE.&quot; or &quot;.FALSE.&quot; then the parameter will              &#39;</span><span class="p">,&amp;</span>
<a name="ln-2445"></a><span class="s1">&#39;   be of type LOGICAL, otherwise the parameter is of type INTEGER (and          &#39;</span><span class="p">,&amp;</span>
<a name="ln-2446"></a><span class="s1">&#39;   the expression must be an INTEGER expression or null). If no value is        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2447"></a><span class="s1">&#39;   supplied the parameter is given the INTEGER value &quot;1&quot;.                       &#39;</span><span class="p">,&amp;</span>
<a name="ln-2448"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2449"></a><span class="s1">&#39;   Variables are defined from the point they are declared in a $DEFINE          &#39;</span><span class="p">,&amp;</span>
<a name="ln-2450"></a><span class="s1">&#39;   directive or the command line until program termination unless explicitly    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2451"></a><span class="s1">&#39;   undefined with a $UNDEFINE directive.                                        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2452"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2453"></a><span class="s1">&#39;   If a variable is already defined a $DEFINE generates a warning on stderr.    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2454"></a><span class="s1">&#39;   The $REDEFINE directive is identical to the $DEFINE directive accept no      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2455"></a><span class="s1">&#39;   warning is produced if the variable is already defined.                      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2456"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2457"></a><span class="s1">&#39;   Example:                                                                     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2458"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2459"></a><span class="s1">&#39;    &gt; $define A                        ! will have default value of &quot;1&quot;         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2460"></a><span class="s1">&#39;    &gt; $define B = 10 - 2 * 2**3 / 3    ! integer expressions                    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2461"></a><span class="s1">&#39;    &gt; $define C=1+1; D=(-40)/(-10)                                              &#39;</span><span class="p">,&amp;</span>
<a name="ln-2462"></a><span class="s1">&#39;    &gt; $define bigd= d .ge. a; bigb = ( (b &gt;= c) &amp;&amp; (b &gt; 0) )  ! logical         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2463"></a><span class="s1">&#39;    &gt; $if ( A + B ) / C .eq. 1                                                  &#39;</span><span class="p">,&amp;</span>
<a name="ln-2464"></a><span class="s1">&#39;    &gt;    (a+b)/c is one                                                         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2465"></a><span class="s1">&#39;    &gt; $endif                                                                    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2466"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2467"></a><span class="s1">&#39;   $UNDEFINE variable_name[; ...]                                               &#39;</span><span class="p">,&amp;</span>
<a name="ln-2468"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2469"></a><span class="s1">&#39;   A symbol defined with $DEFINE can be removed with the $UNDEFINE directive.   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2470"></a><span class="s1">&#39;   Multiple names may be specified, preferably separated by semi-colons.        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2471"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2472"></a><span class="s1">&#39;   Basic globbing is supported, where &quot;*&quot; represents any string, and &quot;?&quot;        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2473"></a><span class="s1">&#39;   represents any single character.                                             &#39;</span><span class="p">,&amp;</span>
<a name="ln-2474"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2475"></a><span class="s1">&#39;   DEFINED(variable_name[,...])                                                 &#39;</span><span class="p">,&amp;</span>
<a name="ln-2476"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2477"></a><span class="s1">&#39;   A special function called DEFINED() may appear only in a $IF or $ELSEIF.     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2478"></a><span class="s1">&#39;   If &quot;variable_name&quot; has been defined at that point in the source code,        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2479"></a><span class="s1">&#39;   then the function value is &quot;.TRUE.&quot;, otherwise it is &quot;.FALSE.&quot;. A name is    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2480"></a><span class="s1">&#39;   defined only if it has appeared in the source previously in a $DEFINE        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2481"></a><span class="s1">&#39;   directive or been declared on the command line.                              &#39;</span><span class="p">,&amp;</span>
<a name="ln-2482"></a><span class="s1">&#39;   The names used in compiler directives are district from names in the         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2483"></a><span class="s1">&#39;   FORTRAN source, which means that &quot;a&quot; in a $DEFINE and &quot;a&quot; in a FORTRAN       &#39;</span><span class="p">,&amp;</span>
<a name="ln-2484"></a><span class="s1">&#39;   source statement are totally unrelated.                                      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2485"></a><span class="s1">&#39;   The DEFINED() parameter is NOT valid in a $DEFINE directive.                 &#39;</span><span class="p">,&amp;</span>
<a name="ln-2486"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2487"></a><span class="s1">&#39;   Example:                                                                     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2488"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2489"></a><span class="s1">&#39;    &gt;        Program test                                                       &#39;</span><span class="p">,&amp;</span>
<a name="ln-2490"></a><span class="s1">&#39;    &gt; $IF .NOT. DEFINED (inc)                                                   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2491"></a><span class="s1">&#39;    &gt;        INCLUDE &quot;comm.inc&quot;                                                 &#39;</span><span class="p">,&amp;</span>
<a name="ln-2492"></a><span class="s1">&#39;    &gt; $ELSE                                                                     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2493"></a><span class="s1">&#39;    &gt;        INCLUDE &quot;comm2.inc&quot;                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2494"></a><span class="s1">&#39;    &gt; $ENDIF                                                                    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2495"></a><span class="s1">&#39;    &gt;        END                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2496"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2497"></a><span class="s1">&#39;   The file, &quot;comm.inc&quot; will be included in the source if the variable          &#39;</span><span class="p">,&amp;</span>
<a name="ln-2498"></a><span class="s1">&#39;   &quot;inc&quot;, has not been previously defined, while INCLUDE &quot;comm2.inc&quot; will       &#39;</span><span class="p">,&amp;</span>
<a name="ln-2499"></a><span class="s1">&#39;   be included in the source if &quot;inc&quot; has been defined.                         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2500"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2501"></a><span class="s1">&#39;   Predefined variables are                                                     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2502"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2503"></a><span class="s1">&#39;    SYSTEMON = .TRUE. if --system was present on the command line, else .FALSE. &#39;</span><span class="p">,&amp;</span>
<a name="ln-2504"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2505"></a><span class="s1">&#39;    UNKNOWN = 0 LINUX   = 1 MACOS   = 2 WINDOWS = 3                             &#39;</span><span class="p">,&amp;</span>
<a name="ln-2506"></a><span class="s1">&#39;    CYGWIN  = 4 SOLARIS = 5 FREEBSD = 6 OPENBSD = 7                             &#39;</span><span class="p">,&amp;</span>
<a name="ln-2507"></a><span class="s1">&#39;    In addition OS is set to what the program guesses the system type is.       &#39;</span><span class="p">,&amp;</span>
<a name="ln-2508"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2509"></a><span class="s1">&#39;     &gt; $if OS == LINUX                                                          &#39;</span><span class="p">,&amp;</span>
<a name="ln-2510"></a><span class="s1">&#39;     &gt;    write(*,*)&quot;System type is Linux&quot;                                      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2511"></a><span class="s1">&#39;     &gt; $elseif OS == WINDOWS                                                    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2512"></a><span class="s1">&#39;     &gt;    write(*,*)&quot;System type is MSWindows&quot;                                  &#39;</span><span class="p">,&amp;</span>
<a name="ln-2513"></a><span class="s1">&#39;     &gt; $else                                                                    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2514"></a><span class="s1">&#39;     &gt;    write(*,*)&quot;System type is unknown&quot;                                    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2515"></a><span class="s1">&#39;     &gt; $endif                                                                   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2516"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2517"></a><span class="s1">&#39;   $IF/$ELSEIF/$ELSE/$ENDIF directives                                          &#39;</span><span class="p">,&amp;</span>
<a name="ln-2518"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2519"></a><span class="s1">&#39;   Each of these control lines delineates a block of source lines. If the       &#39;</span><span class="p">,&amp;</span>
<a name="ln-2520"></a><span class="s1">&#39;   expression following the $IF is &quot;.TRUE.&quot;, then the following lines of        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2521"></a><span class="s1">&#39;   source following are output. If it is &quot;.FALSE.&quot;, and an $ELSEIF              &#39;</span><span class="p">,&amp;</span>
<a name="ln-2522"></a><span class="s1">&#39;   follows, the expression is evaluated and treated the same as the $IF. If     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2523"></a><span class="s1">&#39;   the $IF and all $ELSEIF expressions are &quot;.FALSE.&quot;, then the lines of         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2524"></a><span class="s1">&#39;   source following the optional $ELSE are output. A matching $ENDIF ends the   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2525"></a><span class="s1">&#39;   conditional block.                                                           &#39;</span><span class="p">,&amp;</span>
<a name="ln-2526"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2527"></a><span class="s1">&#39;   $IFDEF/$IFNDEF directives                                                    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2528"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2529"></a><span class="s1">&#39;   $IFDEF and $IFNDEF are special forms of the $IF directive that simply test   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2530"></a><span class="s1">&#39;   if a variable name is defined or not.                                        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2531"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2532"></a><span class="s1">&#39;   The expressions may optionally be enclosed in parenthesis and followed by    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2533"></a><span class="s1">&#39;   the keyword &quot;THEN&quot;, ie. they may use Fortran syntax. For example, the        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2534"></a><span class="s1">&#39;   previous example may also be written as:                                     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2535"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2536"></a><span class="s1">&#39;     &gt; $IF(OS .EQ. LINUX)THEN                                                   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2537"></a><span class="s1">&#39;     &gt;    write(*,*)&quot;System type is Linux&quot;                                      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2538"></a><span class="s1">&#39;     &gt; $ELSEIF(OS .EQ. WINDOWS)THEN                                             &#39;</span><span class="p">,&amp;</span>
<a name="ln-2539"></a><span class="s1">&#39;     &gt;    write(*,*)&quot;System type is MSWindows&quot;                                  &#39;</span><span class="p">,&amp;</span>
<a name="ln-2540"></a><span class="s1">&#39;     &gt; $ELSE                                                                    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2541"></a><span class="s1">&#39;     &gt;    write(*,*)&quot;System type is unknown&quot;                                    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2542"></a><span class="s1">&#39;     &gt; $ENDIF                                                                   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2543"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2544"></a><span class="s1">&#39;   Essentially, these are equivalent:                                           &#39;</span><span class="p">,&amp;</span>
<a name="ln-2545"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2546"></a><span class="s1">&#39;     $IFDEF varname  ==&gt; $IF DEFINED(varname)                                   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2547"></a><span class="s1">&#39;     $IFNDEF varname ==&gt; $IF .NOT. DEFINED(varname)                             &#39;</span><span class="p">,&amp;</span>
<a name="ln-2548"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2549"></a><span class="s1">&#39;   except that environment variables are tested as well by $IFDEF and $IFNDEF   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2550"></a><span class="s1">&#39;   if the --noenv option is not specified, but never by the function DEFINED(), &#39;</span><span class="p">,&amp;</span>
<a name="ln-2551"></a><span class="s1">&#39;   allowing for environment variables to be selectively used or ignored.        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2552"></a><span class="s1">&#39;   The --noenv switch is therefore only needed for compatibility with fpp(1).   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2553"></a><span class="s1">&#39;   For the purposes of prep(1) an environment variable is defined if it is      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2554"></a><span class="s1">&#39;   returned by the system and has a non-blank value.                            &#39;</span><span class="p">,&amp;</span>
<a name="ln-2555"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2556"></a><span class="s1">&#39;   $IDENT metadata [--language fortran|c|shell]                                 &#39;</span><span class="p">,&amp;</span>
<a name="ln-2557"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2558"></a><span class="s1">&#39;   $IDENT is a special-purpose directive generally used only by users of        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2559"></a><span class="s1">&#39;   SCCS-metadata. This string is generally included for use with the            &#39;</span><span class="p">,&amp;</span>
<a name="ln-2560"></a><span class="s1">&#39;   what(1) command, and generates a comment if &quot;-ident&quot; is not specified        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2561"></a><span class="s1">&#39;   on the command line.                                                         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2562"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2563"></a><span class="s1">&#39;   When the command line option &quot;--ident&quot; is specified this directive           &#39;</span><span class="p">,&amp;</span>
<a name="ln-2564"></a><span class="s1">&#39;   writes a line using SCCS-metadata format of one of the following forms:      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2565"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2566"></a><span class="s1">&#39;     language:                                                                  &#39;</span><span class="p">,&amp;</span>
<a name="ln-2567"></a><span class="s1">&#39;     fortran   character(len=*),parameter::ident=&quot;@(#)metadata&quot;                 &#39;</span><span class="p">,&amp;</span>
<a name="ln-2568"></a><span class="s1">&#39;     c         #ident &quot;@(#)metadata&quot;                                            &#39;</span><span class="p">,&amp;</span>
<a name="ln-2569"></a><span class="s1">&#39;     shell     #@(#) metadata                                                   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2570"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2571"></a><span class="s1">&#39;   &quot;$@(#)&quot; is an alias for &quot;$IDENT&quot; so the source file itself will contain      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2572"></a><span class="s1">&#39;   SCCS-metadata so the metadata can be displayed with what(1) even for the     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2573"></a><span class="s1">&#39;   unprocessed files.                                                           &#39;</span><span class="p">,&amp;</span>
<a name="ln-2574"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2575"></a><span class="s1">&#39;   The default language is &quot;fortran&quot;. Depending on your compiler and the        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2576"></a><span class="s1">&#39;   optimization level used when compiling, the output strings may or may not    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2577"></a><span class="s1">&#39;   remain in the object files and executables created.                          &#39;</span><span class="p">,&amp;</span>
<a name="ln-2578"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2579"></a><span class="s1">&#39;   Do not use the characters double-quote, greater-than, backslash (ie. &quot;&gt;\)    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2580"></a><span class="s1">&#39;   in the metadata to remain compatible with SCCS metadata syntax.              &#39;</span><span class="p">,&amp;</span>
<a name="ln-2581"></a><span class="s1">&#39;   Do not use strings starting with &quot; -&quot; either.                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2582"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2583"></a><span class="s1">&#39;   $OUTPUT filename [--append [.true.|.false.]]                                 &#39;</span><span class="p">,&amp;</span>
<a name="ln-2584"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2585"></a><span class="s1">&#39;   Specify the output file to write to. This overrides the initial output file  &#39;</span><span class="p">,&amp;</span>
<a name="ln-2586"></a><span class="s1">&#39;   specified with command line options. If no output filename is given          &#39;</span><span class="p">,&amp;</span>
<a name="ln-2587"></a><span class="s1">&#39;   prep(1) reverts back to the initial output file. @ is a synonym for stdout.  &#39;</span><span class="p">,&amp;</span>
<a name="ln-2588"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2589"></a><span class="s1">&#39;   Files open at the beginning by default. Use the --append switch to           &#39;</span><span class="p">,&amp;</span>
<a name="ln-2590"></a><span class="s1">&#39;   append to the end of an existing file instead of overwriting it.             &#39;</span><span class="p">,&amp;</span>
<a name="ln-2591"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2592"></a><span class="s1">&#39;   $INCLUDE filename                                                            &#39;</span><span class="p">,&amp;</span>
<a name="ln-2593"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2594"></a><span class="s1">&#39;   Read in the specified input file. Fifty (50) nesting levels are allowed.     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2595"></a><span class="s1">&#39;   Following the tradition of cpp(1) if &quot;&lt;filename&gt;&quot; is specified the file is   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2596"></a><span class="s1">&#39;   only searched for relative to the search directories, otherwise it is        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2597"></a><span class="s1">&#39;   searched for as specified first. Double-quotes are treated as in Fortran     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2598"></a><span class="s1">&#39;   list-directed input.                                                         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2599"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2600"></a><span class="s1">&#39;   $PARCEL [name] / $ENDPARCEL                                                  &#39;</span><span class="p">,&amp;</span>
<a name="ln-2601"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2602"></a><span class="s1">&#39;   The lines between a &quot;$PARCEL name&quot; and &quot;$ENDPARCEL&quot; block are written to a   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2603"></a><span class="s1">&#39;   scratch file WITHOUT expanding directives. the scratch file can then be read &#39;</span><span class="p">,&amp;</span>
<a name="ln-2604"></a><span class="s1">&#39;   in with the $POST directive much like a named file can be with $INCLUDE,     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2605"></a><span class="s1">&#39;   except the scratch file is automatically deleted at program termination.     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2606"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2607"></a><span class="s1">&#39;   $POST name                                                                   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2608"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2609"></a><span class="s1">&#39;   Read in the scratch file created by the $PARCEL directive. Combined with     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2610"></a><span class="s1">&#39;   $SET and $IMPORT directives this allows you to replay a section of input     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2611"></a><span class="s1">&#39;   and replace strings as a simple templating technique, or to repeat lines     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2612"></a><span class="s1">&#39;   like copyright information or definitions of (obsolescent) Fortran COMMON    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2613"></a><span class="s1">&#39;   blocks, put contained in source files without the need for separate          &#39;</span><span class="p">,&amp;</span>
<a name="ln-2614"></a><span class="s1">&#39;   INCLUDE files or error-prone repetition of the declarations.                 &#39;</span><span class="p">,&amp;</span>
<a name="ln-2615"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2616"></a><span class="s1">&#39;   $SET name string                                                             &#39;</span><span class="p">,&amp;</span>
<a name="ln-2617"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2618"></a><span class="s1">&#39;   If a $SET directive defines a name prep(1) enters expansion mode. In this    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2619"></a><span class="s1">&#39;   mode anywhere the string &quot;${NAME}&quot; is encountered in subsequent output it    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2620"></a><span class="s1">&#39;   is replaced by &quot;string&quot;. Comments should not be used on a $SET directive.    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2621"></a><span class="s1">&#39;   Note expansion of a line may cause it to be longer than allowed by some      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2622"></a><span class="s1">&#39;   compilers. Automatic breaking into continuation lines does not occur.        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2623"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2624"></a><span class="s1">&#39;   IF A $SET DIRECTIVE HAS BEEN DEFINED the &quot;standard&quot; preprocessor values      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2625"></a><span class="s1">&#39;   ${FILE}, ${LINE}, ${DATE}, and ${TIME} are also available. The time          &#39;</span><span class="p">,&amp;</span>
<a name="ln-2626"></a><span class="s1">&#39;   refers to the time of processing, not the time of compilation or loading.    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2627"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2628"></a><span class="s1">&#39;   $IMPORT name[;...]                                                           &#39;</span><span class="p">,&amp;</span>
<a name="ln-2629"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2630"></a><span class="s1">&#39;   The values of environment variables may be imported just like their names    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2631"></a><span class="s1">&#39;   and values were used on a $SET directive. The names of the variables are     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2632"></a><span class="s1">&#39;   case-sensitive in regards to obtaining the values, but the names become      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2633"></a><span class="s1">&#39;   values, but the names because case-insensitive in prep(). That is,           &#39;</span><span class="p">,&amp;</span>
<a name="ln-2634"></a><span class="s1">&#39;   &quot;import home&quot; gets the lowercase environment variable &quot;home&quot; and then sets   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2635"></a><span class="s1">&#39;   the associated value and then sets the prep(1) variable &quot;HOME&quot; to the value. &#39;</span><span class="p">,&amp;</span>
<a name="ln-2636"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2637"></a><span class="s1">&#39;   $BLOCK / $ENDBLOCK                                                           &#39;</span><span class="p">,&amp;</span>
<a name="ln-2638"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2639"></a><span class="s1">&#39;   $BLOCK has several forms but in all cases operates on a block of lines:      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2640"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2641"></a><span class="s1">&#39;     basic filtering:                                                           &#39;</span><span class="p">,&amp;</span>
<a name="ln-2642"></a><span class="s1">&#39;      $BLOCK [comment|null|write                 [--file NAME [--append]]       &#39;</span><span class="p">,&amp;</span>
<a name="ln-2643"></a><span class="s1">&#39;     creating a CHARACTER array:                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2644"></a><span class="s1">&#39;      $BLOCK VARIABLE --varname NAME             [--file NAME [--append]]       &#39;</span><span class="p">,&amp;</span>
<a name="ln-2645"></a><span class="s1">&#39;     block versions of prep(1) commands:                                        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2646"></a><span class="s1">&#39;      $BLOCK set|system|message|define|redefine  [--file NAME [--append]]       &#39;</span><span class="p">,&amp;</span>
<a name="ln-2647"></a><span class="s1">&#39;     specialized procedure construction:                                        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2648"></a><span class="s1">&#39;      $BLOCK help|version                        [--file NAME [--append]]       &#39;</span><span class="p">,&amp;</span>
<a name="ln-2649"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2650"></a><span class="s1">&#39;      NULL:      Do not write into current output file                          &#39;</span><span class="p">,&amp;</span>
<a name="ln-2651"></a><span class="s1">&#39;      COMMENT:   write text prefixed by an exclamation and a space or according &#39;</span><span class="p">,&amp;</span>
<a name="ln-2652"></a><span class="s1">&#39;                 to the style selected by the --comment style selected on the   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2653"></a><span class="s1">&#39;                 command line.                                                  &#39;</span><span class="p">,&amp;</span>
<a name="ln-2654"></a><span class="s1">&#39;      WRITE:     write text as Fortran WRITE(3f) statements                     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2655"></a><span class="s1">&#39;                 The Fortran generated is free-format. It is assumed the        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2656"></a><span class="s1">&#39;                 output will not generate lines over 132 columns.               &#39;</span><span class="p">,&amp;</span>
<a name="ln-2657"></a><span class="s1">&#39;      VARIABLE:  write as a text variable. The name may be defined using        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2658"></a><span class="s1">&#39;                 the --varname switch. Default name is &quot;textblock&quot;.             &#39;</span><span class="p">,&amp;</span>
<a name="ln-2659"></a><span class="s1">&#39;      MESSAGE:   All the lines in the block are treated as options to $MESSAGE  &#39;</span><span class="p">,&amp;</span>
<a name="ln-2660"></a><span class="s1">&#39;      SET:       All the lines in the block are treated as options to $SET      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2661"></a><span class="s1">&#39;      DEFINE:    All the lines in the block are treated as options to $DEFINE   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2662"></a><span class="s1">&#39;      REDEFINE   All the lines in the block are treated as options to $REDEFINE &#39;</span><span class="p">,&amp;</span>
<a name="ln-2663"></a><span class="s1">&#39;      SYSTEM:    The lines are gathered into a file and executed by the shell   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2664"></a><span class="s1">&#39;                 with the stdout being written to a scratch file and then read  &#39;</span><span class="p">,&amp;</span>
<a name="ln-2665"></a><span class="s1">&#39;      END:       End block of specially processed text                          &#39;</span><span class="p">,&amp;</span>
<a name="ln-2666"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2667"></a><span class="s1">&#39;    special-purpose modes primarily for use with the M_kracken module:          &#39;</span><span class="p">,&amp;</span>
<a name="ln-2668"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2669"></a><span class="s1">&#39;      HELP:      write text as a subroutine called HELP_USAGE                   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2670"></a><span class="s1">&#39;      VERSION:   write text as a subroutine called HELP_VERSION prefixing       &#39;</span><span class="p">,&amp;</span>
<a name="ln-2671"></a><span class="s1">&#39;                 lines with @(#) for use with the what(1) command.              &#39;</span><span class="p">,&amp;</span>
<a name="ln-2672"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2673"></a><span class="s1">&#39;   If the &quot;--file NAME&quot; option is present the text is written to the            &#39;</span><span class="p">,&amp;</span>
<a name="ln-2674"></a><span class="s1">&#39;   specified file unfiltered except for string expansion. This allows           &#39;</span><span class="p">,&amp;</span>
<a name="ln-2675"></a><span class="s1">&#39;   documentation to easily be maintained in the source file. It can be          &#39;</span><span class="p">,&amp;</span>
<a name="ln-2676"></a><span class="s1">&#39;   tex, html, markdown or any plain text. The filename will be prefixed         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2677"></a><span class="s1">&#39;   with $PREP_DOCUMENT_DIR/doc/ . If the environment variable                   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2678"></a><span class="s1">&#39;   $PREP_DOCUMENT_DIR is not set the option is ignored.                         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2679"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2680"></a><span class="s1">&#39;   The --file output can easily be processed by other utilities such            &#39;</span><span class="p">,&amp;</span>
<a name="ln-2681"></a><span class="s1">&#39;   as markdown(1) or txt2man(1) to produce man(1) pages and HTML                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2682"></a><span class="s1">&#39;   documents. $SYSTEM commands may follow the $BLOCK block text to              &#39;</span><span class="p">,&amp;</span>
<a name="ln-2683"></a><span class="s1">&#39;   optionally post-process the doc files.                                       &#39;</span><span class="p">,&amp;</span>
<a name="ln-2684"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2685"></a><span class="s1">&#39;   $ENDBLOCK ends the block, which is preferred; but a blank value or &quot;END&quot; on  &#39;</span><span class="p">,&amp;</span>
<a name="ln-2686"></a><span class="s1">&#39;   a $BLOCK directive does as well.                                             &#39;</span><span class="p">,&amp;</span>
<a name="ln-2687"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2688"></a><span class="s1">&#39;   $SHOW [variable_name][;...]                                                  &#39;</span><span class="p">,&amp;</span>
<a name="ln-2689"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2690"></a><span class="s1">&#39;   Shows current state of prep(1); including variable names and values and      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2691"></a><span class="s1">&#39;   the name of the current input files. All output is preceded by an            &#39;</span><span class="p">,&amp;</span>
<a name="ln-2692"></a><span class="s1">&#39;   exclamation character.                                                       &#39;</span><span class="p">,&amp;</span>
<a name="ln-2693"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2694"></a><span class="s1">&#39;   If a list of defined variable names is present only those variables and      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2695"></a><span class="s1">&#39;   their values are shown.                                                      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2696"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2697"></a><span class="s1">&#39;   Basic globbing is supported, where &quot;*&quot; represents any string, and &quot;?&quot;        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2698"></a><span class="s1">&#39;   represents any single character.                                             &#39;</span><span class="p">,&amp;</span>
<a name="ln-2699"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2700"></a><span class="s1">&#39;   Example:                                                                     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2701"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2702"></a><span class="s1">&#39;    &gt; prep A=10 B C D -o paper                                                  &#39;</span><span class="p">,&amp;</span>
<a name="ln-2703"></a><span class="s1">&#39;    &gt; $define z=22                                                              &#39;</span><span class="p">,&amp;</span>
<a name="ln-2704"></a><span class="s1">&#39;    &gt; $show B Z                                                                 &#39;</span><span class="p">,&amp;</span>
<a name="ln-2705"></a><span class="s1">&#39;    &gt; $show                                                                     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2706"></a><span class="s1">&#39;    &gt; $show H*;*H;*H*! show beginning with &quot;H&quot;, ending with &quot;H&quot;, containing &quot;H&quot; &#39;</span><span class="p">,&amp;</span>
<a name="ln-2707"></a><span class="s1">&#39;    &gt; $stop 0                                                                   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2708"></a><span class="s1">&#39;    &gt;                                                                           &#39;</span><span class="p">,&amp;</span>
<a name="ln-2709"></a><span class="s1">&#39;    &gt; !  B  =  1                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2710"></a><span class="s1">&#39;    &gt; !  Z  =  22                                                               &#39;</span><span class="p">,&amp;</span>
<a name="ln-2711"></a><span class="s1">&#39;    &gt; !================================================================         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2712"></a><span class="s1">&#39;    &gt; !                                                                         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2713"></a><span class="s1">&#39;    &gt; ! Current state of prep(1):(18:39 20 Jun 2021)                            &#39;</span><span class="p">,&amp;</span>
<a name="ln-2714"></a><span class="s1">&#39;    &gt; ! Total lines read ............... 2                                      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2715"></a><span class="s1">&#39;    &gt; ! Conditional nesting level....... 0                                      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2716"></a><span class="s1">&#39;    &gt; ! G_WRITE (general processing).... T                                      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2717"></a><span class="s1">&#39;    &gt; ! G_LLWRITE (write input lines)... T                                      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2718"></a><span class="s1">&#39;    &gt; ! Arguments ...................... A=10 B C D -o paper                    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2719"></a><span class="s1">&#39;    &gt; ! Open files:                                                             &#39;</span><span class="p">,&amp;</span>
<a name="ln-2720"></a><span class="s1">&#39;    &gt; !    unit ! line number ! filename                                        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2721"></a><span class="s1">&#39;    &gt; !       5 !           2 ! @                                               &#39;</span><span class="p">,&amp;</span>
<a name="ln-2722"></a><span class="s1">&#39;    &gt; ! INCLUDE directories:                                                    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2723"></a><span class="s1">&#39;    &gt; !    .                                                                    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2724"></a><span class="s1">&#39;    &gt; ! Variables:                                                              &#39;</span><span class="p">,&amp;</span>
<a name="ln-2725"></a><span class="s1">&#39;    &gt; !    $DEFINE UNKNOWN  =  0                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2726"></a><span class="s1">&#39;    &gt; !    $DEFINE LINUX  =  1                                                  &#39;</span><span class="p">,&amp;</span>
<a name="ln-2727"></a><span class="s1">&#39;    &gt; !    $DEFINE MACOS  =  2                                                  &#39;</span><span class="p">,&amp;</span>
<a name="ln-2728"></a><span class="s1">&#39;    &gt; !    $DEFINE WINDOWS  =  3                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2729"></a><span class="s1">&#39;    &gt; !    $DEFINE CYGWIN  =  4                                                 &#39;</span><span class="p">,&amp;</span>
<a name="ln-2730"></a><span class="s1">&#39;    &gt; !    $DEFINE SOLARIS  =  5                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2731"></a><span class="s1">&#39;    &gt; !    $DEFINE FREEBSD  =  6                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2732"></a><span class="s1">&#39;    &gt; !    $DEFINE OPENBSD  =  7                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2733"></a><span class="s1">&#39;    &gt; !    $DEFINE OS  =  1                                                     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2734"></a><span class="s1">&#39;    &gt; !    $DEFINE A  =  10                                                     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2735"></a><span class="s1">&#39;    &gt; !    $DEFINE B  =  1                                                      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2736"></a><span class="s1">&#39;    &gt; !    $DEFINE C  =  1                                                      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2737"></a><span class="s1">&#39;    &gt; !    $DEFINE D  =  1                                                      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2738"></a><span class="s1">&#39;    &gt; !    $DEFINE Z  =  22                                                     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2739"></a><span class="s1">&#39;    &gt; ! Parcels:                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2740"></a><span class="s1">&#39;    &gt; !================================================================         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2741"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2742"></a><span class="s1">&#39;   $STOP [stop_value [&quot;message&quot;]]                                               &#39;</span><span class="p">,&amp;</span>
<a name="ln-2743"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2744"></a><span class="s1">&#39;   Stops the prep(1) program. An optional integer value will be returned        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2745"></a><span class="s1">&#39;   as a status value to the system where supported.                             &#39;</span><span class="p">,&amp;</span>
<a name="ln-2746"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2747"></a><span class="s1">&#39;   o A value of &quot;0&quot; causes normal program termination.                          &#39;</span><span class="p">,&amp;</span>
<a name="ln-2748"></a><span class="s1">&#39;   o The default value is &quot;1&quot;.                                                  &#39;</span><span class="p">,&amp;</span>
<a name="ln-2749"></a><span class="s1">&#39;   o If a message is supplied it is displayed to stderr.                        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2750"></a><span class="s1">&#39;   o The default message if the value is not &quot;0&quot; is to display the program      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2751"></a><span class="s1">&#39;     state like a &quot;$SHOW&quot; directive.                                            &#39;</span><span class="p">,&amp;</span>
<a name="ln-2752"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2753"></a><span class="s1">&#39;   &quot;$QUIT&quot; is an alias for &quot;$STOP 0&quot;. &quot;$ERROR&quot; is a synonym for &quot;$STOP 1&quot;       &#39;</span><span class="p">,&amp;</span>
<a name="ln-2754"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2755"></a><span class="s1">&#39;     &gt;$IFNDEF TYPE                                                              &#39;</span><span class="p">,&amp;</span>
<a name="ln-2756"></a><span class="s1">&#39;     &gt;$STOP 10 &quot;ERROR: &quot;&quot;TYPE&quot;&quot; not defined&quot;                                    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2757"></a><span class="s1">&#39;     &gt;$ENDIF                                                                    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2758"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2759"></a><span class="s1">&#39;   $SYSTEM system_command                                                       &#39;</span><span class="p">,&amp;</span>
<a name="ln-2760"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2761"></a><span class="s1">&#39;   If system command processing is enabled using the --system switch system     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2762"></a><span class="s1">&#39;   commands can be executed for such tasks as creating files to be read or to   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2763"></a><span class="s1">&#39;   further process documents created by $BLOCK. $SYSTEM directives are errors   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2764"></a><span class="s1">&#39;   by default; as you clearly need to ensure the input file is trusted before   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2765"></a><span class="s1">&#39;   before allowing commands to be executed. Commands that are system-specific   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2766"></a><span class="s1">&#39;   may need to be executed conditionally as well.                               &#39;</span><span class="p">,&amp;</span>
<a name="ln-2767"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2768"></a><span class="s1">&#39;   Examples:                                                                    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2769"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2770"></a><span class="s1">&#39;    &gt; $! build variable definitions using GNU/Linux commands                    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2771"></a><span class="s1">&#39;    &gt; $SYSTEM echo system=`hostname` &gt; compiled.h                               &#39;</span><span class="p">,&amp;</span>
<a name="ln-2772"></a><span class="s1">&#39;    &gt; $SYSTEM echo compile_time=&quot;`date`&quot; &gt;&gt; compiled.h                          &#39;</span><span class="p">,&amp;</span>
<a name="ln-2773"></a><span class="s1">&#39;    &gt; $INCLUDE compiled.h                                                       &#39;</span><span class="p">,&amp;</span>
<a name="ln-2774"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2775"></a><span class="s1">&#39;    &gt; $if systemon      ! if --system switch is present on command line         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2776"></a><span class="s1">&#39;    &gt; $!  obtain up-to-date copy of source file from HTTP server:               &#39;</span><span class="p">,&amp;</span>
<a name="ln-2777"></a><span class="s1">&#39;    &gt; $   SYSTEM wget http://repository.net/src/func.F90 -O - &gt;_tmp.f90         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2778"></a><span class="s1">&#39;    &gt; $   INCLUDE _tmp.f90                                                      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2779"></a><span class="s1">&#39;    &gt; $   SYSTEM  rm _tmp.f90                                                   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2780"></a><span class="s1">&#39;    &gt; $endif                                                                    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2781"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2782"></a><span class="s1">&#39;   $MESSAGE message                                                             &#39;</span><span class="p">,&amp;</span>
<a name="ln-2783"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2784"></a><span class="s1">&#39;   Write message to stderr.                                                     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2785"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2786"></a><span class="s1">&#39;   Note that messages for $MESSAGE do not treat &quot;! &quot; as starting a comment      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2787"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2788"></a><span class="s1">&#39;LIMITATIONS                                                                     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2789"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2790"></a><span class="s1">&#39;   $IF constructs can be nested up to 20 levels deep. Note that using           &#39;</span><span class="p">,&amp;</span>
<a name="ln-2791"></a><span class="s1">&#39;   more than two levels typically makes input files less readable.              &#39;</span><span class="p">,&amp;</span>
<a name="ln-2792"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2793"></a><span class="s1">&#39;   $ENDBLOCK is required after a $BLOCK or --file FILENAME is not written.      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2794"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2795"></a><span class="s1">&#39;   Nesting of $BLOCK sections not allowed.                                      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2796"></a><span class="s1">&#39;   $INCLUDE may be nested fifty (50) levels.                                    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2797"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2798"></a><span class="s1">&#39;   Input files                                                                  &#39;</span><span class="p">,&amp;</span>
<a name="ln-2799"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2800"></a><span class="s1">&#39;   o lines are limited to a maximum of 1024 columns. Text past the limit is     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2801"></a><span class="s1">&#39;     ignored.                                                                   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2802"></a><span class="s1">&#39;   o files cannot be concurrently opened multiple times                         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2803"></a><span class="s1">&#39;   o a maximum of 50 files can be nested by $INCLUDE                            &#39;</span><span class="p">,&amp;</span>
<a name="ln-2804"></a><span class="s1">&#39;   o filenames cannot contain spaces on the command line.                       &#39;</span><span class="p">,&amp;</span>
<a name="ln-2805"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2806"></a><span class="s1">&#39;   Variable names                                                               &#39;</span><span class="p">,&amp;</span>
<a name="ln-2807"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2808"></a><span class="s1">&#39;   o are limited to 31 characters.                                              &#39;</span><span class="p">,&amp;</span>
<a name="ln-2809"></a><span class="s1">&#39;   o must start with a letter (A-Z).                                            &#39;</span><span class="p">,&amp;</span>
<a name="ln-2810"></a><span class="s1">&#39;   o are composed of the letters A-Z, digits 0-9 and _ and $.                   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2811"></a><span class="s1">&#39;   o 2048 variable names may be defined at a time.                              &#39;</span><span class="p">,&amp;</span>
<a name="ln-2812"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2813"></a><span class="s1">&#39;EXAMPLES                                                                        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2814"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2815"></a><span class="s1">&#39;  Define variables on command line:                                             &#39;</span><span class="p">,&amp;</span>
<a name="ln-2816"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2817"></a><span class="s1">&#39;  Typically, variables are defined on the command line when prep(1) is          &#39;</span><span class="p">,&amp;</span>
<a name="ln-2818"></a><span class="s1">&#39;  invoked but can be grouped together into small files that are included        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2819"></a><span class="s1">&#39;  with a $INCLUDE or as input files.                                            &#39;</span><span class="p">,&amp;</span>
<a name="ln-2820"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2821"></a><span class="s1">&#39;    &gt; prep HP size=64 -i hp_directives.dirs test.F90 -o test_out.f90            &#39;</span><span class="p">,&amp;</span>
<a name="ln-2822"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2823"></a><span class="s1">&#39;  defines variables HP and SIZE as if the expressions had been on a             &#39;</span><span class="p">,&amp;</span>
<a name="ln-2824"></a><span class="s1">&#39;  $DEFINE and reads file &quot;hp_directives.dirs&quot; and then test.F90.                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2825"></a><span class="s1">&#39;  Output is directed to test_out.f90                                            &#39;</span><span class="p">,&amp;</span>
<a name="ln-2826"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2827"></a><span class="s1">&#39;  Basic conditionals:                                                           &#39;</span><span class="p">,&amp;</span>
<a name="ln-2828"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2829"></a><span class="s1">&#39;   &gt; $! set variable &quot;a&quot; if not specified on the prep(1) command.               &#39;</span><span class="p">,&amp;</span>
<a name="ln-2830"></a><span class="s1">&#39;   &gt; $IF .NOT.DEFINED(A)                                                        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2831"></a><span class="s1">&#39;   &gt; $   DEFINE a=1  ! so only define the first version of SUB(3f) below        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2832"></a><span class="s1">&#39;   &gt; $ENDIF                                                                     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2833"></a><span class="s1">&#39;   &gt;    program conditional_compile                                             &#39;</span><span class="p">,&amp;</span>
<a name="ln-2834"></a><span class="s1">&#39;   &gt;       call sub()                                                           &#39;</span><span class="p">,&amp;</span>
<a name="ln-2835"></a><span class="s1">&#39;   &gt;    end program conditional_compile                                         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2836"></a><span class="s1">&#39;   &gt; $! select a version of SUB depending on the value of variable &quot;a&quot;          &#39;</span><span class="p">,&amp;</span>
<a name="ln-2837"></a><span class="s1">&#39;   &gt; $IF a .EQ. 1                                                               &#39;</span><span class="p">,&amp;</span>
<a name="ln-2838"></a><span class="s1">&#39;   &gt;    subroutine sub                                                          &#39;</span><span class="p">,&amp;</span>
<a name="ln-2839"></a><span class="s1">&#39;   &gt;       print*, &quot;This is the first SUB&quot;                                      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2840"></a><span class="s1">&#39;   &gt;    end subroutine sub                                                      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2841"></a><span class="s1">&#39;   &gt; $ELSEIF a .eq. 2                                                           &#39;</span><span class="p">,&amp;</span>
<a name="ln-2842"></a><span class="s1">&#39;   &gt;    subroutine sub                                                          &#39;</span><span class="p">,&amp;</span>
<a name="ln-2843"></a><span class="s1">&#39;   &gt;       print*, &quot;This is the second SUB&quot;                                     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2844"></a><span class="s1">&#39;   &gt;    end subroutine sub                                                      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2845"></a><span class="s1">&#39;   &gt; $ELSE                                                                      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2846"></a><span class="s1">&#39;   &gt;    subroutine sub                                                          &#39;</span><span class="p">,&amp;</span>
<a name="ln-2847"></a><span class="s1">&#39;   &gt;       print*, &quot;This is the third SUB&quot;                                      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2848"></a><span class="s1">&#39;   &gt;    end subroutine sub                                                      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2849"></a><span class="s1">&#39;   &gt; $ENDIF                                                                     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2850"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2851"></a><span class="s1">&#39;  Common use of $BLOCK                                                          &#39;</span><span class="p">,&amp;</span>
<a name="ln-2852"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2853"></a><span class="s1">&#39;   &gt; $!                                                                         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2854"></a><span class="s1">&#39;   &gt; $BLOCK NULL --file manual.tex                                              &#39;</span><span class="p">,&amp;</span>
<a name="ln-2855"></a><span class="s1">&#39;   &gt; This is a block of text that will be ignored except it is optionally       &#39;</span><span class="p">,&amp;</span>
<a name="ln-2856"></a><span class="s1">&#39;   &gt; written to a $PREP_DOCUMENT_DIR/doc/ file when $PREP_DOCUMENT_DIR is set.  &#39;</span><span class="p">,&amp;</span>
<a name="ln-2857"></a><span class="s1">&#39;   &gt; $ENDBLOCK                                                                  &#39;</span><span class="p">,&amp;</span>
<a name="ln-2858"></a><span class="s1">&#39;   &gt;                                                                            &#39;</span><span class="p">,&amp;</span>
<a name="ln-2859"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2860"></a><span class="s1">&#39;  This is a block of text that will be converted to comments and optionally     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2861"></a><span class="s1">&#39;  appended to a $PREP_DOCUMENT_DIR/doc/ file when $PREP_DOCUMENT_DIR is set.    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2862"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2863"></a><span class="s1">&#39;   &gt; $BLOCK COMMENT--file conditional_compile.man                               &#39;</span><span class="p">,&amp;</span>
<a name="ln-2864"></a><span class="s1">&#39;   &gt; NAME                                                                       &#39;</span><span class="p">,&amp;</span>
<a name="ln-2865"></a><span class="s1">&#39;   &gt;    conditional_compile - basic example for prep(1) pre-processor.          &#39;</span><span class="p">,&amp;</span>
<a name="ln-2866"></a><span class="s1">&#39;   &gt; SYNOPSIS                                                                   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2867"></a><span class="s1">&#39;   &gt;    conditional_example [--help] [--version]                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2868"></a><span class="s1">&#39;   &gt; DESCRIPTION                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2869"></a><span class="s1">&#39;   &gt;    This is a basic example program showing how documentation can be        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2870"></a><span class="s1">&#39;   &gt;    used to generate program help text                                      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2871"></a><span class="s1">&#39;   &gt; OPTIONS                                                                    &#39;</span><span class="p">,&amp;</span>
<a name="ln-2872"></a><span class="s1">&#39;   &gt;    --help     display this help and exit                                   &#39;</span><span class="p">,&amp;</span>
<a name="ln-2873"></a><span class="s1">&#39;   &gt;    --version  output version information and exit                          &#39;</span><span class="p">,&amp;</span>
<a name="ln-2874"></a><span class="s1">&#39;   &gt; $ENDBLOCK                                                                  &#39;</span><span class="p">,&amp;</span>
<a name="ln-2875"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2876"></a><span class="s1">&#39; SET USAGE                                                                      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2877"></a><span class="s1">&#39;  Note values are case-sensitive but variable names are not, and there are      &#39;</span><span class="p">,&amp;</span>
<a name="ln-2878"></a><span class="s1">&#39;  pre-defined values for input file, line in input file, date and time that     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2879"></a><span class="s1">&#39;  are NOT ACTIVE until at least one $SET or $IMPORT directive is processed.     &#39;</span><span class="p">,&amp;</span>
<a name="ln-2880"></a><span class="s1">&#39;  That is, unless a variable name is defined no ${NAME} expansion occurs.       &#39;</span><span class="p">,&amp;</span>
<a name="ln-2881"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2882"></a><span class="s1">&#39;   &gt; $set author  William Shakespeare                                           &#39;</span><span class="p">,&amp;</span>
<a name="ln-2883"></a><span class="s1">&#39;   &gt; $import HOME                                                               &#39;</span><span class="p">,&amp;</span>
<a name="ln-2884"></a><span class="s1">&#39;   &gt; write(*,*)&#39;&#39;By ${AUTHOR}&#39;&#39;                                                 &#39;</span><span class="p">,&amp;</span>
<a name="ln-2885"></a><span class="s1">&#39;   &gt; write(*,*)&#39;&#39;File ${FILE}&#39;&#39;                                                 &#39;</span><span class="p">,&amp;</span>
<a name="ln-2886"></a><span class="s1">&#39;   &gt; write(*,*)&#39;&#39;Line ${LINE}&#39;&#39;                                                 &#39;</span><span class="p">,&amp;</span>
<a name="ln-2887"></a><span class="s1">&#39;   &gt; write(*,*)&#39;&#39;Date ${DATE}&#39;&#39;                                                 &#39;</span><span class="p">,&amp;</span>
<a name="ln-2888"></a><span class="s1">&#39;   &gt; write(*,*)&#39;&#39;Time ${TIME}&#39;&#39;                                                 &#39;</span><span class="p">,&amp;</span>
<a name="ln-2889"></a><span class="s1">&#39;   &gt; write(*,*)&#39;&#39;HOME ${HOME}&#39;&#39;                                                 &#39;</span><span class="p">,&amp;</span>
<a name="ln-2890"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2891"></a><span class="s1">&#39;GENERAL TEMPLATING                                                              &#39;</span><span class="p">,&amp;</span>
<a name="ln-2892"></a><span class="s1">&#39;  A parcel can be posted multiple times, changing the value of variables        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2893"></a><span class="s1">&#39;  before each post.                                                             &#39;</span><span class="p">,&amp;</span>
<a name="ln-2894"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2895"></a><span class="s1">&#39;   &gt; $PARCEL mysub                                                              &#39;</span><span class="p">,&amp;</span>
<a name="ln-2896"></a><span class="s1">&#39;   &gt; subroutine mysub_${TYPE}(a,b)                                              &#39;</span><span class="p">,&amp;</span>
<a name="ln-2897"></a><span class="s1">&#39;   &gt; use, intrinsic :: iso_fortran_env, only : &amp;                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2898"></a><span class="s1">&#39;   &gt; &amp; real_kinds, real32,real64,real128                                        &#39;</span><span class="p">,&amp;</span>
<a name="ln-2899"></a><span class="s1">&#39;   &gt; implicit none                                                              &#39;</span><span class="p">,&amp;</span>
<a name="ln-2900"></a><span class="s1">&#39;   &gt; integer,parameter  :: wp=${type}                                           &#39;</span><span class="p">,&amp;</span>
<a name="ln-2901"></a><span class="s1">&#39;   &gt; real(kind=${TYPE}) :: a,b                                                  &#39;</span><span class="p">,&amp;</span>
<a name="ln-2902"></a><span class="s1">&#39;   &gt;    write(*,*)10.0_wp                                                       &#39;</span><span class="p">,&amp;</span>
<a name="ln-2903"></a><span class="s1">&#39;   &gt;    write(*,*) &quot;for type ${type}&quot;                                           &#39;</span><span class="p">,&amp;</span>
<a name="ln-2904"></a><span class="s1">&#39;   &gt; end subroutine mysub_${TYPE}                                               &#39;</span><span class="p">,&amp;</span>
<a name="ln-2905"></a><span class="s1">&#39;   &gt;                                                                            &#39;</span><span class="p">,&amp;</span>
<a name="ln-2906"></a><span class="s1">&#39;   &gt; $ENDPARCEL                                                                 &#39;</span><span class="p">,&amp;</span>
<a name="ln-2907"></a><span class="s1">&#39;   &gt; $set type real32                                                           &#39;</span><span class="p">,&amp;</span>
<a name="ln-2908"></a><span class="s1">&#39;   &gt; $post mysub                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2909"></a><span class="s1">&#39;   &gt; $set type real64                                                           &#39;</span><span class="p">,&amp;</span>
<a name="ln-2910"></a><span class="s1">&#39;   &gt; $post mysub                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2911"></a><span class="s1">&#39;   &gt; $set type real128                                                          &#39;</span><span class="p">,&amp;</span>
<a name="ln-2912"></a><span class="s1">&#39;   &gt; $post mysub                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2913"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2914"></a><span class="s1">&#39;NOTE                                                                            &#39;</span><span class="p">,&amp;</span>
<a name="ln-2915"></a><span class="s1">&#39;  Not documented elsewhere, note that there is a developer flag (--debug) that  &#39;</span><span class="p">,&amp;</span>
<a name="ln-2916"></a><span class="s1">&#39;  can be useful when learning proper prep(1) usage (but it should not be used in&#39;</span><span class="p">,&amp;</span>
<a name="ln-2917"></a><span class="s1">&#39;  production). Among other things it deactivates the termination of the program &#39;</span><span class="p">,&amp;</span>
<a name="ln-2918"></a><span class="s1">&#39;  upon detection of an error. This mode thus allows for simple interactive use. &#39;</span><span class="p">,&amp;</span>
<a name="ln-2919"></a><span class="s1">&#39;  In addition, when in this mode entering &quot;$HELP&quot; produces a cribsheet.         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2920"></a><span class="s1">&#39;AUTHOR                                                                          &#39;</span><span class="p">,&amp;</span>
<a name="ln-2921"></a><span class="s1">&#39;   John S. Urban                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2922"></a><span class="s1">&#39;                                                                                &#39;</span><span class="p">,&amp;</span>
<a name="ln-2923"></a><span class="s1">&#39;LICENSE                                                                         &#39;</span><span class="p">,&amp;</span>
<a name="ln-2924"></a><span class="s1">&#39;   MIT                                                                          &#39;</span><span class="p">,&amp;</span>
<a name="ln-2925"></a><span class="s1">&#39;&#39;</span><span class="p">]</span>
<a name="ln-2926"></a>
<a name="ln-2927"></a>   <span class="k">WRITE</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)(</span><span class="nb">trim</span><span class="p">(</span><span class="n">help_text</span><span class="p">(</span><span class="n">i</span><span class="p">)),</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">help_text</span><span class="p">))</span>
<a name="ln-2928"></a>   <span class="k">call stop</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">)</span>
<a name="ln-2929"></a><span class="k">endif</span>
<a name="ln-2930"></a><span class="k">end subroutine </span><span class="n">help_usage</span>
<a name="ln-2931"></a>
<a name="ln-2932"></a><span class="k">subroutine </span><span class="n">help_version</span><span class="p">(</span><span class="n">l_version</span><span class="p">)</span>
<a name="ln-2933"></a><span class="c">!@(#)help_version(3f): prints version information&quot;</span>
<a name="ln-2934"></a><span class="kt">logical</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">l_version</span>
<a name="ln-2935"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span>   <span class="kd">::</span> <span class="n">help_text</span><span class="p">(:)</span>
<a name="ln-2936"></a><span class="kt">integer</span>                        <span class="kd">::</span> <span class="n">i</span>
<a name="ln-2937"></a><span class="kt">logical</span>                        <span class="kd">::</span> <span class="n">stopit</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-2938"></a>
<a name="ln-2939"></a><span class="n">stopit</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-2940"></a><span class="k">if</span><span class="p">(</span><span class="n">l_version</span><span class="p">)</span><span class="k">then</span>
<a name="ln-2941"></a><span class="n">help_text</span><span class="o">=</span><span class="p">[</span> <span class="kt">CHARACTER</span><span class="p">(</span><span class="nb">LEN</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span> <span class="kd">::</span> <span class="p">&amp;</span>
<a name="ln-2942"></a><span class="s1">&#39;@(#)PRODUCT:        GPF (General Purpose Fortran) utilities and examples&gt;&#39;</span><span class="p">,&amp;</span>
<a name="ln-2943"></a><span class="s1">&#39;@(#)PROGRAM:        prep(1f)&gt;&#39;</span><span class="p">,&amp;</span>
<a name="ln-2944"></a><span class="s1">&#39;@(#)DESCRIPTION:    Fortran Pre-processor&gt;&#39;</span><span class="p">,&amp;</span>
<a name="ln-2945"></a><span class="c">!&#39;@(#)VERSION:        4.0.0: 20170502&gt;&#39;,&amp;</span>
<a name="ln-2946"></a><span class="c">!&#39;@(#)VERSION:        5.0.0: 20201219&gt;&#39;,&amp;</span>
<a name="ln-2947"></a><span class="c">!&#39;@(#)VERSION:        6.0.0: 20210613&gt;&#39;,&amp;</span>
<a name="ln-2948"></a><span class="c">!&#39;@(#)VERSION:        6.0.1: 20220311&gt;&#39;,&amp;</span>
<a name="ln-2949"></a><span class="c">!&#39;@(#)VERSION:        6.1.1: 20220326&gt;&#39;,&amp;</span>
<a name="ln-2950"></a><span class="c">!&#39;@(#)VERSION:        6.1.2: 20220326&gt;&#39;,&amp;</span>
<a name="ln-2951"></a><span class="c">!&#39;@(#)VERSION:        6.2.2: 20220329&gt;&#39;,&amp;</span>
<a name="ln-2952"></a><span class="c">!&#39;@(#)VERSION:        7.0.0: 20220401&gt;&#39;,&amp;</span>
<a name="ln-2953"></a><span class="s1">&#39;@(#)VERSION:        8.0.0: 20220403&gt;&#39;</span><span class="p">,&amp;</span>
<a name="ln-2954"></a><span class="s1">&#39;@(#)AUTHOR:         John S. Urban&gt;&#39;</span><span class="p">,&amp;</span>
<a name="ln-2955"></a><span class="s1">&#39;@(#)HOME PAGE       https://github.com/urbanjost/prep.git/&gt;&#39;</span><span class="p">,&amp;</span>
<a name="ln-2956"></a><span class="s1">&#39;&#39;</span><span class="p">]</span>
<a name="ln-2957"></a>   <span class="k">WRITE</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)(</span><span class="nb">trim</span><span class="p">(</span><span class="n">help_text</span><span class="p">(</span><span class="n">i</span><span class="p">)(</span><span class="mi">5</span><span class="p">:</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">help_text</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">help_text</span><span class="p">))</span>
<a name="ln-2958"></a>   <span class="k">call stop</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">)</span>
<a name="ln-2959"></a><span class="k">endif</span>
<a name="ln-2960"></a><span class="k">end subroutine </span><span class="n">help_version</span>
<a name="ln-2961"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2962"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-2963"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-2964"></a><span class="k">subroutine </span><span class="n">short_help</span><span class="p">()</span>
<a name="ln-2965"></a><span class="k">implicit none</span>
<a name="ln-2966"></a><span class="c">!@(#)short_help(3f): prints help information&quot;</span>
<a name="ln-2967"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">help_text</span><span class="p">(:)</span>
<a name="ln-2968"></a><span class="kt">integer</span>                        <span class="kd">::</span> <span class="n">i</span>
<a name="ln-2969"></a><span class="n">help_text</span><span class="o">=</span><span class="p">[</span> <span class="kt">CHARACTER</span><span class="p">(</span><span class="nb">LEN</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span> <span class="kd">::</span> <span class="p">&amp;</span>
<a name="ln-2970"></a><span class="s2">&quot;EXPRESSIONS                                                                     &quot;</span><span class="p">,&amp;</span>    
<a name="ln-2971"></a><span class="s2">&quot;  numeric operators are +,-,*,/,**, (). Logical operators are                   &quot;</span><span class="p">,&amp;</span>
<a name="ln-2972"></a><span class="s2">&quot;   &gt;  | .EQ.| .NE.| .GE.| .GT.| .LE.| .LT.|.NOT.|.AND.| .OR.| .EQV.|.NEQV.|     &quot;</span><span class="p">,&amp;</span>
<a name="ln-2973"></a><span class="s2">&quot;   &gt;  |  == |  /= |  &gt;= |  &gt;  |  &lt;= |  &lt;  |  !  |  &amp;&amp; |  || |  ==  |  !=  |     &quot;</span><span class="p">,&amp;</span>
<a name="ln-2974"></a><span class="s2">&quot;  $DEFINE|$REDEFINE variable_name[=expression][;...]                            &quot;</span><span class="p">,&amp;</span>
<a name="ln-2975"></a><span class="s1">&#39;   &gt; Predefined values are &quot;OS&quot;, which is set to a guess of the system type, and&#39;</span><span class="p">,&amp;</span>
<a name="ln-2976"></a><span class="s2">&quot;   &gt; UNKNOWN=0 LINUX=1 MACOS=2 WINDOWS=3 CYGWIN=4 SOLARIS=5 FREEBSD=6 OPENBSD=7.&quot;</span><span class="p">,&amp;</span>
<a name="ln-2977"></a><span class="s2">&quot;   &gt; SYSTEMON is .TRUE. if --system is present on the command line, else .FALSE.&quot;</span><span class="p">,&amp;</span>
<a name="ln-2978"></a><span class="s2">&quot;  $UNDEFINE|$UNDEF variable_name[;...]                                          &quot;</span><span class="p">,&amp;</span>
<a name="ln-2979"></a><span class="s2">&quot;CONDITIONAL CODE SELECTION:                                                     &quot;</span><span class="p">,&amp;</span>
<a name="ln-2980"></a><span class="s2">&quot;  $IF logical_integer-based_expression | $IFDEF|$IFNDEF variable_or_envname     &quot;</span><span class="p">,&amp;</span>
<a name="ln-2981"></a><span class="s2">&quot;  $IF DEFINED(varname[,...]) | $IF .NOT. DEFINED(varname[,...]) |               &quot;</span><span class="p">,&amp;</span>
<a name="ln-2982"></a><span class="s2">&quot;  $ELSEIF|$ELIF logical_integer-based_expression                                &quot;</span><span class="p">,&amp;</span>
<a name="ln-2983"></a><span class="s2">&quot;  $ELSE                                                                         &quot;</span><span class="p">,&amp;</span>
<a name="ln-2984"></a><span class="s2">&quot;  $ENDIF                                                                        &quot;</span><span class="p">,&amp;</span>
<a name="ln-2985"></a><span class="s2">&quot;MACRO STRING EXPANSION AND TEXT REPLAY:                                         &quot;</span><span class="p">,&amp;</span>
<a name="ln-2986"></a><span class="s2">&quot;   &gt; Unless at least one variable name is defined no ${NAME} expansion occurs.  &quot;</span><span class="p">,&amp;</span>
<a name="ln-2987"></a><span class="s2">&quot;  $SET varname string                                                           &quot;</span><span class="p">,&amp;</span>
<a name="ln-2988"></a><span class="s2">&quot;  $IMPORT envname[;...]                                                         &quot;</span><span class="p">,&amp;</span>
<a name="ln-2989"></a><span class="s2">&quot;   &gt; $set author  William Shakespeare                                           &quot;</span><span class="p">,&amp;</span>
<a name="ln-2990"></a><span class="s2">&quot;   &gt; $import HOME                                                               &quot;</span><span class="p">,&amp;</span>
<a name="ln-2991"></a><span class="s2">&quot;   &gt; write(*,*)&#39;${AUTHOR} ${DATE} ${TIME} File ${FILE} Line ${LINE} HOME ${HOME}&quot;</span><span class="p">,&amp;</span>
<a name="ln-2992"></a><span class="s2">&quot;  $PARCEL [blockname] ... $ENDPARCEL ! a reuseable parcel of expandable text    &quot;</span><span class="p">,&amp;</span>
<a name="ln-2993"></a><span class="s2">&quot;  $POST   blockname  ! insert a defined parcel of text                          &quot;</span><span class="p">,&amp;</span>
<a name="ln-2994"></a><span class="s2">&quot;EXTERNAL FILES (see $BLOCK ... --file also)                                     &quot;</span><span class="p">,&amp;</span>
<a name="ln-2995"></a><span class="s2">&quot;  $OUTPUT filename [--append]                                                   &quot;</span><span class="p">,&amp;</span>
<a name="ln-2996"></a><span class="s2">&quot;  $INCLUDE filename                                                             &quot;</span><span class="p">,&amp;</span>
<a name="ln-2997"></a><span class="s2">&quot;TEXT BLOCK FILTERS (--file writes to $PREP_DOCUMENT_DIR/doc/NAME)               &quot;</span><span class="p">,&amp;</span>
<a name="ln-2998"></a><span class="s2">&quot;  $BLOCK [comment|null|write|variable [--varname NAME]|set|system|message|      &quot;</span><span class="p">,&amp;</span>
<a name="ln-2999"></a><span class="s2">&quot;         define|redefine|help|version][--file NAME [--append]] ... $ENDBLOCK    &quot;</span><span class="p">,&amp;</span>
<a name="ln-3000"></a><span class="s2">&quot;INFORMATION                                                                     &quot;</span><span class="p">,&amp;</span>
<a name="ln-3001"></a><span class="s2">&quot;  $MESSAGE message_to_stderr                                                    &quot;</span><span class="p">,&amp;</span>
<a name="ln-3002"></a><span class="s2">&quot;  $SHOW [defined_variable_name][;...]                                           &quot;</span><span class="p">,&amp;</span>
<a name="ln-3003"></a><span class="s2">&quot;SYSTEM COMMANDS (see also: $BLOCK SHELL)                                        &quot;</span><span class="p">,&amp;</span>
<a name="ln-3004"></a><span class="s2">&quot;  $SYSTEM command                                                               &quot;</span><span class="p">,&amp;</span>
<a name="ln-3005"></a><span class="s2">&quot;  $STOP [stop_value[ &quot;&quot;message&quot;&quot;]] | $QUIT [&quot;&quot;message&quot;&quot;]| $ERROR [&quot;&quot;message&quot;&quot;]        &quot;</span><span class="p">]</span>
<a name="ln-3006"></a>   <span class="k">WRITE</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)(</span><span class="nb">trim</span><span class="p">(</span><span class="n">help_text</span><span class="p">(</span><span class="n">i</span><span class="p">)),</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">help_text</span><span class="p">))</span>
<a name="ln-3007"></a><span class="k">end subroutine </span><span class="n">short_help</span>
<a name="ln-3008"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-3009"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-3010"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-3011"></a><span class="k">subroutine </span><span class="n">write_out</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>  <span class="c">!@(#)writeout(3f):  write (most) source code lines to output file</span>
<a name="ln-3012"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">line</span>
<a name="ln-3013"></a><span class="kt">integer</span>                        <span class="kd">::</span> <span class="n">istart</span>
<a name="ln-3014"></a>
<a name="ln-3015"></a>   <span class="k">if</span><span class="p">(</span><span class="n">G_verbose</span><span class="p">)</span><span class="k">then</span>              <span class="c">! echo &quot;what&quot; lines to stderr</span>
<a name="ln-3016"></a>      <span class="n">istart</span><span class="o">=</span><span class="nb">index</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="s1">&#39;@(#)&#39;</span><span class="p">)</span>
<a name="ln-3017"></a>      <span class="k">if</span><span class="p">(</span><span class="n">istart</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-3018"></a><span class="k">         call </span><span class="n">write_err</span><span class="p">(</span> <span class="s1">&#39;+ --&gt;&gt;&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">line</span><span class="p">(</span><span class="n">istart</span><span class="o">+</span><span class="mi">4</span><span class="p">:))</span> <span class="p">)</span>
<a name="ln-3019"></a>      <span class="k">endif</span>
<a name="ln-3020"></a><span class="k">   endif</span>
<a name="ln-3021"></a>
<a name="ln-3022"></a><span class="k">   call </span><span class="n">www</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<a name="ln-3023"></a><span class="k">end subroutine </span><span class="n">write_out</span>
<a name="ln-3024"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-3025"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-3026"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-3027"></a><span class="k">subroutine </span><span class="n">www</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="c">!@(#)www(3f):  change line into a WRITE, HELP/VERSION, COMMENT output line</span>
<a name="ln-3028"></a><span class="kt">integer</span><span class="p">,</span><span class="k">parameter</span>              <span class="kd">::</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">128</span>
<a name="ln-3029"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">line</span>
<a name="ln-3030"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span>   <span class="kd">::</span> <span class="n">buff</span>
<a name="ln-3031"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">115</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">chunk</span>
<a name="ln-3032"></a><span class="kt">integer</span>                        <span class="kd">::</span> <span class="n">ilen</span>
<a name="ln-3033"></a><span class="kt">integer</span>                        <span class="kd">::</span> <span class="n">ios</span>
<a name="ln-3034"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">message</span>
<a name="ln-3035"></a>
<a name="ln-3036"></a>   <span class="k">select case</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_outtype</span><span class="p">))</span>
<a name="ln-3037"></a>
<a name="ln-3038"></a>   <span class="k">case</span><span class="p">(</span><span class="s1">&#39;comment&#39;</span><span class="p">)</span>                             <span class="c">! write as a Fortran comment preceded by two explanations and a space</span>
<a name="ln-3039"></a>                                               <span class="c">! will be written later at end of BLOCK section</span>
<a name="ln-3040"></a>
<a name="ln-3041"></a>   <span class="k">case</span><span class="p">(</span><span class="s1">&#39;null&#39;</span><span class="p">)</span>                                <span class="c">! do not write</span>
<a name="ln-3042"></a>
<a name="ln-3043"></a>   <span class="k">case</span><span class="p">(</span><span class="s1">&#39;set&#39;</span><span class="p">)</span>                                 <span class="c">! do not write</span>
<a name="ln-3044"></a>      <span class="k">call </span><span class="n">set</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<a name="ln-3045"></a>
<a name="ln-3046"></a>   <span class="k">case</span><span class="p">(</span><span class="s1">&#39;define&#39;</span><span class="p">)</span>                              <span class="c">! do not write</span>
<a name="ln-3047"></a>      <span class="k">call </span><span class="n">define</span><span class="p">(</span><span class="n">nospace</span><span class="p">(</span><span class="n">upper</span><span class="p">(</span><span class="n">line</span><span class="p">)),</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-3048"></a>
<a name="ln-3049"></a>   <span class="k">case</span><span class="p">(</span><span class="s1">&#39;redefine&#39;</span><span class="p">)</span>                            <span class="c">! do not write</span>
<a name="ln-3050"></a>      <span class="k">call </span><span class="n">define</span><span class="p">(</span><span class="n">nospace</span><span class="p">(</span><span class="n">upper</span><span class="p">(</span><span class="n">line</span><span class="p">)),</span><span class="mi">0</span><span class="p">)</span>
<a name="ln-3051"></a>
<a name="ln-3052"></a>   <span class="k">case</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">)</span>                             <span class="c">! do not write</span>
<a name="ln-3053"></a>      <span class="k">call </span><span class="n">write_err</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>                     <span class="c">! trustingly trim MESSAGE from directive</span>
<a name="ln-3054"></a>
<a name="ln-3055"></a>   <span class="k">case</span><span class="p">(</span><span class="s1">&#39;system&#39;</span><span class="p">)</span>
<a name="ln-3056"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_scratch_lun</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">ios</span><span class="p">,</span><span class="n">iomsg</span><span class="o">=</span><span class="n">message</span><span class="p">)</span><span class="nb">trim</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<a name="ln-3057"></a>      <span class="k">if</span><span class="p">(</span><span class="n">ios</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-3058"></a><span class="k">         call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(068) - FAILED TO WRITE TO PROCESS:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">line</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">message</span><span class="p">))</span>
<a name="ln-3059"></a>      <span class="k">endif</span>
<a name="ln-3060"></a>
<a name="ln-3061"></a><span class="k">   case</span><span class="p">(</span><span class="s1">&#39;variable&#39;</span><span class="p">)</span>
<a name="ln-3062"></a>      <span class="n">buff</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>                          <span class="c">! do not make a line over 132 characters. Trim input line if needed</span>
<a name="ln-3063"></a>      <span class="n">buff</span><span class="o">=</span><span class="n">buff</span><span class="o">//</span><span class="nb">repeat</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">linewidth</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">buff</span><span class="p">)))</span> <span class="c">! ensure space in buffer for substitute</span>
<a name="ln-3064"></a>      <span class="k">call </span><span class="n">substitute</span><span class="p">(</span><span class="n">buff</span><span class="p">,</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;&#39;&quot;</span><span class="p">)</span>           <span class="c">! change single quotes in input to two adjacent single quotes</span>
<a name="ln-3065"></a>      <span class="n">ilen</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">buff</span><span class="p">),</span><span class="n">linewidth</span><span class="p">)</span>       <span class="c">! make all lines have at least linewidth characters for a more legible output</span>
<a name="ln-3066"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(&quot;&#39;&#39;&quot;,a,&quot;&#39;&#39;,&amp;&quot;)&#39;</span><span class="p">)</span> <span class="n">buff</span><span class="p">(:</span><span class="n">ilen</span><span class="p">)</span>
<a name="ln-3067"></a>
<a name="ln-3068"></a>   <span class="k">case</span><span class="p">(</span><span class="s1">&#39;help&#39;</span><span class="p">)</span>
<a name="ln-3069"></a>      <span class="n">buff</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>                          <span class="c">! do not make a line over 132 characters. Trim input line if needed</span>
<a name="ln-3070"></a>      <span class="n">buff</span><span class="o">=</span><span class="n">buff</span><span class="o">//</span><span class="nb">repeat</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">linewidth</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">buff</span><span class="p">)))</span> <span class="c">! ensure space in buffer for substitute</span>
<a name="ln-3071"></a>      <span class="k">call </span><span class="n">substitute</span><span class="p">(</span><span class="n">buff</span><span class="p">,</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;&#39;&quot;</span><span class="p">)</span>           <span class="c">! change single quotes in input to two adjacent single quotes</span>
<a name="ln-3072"></a>      <span class="n">ilen</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">buff</span><span class="p">),</span><span class="n">linewidth</span><span class="p">)</span>              <span class="c">! make all lines have at least 80 characters for a more legible output</span>
<a name="ln-3073"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(&quot;&#39;&#39;&quot;,a,&quot;&#39;&#39;,&amp;&quot;)&#39;</span><span class="p">)</span> <span class="n">buff</span><span class="p">(:</span><span class="n">ilen</span><span class="p">)</span>
<a name="ln-3074"></a>
<a name="ln-3075"></a>   <span class="k">case</span><span class="p">(</span><span class="s1">&#39;version&#39;</span><span class="p">)</span>                             <span class="c">! write version information with SCCS ID prefix for use with what(1) command</span>
<a name="ln-3076"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(&quot;&#39;&#39;@(#)&quot;,a,&quot;&#39;&#39;,&amp;&quot;)&#39;</span><span class="p">)</span><span class="nb">trim</span><span class="p">(</span><span class="n">line</span><span class="p">(:</span><span class="nb">min</span><span class="p">(</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">line</span><span class="p">),</span><span class="mi">128</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span><span class="o">//</span><span class="s1">&#39;&gt;&#39;</span>
<a name="ln-3077"></a>
<a name="ln-3078"></a>                                               <span class="c">!x! should handle longer lines and split them</span>
<a name="ln-3079"></a>   <span class="k">case</span><span class="p">(</span><span class="s1">&#39;write&#39;</span><span class="p">)</span>                               <span class="c">! convert string to a Fortran write statement to unit &quot;IO&quot;</span>
<a name="ln-3080"></a>      <span class="n">buff</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>                          <span class="c">! do not make a line over 132 characters. Trim input line if needed</span>
<a name="ln-3081"></a>      <span class="n">buff</span><span class="o">=</span><span class="n">buff</span><span class="o">//</span><span class="nb">repeat</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">linewidth</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">buff</span><span class="p">)))</span> <span class="c">! ensure space in buffer for substitute</span>
<a name="ln-3082"></a>      <span class="k">call </span><span class="n">substitute</span><span class="p">(</span><span class="n">buff</span><span class="p">,</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;&#39;&quot;</span><span class="p">)</span>
<a name="ln-3083"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">,</span><span class="n">advance</span><span class="o">=</span><span class="s1">&#39;no&#39;</span><span class="p">)</span><span class="s1">&#39;write(io,&#39;&#39;(a)&#39;&#39;)&#39;&#39;&#39;</span>
<a name="ln-3084"></a>      <span class="n">chunk</span><span class="o">=</span><span class="n">buff</span>
<a name="ln-3085"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">,</span><span class="n">advance</span><span class="o">=</span><span class="s1">&#39;no&#39;</span><span class="p">)</span><span class="nb">trim</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
<a name="ln-3086"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="s1">&#39;&#39;&#39;&#39;</span>
<a name="ln-3087"></a>
<a name="ln-3088"></a>   <span class="k">case</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;asis&#39;</span><span class="p">)</span>
<a name="ln-3089"></a>      <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">)</span><span class="nb">trim</span><span class="p">(</span><span class="n">line</span><span class="p">(:</span><span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">),</span><span class="n">G_iwidth</span><span class="p">)))</span>
<a name="ln-3090"></a>
<a name="ln-3091"></a>   <span class="k">case </span><span class="n">default</span>
<a name="ln-3092"></a>      <span class="k">call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(063) - UNEXPECTED &quot;BLOCK&quot; VALUE. FOUND:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_source</span><span class="p">))</span>
<a name="ln-3093"></a>      <span class="k">call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(064) - UNEXPECTED &quot;BLOCK&quot; VALUE. FOUND:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_outtype</span><span class="p">))</span>
<a name="ln-3094"></a>
<a name="ln-3095"></a>   <span class="k">end select</span>
<a name="ln-3096"></a>
<a name="ln-3097"></a><span class="k">   if</span><span class="p">(</span><span class="n">G_MAN_COLLECT</span><span class="p">)</span><span class="k">then</span>
<a name="ln-3098"></a><span class="k">      </span><span class="n">G_MAN</span><span class="o">=</span><span class="n">G_MAN</span><span class="o">//</span><span class="nb">new_line</span><span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">)</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<a name="ln-3099"></a>   <span class="k">endif</span>
<a name="ln-3100"></a>
<a name="ln-3101"></a><span class="k">   </span><span class="n">G_comment_count</span><span class="o">=</span><span class="n">G_comment_count</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-3102"></a>
<a name="ln-3103"></a><span class="k">end subroutine </span><span class="n">www</span>
<a name="ln-3104"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-3105"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-3106"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-3107"></a><span class="k">subroutine </span><span class="n">write_err</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a name="ln-3108"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">msg</span>
<a name="ln-3109"></a><span class="kt">integer</span>                     <span class="kd">::</span> <span class="n">ios</span>
<a name="ln-3110"></a><span class="c">! ident_2=&quot;@(#)M_verify::write_err(3f): writes a message to standard error using a standard f2003 method&quot;</span>
<a name="ln-3111"></a>
<a name="ln-3112"></a>   <span class="k">write</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">ios</span><span class="p">)</span> <span class="nb">trim</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a name="ln-3113"></a>   <span class="k">call </span><span class="n">flushit</span><span class="p">()</span>
<a name="ln-3114"></a><span class="k">end subroutine </span><span class="n">write_err</span>
<a name="ln-3115"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-3116"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-3117"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-3118"></a><span class="k">subroutine </span><span class="n">dissect2</span><span class="p">(</span><span class="n">verb</span><span class="p">,</span><span class="n">init</span><span class="p">,</span><span class="n">pars</span><span class="p">,</span><span class="n">error_return</span><span class="p">)</span>
<a name="ln-3119"></a><span class="c">! &quot;@(#)dissect2(3f): convenient call to parse() -- define defaults, then process&quot;</span>
<a name="ln-3120"></a><span class="c">!</span>
<a name="ln-3121"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">verb</span>            <span class="c">! the name of the command to be reset/defined  and then set</span>
<a name="ln-3122"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">init</span>            <span class="c">! used to define or reset command options; usually hard-set in the program.</span>
<a name="ln-3123"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">pars</span>            <span class="c">! defines the command options to be set, usually from a user input file</span>
<a name="ln-3124"></a><span class="kt">integer</span>                      <span class="kd">::</span> <span class="n">ipars</span>           <span class="c">! length of the user-input string pars.</span>
<a name="ln-3125"></a><span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">error_return</span>
<a name="ln-3126"></a>   <span class="n">ipars</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">pars</span><span class="p">)</span>
<a name="ln-3127"></a>   <span class="k">call </span><span class="n">dissect</span><span class="p">(</span><span class="n">verb</span><span class="p">,</span><span class="n">init</span><span class="p">,</span><span class="n">pars</span><span class="p">,</span><span class="n">ipars</span><span class="p">,</span><span class="n">error_return</span><span class="p">)</span>
<a name="ln-3128"></a><span class="k">end subroutine </span><span class="n">dissect2</span>
<a name="ln-3129"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-3130"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-3131"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-3132"></a><span class="k">subroutine import</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<a name="ln-3133"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">line</span>
<a name="ln-3134"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">names</span><span class="p">(:)</span>
<a name="ln-3135"></a><span class="kt">integer</span>                      <span class="kd">::</span> <span class="n">i</span>
<a name="ln-3136"></a>   <span class="n">names</span><span class="o">=</span><span class="n">sep</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="s1">&#39; ,;&#39;</span><span class="p">)</span>
<a name="ln-3137"></a>   <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
<a name="ln-3138"></a>      <span class="k">call </span><span class="n">set</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; &#39;</span><span class="o">//</span><span class="n">get_env</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
<a name="ln-3139"></a>   <span class="k">enddo</span>
<a name="ln-3140"></a><span class="k">end subroutine import</span>
<a name="ln-3141"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-3142"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-3143"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-3144"></a><span class="k">subroutine </span><span class="n">set</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<a name="ln-3145"></a><span class="k">use </span><span class="n">M_list</span><span class="p">,</span>      <span class="k">only</span> <span class="p">:</span> <span class="n">insert</span><span class="p">,</span> <span class="n">locate</span><span class="p">,</span> <span class="n">replace</span><span class="p">,</span> <span class="n">remove</span>                   <span class="c">! Basic list lookup and maintenance</span>
<a name="ln-3146"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">line</span>
<a name="ln-3147"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">name</span>
<a name="ln-3148"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">val</span>
<a name="ln-3149"></a><span class="kt">integer</span>                      <span class="kd">::</span> <span class="n">iend</span>
<a name="ln-3150"></a><span class="kt">integer</span>                      <span class="kd">::</span> <span class="n">i</span>
<a name="ln-3151"></a><span class="c">! create a dictionary with character keywords, values, and value lengths</span>
<a name="ln-3152"></a><span class="c">! using the routines for maintaining a list</span>
<a name="ln-3153"></a>
<a name="ln-3154"></a>  <span class="n">iend</span><span class="o">=</span><span class="nb">index</span><span class="p">(</span><span class="n">line</span><span class="o">//</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<a name="ln-3155"></a>  <span class="n">name</span><span class="o">=</span><span class="n">upper</span><span class="p">(</span><span class="n">line</span><span class="p">(:</span><span class="n">iend</span><span class="p">))</span>
<a name="ln-3156"></a>  <span class="k">if</span><span class="p">(</span><span class="n">name</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="k">then</span>
<a name="ln-3157"></a>    <span class="c">! show array</span>
<a name="ln-3158"></a>    <span class="k">if</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">keywords</span><span class="p">).</span><span class="n">gt</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-3159"></a><span class="k">       write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="o">*</span><span class="p">)</span><span class="s1">&#39;&gt;&gt;&gt;&#39;</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">keywords</span><span class="p">)</span>
<a name="ln-3160"></a>       <span class="k">write</span><span class="p">(</span><span class="n">G_iout</span><span class="p">,</span><span class="s1">&#39;(*(&quot;!&quot;,a,&quot;==&gt;&quot;,&quot;[&quot;,a,&quot;]&quot;,/))&#39;</span><span class="p">)(</span><span class="nb">trim</span><span class="p">(</span><span class="n">keywords</span><span class="p">(</span><span class="n">i</span><span class="p">)),</span><span class="n">values</span><span class="p">(</span><span class="n">i</span><span class="p">)(:</span><span class="n">counts</span><span class="p">(</span><span class="n">i</span><span class="p">)),</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">keywords</span><span class="p">))</span>
<a name="ln-3161"></a>    <span class="k">endif</span>
<a name="ln-3162"></a><span class="k">  else</span>
<a name="ln-3163"></a><span class="k">    </span><span class="n">val</span><span class="o">=</span><span class="n">line</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">iend</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)):)</span>
<a name="ln-3164"></a>    <span class="c">! insert and replace entries</span>
<a name="ln-3165"></a>    <span class="k">call </span><span class="n">update</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
<a name="ln-3166"></a>    <span class="c">! remove some entries</span>
<a name="ln-3167"></a>    <span class="c">!call update(&#39;a&#39;)</span>
<a name="ln-3168"></a>    <span class="c">! get some values</span>
<a name="ln-3169"></a>    <span class="c">!write(stderr,*)&#39;get b=&gt;&#39;,get(&#39;b&#39;)</span>
<a name="ln-3170"></a>    <span class="c">!call flushit()</span>
<a name="ln-3171"></a>  <span class="k">endif</span>
<a name="ln-3172"></a>
<a name="ln-3173"></a><span class="k">contains</span>
<a name="ln-3174"></a><span class="k">subroutine </span><span class="n">update</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">valin</span><span class="p">)</span>
<a name="ln-3175"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">key</span>
<a name="ln-3176"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>  <span class="kd">::</span> <span class="n">valin</span>
<a name="ln-3177"></a><span class="kt">integer</span>                               <span class="kd">::</span> <span class="n">place</span>
<a name="ln-3178"></a><span class="kt">integer</span>                               <span class="kd">::</span> <span class="n">ilen</span>
<a name="ln-3179"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span>          <span class="kd">::</span> <span class="n">val</span>
<a name="ln-3180"></a><span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">valin</span><span class="p">))</span><span class="k">then</span>
<a name="ln-3181"></a><span class="k">   </span><span class="n">val</span><span class="o">=</span><span class="n">valin</span>
<a name="ln-3182"></a>   <span class="n">ilen</span><span class="o">=</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
<a name="ln-3183"></a>   <span class="c">! find where string is or should be</span>
<a name="ln-3184"></a>   <span class="k">call </span><span class="n">locate</span><span class="p">(</span><span class="n">keywords</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">place</span><span class="p">)</span>
<a name="ln-3185"></a>   <span class="c">! if string was not found insert it</span>
<a name="ln-3186"></a>   <span class="k">if</span><span class="p">(</span><span class="n">place</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="k">then</span>
<a name="ln-3187"></a><span class="k">      call </span><span class="n">insert</span><span class="p">(</span><span class="n">keywords</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="nb">iabs</span><span class="p">(</span><span class="n">place</span><span class="p">))</span>
<a name="ln-3188"></a>      <span class="k">call </span><span class="n">insert</span><span class="p">(</span><span class="n">values</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="nb">iabs</span><span class="p">(</span><span class="n">place</span><span class="p">))</span>
<a name="ln-3189"></a>      <span class="k">call </span><span class="n">insert</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span><span class="n">ilen</span><span class="p">,</span><span class="nb">iabs</span><span class="p">(</span><span class="n">place</span><span class="p">))</span>
<a name="ln-3190"></a>   <span class="k">else</span>
<a name="ln-3191"></a><span class="k">      call </span><span class="n">replace</span><span class="p">(</span><span class="n">values</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">place</span><span class="p">)</span>
<a name="ln-3192"></a>      <span class="k">call </span><span class="n">replace</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span><span class="n">ilen</span><span class="p">,</span><span class="n">place</span><span class="p">)</span>
<a name="ln-3193"></a>   <span class="k">endif</span>
<a name="ln-3194"></a><span class="k">else</span>
<a name="ln-3195"></a><span class="k">   call </span><span class="n">locate</span><span class="p">(</span><span class="n">keywords</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">place</span><span class="p">)</span>
<a name="ln-3196"></a>   <span class="k">if</span><span class="p">(</span><span class="n">place</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-3197"></a><span class="k">      call </span><span class="n">remove</span><span class="p">(</span><span class="n">keywords</span><span class="p">,</span><span class="n">place</span><span class="p">)</span>
<a name="ln-3198"></a>      <span class="k">call </span><span class="n">remove</span><span class="p">(</span><span class="n">values</span><span class="p">,</span><span class="n">place</span><span class="p">)</span>
<a name="ln-3199"></a>      <span class="k">call </span><span class="n">remove</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span><span class="n">place</span><span class="p">)</span>
<a name="ln-3200"></a>   <span class="k">endif</span>
<a name="ln-3201"></a><span class="k">endif</span>
<a name="ln-3202"></a><span class="k">end subroutine </span><span class="n">update</span>
<a name="ln-3203"></a>
<a name="ln-3204"></a><span class="k">function </span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">valout</span><span class="p">)</span>
<a name="ln-3205"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">key</span>
<a name="ln-3206"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span>  <span class="kd">::</span> <span class="n">valout</span>
<a name="ln-3207"></a><span class="kt">integer</span>                       <span class="kd">::</span> <span class="n">place</span>
<a name="ln-3208"></a>   <span class="c">! find where string is or should be</span>
<a name="ln-3209"></a>   <span class="k">call </span><span class="n">locate</span><span class="p">(</span><span class="n">keywords</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">place</span><span class="p">)</span>
<a name="ln-3210"></a>   <span class="k">if</span><span class="p">(</span><span class="n">place</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="k">then</span>
<a name="ln-3211"></a><span class="k">      </span><span class="n">valout</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
<a name="ln-3212"></a>   <span class="k">else</span>
<a name="ln-3213"></a><span class="k">      </span><span class="n">valout</span><span class="o">=</span><span class="n">values</span><span class="p">(</span><span class="n">place</span><span class="p">)(:</span><span class="n">counts</span><span class="p">(</span><span class="n">place</span><span class="p">))</span>
<a name="ln-3214"></a>   <span class="k">endif</span>
<a name="ln-3215"></a><span class="k">end function </span><span class="n">get</span>
<a name="ln-3216"></a>
<a name="ln-3217"></a><span class="k">end subroutine </span><span class="n">set</span>
<a name="ln-3218"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-3219"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-3220"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-3221"></a><span class="k">subroutine </span><span class="n">expand_variables</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<a name="ln-3222"></a><span class="c">!@(#) brute force variable substitution. maybe add something like wordexp(3c) with command expansion only if --system?</span>
<a name="ln-3223"></a><span class="c">! this is just to try the concept. Either use wordexp or an equivalent to replicate &quot;here document&quot; processing.</span>
<a name="ln-3224"></a><span class="c">! note no automatic continuation of the line if it extends past allowed length, which for Fortran is currently 132 for free-format</span>
<a name="ln-3225"></a><span class="c">! the way this is written it would do recursive substitution and does not know when there is just not a match</span>
<a name="ln-3226"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=*</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">line</span>
<a name="ln-3227"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span>  <span class="kd">::</span> <span class="n">temp</span><span class="p">,</span><span class="n">search</span>
<a name="ln-3228"></a><span class="kt">integer</span><span class="p">,</span><span class="k">parameter</span>             <span class="kd">::</span> <span class="n">toomany</span><span class="o">=</span><span class="mi">1000</span>
<a name="ln-3229"></a><span class="kt">integer</span>                       <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span>
<a name="ln-3230"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">4096</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">scratch</span>
<a name="ln-3231"></a>
<a name="ln-3232"></a><span class="k">write</span><span class="p">(</span><span class="n">scratch</span><span class="p">,</span><span class="s1">&#39;(i0)&#39;</span><span class="p">)</span><span class="n">G_file_dictionary</span><span class="p">(</span><span class="n">G_iocount</span><span class="p">)%</span><span class="n">line_number</span>
<a name="ln-3233"></a>
<a name="ln-3234"></a><span class="k">call </span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;LINE &#39;</span> <span class="o">//</span> <span class="n">scratch</span><span class="p">)</span>
<a name="ln-3235"></a><span class="k">call </span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;FILE &#39;</span> <span class="o">//</span> <span class="n">G_file_dictionary</span><span class="p">(</span><span class="n">G_iocount</span><span class="p">)%</span><span class="n">filename</span> <span class="p">)</span>
<a name="ln-3236"></a><span class="k">call </span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;TIME &#39;</span> <span class="o">//</span> <span class="n">getdate</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">))</span>
<a name="ln-3237"></a><span class="k">call </span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;DATE &#39;</span> <span class="o">//</span> <span class="n">getdate</span><span class="p">(</span><span class="s1">&#39;cdate&#39;</span><span class="p">))</span>
<a name="ln-3238"></a><span class="n">temp</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<a name="ln-3239"></a><span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">toomany</span>
<a name="ln-3240"></a>   <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">keywords</span><span class="p">)</span>
<a name="ln-3241"></a>      <span class="k">if</span><span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="s1">&#39;${&#39;</span><span class="p">).</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-3242"></a><span class="k">         </span><span class="n">search</span><span class="o">=</span><span class="s1">&#39;${&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">keywords</span><span class="p">(</span><span class="n">j</span><span class="p">))</span><span class="o">//</span><span class="s1">&#39;}&#39;</span>
<a name="ln-3243"></a>         <span class="n">temp</span><span class="o">=</span><span class="n">str_replace</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="n">search</span><span class="p">,</span><span class="n">values</span><span class="p">(</span><span class="n">j</span><span class="p">)(:</span><span class="n">counts</span><span class="p">(</span><span class="n">j</span><span class="p">)),</span><span class="n">ignorecase</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.)</span>
<a name="ln-3244"></a>      <span class="k">else</span>
<a name="ln-3245"></a><span class="k">         exit</span>
<a name="ln-3246"></a><span class="k">      endif</span>
<a name="ln-3247"></a><span class="k">   enddo</span>
<a name="ln-3248"></a><span class="k">enddo</span>
<a name="ln-3249"></a><span class="n">line</span><span class="o">=</span><span class="n">temp</span>
<a name="ln-3250"></a><span class="k">end subroutine </span><span class="n">expand_variables</span>
<a name="ln-3251"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-3252"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-3253"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-3254"></a><span class="c">!&gt; Determine the OS type by guessing</span>
<a name="ln-3255"></a><span class="k">subroutine </span><span class="n">get_os_type</span><span class="p">()</span>
<a name="ln-3256"></a><span class="c">!!</span>
<a name="ln-3257"></a><span class="c">!! At first, the environment variable `OS` is checked, which is usually</span>
<a name="ln-3258"></a><span class="c">!! found on Windows. Then, `OSTYPE` is read in and compared with common</span>
<a name="ln-3259"></a><span class="c">!! names. If this fails too, check the existence of files that can be</span>
<a name="ln-3260"></a><span class="c">!! found on specific system types only.</span>
<a name="ln-3261"></a><span class="c">!!</span>
<a name="ln-3262"></a><span class="c">!! Returns OS_UNKNOWN if the operating system cannot be determined.</span>
<a name="ln-3263"></a><span class="c">!!</span>
<a name="ln-3264"></a><span class="c">!! calling POSIX or C routines would be far better, M_system::like system_uname(3f)</span>
<a name="ln-3265"></a><span class="c">!! but trying to use portable Fortran. If assume compiled by certain compilers could</span>
<a name="ln-3266"></a><span class="c">!! use their extensions as well. Most have a uname(3f) function.</span>
<a name="ln-3267"></a><span class="c">!!</span>
<a name="ln-3268"></a><span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">OS_UNKNOWN</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-3269"></a><span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">OS_LINUX</span>   <span class="o">=</span> <span class="mi">1</span>
<a name="ln-3270"></a><span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">OS_MACOS</span>   <span class="o">=</span> <span class="mi">2</span>
<a name="ln-3271"></a><span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">OS_WINDOWS</span> <span class="o">=</span> <span class="mi">3</span>
<a name="ln-3272"></a><span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">OS_CYGWIN</span>  <span class="o">=</span> <span class="mi">4</span>
<a name="ln-3273"></a><span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">OS_SOLARIS</span> <span class="o">=</span> <span class="mi">5</span>
<a name="ln-3274"></a><span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">OS_FREEBSD</span> <span class="o">=</span> <span class="mi">6</span>
<a name="ln-3275"></a><span class="kt">integer</span><span class="p">,</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">OS_OPENBSD</span> <span class="o">=</span> <span class="mi">7</span>
<a name="ln-3276"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_var_len</span><span class="p">)</span> <span class="kd">::</span> <span class="n">val</span>
<a name="ln-3277"></a><span class="kt">integer</span>           <span class="kd">::</span> <span class="n">length</span><span class="p">,</span> <span class="n">rc</span><span class="p">,</span> <span class="n">r</span>
<a name="ln-3278"></a><span class="kt">logical</span>           <span class="kd">::</span> <span class="n">file_exists</span>
<a name="ln-3279"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span> <span class="kd">::</span> <span class="n">scratch</span>
<a name="ln-3280"></a>
<a name="ln-3281"></a>   <span class="k">call </span><span class="n">define</span><span class="p">(</span><span class="s1">&#39;UNKNOWN=0&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a name="ln-3282"></a>   <span class="k">call </span><span class="n">define</span><span class="p">(</span><span class="s1">&#39;LINUX=1&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a name="ln-3283"></a>   <span class="k">call </span><span class="n">define</span><span class="p">(</span><span class="s1">&#39;MACOS=2&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a name="ln-3284"></a>   <span class="k">call </span><span class="n">define</span><span class="p">(</span><span class="s1">&#39;WINDOWS=3&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a name="ln-3285"></a>   <span class="k">call </span><span class="n">define</span><span class="p">(</span><span class="s1">&#39;CYGWIN=4&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a name="ln-3286"></a>   <span class="k">call </span><span class="n">define</span><span class="p">(</span><span class="s1">&#39;SOLARIS=5&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a name="ln-3287"></a>   <span class="k">call </span><span class="n">define</span><span class="p">(</span><span class="s1">&#39;FREEBSD=6&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a name="ln-3288"></a>   <span class="k">call </span><span class="n">define</span><span class="p">(</span><span class="s1">&#39;OPENBSD=7&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a name="ln-3289"></a>
<a name="ln-3290"></a>   <span class="n">r</span> <span class="o">=</span> <span class="n">OS_UNKNOWN</span>
<a name="ln-3291"></a>   <span class="c">! Check environment variable `OS`.</span>
<a name="ln-3292"></a>   <span class="k">call </span><span class="nb">get_environment_variable</span><span class="p">(</span><span class="s1">&#39;OS&#39;</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">rc</span><span class="p">)</span>
<a name="ln-3293"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">index</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s1">&#39;Windows_NT&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3294"></a><span class="k">       </span><span class="n">r</span> <span class="o">=</span> <span class="n">OS_WINDOWS</span>
<a name="ln-3295"></a>   <span class="k">else</span>
<a name="ln-3296"></a>      <span class="c">! Check environment variable `OSTYPE`.</span>
<a name="ln-3297"></a>      <span class="k">call </span><span class="nb">get_environment_variable</span><span class="p">(</span><span class="s1">&#39;OSTYPE&#39;</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">rc</span><span class="p">)</span>
<a name="ln-3298"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3299"></a><span class="k">          if</span> <span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s1">&#39;linux&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>      <span class="c">! Linux</span>
<a name="ln-3300"></a>              <span class="n">r</span> <span class="o">=</span> <span class="n">OS_LINUX</span>
<a name="ln-3301"></a>          <span class="n">elseif</span> <span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s1">&#39;darwin&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="c">! macOS</span>
<a name="ln-3302"></a>              <span class="n">r</span> <span class="o">=</span> <span class="n">OS_MACOS</span>
<a name="ln-3303"></a>          <span class="n">elseif</span> <span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s1">&#39;win&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="nb">index</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s1">&#39;msys&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="c">! Windows, MSYS, MinGW, Git Bash</span>
<a name="ln-3304"></a>              <span class="n">r</span> <span class="o">=</span> <span class="n">OS_WINDOWS</span>
<a name="ln-3305"></a>          <span class="n">elseif</span> <span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s1">&#39;cygwin&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="c">! Cygwin</span>
<a name="ln-3306"></a>              <span class="n">r</span> <span class="o">=</span> <span class="n">OS_CYGWIN</span>
<a name="ln-3307"></a>          <span class="n">elseif</span> <span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s1">&#39;SunOS&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="nb">index</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s1">&#39;solaris&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="c">! Solaris, OpenIndiana, ...</span>
<a name="ln-3308"></a>              <span class="n">r</span> <span class="o">=</span> <span class="n">OS_SOLARIS</span>
<a name="ln-3309"></a>          <span class="n">elseif</span> <span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s1">&#39;FreeBSD&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="nb">index</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s1">&#39;freebsd&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="c">! FreeBSD</span>
<a name="ln-3310"></a>              <span class="n">r</span> <span class="o">=</span> <span class="n">OS_FREEBSD</span>
<a name="ln-3311"></a>          <span class="n">elseif</span> <span class="p">(</span><span class="nb">index</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s1">&#39;OpenBSD&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="nb">index</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s1">&#39;openbsd&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="c">! OpenBSD</span>
<a name="ln-3312"></a>              <span class="n">r</span> <span class="o">=</span> <span class="n">OS_OPENBSD</span>
<a name="ln-3313"></a>          <span class="k">endif</span>
<a name="ln-3314"></a><span class="k">      endif</span>
<a name="ln-3315"></a><span class="k">   endif</span>
<a name="ln-3316"></a><span class="k">   if</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">OS_UNKNOWN</span><span class="p">)</span><span class="k">then</span>
<a name="ln-3317"></a><span class="k">      inquire</span> <span class="p">(</span><span class="k">file</span><span class="o">=</span><span class="s1">&#39;/etc/os-release&#39;</span><span class="p">,</span> <span class="n">exist</span><span class="o">=</span><span class="n">file_exists</span><span class="p">)</span> <span class="c">! Linux</span>
<a name="ln-3318"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">file_exists</span><span class="p">)</span> <span class="n">r</span> <span class="o">=</span> <span class="n">OS_LINUX</span>
<a name="ln-3319"></a>      <span class="k">inquire</span> <span class="p">(</span><span class="k">file</span><span class="o">=</span><span class="s1">&#39;/usr/bin/sw_vers&#39;</span><span class="p">,</span> <span class="n">exist</span><span class="o">=</span><span class="n">file_exists</span><span class="p">)</span> <span class="c">! macOS</span>
<a name="ln-3320"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">file_exists</span><span class="p">)</span> <span class="n">r</span> <span class="o">=</span> <span class="n">OS_MACOS</span>
<a name="ln-3321"></a>      <span class="k">inquire</span> <span class="p">(</span><span class="k">file</span><span class="o">=</span><span class="s1">&#39;/bin/freebsd-version&#39;</span><span class="p">,</span> <span class="n">exist</span><span class="o">=</span><span class="n">file_exists</span><span class="p">)</span> <span class="c">! FreeBSD</span>
<a name="ln-3322"></a>      <span class="k">if</span> <span class="p">(</span><span class="n">file_exists</span><span class="p">)</span> <span class="n">r</span> <span class="o">=</span> <span class="n">OS_FREEBSD</span>
<a name="ln-3323"></a>   <span class="k">endif</span>
<a name="ln-3324"></a><span class="k">   </span><span class="n">scratch</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
<a name="ln-3325"></a>   <span class="k">write</span><span class="p">(</span><span class="n">scratch</span><span class="p">,</span><span class="s1">&#39;(&quot;OS=&quot;,i0)&#39;</span><span class="p">)</span><span class="n">r</span>
<a name="ln-3326"></a>   <span class="k">call </span><span class="n">define</span><span class="p">(</span><span class="n">scratch</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<a name="ln-3327"></a><span class="k">end subroutine </span><span class="n">get_os_type</span>
<a name="ln-3328"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-3329"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-3330"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-3331"></a><span class="k">pure function </span><span class="n">ends_in</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">ending</span><span class="p">)</span>
<a name="ln-3332"></a><span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">string</span>
<a name="ln-3333"></a><span class="kt">character</span><span class="p">(:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">ending</span>
<a name="ln-3334"></a><span class="kt">integer</span>                   <span class="kd">::</span> <span class="n">n1</span>
<a name="ln-3335"></a>   <span class="n">n1</span><span class="o">=</span><span class="nb">index</span><span class="p">(</span><span class="n">string</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="n">back</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.)</span>
<a name="ln-3336"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">n1</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">n1</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="nb">len</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="p">)</span> <span class="k">then</span>
<a name="ln-3337"></a><span class="k">       </span><span class="n">ending</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
<a name="ln-3338"></a>   <span class="k">else</span>
<a name="ln-3339"></a><span class="k">       </span><span class="n">ending</span><span class="o">=</span><span class="n">string</span><span class="p">(</span><span class="n">n1</span><span class="o">+</span><span class="mi">1</span><span class="p">:)</span>
<a name="ln-3340"></a>   <span class="k">endif</span>
<a name="ln-3341"></a><span class="k">end function </span><span class="n">ends_in</span>
<a name="ln-3342"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-3343"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-3344"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-3345"></a><span class="k">subroutine </span><span class="n">flushit</span><span class="p">()</span>
<a name="ln-3346"></a><span class="kt">integer</span> <span class="kd">::</span> <span class="n">ios</span>
<a name="ln-3347"></a>      <span class="nb">flush</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">stdout</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">ios</span><span class="p">)</span>
<a name="ln-3348"></a>      <span class="nb">flush</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">stderr</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">ios</span><span class="p">)</span>
<a name="ln-3349"></a><span class="k">end subroutine </span><span class="n">flushit</span>
<a name="ln-3350"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-3351"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-3352"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-3353"></a><span class="k">end module </span><span class="n">M_fpp</span>
<a name="ln-3354"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-3355"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-3356"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-3357"></a><span class="k">program </span><span class="n">prep</span>                                                 <span class="c">!@(#)prep(1f): preprocessor for Fortran/FORTRAN source code</span>
<a name="ln-3358"></a><span class="k">use </span><span class="n">M_kracken95</span><span class="p">,</span> <span class="k">only</span> <span class="p">:</span> <span class="n">kracken</span><span class="p">,</span> <span class="n">lget</span><span class="p">,</span> <span class="n">rget</span><span class="p">,</span> <span class="n">iget</span><span class="p">,</span> <span class="n">sget</span><span class="p">,</span> <span class="n">kracken_comment</span>
<a name="ln-3359"></a><span class="k">use </span><span class="n">M_strings</span><span class="p">,</span>   <span class="k">only</span> <span class="p">:</span> <span class="n">notabs</span><span class="p">,</span> <span class="n">isdigit</span><span class="p">,</span> <span class="n">switch</span>
<a name="ln-3360"></a><span class="k">use </span><span class="n">M_fpp</span>
<a name="ln-3361"></a>
<a name="ln-3362"></a><span class="k">implicit none</span>
<a name="ln-3363"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">)</span> <span class="kd">::</span> <span class="n">out_filename</span><span class="o">=</span><span class="s1">&#39;&#39;</span>           <span class="c">! output filename, default is stdout</span>
<a name="ln-3364"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">prefix</span>                    <span class="c">! directive prefix character</span>
<a name="ln-3365"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">letterd</span>                   <span class="c">!</span>
<a name="ln-3366"></a>
<a name="ln-3367"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="n">G_line_length</span><span class="p">)</span> <span class="kd">::</span> <span class="n">line</span>                      <span class="c">! working copy of input line</span>
<a name="ln-3368"></a><span class="kt">logical</span>                      <span class="kd">::</span> <span class="n">keeptabs</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>          <span class="c">! flag whether to retain tabs and carriage returns or not</span>
<a name="ln-3369"></a><span class="kt">integer</span>                      <span class="kd">::</span> <span class="n">ilast</span>
<a name="ln-3370"></a><span class="kt">integer</span>                      <span class="kd">::</span> <span class="n">ios</span>
<a name="ln-3371"></a><span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">cmd</span><span class="o">=</span><span class="s1">&#39; &amp;</span>
<a name="ln-3372"></a><span class="s1">   &amp; -i                          &amp;</span>
<a name="ln-3373"></a><span class="s1">   &amp; -D                          &amp;</span>
<a name="ln-3374"></a><span class="s1">   &amp; -I                          &amp;</span>
<a name="ln-3375"></a><span class="s1">   &amp; -o                          &amp;</span>
<a name="ln-3376"></a><span class="s1">   &amp; --prefix           36       &amp;</span>
<a name="ln-3377"></a><span class="s1">   &amp; --keeptabs         .false.  &amp;</span>
<a name="ln-3378"></a><span class="s1">   &amp; -d                 ignore   &amp;</span>
<a name="ln-3379"></a><span class="s1">   &amp; --help             .false.  &amp;</span>
<a name="ln-3380"></a><span class="s1">   &amp; --verbose          .false.  &amp;</span>
<a name="ln-3381"></a><span class="s1">   &amp; --system           .false.  &amp;</span>
<a name="ln-3382"></a><span class="s1">   &amp; --version          .false.  &amp;</span>
<a name="ln-3383"></a><span class="s1">   &amp; --debug            .false.  &amp;</span>
<a name="ln-3384"></a><span class="s1">   &amp; --noenv            .false.  &amp;</span>
<a name="ln-3385"></a><span class="s1">   &amp; --comment          COMMENT  &amp;</span>
<a name="ln-3386"></a><span class="s1">   &amp; --ident            .false.  &amp;</span>
<a name="ln-3387"></a><span class="s1">   &amp; --width            1024     &amp;</span>
<a name="ln-3388"></a><span class="s1">   &amp; --start            &quot; &quot;      &amp;</span>
<a name="ln-3389"></a><span class="s1">   &amp; --stop             &quot; &quot;      &amp;</span>
<a name="ln-3390"></a><span class="s1">   &amp; --type             &quot; &quot;      &amp;</span>
<a name="ln-3391"></a><span class="s1">   &amp; &#39;</span>
<a name="ln-3392"></a><span class="kt">logical</span>                       <span class="kd">::</span> <span class="n">isscratch</span>
<a name="ln-3393"></a>
<a name="ln-3394"></a>                                                                        <span class="c">! allow formatting comments for particular post-processors</span>
<a name="ln-3395"></a>   <span class="k">call </span><span class="nb">get_environment_variable</span><span class="p">(</span><span class="s1">&#39;PREP_COMMENT_STYLE&#39;</span><span class="p">,</span><span class="n">G_comment_style</span><span class="p">)</span>  <span class="c">! get environment variable for -comment switch</span>
<a name="ln-3396"></a>   <span class="k">if</span><span class="p">(</span><span class="n">G_comment_style</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="n">G_comment_style</span><span class="o">=</span><span class="s1">&#39;default&#39;</span>                   <span class="c">! if environment variable not set set default</span>
<a name="ln-3397"></a>   <span class="k">call </span><span class="n">substitute</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span><span class="s1">&#39;COMMENT&#39;</span><span class="p">,</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_comment_style</span><span class="p">))</span>                 <span class="c">! change command line to have correct default</span>
<a name="ln-3398"></a>                                                                        <span class="c">! this would actually allow any parameter after number</span>
<a name="ln-3399"></a>   <span class="n">G_comment</span><span class="o">=</span><span class="s1">&#39;! &#39;</span>
<a name="ln-3400"></a>   <span class="n">kracken_comment</span><span class="o">=</span><span class="n">G_comment</span>
<a name="ln-3401"></a>   <span class="k">call </span><span class="n">kracken</span><span class="p">(</span><span class="s1">&#39;prep&#39;</span><span class="p">,</span><span class="n">cmd</span><span class="p">)</span>                                       <span class="c">! define command arguments, default values and crack command line</span>
<a name="ln-3402"></a>
<a name="ln-3403"></a>   <span class="n">G_inc_files</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
<a name="ln-3404"></a>
<a name="ln-3405"></a>   <span class="n">out_filename</span><span class="p">(:</span><span class="n">G_line_length</span><span class="p">)</span> <span class="o">=</span> <span class="n">sget</span><span class="p">(</span><span class="s1">&#39;prep_o&#39;</span><span class="p">)</span>
<a name="ln-3406"></a>   <span class="k">if</span> <span class="p">(</span> <span class="k">all</span><span class="p">(</span><span class="n">isdigit</span><span class="p">(</span><span class="n">switch</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">sget</span><span class="p">(</span><span class="s1">&#39;prep_prefix&#39;</span><span class="p">)))))</span> <span class="p">)</span> <span class="k">then</span>   <span class="c">! if all characters are numeric digits</span>
<a name="ln-3407"></a>      <span class="n">prefix</span> <span class="o">=</span> <span class="nb">char</span><span class="p">(</span><span class="n">iget</span><span class="p">(</span><span class="s1">&#39;prep_prefix&#39;</span><span class="p">))</span>                         <span class="c">! assume this is an ADE</span>
<a name="ln-3408"></a>   <span class="k">else</span>
<a name="ln-3409"></a><span class="k">      </span><span class="n">prefix</span> <span class="o">=</span> <span class="n">sget</span><span class="p">(</span><span class="s1">&#39;prep_prefix&#39;</span><span class="p">)</span>                               <span class="c">! not a digit so not an ADE so assume a literal character</span>
<a name="ln-3410"></a>   <span class="k">endif</span>
<a name="ln-3411"></a><span class="k">   </span><span class="n">G_ident</span><span class="o">=</span><span class="n">lget</span><span class="p">(</span><span class="s1">&#39;prep_ident&#39;</span><span class="p">)</span>                                    <span class="c">! write IDENT as comment or CHARACTER variable</span>
<a name="ln-3412"></a>   <span class="n">G_iwidth</span>                     <span class="o">=</span> <span class="n">iget</span><span class="p">(</span><span class="s1">&#39;prep_width&#39;</span><span class="p">)</span>
<a name="ln-3413"></a>   <span class="n">G_iwidth</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">G_iwidth</span><span class="p">)</span>
<a name="ln-3414"></a>   <span class="n">letterd</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span>               <span class="o">=</span> <span class="n">sget</span><span class="p">(</span><span class="s1">&#39;prep_d&#39;</span><span class="p">)</span>
<a name="ln-3415"></a>   <span class="n">G_noenv</span><span class="o">=</span><span class="n">lget</span><span class="p">(</span><span class="s1">&#39;prep_noenv&#39;</span><span class="p">)</span>
<a name="ln-3416"></a>
<a name="ln-3417"></a>   <span class="k">if</span><span class="p">(</span><span class="n">out_filename</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="k">then</span>                              <span class="c">! open output file</span>
<a name="ln-3418"></a>      <span class="n">G_iout</span><span class="o">=</span><span class="n">stdout</span>
<a name="ln-3419"></a>   <span class="n">elseif</span><span class="p">(</span><span class="n">out_filename</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="s1">&#39;@&#39;</span><span class="p">)</span><span class="k">then</span>
<a name="ln-3420"></a><span class="k">      </span><span class="n">G_iout</span><span class="o">=</span><span class="n">stdout</span>
<a name="ln-3421"></a>      <span class="n">G_IHELP</span><span class="o">=</span><span class="n">stdout</span>
<a name="ln-3422"></a>   <span class="k">else</span>
<a name="ln-3423"></a><span class="k">      </span><span class="n">G_iout</span><span class="o">=</span><span class="mi">60</span>
<a name="ln-3424"></a>      <span class="n">G_IHELP</span><span class="o">=</span><span class="mi">60</span>
<a name="ln-3425"></a>      <span class="k">open</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span><span class="k">file</span><span class="o">=</span><span class="n">out_filename</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">ios</span><span class="p">,</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;write&#39;</span><span class="p">)</span>
<a name="ln-3426"></a>      <span class="k">if</span><span class="p">(</span><span class="n">ios</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>
<a name="ln-3427"></a><span class="k">         call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(065) - FAILED TO OPEN OUTPUT FILE:&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">out_filename</span><span class="p">))</span>
<a name="ln-3428"></a>      <span class="k">endif</span>
<a name="ln-3429"></a><span class="k">   endif</span>
<a name="ln-3430"></a><span class="k">   </span><span class="n">G_iout_init</span><span class="o">=</span><span class="n">G_iout</span>
<a name="ln-3431"></a>
<a name="ln-3432"></a>   <span class="k">call </span><span class="n">help_version</span><span class="p">(</span><span class="n">lget</span><span class="p">(</span><span class="s1">&#39;prep_version&#39;</span><span class="p">))</span>                 <span class="c">! if version switch is present display version and exit</span>
<a name="ln-3433"></a>   <span class="k">call </span><span class="n">help_usage</span><span class="p">(</span><span class="n">lget</span><span class="p">(</span><span class="s1">&#39;prep_help&#39;</span><span class="p">))</span>                      <span class="c">! if help switch is present display help and exit</span>
<a name="ln-3434"></a>   <span class="n">G_debug</span><span class="o">=</span><span class="n">lget</span><span class="p">(</span><span class="s1">&#39;prep_debug&#39;</span><span class="p">)</span>                              <span class="c">! turn on debug mode for developer</span>
<a name="ln-3435"></a>
<a name="ln-3436"></a>   <span class="n">keeptabs</span><span class="o">=</span><span class="n">lget</span><span class="p">(</span><span class="s1">&#39;prep_keeptabs&#39;</span><span class="p">)</span>
<a name="ln-3437"></a>   <span class="n">G_verbose</span><span class="o">=</span><span class="n">lget</span><span class="p">(</span><span class="s1">&#39;prep_verbose&#39;</span><span class="p">)</span>                          <span class="c">! set flag for special mode where lines with @(#) are written to stderr</span>
<a name="ln-3438"></a>   <span class="k">if</span><span class="p">(</span><span class="n">G_verbose</span><span class="p">)</span><span class="k">then</span>
<a name="ln-3439"></a><span class="k">      call </span><span class="n">write_err</span><span class="p">(</span><span class="s1">&#39;+ verbose mode on &#39;</span><span class="p">)</span>
<a name="ln-3440"></a>   <span class="k">endif</span>
<a name="ln-3441"></a><span class="k">   </span><span class="n">G_comment_style</span><span class="o">=</span><span class="n">lower</span><span class="p">(</span><span class="n">sget</span><span class="p">(</span><span class="s1">&#39;prep_comment&#39;</span><span class="p">))</span>             <span class="c">! allow formatting comments for particular post-processors</span>
<a name="ln-3442"></a>   <span class="n">G_system_on</span> <span class="o">=</span> <span class="n">lget</span><span class="p">(</span><span class="s1">&#39;prep_system&#39;</span><span class="p">)</span>                       <span class="c">! allow system commands on $SYSTEM directives</span>
<a name="ln-3443"></a>   <span class="k">if</span><span class="p">(</span><span class="n">G_system_on</span><span class="p">)</span><span class="k">then</span>
<a name="ln-3444"></a><span class="k">      call </span><span class="n">define</span><span class="p">(</span><span class="s1">&#39;SYSTEMON=.TRUE.&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a name="ln-3445"></a>   <span class="k">else</span>
<a name="ln-3446"></a><span class="k">      call </span><span class="n">define</span><span class="p">(</span><span class="s1">&#39;SYSTEMON=.FALSE.&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a name="ln-3447"></a>   <span class="k">endif</span>
<a name="ln-3448"></a>   <span class="c">!TODO! have an auto mode where start and end are selected based on file suffix</span>
<a name="ln-3449"></a>   <span class="k">select case</span><span class="p">(</span><span class="n">sget</span><span class="p">(</span><span class="s1">&#39;prep_type&#39;</span><span class="p">))</span>
<a name="ln-3450"></a>   <span class="k">case</span><span class="p">(</span><span class="s1">&#39;md&#39;</span><span class="p">,</span><span class="s1">&#39;.md&#39;</span><span class="p">)</span>
<a name="ln-3451"></a>      <span class="n">G_extract_start</span><span class="o">=</span><span class="s1">&#39;```fortran&#39;</span>
<a name="ln-3452"></a>      <span class="n">G_extract_stop</span><span class="o">=</span><span class="s1">&#39;```&#39;</span>
<a name="ln-3453"></a>   <span class="k">case</span><span class="p">(</span><span class="s1">&#39;html&#39;</span><span class="p">,</span><span class="s1">&#39;.html&#39;</span><span class="p">,</span><span class="s1">&#39;htm&#39;</span><span class="p">,</span><span class="s1">&#39;.htm&#39;</span><span class="p">)</span>
<a name="ln-3454"></a>      <span class="c">! flaw is HTML is not case sensitive</span>
<a name="ln-3455"></a>      <span class="n">G_extract_start</span><span class="o">=</span><span class="s1">&#39;&lt;xmp&gt;&#39;</span>
<a name="ln-3456"></a>      <span class="n">G_extract_stop</span><span class="o">=</span><span class="s1">&#39;&lt;/xmp&gt;&#39;</span>
<a name="ln-3457"></a>   <span class="k">case</span><span class="p">(</span><span class="s1">&#39;tex&#39;</span><span class="p">)</span>
<a name="ln-3458"></a>      <span class="n">G_extract_start</span><span class="o">=</span><span class="s1">&#39;\begin{minted}{Fortran}&#39;</span>
<a name="ln-3459"></a>      <span class="n">G_extract_stop</span><span class="o">=</span><span class="s1">&#39;\end{minted}&#39;</span>
<a name="ln-3460"></a>   <span class="k">case</span><span class="p">(</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
<a name="ln-3461"></a>      <span class="n">G_extract_start</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
<a name="ln-3462"></a>      <span class="n">G_extract_stop</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
<a name="ln-3463"></a>      <span class="n">G_extract_auto</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-3464"></a>      <span class="n">G_extract</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-3465"></a>   <span class="k">case</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<a name="ln-3466"></a>      <span class="n">G_extract_start</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
<a name="ln-3467"></a>      <span class="n">G_extract_stop</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
<a name="ln-3468"></a>      <span class="n">G_extract_auto</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-3469"></a>      <span class="n">G_extract</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-3470"></a>   <span class="k">case </span><span class="n">default</span>
<a name="ln-3471"></a>      <span class="n">G_extract_start</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">sget</span><span class="p">(</span><span class="s1">&#39;prep_start&#39;</span><span class="p">))</span>
<a name="ln-3472"></a>      <span class="n">G_extract_stop</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">sget</span><span class="p">(</span><span class="s1">&#39;prep_stop&#39;</span><span class="p">))</span>
<a name="ln-3473"></a>   <span class="k">end select</span>
<a name="ln-3474"></a><span class="k">   if</span><span class="p">(</span><span class="n">G_extract_start</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="s1">&#39;&#39;</span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="n">G_extract_stop</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="n">G_extract</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-3475"></a>
<a name="ln-3476"></a>   <span class="k">call </span><span class="n">get_os_type</span><span class="p">()</span>
<a name="ln-3477"></a>   <span class="k">call </span><span class="n">defines</span><span class="p">()</span>                                          <span class="c">! define named variables declared on the command line</span>
<a name="ln-3478"></a>   <span class="k">call </span><span class="n">includes</span><span class="p">()</span>                                         <span class="c">! define include directories supplies on command line</span>
<a name="ln-3479"></a>   <span class="k">call </span><span class="n">opens</span><span class="p">()</span>                                            <span class="c">! convert input filenames into $include directives</span>
<a name="ln-3480"></a>   <span class="k">call </span><span class="n">auto</span><span class="p">()</span>
<a name="ln-3481"></a>
<a name="ln-3482"></a>   <span class="n">READLINE</span><span class="p">:</span> <span class="k">do</span>                                            <span class="c">! read loop to read input file</span>
<a name="ln-3483"></a>      <span class="k">read</span><span class="p">(</span><span class="n">G_file_dictionary</span><span class="p">(</span><span class="n">G_iocount</span><span class="p">)%</span><span class="n">unit_number</span><span class="p">,</span><span class="s1">&#39;(a)&#39;</span><span class="p">,</span><span class="k">end</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span> <span class="n">line</span>
<a name="ln-3484"></a>      <span class="k">if</span><span class="p">(</span><span class="n">G_extract</span><span class="p">)</span><span class="k">then</span>                       <span class="c">! in extract mode</span>
<a name="ln-3485"></a>         <span class="k">if</span><span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">G_extract_start</span><span class="p">)</span><span class="k">then</span>      <span class="c">! start extracting</span>
<a name="ln-3486"></a>            <span class="n">G_extract_flag</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-3487"></a>            <span class="k">cycle </span><span class="n">READLINE</span>
<a name="ln-3488"></a>         <span class="n">elseif</span><span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="n">eq</span><span class="p">.</span><span class="n">G_extract_stop</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">G_extract_flag</span><span class="p">)</span><span class="k">then</span>   <span class="c">! stop extracting</span>
<a name="ln-3489"></a>            <span class="n">G_extract_flag</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-3490"></a>            <span class="k">cycle </span><span class="n">READLINE</span>
<a name="ln-3491"></a>         <span class="n">elseif</span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">G_extract_flag</span><span class="p">)</span><span class="k">then</span>      <span class="c">! skip if not extracting</span>
<a name="ln-3492"></a>            <span class="k">cycle </span><span class="n">READLINE</span>
<a name="ln-3493"></a>         <span class="k">endif</span>
<a name="ln-3494"></a><span class="k">      endif</span>
<a name="ln-3495"></a>      <span class="c">!TODO! should line count include skipped lines?</span>
<a name="ln-3496"></a>      <span class="n">G_io_total_lines</span><span class="o">=</span><span class="n">G_io_total_lines</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-3497"></a>      <span class="n">G_file_dictionary</span><span class="p">(</span><span class="n">G_iocount</span><span class="p">)%</span><span class="n">line_number</span><span class="o">=</span><span class="n">G_file_dictionary</span><span class="p">(</span><span class="n">G_iocount</span><span class="p">)%</span><span class="n">line_number</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-3498"></a>
<a name="ln-3499"></a>      <span class="k">if</span><span class="p">(</span><span class="n">keeptabs</span><span class="p">)</span><span class="k">then</span>
<a name="ln-3500"></a><span class="k">         </span><span class="n">G_source</span><span class="o">=</span><span class="n">line</span>
<a name="ln-3501"></a>      <span class="k">else</span>
<a name="ln-3502"></a><span class="k">         call </span><span class="n">notabs</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="n">G_source</span><span class="p">,</span><span class="n">ilast</span><span class="p">)</span>                  <span class="c">! expand tab characters and trim trailing ctrl-M from DOS files</span>
<a name="ln-3503"></a>      <span class="k">endif</span>
<a name="ln-3504"></a>
<a name="ln-3505"></a><span class="k">      if</span><span class="p">(</span><span class="n">G_inparcel</span><span class="p">)</span><span class="k">then</span>                                   <span class="c">! do not expand lines stored in a parcel</span>
<a name="ln-3506"></a>      <span class="n">elseif</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">keywords</span><span class="p">).</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="k">then</span>                      <span class="c">! expand variables if any variable is defined, else skip for efficieny</span>
<a name="ln-3507"></a>         <span class="k">call </span><span class="n">expand_variables</span><span class="p">(</span><span class="n">G_source</span><span class="p">)</span>                   <span class="c">! expand ${NAME} strings</span>
<a name="ln-3508"></a>      <span class="k">endif</span>
<a name="ln-3509"></a>
<a name="ln-3510"></a><span class="k">      select case</span> <span class="p">(</span><span class="n">line</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">))</span>                              <span class="c">! special processing for lines starting with &#39;d&#39; or &#39;D&#39;</span>
<a name="ln-3511"></a>      <span class="k">case</span> <span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>
<a name="ln-3512"></a>         <span class="k">select case</span><span class="p">(</span><span class="n">letterd</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-3513"></a>         <span class="k">case</span><span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">)</span>                                         <span class="c">! ignore</span>
<a name="ln-3514"></a>         <span class="k">case</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>                                         <span class="c">! remove</span>
<a name="ln-3515"></a>            <span class="k">cycle</span>
<a name="ln-3516"></a><span class="k">         case</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span>                                     <span class="c">! blank</span>
<a name="ln-3517"></a>            <span class="n">line</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="s1">&#39; &#39;</span>
<a name="ln-3518"></a>         <span class="k">case</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">)</span>                                         <span class="c">! comment</span>
<a name="ln-3519"></a>            <span class="n">line</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="s1">&#39;C&#39;</span>
<a name="ln-3520"></a>         <span class="k">case</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">)</span>                                         <span class="c">! exclamation</span>
<a name="ln-3521"></a>            <span class="n">line</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span><span class="s1">&#39;!&#39;</span>
<a name="ln-3522"></a>         <span class="k">end select</span>
<a name="ln-3523"></a><span class="k">      end select</span>
<a name="ln-3524"></a>
<a name="ln-3525"></a><span class="k">      if</span> <span class="p">(</span><span class="n">line</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">).</span><span class="n">eq</span><span class="p">.</span><span class="n">prefix</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">line</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">).</span><span class="n">ne</span><span class="p">.</span><span class="s1">&#39;{&#39;</span><span class="p">)</span> <span class="k">then</span>   <span class="c">! prefix must be in column 1 for conditional compile directive</span>
<a name="ln-3526"></a>         <span class="k">call </span><span class="n">cond</span><span class="p">()</span>                                       <span class="c">! process directive</span>
<a name="ln-3527"></a>      <span class="n">elseif</span> <span class="p">(</span><span class="n">G_write</span><span class="p">)</span> <span class="k">then</span>                                <span class="c">! if last conditional was true then write line</span>
<a name="ln-3528"></a>         <span class="k">call </span><span class="n">write_out</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">G_source</span><span class="p">))</span>                    <span class="c">! write data line</span>
<a name="ln-3529"></a>      <span class="k">endif</span>
<a name="ln-3530"></a><span class="k">      cycle</span>
<a name="ln-3531"></a>
<a name="ln-3532"></a><span class="mi">7</span>     <span class="k">continue</span>                                                      <span class="c">! end of file encountered on input</span>
<a name="ln-3533"></a>      <span class="k">if</span><span class="p">(</span><span class="n">G_file_dictionary</span><span class="p">(</span><span class="n">G_iocount</span><span class="p">)%</span><span class="n">unit_number</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span><span class="k">then</span>
<a name="ln-3534"></a><span class="k">         inquire</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">G_file_dictionary</span><span class="p">(</span><span class="n">G_iocount</span><span class="p">)%</span><span class="n">unit_number</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">ios</span><span class="p">,</span><span class="n">named</span><span class="o">=</span><span class="n">isscratch</span><span class="p">)</span>
<a name="ln-3535"></a>         <span class="k">if</span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">isscratch</span><span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(</span><span class="n">G_file_dictionary</span><span class="p">(</span><span class="n">G_iocount</span><span class="p">)%</span><span class="n">unit_number</span><span class="p">.</span><span class="n">gt</span><span class="p">.</span><span class="mi">0</span><span class="p">))</span><span class="k">then</span>
<a name="ln-3536"></a><span class="k">            close</span><span class="p">(</span><span class="n">G_file_dictionary</span><span class="p">(</span><span class="n">G_iocount</span><span class="p">)%</span><span class="n">unit_number</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">ios</span><span class="p">)</span>
<a name="ln-3537"></a>         <span class="k">endif</span>
<a name="ln-3538"></a><span class="k">      endif</span>
<a name="ln-3539"></a>
<a name="ln-3540"></a><span class="k">      </span><span class="n">G_iocount</span><span class="o">=</span><span class="n">G_iocount</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-3541"></a>      <span class="k">if</span><span class="p">(</span><span class="n">G_scratch_lun</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="k">then</span>
<a name="ln-3542"></a><span class="k">         </span><span class="n">ios</span><span class="o">=</span><span class="n">filedelete</span><span class="p">(</span><span class="n">G_scratch_file</span><span class="o">//</span><span class="s1">&#39;.out&#39;</span><span class="p">)</span>
<a name="ln-3543"></a>         <span class="n">G_scratch_lun</span><span class="o">=-</span><span class="mi">1</span>
<a name="ln-3544"></a>      <span class="k">endif</span>
<a name="ln-3545"></a>
<a name="ln-3546"></a><span class="k">      if</span><span class="p">(</span><span class="n">G_iocount</span><span class="p">.</span><span class="n">lt</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="k">exit</span>
<a name="ln-3547"></a><span class="k">      call </span><span class="n">auto</span><span class="p">()</span> <span class="c">! if in auto mode determine strings for new file</span>
<a name="ln-3548"></a>
<a name="ln-3549"></a>   <span class="k">enddo </span><span class="n">READLINE</span>
<a name="ln-3550"></a>
<a name="ln-3551"></a>   <span class="k">if</span> <span class="p">(</span><span class="n">G_nestl</span><span class="p">.</span><span class="n">ne</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>                                           <span class="c">! check to make sure all if blocks are closed</span>
<a name="ln-3552"></a>      <span class="k">call </span><span class="n">stop_prep</span><span class="p">(</span><span class="s1">&#39;*prep* ERROR(067) - $IF BLOCK NOT CLOSED.&#39;</span><span class="p">)</span>
<a name="ln-3553"></a>   <span class="k">endif</span>
<a name="ln-3554"></a><span class="k">   call </span><span class="n">print_comment_block</span><span class="p">()</span>
<a name="ln-3555"></a>
<a name="ln-3556"></a>   <span class="k">contains</span>
<a name="ln-3557"></a>
<a name="ln-3558"></a><span class="k">subroutine </span><span class="n">auto</span><span class="p">()</span>
<a name="ln-3559"></a>   <span class="k">if</span><span class="p">(</span><span class="n">G_extract_auto</span><span class="p">)</span><span class="k">then</span>
<a name="ln-3560"></a><span class="k">      select case</span><span class="p">(</span><span class="n">ends_in</span><span class="p">(</span><span class="n">G_file_dictionary</span><span class="p">(</span><span class="n">G_iocount</span><span class="p">)%</span><span class="n">filename</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-3561"></a>      <span class="k">case</span><span class="p">(</span><span class="s1">&#39;md&#39;</span><span class="p">,</span><span class="s1">&#39;.md&#39;</span><span class="p">)</span>
<a name="ln-3562"></a>         <span class="n">G_extract_start</span><span class="o">=</span><span class="s1">&#39;```fortran&#39;</span>
<a name="ln-3563"></a>         <span class="n">G_extract_stop</span><span class="o">=</span><span class="s1">&#39;```&#39;</span>
<a name="ln-3564"></a>      <span class="k">case</span><span class="p">(</span><span class="s1">&#39;tex&#39;</span><span class="p">)</span>
<a name="ln-3565"></a>         <span class="n">G_extract_start</span><span class="o">=</span><span class="s1">&#39;\begin{minted}{Fortran}&#39;</span>
<a name="ln-3566"></a>         <span class="n">G_extract_stop</span><span class="o">=</span><span class="s1">&#39;\end{minted}&#39;</span>
<a name="ln-3567"></a>      <span class="k">case</span><span class="p">(</span><span class="s1">&#39;html&#39;</span><span class="p">,</span><span class="s1">&#39;.html&#39;</span><span class="p">,</span><span class="s1">&#39;htm&#39;</span><span class="p">,</span><span class="s1">&#39;.htm&#39;</span><span class="p">)</span>
<a name="ln-3568"></a>         <span class="n">G_extract_start</span><span class="o">=</span><span class="s1">&#39;&lt;xmp&gt;&#39;</span>
<a name="ln-3569"></a>         <span class="n">G_extract_stop</span><span class="o">=</span><span class="s1">&#39;&lt;/xmp&gt;&#39;</span>
<a name="ln-3570"></a>      <span class="k">case </span><span class="n">default</span>
<a name="ln-3571"></a>         <span class="n">G_extract_start</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">sget</span><span class="p">(</span><span class="s1">&#39;prep_start&#39;</span><span class="p">))</span>
<a name="ln-3572"></a>         <span class="n">G_extract_stop</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">sget</span><span class="p">(</span><span class="s1">&#39;prep_stop&#39;</span><span class="p">))</span>
<a name="ln-3573"></a>      <span class="k">end select</span>
<a name="ln-3574"></a><span class="k">   endif</span>
<a name="ln-3575"></a><span class="k">end subroutine </span><span class="n">auto</span>
<a name="ln-3576"></a>
<a name="ln-3577"></a><span class="k">end program </span><span class="n">prep</span>
<a name="ln-3578"></a><span class="c">!===================================================================================================================================</span>
<a name="ln-3579"></a><span class="c">!()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()()!</span>
<a name="ln-3580"></a><span class="c">!===================================================================================================================================</span>
</pre></div>

    </section>
    </div>
  </div>

  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2022 
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
             on 2022-04-04 18:35  
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> prep was developed by John S. Urban</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>